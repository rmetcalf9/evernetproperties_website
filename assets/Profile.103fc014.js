import{d as h,_ as v,r as g,o as s,K as n,a as t,w as b,aA as P,N as u,c as I,e as i,a7 as c,f as l,ar as d,t as m,M as D,L as M,a8 as p}from"./index.6c102195.js";import{Q as E}from"./QPage.c0f79831.js";import{u as T,a as C}from"./backend_connection.c4a9be6e.js";import{P as S}from"./ProfilePimsDetailForm.e193da7c.js";import"./axios.6e1fcf85.js";const A=h({name:"ProfilePimsDetailDialogComponent",components:{ProfilePimsDetailForm:S},setup(){},data(){return{enterpimsdialog:{visible:!1}}},methods:{launch_dialog(){this.enterpimsdialog.visible=!0;const e=this;setTimeout(function(){e.$refs.ProfilePimsDetailForm.blank_data()},10)},enterpimsdialogclick(){this.enterpimsdialog.visible=!1}}});function $(e,o,r,f,y,k){const _=g("ProfilePimsDetailForm");return s(),n("div",null,[t(P,{modelValue:e.enterpimsdialog.visible,"onUpdate:modelValue":o[0]||(o[0]=a=>e.enterpimsdialog.visible=a),persistent:""},{default:b(()=>[t(_,{ref:"ProfilePimsDetailForm",onProcess_done:e.enterpimsdialogclick,onClick_cancel:e.enterpimsdialogclick},null,8,["onProcess_done","onClick_cancel"])]),_:1},8,["modelValue"])])}var N=v(A,[["render",$]]);const w=h({name:"ProfilePage",setup(){return{backend_connection_store:T()}},components:{ProfilePimsDetailDialog:N},data(){return{}},computed:{isLoggedin(){return this.backend_connection_store.isLoggedin},user_profile(){return this.backend_connection_store.user_profile},pimsverfiylink(){const e=window.location.origin+"/#/v/"+this.user_profile.pims.verify_code+"/"+this.user_profile.pims.number;return"Robert - Please verify my PIMS "+this.user_profile.pims.first_name+"/"+this.user_profile.pims.last_name+" ("+this.user_profile.pims.number+') <a href="'+e+'" target="_new">'+e+"</a>"}},methods:{clickcopypimsverfiylink(){const e=this,o={ok:function(r){u.create({color:"bg-grey-2",message:"Copied text to clipboard "+e.pimsverfiylink,timeout:2e3})},error:function(r){u.create({color:"negative",message:"Copy to clipboard failed",timeout:2e3})}};C.copyTextToClipboard2(this.pimsverfiylink,o)},logout(){this.backend_connection_store.logout(),this.$router.push("/tools")},clickenterpimsinformation(){this.$refs.ProfilePimsDetailDialog.launch_dialog()},pimsinfo(){const e=this;let o="Enter PIMS details",r="Extra site features are available to users who have a verified PIMS membership.";this.user_profile.pims.state==="WAITINGVERIFICATION"&&(o="Change PIMS details"),this.user_profile.pims.state==="VERIFIED"&&(o="Change PIMS details",r="WARNING - you are already a verified PIMS member. Changing the details will result in resetting the verification process. You will <b>temporarily lose access</b> to your projects until you are successfully reverified."),this.$q.dialog({title:"PIMS Membership Details",message:r,html:!0,ok:{push:!0,label:o,color:"secondary"},cancel:{push:!0,label:"Close",color:"primary"}}).onOk(()=>{e.clickenterpimsinformation()})},deleteaccount(){const e=this;this.$q.dialog({title:"Delete Account",message:"Deleting your account will wipe all your user data from our system. This inclues all saved projects. Are you sure? (Type DELETE below to confirm)<br>Account Username: "+this.user_profile.name+"<br>Account Email: "+this.user_profile.email,html:!0,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(o=>{if(o.trim()!=="DELETE"){u.create({color:"red",message:"Failed - You must type DELETE in the text box",timeout:2e3});return}const r={ok:function(f){e.logout(),u.create({color:"bg-grey-2",message:"User account deleted",timeout:2e3})},error:function(f){u.create({color:"bg-grey-2",message:"Account deletion failed "+f,timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/delete",method:"GET",data:o,callback:r})})}},mounted(){this.isLoggedin||this.$router.push("/tools")}}),F={rows:""},L=i("h3",{style:{margin:"0px"}},"User Profile",-1),V={key:0,class:"notice"},R=i("h4",null,"Details",-1),B={class:"section"},z={class:"section"},O={key:0},U=i("div",null,"PIMS Membership details not entered - Extra site features are available to Academy/PIMS members.",-1),x={align:"center"},Q={key:1},G=i("div",null,"PIMS details entered but not verified. To verify please send a message in the Samuel Leeds Academy chat with the following text:",-1),W=["innerHTML"],j={key:2},q=i("div",null,[i("h5",null,"PIMS member")],-1),H={key:3},Y=i("div",null,"Extra site features are available to Academy/PIMS members. PIMS Membership details verification failed",-1),K={align:"center"},J={class:"bottom-buttons"};function X(e,o,r,f,y,k){const _=g("ProfilePimsDetailDialog");return s(),I(E,{class:"flex flex-center"},{default:b(()=>[i("div",F,[L,e.user_profile.pims.state!=="VERIFIED"?(s(),n("div",V,[t(c,{name:"info",size:"md",color:"green"}),l(" Enter and verify your PIMS membership details to activate Property Pipeline Builder early access.")])):d("",!0),R,i("div",B,[i("div",null,"User: "+m(e.user_profile.name),1),i("div",null,"Email: "+m(e.user_profile.email),1),i("div",null,[l("Roles: "),i("ul",null,[(s(!0),n(M,null,D(e.user_profile.roles,a=>(s(),n("div",{key:a},[i("li",null,m(a),1)]))),128))])])]),i("div",z,[i("h4",null,[l("PIMS Membership "),t(p,{round:"",dense:"",flat:"",icon:"info",onClick:e.pimsinfo},null,8,["onClick"])]),e.user_profile.pims.state==="NOTENTERED"?(s(),n("div",O,[U,i("div",x,[t(p,{label:"Enter PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[l("PIMS Membership verified: "),t(c,{name:"cancel",color:"red",size:"32px"})])])):d("",!0),e.user_profile.pims.state==="WAITINGVERIFICATION"?(s(),n("div",Q,[G,i("div",{class:"pimstext",onClick:o[0]||(o[0]=(...a)=>e.clickcopypimsverfiylink&&e.clickcopypimsverfiylink(...a))},[i("div",{innerHTML:e.pimsverfiylink},null,8,W),l("\xA0 "),t(c,{class:"float-right",name:"content_copy",size:"16px"})]),i("div",null,[l("PIMS Membership verified: "),t(c,{name:"cancel",color:"red",size:"32px"})])])):d("",!0),e.user_profile.pims.state==="VERIFIED"?(s(),n("div",j,[q,i("div",null,m(e.user_profile.pims.first_name)+" "+m(e.user_profile.pims.last_name)+" - PIMS number "+m(e.user_profile.pims.number),1),i("div",null,[l("PIMS Membership verified: "),t(c,{name:"check_box",color:"green",size:"32px"})])])):d("",!0),e.user_profile.pims.state==="VERIFICATIONFAILED"?(s(),n("div",H,[Y,i("div",K,[t(p,{label:"Retry entering PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[l("PIMS Membership verified: "),t(c,{name:"cancel",color:"red",size:"32px"})])])):d("",!0)]),i("div",J,[t(p,{class:"bottom-button",onClick:e.logout,color:"secondary",label:"Logout"},null,8,["onClick"]),t(p,{class:"bottom-button",onClick:e.deleteaccount,color:"red",label:"Delete my account"},null,8,["onClick"])])]),t(_,{ref:"ProfilePimsDetailDialog"},null,512)]),_:1})}var se=v(w,[["render",X]]);export{se as default};

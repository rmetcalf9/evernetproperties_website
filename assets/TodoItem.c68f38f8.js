import{q as h,g as v,d as b,_ as k,N as C,r as D,o as i,K as l,e as d,f as m,a as t,w as p,t as _,ar as n,a8 as r,a9 as T,ag as c,an as N,af as g,aB as V,av as w,aA as O,at as S}from"./index.359aadd0.js";import{Q}from"./QTable.7af92238.js";import{C as U}from"./ClosePopup.5e7a0654.js";import{u as j}from"./backend_connection.2a9a2030.js";const A=h("div",{class:"q-space"});var I=v({name:"QSpace",setup(){return()=>A}});const $=[{label:"Call Agent",value:"agent"},{label:"Call Sourcer",value:"sourcer"},{label:"Other",value:"other"}];var f={todo_item_types:$};function B(e,o){const u=Math.abs(e-o);return Math.round(u/864e5)}const E=b({name:"BrrCalcTodoItem",props:{todo:{type:Object,default:void 0},include_project:{type:Boolean,default:!1}},emits:["update_todo_item"],setup(){return{backend_connection_store:j()}},data(){return{dialog_visible:!1,type_options:f.todo_item_types,dialog_data:{description:"",type:"other",group:"",due:"UNCHANGED",loaded_todo:void 0},due_options:[{label:"Unchanged",value:"UNCHANGED"},{label:"1 Day",value:"1"},{label:"3 Days",value:"3"},{label:"5 Days",value:"5"}]}},computed:{get_item_class(){return this.todo.done?"todoitem-tododoneitem todoitem-all":this.todo.due?"todoitem-duetodoitem todoitem-all flex col":"todoitem-todoitem todoitem-all flex col"}},methods:{helpgrouping(){this.$q.dialog({title:"Todo Item Grouping",message:"The grouping field can be left blank. It can be used to group todo items together in displays.",html:!1}).onOk(()=>{})},get_multiline_html(e){return e.replaceAll(`
`,"<br/>")},get_todo_item_type(e){return f.todo_item_types.filter(function(o){return o.value===e})[0].label},due_date_text(e){if(e.due)return"Due by: NOW!";const o=B(new Date,new Date(e.due_date));return o===1?"Due in: "+o+" day":"Due in: "+o+" days"},done_date_text(e){const o=new Date(e),s={weekday:"short",year:"numeric",month:"short",day:"numeric"};return o.toLocaleDateString("en-GB",s)},btn_edit(e){this.dialog_data.description=e.description,this.dialog_data.type=e.type,this.dialog_data.group=e.group,this.dialog_data.due="UNCHANGED",this.dialog_data.loaded_todo=e,this.dialog_visible=!0},click_dialog_ok(){if(this.dialog_data.loaded_todo.description=this.dialog_data.description,this.dialog_data.loaded_todo.type=this.dialog_data.type,this.dialog_data.loaded_todo.group=this.dialog_data.group,this.dialog_data.due!=="UNCHANGED"){const e=parseInt(this.dialog_data.due),o=new Date(new Date().getTime()+e*24*60*60*1e3);this.dialog_data.loaded_todo.due_date=o.toISOString()}this.exec_update_todo_item(this.dialog_data.loaded_todo),this.dialog_visible=!1},btn_mark_done(e){const o=this;this.$q.dialog({title:"Completion Notes",message:"Description: "+e.description+" - Enter notes around completion of this task.",html:!1,ok:{push:!0,label:"Ok",color:"primary"},cancel:{push:!0,label:"Cancel",color:"secondary"},prompt:{model:e.done_text,type:"text"}}).onOk(s=>{e.done_text=s,e.done_date=new Date().toISOString(),e.done=!0,o.exec_update_todo_item(e)})},btn_mark_undone(e){e.done=!1,this.exec_update_todo_item(e)},exec_update_todo_item(e){const o=this,s={ok:function(u){o.$emit("update_todo_item",u.data.todo)},error:function(u){C.create({color:"bg-grey-2",message:u.message,timeout:2e3,color:"negative"})}};o.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e.project_id+"/todos",method:"POST",data:e,callback:s})}}}),G={class:"col-grow"},M={key:0},H={key:1},q=["innerHTML"],L={key:2},P={key:3},R={key:0,class:"todoitem-btn"},Y={key:1,class:"todoitem-btn"},z={key:2},K=d("div",{class:"text-h6"},"Edit Todo Item",-1),W={class:"todoitem-dialogfield"},F={key:0,class:"todoitem-dialogfield col flex"},J={class:"todoitem-dialogfield"},X={class:"todoitem-dialogfield"};function Z(e,o,s,u,x,ee){const y=D("RouterLink");return typeof e.todo!="undefined"?(i(),l("div",{key:0,class:S(e.get_item_class)},[d("div",G,[e.include_project?(i(),l("div",M,[m("Project: "),t(y,{style:{color:"white"},to:"/tools/brrcalc?projectid="+e.todo.project_id},{default:p(()=>[m(_(e.todo.project_name),1)]),_:1},8,["to"])])):n("",!0),d("div",null,"Type: "+_(e.get_todo_item_type(e.todo.type)),1),e.todo.group!==""?(i(),l("div",H,"Group: "+_(e.todo.group),1)):n("",!0),d("div",{innerHTML:e.get_multiline_html(e.todo.description)},null,8,q),d("div",null,_(e.due_date_text(e.todo)),1),e.todo.done?(i(),l("div",L,"Completion Notes: "+_(e.todo.done_text),1)):n("",!0),e.todo.done?(i(),l("div",P,"Date Completed: "+_(e.done_date_text(e.todo.done_date)),1)):n("",!0)]),d("div",null,[e.todo.done?n("",!0):(i(),l("div",R,[t(r,{icon:"edit",round:"",color:"secondary",onClick:o[0]||(o[0]=a=>e.btn_edit(e.todo))})])),e.todo.done?n("",!0):(i(),l("div",Y,[t(r,{icon:"check",round:"",color:"secondary",onClick:o[1]||(o[1]=a=>e.btn_mark_done(e.todo))})])),e.todo.done?(i(),l("div",z,[t(r,{label:"Mark Undone",color:"secondary",onClick:o[2]||(o[2]=a=>e.btn_mark_undone(e.todo))})])):n("",!0)]),t(O,{modelValue:e.dialog_visible,"onUpdate:modelValue":o[8]||(o[8]=a=>e.dialog_visible=a)},{default:p(()=>[t(T,{class:"todoitem-dialogcard"},{default:p(()=>[t(c,{class:"row items-center q-pb-none"},{default:p(()=>[K,t(I),N(t(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[U]])]),_:1}),t(c,null,{default:p(()=>[d("div",null,[d("div",W,[t(Q,{modelValue:e.dialog_data.type,"onUpdate:modelValue":o[3]||(o[3]=a=>e.dialog_data.type=a),options:e.type_options,label:"Type of Task","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e.dialog_data.type==="other"?(i(),l("div",F,[t(g,{modelValue:e.dialog_data.group,"onUpdate:modelValue":o[4]||(o[4]=a=>e.dialog_data.group=a),label:"Grouping",class:"col-grow"},null,8,["modelValue"]),t(r,{round:"",dense:"",flat:"",icon:"info",onClick:e.helpgrouping},null,8,["onClick"])])):n("",!0),d("div",J,[t(g,{modelValue:e.dialog_data.description,"onUpdate:modelValue":o[5]||(o[5]=a=>e.dialog_data.description=a),label:"Description",autogrow:"",rules:[a=>a.trim().length>3||"Minimum 4 characters"],ref:"field_description"},null,8,["modelValue","rules"])]),d("div",X,[m("Due: "),t(V,{modelValue:e.dialog_data.due,"onUpdate:modelValue":o[6]||(o[6]=a=>e.dialog_data.due=a),options:e.due_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),t(w,{align:"right",class:"text-primary"},{default:p(()=>[t(r,{label:"Cancel",onClick:o[7]||(o[7]=a=>this.dialog_visible=!1)}),t(r,{color:"primary",icon:"rule",label:"Ok",onClick:e.click_dialog_ok},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],2)):n("",!0)}var ie=k(E,[["render",Z]]);export{I as Q,ie as T,f as c};

import{_ as g,d as v,N as a,o as n,c as k,w as c,e as i,t as d,f as l,K as p,M as y,L as I,a as o,ae as m,a7 as f,aq as h,af as M,ag as b,ad as _,av as P,an as C,aw as S}from"./index.e6675399.js";import{Q as T}from"./QPage.f035989c.js";import{C as E}from"./ClosePopup.387db500.js";import{u as V}from"./backend_connection.e79794d8.js";import{u as w}from"./utils.5f33790e.js";import"./axios.6e1fcf85.js";const N=v({name:"ProfilePage",setup(){return{backend_connection_store:V()}},components:{},data(){return{enterpimsdialog:{visible:!1,number:"",first_name:"",last_name:""}}},computed:{isLoggedin(){return this.backend_connection_store.isLoggedin},user_profile(){return this.backend_connection_store.user_profile},pimsverfiylink(){const e=window.location.origin+"/#/v/"+this.user_profile.pims.verify_code+"/"+this.user_profile.pims.number;return"Robert - Please verify my PIMS "+this.user_profile.pims.first_name+"/"+this.user_profile.pims.last_name+" ("+this.user_profile.pims.number+') <a href="'+e+'" target="_new">'+e+"</a>"}},methods:{clickcopypimsverfiylink(){const e=this,t={ok:function(u){a.create({color:"bg-grey-2",message:"Copied text to clipboard "+e.pimsverfiylink,timeout:2e3})},error:function(u){a.create({color:"negative",message:"Copy to clipboard failed",timeout:2e3})}};w.copyTextToClipboard2(this.pimsverfiylink,t)},logout(){this.backend_connection_store.logout(),this.$router.push("/tools")},clickenterpimsinformation(){this.enterpimsdialog.number="",this.enterpimsdialog.first_name="",this.enterpimsdialog.last_name="",this.enterpimsdialog.visible=!0},pimsinfo(){const e=this;let t="Enter PIMS details";this.user_profile.pims.state==="WAITINGVERIFICATION"&&(t="Change PIMS details"),this.$q.dialog({title:"PIMS Membership Details",message:"Extra site features are available to users who have a verified PIMS membership.",html:!0,ok:{push:!0,label:t,color:"secondary"},cancel:{push:!0,label:"Close",color:"primary"}}).onOk(()=>{e.clickenterpimsinformation()})},enterpimsdialogclick(){const e=["numberref","first_nameref","last_nameref"];for(const r of e)this.$refs[r].validate();for(const r of e)if(this.$refs[r].hasError)return;const t={number:this.enterpimsdialog.number,first_name:this.enterpimsdialog.first_name,last_name:this.enterpimsdialog.last_name},u={ok:this.submitpimsinfo_success,error:this.submitpimsinfo_fail};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/pimsdetails",method:"POST",data:t,callback:u}),this.enterpimsdialog.visible=!1},submitpimsinfo_success(e){this.backend_connection_store.update_user_profile({user_profile:e.data}),a.create({color:"bg-grey-2",message:"New PIMS details saved - Please request Verification",timeout:2e3})},submitpimsinfo_fail(e){console.log("ERROR failed to update PIMS information ",e),a.create({color:"bg-grey-2",message:"Failed to update PIMS information "+e,timeout:2e3})},deleteaccount(){const e=this;this.$q.dialog({title:"Delete Account",message:"Deleting your account will wipe all your user data from our system. This inclues all saved properties. Are you sure? (Type DELETE below to confirm)",html:!1,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(t=>{if(t.trim()!=="DELETE"){a.create({color:"red",message:"Failed - You must type DELETE in the text box",timeout:2e3});return}const u={ok:function(r){e.logout(),a.create({color:"bg-grey-2",message:"User account deleted",timeout:2e3})},error:function(r){a.create({color:"bg-grey-2",message:"Account deletion failed "+r,timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/delete",method:"GET",data:t,callback:u})})}},mounted(){this.isLoggedin||this.$router.push("/tools")}}),D={rows:""},A=i("h3",{style:{margin:"0px"}},"User Profile",-1),L=i("h4",null,"Details",-1),R={class:"section"},$={class:"section"},F={key:0},Q=i("div",null,"PIMS Membership details not entered - Extra site features are available to Academy/PIMS members.",-1),U={align:"center"},O={key:1},B=i("div",null,"PIMS details entered but not verified. To verify please send a message in the Samuel Leeds Academy chat with the following text:",-1),q=["innerHTML"],z={key:2},x=i("div",null,[i("h5",null,"PIMS member")],-1),G={key:3},H=i("div",null,"Extra site features are available to Academy/PIMS members. PIMS Membership details verification failed",-1),W={align:"center"},Y={class:"bottom-buttons"},K=i("div",{class:"text-h6"},"Your PIMS membership details",-1),j=i("div",null,[l("Details must match what appears on the "),i("a",{href:"https://www.thepims.co.uk/members/",target:"_new"},"PIMS website"),l(".")],-1);function J(e,t,u,r,X,Z){return n(),k(T,{class:"flex flex-center"},{default:c(()=>[i("div",D,[A,L,i("div",R,[i("div",null,"User: "+d(e.user_profile.name),1),i("div",null,"Email: "+d(e.user_profile.email),1),i("div",null,[l("Roles: "),i("ul",null,[(n(!0),p(I,null,y(e.user_profile.roles,s=>(n(),p("div",{key:s},[i("li",null,d(s),1)]))),128))])])]),i("div",$,[i("h4",null,[l("PIMS Membership "),o(m,{round:"",dense:"",flat:"",icon:"info",onClick:e.pimsinfo},null,8,["onClick"])]),e.user_profile.pims.state==="NOTENTERED"?(n(),p("div",F,[Q,i("div",U,[o(m,{label:"Enter PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[l("PIMS Membership verified: "),o(f,{name:"cancel",color:"red",size:"32px"})])])):h("",!0),e.user_profile.pims.state==="WAITINGVERIFICATION"?(n(),p("div",O,[B,i("div",{class:"pimstext",onClick:t[0]||(t[0]=(...s)=>e.clickcopypimsverfiylink&&e.clickcopypimsverfiylink(...s))},[i("div",{innerHTML:e.pimsverfiylink},null,8,q),l("\xA0 "),o(f,{class:"float-right",name:"content_copy",size:"16px"})]),i("div",null,[l("PIMS Membership verified: "),o(f,{name:"cancel",color:"red",size:"32px"})])])):h("",!0),e.user_profile.pims.state==="VERIFIED"?(n(),p("div",z,[x,i("div",null,d(e.user_profile.pims.first_name)+" "+d(e.user_profile.pims.last_name)+" - PIMS number "+d(e.user_profile.pims.number),1),i("div",null,[l("PIMS Membership verified: "),o(f,{name:"check_box",color:"green",size:"32px"})])])):h("",!0),e.user_profile.pims.state==="VERIFICATIONFAILED"?(n(),p("div",G,[H,i("div",W,[o(m,{label:"Retry entering PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[l("PIMS Membership verified: "),o(f,{name:"cancel",color:"red",size:"32px"})])])):h("",!0)]),i("div",Y,[o(m,{class:"bottom-button",onClick:e.logout,color:"secondary",label:"Logout"},null,8,["onClick"]),o(m,{class:"bottom-button",onClick:e.deleteaccount,color:"red",label:"Delete my account"},null,8,["onClick"])])]),o(S,{modelValue:e.enterpimsdialog.visible,"onUpdate:modelValue":t[4]||(t[4]=s=>e.enterpimsdialog.visible=s),persistent:""},{default:c(()=>[o(M,null,{default:c(()=>[o(b,null,{default:c(()=>[K]),_:1}),o(b,{class:"q-pt-none"},{default:c(()=>[j,o(_,{modelValue:e.enterpimsdialog.number,"onUpdate:modelValue":t[1]||(t[1]=s=>e.enterpimsdialog.number=s),label:"PIMS Number",rules:[s=>s.trim().length>4||"Minimum 5 characters",s=>s.trim().match(/^\d+$/)!==null||"Numeric characters only"],ref:"numberref"},null,8,["modelValue","rules"]),o(_,{modelValue:e.enterpimsdialog.first_name,"onUpdate:modelValue":t[2]||(t[2]=s=>e.enterpimsdialog.first_name=s),label:"First Name",rules:[s=>s.trim().length>1||"Minimum 2 characters"],ref:"first_nameref"},null,8,["modelValue","rules"]),o(_,{modelValue:e.enterpimsdialog.last_name,"onUpdate:modelValue":t[3]||(t[3]=s=>e.enterpimsdialog.last_name=s),label:"Last Name",rules:[s=>s.trim().length>1||"Minimum 2 characters"],ref:"last_nameref"},null,8,["modelValue","rules"])]),_:1}),o(P,{align:"right"},{default:c(()=>[C(o(m,{flat:"",label:"Cancel"},null,512),[[E]]),o(m,{flat:"",label:"Submit for Verification",color:"secondary",onClick:e.enterpimsdialogclick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var re=g(N,[["render",J]]);export{re as default};

import{d as y,_ as b,r as k,o as l,K as r,a as t,w as P,aw as D,N as a,e as i,f as u,a8 as p,L as I,M as C,t as d,c as A,a7 as m,ar as _}from"./index.34bbd562.js";import{Q as M}from"./QPage.3a69b903.js";import{u as T,a as E}from"./backend_connection.36a92590.js";import{P as S}from"./ProfilePimsDetailForm.4fa86957.js";import"./axios.6e1fcf85.js";const $=y({name:"ProfilePimsDetailDialogComponent",components:{ProfilePimsDetailForm:S},setup(){},data(){return{enterpimsdialog:{visible:!1}}},methods:{launch_dialog(){this.enterpimsdialog.visible=!0;const e=this;setTimeout(function(){e.$refs.ProfilePimsDetailForm.blank_data()},10)},enterpimsdialogclick(){this.enterpimsdialog.visible=!1}}});function w(e,o,s,c,g,v){const n=k("ProfilePimsDetailForm");return l(),r("div",null,[t(D,{modelValue:e.enterpimsdialog.visible,"onUpdate:modelValue":o[0]||(o[0]=f=>e.enterpimsdialog.visible=f),persistent:""},{default:P(()=>[t(n,{ref:"ProfilePimsDetailForm",onProcess_done:e.enterpimsdialogclick,onClick_cancel:e.enterpimsdialogclick},null,8,["onProcess_done","onClick_cancel"])]),_:1},8,["modelValue"])])}var N=b($,[["render",w]]);const L=y({name:"ProfilePageApiKeys",setup(){return{backend_connection_store:T()}},components:{},data(){return{}},computed:{user_profile(){return this.backend_connection_store.user_profile}},methods:{delete_apikey(e){const o=this,s={ok:o.delapikey_successcallback,error:o.delapikey_failcallback},c={name:e.name};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/apikey",method:"DELETE",data:c,callback:s})},copy_apikey(e){const o={ok:function(s){a.create({color:"bg-grey-2",message:"API key copied to clipboard",timeout:2e3})},error:function(s){a.create({color:"negative",message:"Copy failed",timeout:2e3})}};E.copyTextToClipboard2(e.apikey,o)},expires_string(e){return new Date(e).toDateString()},get_last_used_string(e){return e===""?"Never":"SS"+e},clickhelp(){this.$q.dialog({title:"API Keys",message:"API Keys allow for integrations with other systems.",html:!0}).onOk(()=>{})},addapikey(){const e=this;this.$q.dialog({title:"Create API Key",message:"Enter the name for this API key",html:!1,ok:{push:!0,label:"Ok",color:"primary"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(o=>{if(o.length<1){a.create({color:"negative",message:"You must specify a name for the apikey",timeout:2e3});return}const s={ok:e.addapikey_successcallback,error:e.addapikey_failcallback},c={name:o};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/apikey",method:"POST",data:c,callback:s})})},addapikey_successcallback(e){this.backend_connection_store.update_user_profile({user_profile:e.data.user_profile,then:void 0})},addapikey_failcallback(e){a.create({color:"negative",message:"Api key creation failed - "+e,timeout:2e3})},delapikey_successcallback(e){this.backend_connection_store.update_user_profile({user_profile:e.data.user_profile,then:void 0})},delapikey_failcallback(e){a.create({color:"negative",message:"Api key deletion failed - "+e,timeout:2e3})}}}),F={class:"profileapikeys-main"},V=i("thead",null,[i("tr",null,[i("th",null,"Name"),i("th",null,"Last Used"),i("th",null,"Expires"),i("th")])],-1);function K(e,o,s,c,g,v){return l(),r("div",F,[i("h4",null,[u("API Keys"),t(p,{round:"",dense:"",flat:"",icon:"info",onClick:e.clickhelp},null,8,["onClick"])]),i("table",null,[V,i("tbody",null,[(l(!0),r(I,null,C(e.user_profile.apikeys,n=>(l(),r("tr",{key:n.id},[i("td",null,d(n.name),1),i("td",null,d(e.get_last_used_string(n.last_used)),1),i("td",null,d(e.expires_string(n.expires)),1),i("td",null,[t(p,{round:"",dense:"",flat:"",icon:"content_copy",onClick:f=>e.copy_apikey(n)},null,8,["onClick"]),t(p,{round:"",dense:"",flat:"",icon:"delete",onClick:f=>e.delete_apikey(n)},null,8,["onClick"])])]))),128))])]),t(p,{class:"profileapikeys-bottom-button",onClick:e.addapikey,color:"secondary",label:"Add API Key"},null,8,["onClick"])])}var R=b(L,[["render",K]]);const x=y({name:"ProfilePage",setup(){return{backend_connection_store:T()}},components:{ProfilePimsDetailDialog:N,ProfileApiKeys:R},data(){return{}},computed:{isLoggedin(){return this.backend_connection_store.isLoggedin},user_profile(){return this.backend_connection_store.user_profile},pimsverfiylink(){const e=window.location.origin+"/#/v/"+this.user_profile.pims.verify_code+"/"+this.user_profile.pims.number;return"Robert - Please verify my PIMS "+this.user_profile.pims.first_name+"/"+this.user_profile.pims.last_name+" ("+this.user_profile.pims.number+') <a href="'+e+'" target="_new">'+e+"</a>"}},methods:{clickcopypimsverfiylink(){const e=this,o={ok:function(s){a.create({color:"bg-grey-2",message:"Copied text to clipboard "+e.pimsverfiylink,timeout:2e3})},error:function(s){a.create({color:"negative",message:"Copy to clipboard failed",timeout:2e3})}};E.copyTextToClipboard2(this.pimsverfiylink,o)},logout(){this.backend_connection_store.logout(),this.$router.push("/tools")},clickenterpimsinformation(){this.$refs.ProfilePimsDetailDialog.launch_dialog()},pimsinfo(){const e=this;let o="Enter PIMS details",s="Extra site features are available to users who have a verified PIMS membership.";this.user_profile.pims.state==="WAITINGVERIFICATION"&&(o="Change PIMS details"),this.user_profile.pims.state==="VERIFIED"&&(o="Change PIMS details",s="WARNING - you are already a verified PIMS member. Changing the details will result in resetting the verification process. You will <b>temporarily lose access</b> to your projects until you are successfully reverified."),this.$q.dialog({title:"PIMS Membership Details",message:s,html:!0,ok:{push:!0,label:o,color:"secondary"},cancel:{push:!0,label:"Close",color:"primary"}}).onOk(()=>{e.clickenterpimsinformation()})},deleteaccount(){const e=this;this.$q.dialog({title:"Delete Account",message:"Deleting your account will wipe all your user data from our system. This inclues all saved projects. Are you sure? (Type DELETE below to confirm)<br>Account Username: "+this.user_profile.name+"<br>Account Email: "+this.user_profile.email,html:!0,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(o=>{if(o.trim()!=="DELETE"){a.create({color:"red",message:"Failed - You must type DELETE in the text box",timeout:2e3});return}const s={ok:function(c){e.logout(),a.create({color:"bg-grey-2",message:"User account deleted",timeout:2e3})},error:function(c){a.create({color:"bg-grey-2",message:"Account deletion failed "+c,timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/delete",method:"GET",data:o,callback:s})})}},mounted(){this.isLoggedin||this.$router.push("/tools")}}),O={rows:""},U=i("h3",{style:{margin:"0px"}},"User Profile",-1),B={key:0,class:"notice"},z=i("h4",null,"Details",-1),Q={class:"section"},q={class:"section"},G={key:0},W=i("div",null,"PIMS Membership details not entered - Extra site features are available to Academy/PIMS members.",-1),Y={align:"center"},j={key:1},H=i("div",null,"PIMS details entered but not verified. To verify please send a message in the Samuel Leeds Academy chat with the following text:",-1),J=["innerHTML"],X={key:2},Z=i("div",null,[i("h5",null,"PIMS member")],-1),ee={key:3},ie=i("div",null,"Extra site features are available to Academy/PIMS members. PIMS Membership details verification failed",-1),oe={align:"center"},te={class:"bottom-buttons"};function se(e,o,s,c,g,v){const n=k("ProfileApiKeys"),f=k("ProfilePimsDetailDialog");return l(),A(M,{class:"flex flex-center"},{default:P(()=>[i("div",O,[U,e.user_profile.pims.state!=="VERIFIED"?(l(),r("div",B,[t(m,{name:"info",size:"md",color:"green"}),u(" Enter and verify your PIMS membership details to activate Property Pipeline Builder early access.")])):_("",!0),z,i("div",Q,[i("div",null,"User: "+d(e.user_profile.name),1),i("div",null,"Email: "+d(e.user_profile.email),1),i("div",null,[u("Roles: "),i("ul",null,[(l(!0),r(I,null,C(e.user_profile.roles,h=>(l(),r("div",{key:h},[i("li",null,d(h),1)]))),128))])])]),i("div",q,[i("h4",null,[u("PIMS Membership "),t(p,{round:"",dense:"",flat:"",icon:"info",onClick:e.pimsinfo},null,8,["onClick"])]),e.user_profile.pims.state==="NOTENTERED"?(l(),r("div",G,[W,i("div",Y,[t(p,{label:"Enter PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[u("PIMS Membership verified: "),t(m,{name:"cancel",color:"red",size:"32px"})])])):_("",!0),e.user_profile.pims.state==="WAITINGVERIFICATION"?(l(),r("div",j,[H,i("div",{class:"pimstext",onClick:o[0]||(o[0]=(...h)=>e.clickcopypimsverfiylink&&e.clickcopypimsverfiylink(...h))},[i("div",{innerHTML:e.pimsverfiylink},null,8,J),u("\xA0 "),t(m,{class:"float-right",name:"content_copy",size:"16px"})]),i("div",null,[u("PIMS Membership verified: "),t(m,{name:"cancel",color:"red",size:"32px"})])])):_("",!0),e.user_profile.pims.state==="VERIFIED"?(l(),r("div",X,[Z,i("div",null,d(e.user_profile.pims.first_name)+" "+d(e.user_profile.pims.last_name)+" - PIMS number "+d(e.user_profile.pims.number),1),i("div",null,[u("PIMS Membership verified: "),t(m,{name:"check_box",color:"green",size:"32px"})])])):_("",!0),e.user_profile.pims.state==="VERIFICATIONFAILED"?(l(),r("div",ee,[ie,i("div",oe,[t(p,{label:"Retry entering PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[u("PIMS Membership verified: "),t(m,{name:"cancel",color:"red",size:"32px"})])])):_("",!0),t(n)]),i("div",te,[t(p,{class:"bottom-button",onClick:e.logout,color:"secondary",label:"Logout"},null,8,["onClick"]),t(p,{class:"bottom-button",onClick:e.deleteaccount,color:"red",label:"Delete my account"},null,8,["onClick"])])]),t(f,{ref:"ProfilePimsDetailDialog"},null,512)]),_:1})}var ue=b(x,[["render",se]]);export{ue as default};

import{Q as De}from"./QPage.3d6760a9.js";import{k as p,g as E,i as ee,C as Te,bf as te,q as y,a8 as C,a7 as ae,A as re,u as Q,O as Ae,R as Ve,j as K,al as O,V as we,v as Ge,x as oe,h as W,l as Be,_ as D,o as m,c as q,w as f,a as s,a9 as ne,f as w,an as le,ag as ie,af as Z,av as de,aA as se,N,r as A,K as I,e as B,ar as G,t as Y,d as Me}from"./index.359aadd0.js";import{s as ue,c as U,z as ce}from"./zoom.2619b28f.js";import{a as he,Q as H}from"./QToolbar.81eb0167.js";import{C as pe}from"./ClosePopup.5e7a0654.js";const Pe=["top","right","bottom","left"],fe={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:e=>Pe.includes(e)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function ge(e,t){return{formClass:p(()=>`q-fab--form-${e.square===!0?"square":"rounded"}`),stacked:p(()=>e.externalLabel===!1&&["top","bottom"].includes(e.labelPosition)),labelProps:p(()=>{if(e.externalLabel===!0){const a=e.hideLabel===null?t.value===!1:e.hideLabel;return{action:"push",data:{class:[e.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${e.labelPosition}`+(a===!0?" q-fab__label--external-hidden":"")],style:e.labelStyle}}}return{action:["left","top"].includes(e.labelPosition)?"unshift":"push",data:{class:[e.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${e.labelPosition}`+(e.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:e.labelStyle}}})}}const me={start:"self-end",center:"self-center",end:"self-start"},qe=Object.keys(me);var X=E({name:"QFabAction",props:{...fe,icon:{type:String,default:""},anchor:{type:String,validator:e=>qe.includes(e)},to:[String,Object],replace:Boolean},emits:["click"],setup(e,{slots:t,emit:a}){const r=ee(te,()=>({showing:{value:!0},onChildClick:Te})),{formClass:n,labelProps:o}=ge(e,r.showing),l=p(()=>{const d=me[e.anchor];return n.value+(d!==void 0?` ${d}`:"")}),i=p(()=>e.disable===!0||r.showing.value!==!0);function u(d){r.onChildClick(d),a("click",d)}function h(){const d=[];return t.icon!==void 0?d.push(t.icon()):e.icon!==""&&d.push(y(ae,{name:e.icon})),(e.label!==""||t.label!==void 0)&&d[o.value.action](y("div",o.value.data,t.label!==void 0?t.label():[e.label])),re(t.default,d)}const b=Q();return Object.assign(b.proxy,{click:u}),()=>y(C,{class:l.value,...e,noWrap:!0,stack:e.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:i.value,onClick:u},h)}});const $e=["up","right","down","left"],Le=["left","center","right"];var ze=E({name:"QFab",props:{...fe,...Ae,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{default:null},direction:{type:String,default:"right",validator:e=>$e.includes(e)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:e=>Le.includes(e)}},emits:Ve,setup(e,{slots:t}){const a=K(null),r=K(e.modelValue===!0),n=O(),{proxy:{$q:o}}=Q(),{formClass:l,labelProps:i}=ge(e,r),u=p(()=>e.persistent!==!0),{hide:h,toggle:b}=we({showing:r,hideOnRouteChange:u}),d=p(()=>({opened:r.value})),c=p(()=>`q-fab z-fab row inline justify-center q-fab--align-${e.verticalActionsAlign} ${l.value}`+(r.value===!0?" q-fab--opened":" q-fab--closed")),_=p(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${e.direction} q-fab__actions--${r.value===!0?"opened":"closed"}`),S=p(()=>{const g={id:n,role:"menu"};return r.value!==!0&&(g["aria-hidden"]="true"),g}),k=p(()=>`q-fab__icon-holder  q-fab__icon-holder--${r.value===!0?"opened":"closed"}`);function T(g,L){const z=t[g],V=`q-fab__${g} absolute-full`;return z===void 0?y(ae,{class:V,name:e[L]||o.iconSet.fab[L]}):y("div",{class:V},z(d.value))}function M(){const g=[];return e.hideIcon!==!0&&g.push(y("div",{class:k.value},[T("icon","icon"),T("active-icon","activeIcon")])),(e.label!==""||t.label!==void 0)&&g[i.value.action](y("div",i.value.data,t.label!==void 0?t.label(d.value):[e.label])),re(t.tooltip,g)}return Ge(te,{showing:r,onChildClick(g){h(g),a.value!==null&&a.value.$el.focus()}}),()=>y("div",{class:c.value},[y(C,{ref:a,class:l.value,...e,noWrap:!0,stack:e.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":r.value===!0?"true":"false","aria-haspopup":"true","aria-controls":n,onClick:b},M),y("div",{class:_.value,...S.value},oe(t.default))])}});const Fe={position:{type:String,default:"bottom-right",validator:e=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(e)},offset:{type:Array,validator:e=>e.length===2},expand:Boolean};function Ne(){const{props:e,proxy:{$q:t}}=Q(),a=ee(Be,W);if(a===W)return console.error("QPageSticky needs to be child of QLayout"),W;const r=p(()=>{const d=e.position;return{top:d.indexOf("top")>-1,right:d.indexOf("right")>-1,bottom:d.indexOf("bottom")>-1,left:d.indexOf("left")>-1,vertical:d==="top"||d==="bottom",horizontal:d==="left"||d==="right"}}),n=p(()=>a.header.offset),o=p(()=>a.right.offset),l=p(()=>a.footer.offset),i=p(()=>a.left.offset),u=p(()=>{let d=0,c=0;const _=r.value,S=t.lang.rtl===!0?-1:1;_.top===!0&&n.value!==0?c=`${n.value}px`:_.bottom===!0&&l.value!==0&&(c=`${-l.value}px`),_.left===!0&&i.value!==0?d=`${S*i.value}px`:_.right===!0&&o.value!==0&&(d=`${-S*o.value}px`);const k={transform:`translate(${d}, ${c})`};return e.offset&&(k.margin=`${e.offset[1]}px ${e.offset[0]}px`),_.vertical===!0?(i.value!==0&&(k[t.lang.rtl===!0?"right":"left"]=`${i.value}px`),o.value!==0&&(k[t.lang.rtl===!0?"left":"right"]=`${o.value}px`)):_.horizontal===!0&&(n.value!==0&&(k.top=`${n.value}px`),l.value!==0&&(k.bottom=`${l.value}px`)),k}),h=p(()=>`q-page-sticky row flex-center fixed-${e.position} q-page-sticky--${e.expand===!0?"expand":"shrink"}`);function b(d){const c=oe(d.default);return y("div",{class:h.value,style:u.value},e.expand===!0?c:[y("div",c)])}return{$layout:a,getStickyContent:b}}var Re=E({name:"QPageSticky",props:Fe,setup(e,{slots:t}){const{getStickyContent:a}=Ne();return()=>a(t)}});const We={name:"AddFloorplanDialog",data(){return{visible:!1,floorplan_url:""}},methods:{ok(){this.$refs.urlInput.validate()&&(this.visible=!1,this.$emit("ok",{floorplan_url:this.floorplan_url}))},cancel(){this.visible=!1},launchDialog(){this.okdisabled=!0,this.floorplan_url="";var e=this;e.visible=!0}},computed:{}};function Ue(e,t,a,r,n,o){return m(),q(se,{modelValue:n.visible,"onUpdate:modelValue":t[1]||(t[1]=l=>n.visible=l)},{default:f(()=>[s(ne,null,{default:f(()=>[s(he,null,{default:f(()=>[s(H,null,{default:f(()=>[w("Add Floorplan")]),_:1}),le(s(C,{flat:"",round:"",dense:"",icon:"close"},null,512),[[pe]])]),_:1}),s(ie,null,{default:f(()=>[w(" Enter a web accessible URL for an image of the floorplan "),s(Z,{ref:"urlInput",filled:"",color:"grey",modelValue:n.floorplan_url,"onUpdate:modelValue":t[0]||(t[0]=l=>n.floorplan_url=l),name:"Floorplan Image URL",label:"URL","lazy-rules":"",rules:[l=>l&&l.length>0||"Enter URL"]},null,8,["modelValue","rules"])]),_:1}),s(de,{align:"right"},{default:f(()=>[s(C,{flat:"",label:"OK",color:"black",onClick:o.ok},null,8,["onClick"]),s(C,{flat:"",label:"Cancel",color:"primary",onClick:o.cancel},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var He=D(We,[["render",Ue]]),v={typefloorplan:"floorplan",typeotherarea:"otherarea",otherareaheight:500,backgrounditemwidth:1e3,otherareadata:[{label:"Front Garden",value:"optfg"},{label:"Back Garden",value:"optbg"},{label:"Side",value:"optside"},{label:"Electrics",value:"optelectric"},{label:"Boiler",value:"optboiler"},{label:"Water",value:"optwater"}]};function Ee(){return{background_items:[],node_items:[]}}function Qe({url:e,width:t,height:a}){return{type:v.typefloorplan,url:e,width:t,height:a}}function ve({data:e,item_data:t}){let a=e.background_items.reduce((n,o)=>n=n>o.order?n:o.order,0);const r={id:O(),item_data:t,order:a+1};return e.background_items.push(r),r}function Oe({data:e,item_data:t}){const a={id:O(),item_data:t};return e.node_items.push(a),a}function be({data:e}){var t=e.background_items.filter(function(a){return a.item_data.type===v.typeotherarea});if(t.length!==0)return t[0]}function Ze({data:e}){var t=be({data:e});return typeof t=="undefined"?[]:t.item_data.selection}function Je({data:e,selection:t}){var a=be({data:e});if(typeof a=="undefined"){ve({data:e,item_data:{type:v.typeotherarea,selection:t,height:v.otherareaheight,width:v.backgrounditemwidth}});return}a.item_data.selection=t}function Ke({data:e,nodeid:t}){const a=e.node_items.filter(function(r){return r.id===t});if(a.length===1)return a[0]}function Ye({data:e,nodeid:t}){e.node_items=e.node_items.filter(function(a){return a.id!==t})}var x={getNewlyCreatedDataSet:Ee,addBackgroundItem:ve,getBackgroudnItemJson_Floorplan:Qe,getSelectedOtherAreas:Ze,setSelectedOtherAreas:Je,addNodeItem:Oe,getNodeFromId:Ke,deleteNodeFromId:Ye};function Xe({parentele:e,item:t,title:a,x:r,y:n,oadata:o}){e.append("rect").attr("width",t.item_data.width/3).attr("height",t.item_data.height/2-100).attr("x",r).attr("y",n+50).attr("style","fill: white;stroke-width:1;stroke:rgb(0,0,0)"),e.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("x",r+t.item_data.width/(2*3)).attr("y",n+30+50).attr("style","font-size: 20px; font-weight: 800;").text(l=>o.label)}function je({backgroudnitem_group:e,allzoomedelements:t,thencall:a}){var r=ue(".backgroudnitemDrawing_otherAreaGroup"),n=e.filter(function(l){return l.item_data.type===v.typeotherarea});if(r.size()===0){J({item:n[0],backgroudnitem_group:e,allzoomedelements:t,thencall:a});return}var o=r.node().getBBox().y;r.remove(),_e({allzoomedelements:t,item:n[0],ypos:o})}function _e({allzoomedelements:e,item:t,ypos:a}){var r=0,n=0,o=e.append("g");o.attr("class","backgroudnitemDrawing_otherAreaGroup");var l=0;v.otherareadata.map(function(i){t.item_data.selection.includes(v.otherareadata[l].value)&&Xe({parentele:o,item:t,title:i.label,x:-550+r*(t.item_data.width/3),y:a+n*(t.item_data.height/2),oadata:v.otherareadata[l]}),l+=1,r+=1,r>2&&(r=0,n=1)})}function J({item:e,backgroudnitem_group:t,allzoomedelements:a,thencall:r}){let n=t.reduce((i,u)=>u.order<e.order?i=i+u.item_data.height:i,0);if(e.item_data.type===v.typefloorplan){var o=a.append("svg:image").attr("href",e.item_data.url).attr("width",e.item_data.width).attr("x",-550).attr("y",n).on("error",function(i){console.log("load image ",e.item_data.url," failed",i),console.log("error message ",i.message),console.log("error message ",i.target.error.message),console.log("allzoomedelements",a),N.create({color:"bg-grey-2",message:"Failed to load image",timeout:2})}),l=function(){setTimeout(function(){if(o.node().getBBox().height===0){l();return}e.item_data.height=o.node().getBBox().height,r()},5)};l();return}if(e.item_data.type===v.typeotherarea){_e({allzoomedelements:a,item:e,ypos:n}),r();return}console.log("Error invalid backgroudn item type",e),r()}function ke(e,t,a,r){if(e.length===0){r();return}J({item:e[0],backgroudnitem_group:t,allzoomedelements:a,thencall:function(){e.shift(),ke(e,t,a,r)}})}function et({backgroudnitem_group:e,allzoomedelements:t,thencall:a}){e.sort((n,o)=>n.order-o.order);var r=e.map(function(n){return n});ke(r,e,t,a)}var F={drawSingleItem:J,drawAllBackgroundItems:et,redrawOtherArea:je};const tt={name:"ChartComponent",components:{addFloorplanDialog:He},props:["refurbData"],data(){return{allzoomedelements:void 0,boudaryRect:void 0,svg:void 0,background_item_group:void 0,chartarea:{xmin:-650,xmax:650,ymin:-150,ymax:800}}},methods:{onClickAddOtherAreas(){var e=x.getSelectedOtherAreas({data:this.refurbData});this.$q.dialog({title:"Options",message:"Select other areas to add to plans:",options:{type:"checkbox",model:e,items:v.otherareadata},cancel:!0,persistent:!0}).onOk(t=>{x.setSelectedOtherAreas({data:this.refurbData,selection:t}),F.redrawOtherArea({backgroudnitem_group:this.refurbData.background_items,allzoomedelements:this.background_item_group,thencall:this.updatechartsize})}).onCancel(()=>{}).onDismiss(()=>{})},onClickAddFloorplan(){this.$refs.addFloorplanDialog.launchDialog()},onDialogCompleteAddFloorplan(e){e.floorplan_url="https://lh3.googleusercontent.com/pw/ABLVV8715kFOUDZGlx6NcwSx-EGUnYGl_7sLJ5T-QHVLTm0ojxZ04GzAyUnwnCORsc34bM5wOiSNnj1PVVhTlxKE-hb8gUw5hMtFH5-6xUymqPObqtQx6dS-Of8tSnFUNGYrPG_d9TzkJqUce4Gtj7dCeJlFQQ=w987-h755-s-no-gm?authuser=0";const t=x.addBackgroundItem({data:this.refurbData,item_data:x.getBackgroudnItemJson_Floorplan({url:e.floorplan_url,width:v.backgrounditemwidth,height:0})});F.drawSingleItem({item:t,backgroudnitem_group:this.refurbData.background_items,allzoomedelements:this.background_item_group,thencall:this.updatechartsize})},clickDIV(){},updatechartsize(){let e=this.refurbData.background_items.reduce((t,a)=>t=t+a.item_data.height,0);this.boudaryRect.attr("height",e+200)},initChart(){for(var e=this,t=function(r){var n=800,o=800;r.svg=U("svg").attr("style","border: 1px solid black;position:fixed; top:0; left:0; height:100%; width:100%").attr("viewBox",[-n/2,-o/2,n,o]).attr("oncontextmenu","return false;"),r.allzoomedelements=r.svg.append("g"),e.boudaryRect=r.allzoomedelements.append("rect").attr("width",r.chartarea.xmax-r.chartarea.xmin).attr("height",r.chartarea.ymax-r.chartarea.ymin).attr("x",r.chartarea.xmin).attr("y",r.chartarea.ymin).attr("style","fill: white;stroke-width:3;stroke:rgb(0,0,0)"),r.svg.call(ce().extent([[0,0],[n,o]]).scaleExtent([-5,10]).on("zoom",l)),r.svg.on("dblclick.zoom",null);function l(i,u){r.allzoomedelements.attr("transform",i.transform)}return r.allzoomedelements.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("x",0).attr("y",-70).attr("style","font-size: 40px; font-weight: 800;").text(i=>"Setup Plans"),e.background_item_group=r.allzoomedelements.append("g"),F.drawAllBackgroundItems({backgroudnitem_group:e.refurbData.background_items,allzoomedelements:e.background_item_group,thencall:e.updatechartsize}),r.svg.node()},a=document.getElementById("chartInsetionPoint_adsdsa");a.firstChild;)console.log("Removing old SVG"),a.removeChild(a.firstChild);a.appendChild(t(this))}},mounted(){this.initChart()},unmounted(){}};function at(e,t,a,r,n,o){const l=A("addFloorplanDialog");return m(),I("div",null,[B("div",{id:"chartInsetionPoint_adsdsa",onClick:t[0]||(t[0]=i=>o.clickDIV(i))}),s(Re,{position:"bottom-right",offset:[18,18]},{default:f(()=>[s(ze,{color:"grey",icon:"keyboard_arrow_up",direction:"up","vertical-actions-align":"right"},{default:f(()=>[s(X,{color:"grey",onClick:o.onClickAddFloorplan,icon:"add",label:"Add floorplan"},null,8,["onClick"]),s(X,{color:"grey",onClick:o.onClickAddOtherAreas,icon:"add",label:"Add other areas"},null,8,["onClick"])]),_:1})]),_:1}),s(l,{ref:"addFloorplanDialog",onOk:o.onDialogCompleteAddFloorplan,refurbData:a.refurbData},null,8,["onOk","refurbData"])])}var rt=D(tt,[["render",at]]);const ot={name:"AddWorkitemDialog",data(){return{visible:!1,editMode:!1,description:"",nodeid:void 0,nodeCords:void 0}},methods:{deletee(){this.visible=!1,this.$emit("deletee",{nodeid:this.nodeid})},ok(){if(this.$refs.urlInput.validate()){this.visible=!1;let e={type:"WORK",cords:this.nodeCords,description:this.description,nodeid:this.nodeid};this.$emit("ok",{editMode:this.editMode,node:e})}},cancel(){this.visible=!1},launchDialog(e,t,a,r){this.nodeCords=e,this.editMode=t,this.okdisabled=!0,t?(this.description=a,this.nodeid=r):this.description="";var n=this;n.visible=!0}},computed:{}};function nt(e,t,a,r,n,o){return m(),q(se,{modelValue:n.visible,"onUpdate:modelValue":t[1]||(t[1]=l=>n.visible=l)},{default:f(()=>[s(ne,null,{default:f(()=>[s(he,null,{default:f(()=>[n.editMode?G("",!0):(m(),q(H,{key:0},{default:f(()=>[w("Add Work item")]),_:1})),n.editMode?(m(),q(H,{key:1},{default:f(()=>[w("Edit Work item")]),_:1})):G("",!0),n.editMode?(m(),q(C,{key:2,flat:"",round:"",dense:"",icon:"delete",onClick:o.deletee},null,8,["onClick"])):G("",!0),le(s(C,{flat:"",round:"",dense:"",icon:"close"},null,512),[[pe]])]),_:1}),s(ie,null,{default:f(()=>[w(" Enter description of work "),s(Z,{ref:"urlInput",filled:"",color:"grey",modelValue:n.description,"onUpdate:modelValue":t[0]||(t[0]=l=>n.description=l),name:"Description of work",label:"Description","lazy-rules":"",rules:[l=>l&&l.length>0||"Enter description of work to be done"]},null,8,["modelValue","rules"])]),_:1}),s(de,{align:"right"},{default:f(()=>[s(C,{flat:"",label:"OK",color:"black",onClick:o.ok},null,8,["onClick"]),s(C,{flat:"",label:"Cancel",color:"primary",onClick:o.cancel},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var lt=D(ot,[["render",nt]]);function it({rootGroup:e}){var t=e.append("g").attr("transform","rotate( 40 ) scale( 3 3 ) translate( -12 -12)");return t.append("path").attr("d","M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"),t}function dt({rootGroup:e}){var t=e.append("g").attr("transform","scale( 2.2 2.2 ) translate( -12 -12)");return t.append("path").attr("d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),t.append("path").attr("d","M0 0h24v24H0z").attr("fill","none"),t}function st({rootGroup:e}){var t=e.append("g").attr("transform","scale( 2.2 2.2 ) translate( -12 -12)");return t.append("path").attr("d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"),t.append("path").attr("d","M0 0h24v24H0z").attr("fill","none"),t}function ut({rootGroup:e}){var t=e.append("g").attr("transform","rotate( 40 ) translate( 0 -12)");return t.append("path").attr("d","M 0 0 L 0 24 L 24 24 L 24 0 L 0 0").attr("style","stroke:rgb(0,0,0);stroke-width:2"),t.append("path").attr("d","M 0 0 L 0 24 L -24 24 L -24 0 L 0 0").attr("fill","none").attr("style","stroke:rgb(0,0,0);stroke-width:2"),t}function ct({rootGroup:e}){var t=e.append("g").attr("transform","scale( 2.8 2.8 ) translate( -12 -12)");return t.append("path").attr("d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"),t.append("path").attr("d","M0 0h24v24H0z").attr("fill","none"),t}function ht({rootGroup:e}){var t=e.append("g").attr("transform","scale( 2.8 2.8 ) translate( -12 -12)");return t.append("path").attr("d","M12 10c-3.86 0-7 3.14-7 7h2c0-2.76 2.24-5 5-5s5 2.24 5 5h2c0-3.86-3.14-7-7-7zm0-4C5.93 6 1 10.93 1 17h2c0-4.96 4.04-9 9-9s9 4.04 9 9h2c0-6.07-4.93-11-11-11z"),t}function pt({rootGroup:e}){var t=e.append("g").attr("transform","scale( 0.05 0.05 ) translate( -300 500)");return t.append("path").attr("d","M440-440ZM120-120q-33 0-56.5-23.5T40-200v-480q0-33 23.5-56.5T120-760h126l74-80h240v80H355l-73 80H120v480h640v-360h80v360q0 33-23.5 56.5T760-120H120Zm640-560v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80ZM440-260q75 0 127.5-52.5T620-440q0-75-52.5-127.5T440-620q-75 0-127.5 52.5T260-440q0 75 52.5 127.5T440-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29Z"),t}function ft({rootGroup:e}){var t=e.append("g").attr("transform","scale( 0.05 0.05 ) translate( -300 500)");return t.append("path").attr("d","M480-260q75 0 127.5-52.5T660-440q0-75-52.5-127.5T480-620q-75 0-127.5 52.5T300-440q0 75 52.5 127.5T480-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM160-120q-33 0-56.5-23.5T80-200v-480q0-33 23.5-56.5T160-760h126l74-80h240l74 80h126q33 0 56.5 23.5T880-680v480q0 33-23.5 56.5T800-120H160Zm0-80h640v-480H638l-73-80H395l-73 80H160v480Zm320-240Z"),t}function gt({rootGroup:e}){var t=e.append("g").attr("transform","scale( 0.05 0.05 ) translate( -300 500)");return t.append("path").attr("d","M756-120 537-339l84-84 219 219-84 84Zm-552 0-84-84 276-276-68-68-28 28-51-51v82l-28 28-121-121 28-28h82l-50-50 142-142q20-20 43-29t47-9q24 0 47 9t43 29l-92 92 50 50-28 28 68 68 90-90q-4-11-6.5-23t-2.5-24q0-59 40.5-99.5T701-841q15 0 28.5 3t27.5 9l-99 99 72 72 99-99q7 14 9.5 27.5T841-701q0 59-40.5 99.5T701-561q-12 0-24-2t-23-7L204-120Z"),t}function mt({rootGroup:e}){var t=14,a=3,r=24,n=10,o=5,l=[0,-r],i=[-t,0],u=[t,0],h=[-a,-o],b=[a,-o],d=[-a,n+o],c=[a,n+o],_=[["L",...h],["L",...d],["L",...c],["L",...b]],S=[["M",...l],["L",...i],..._,["L",...u],["L",...l]],k=S.reduce(function(M,g,L,z){return g.reduce(function(V,R,Ie,Se){return V+R+" "},M)},""),T=e.append("g").attr("transform","rotate( -30 ) translate( 0 5)");return T.append("path").attr("d",k).attr("style","stroke:rgb(0,0,0);stroke-width:2"),T}var $={getSVGMaterialIconLink:it,getSVGMaterialIconDelete:dt,getSVGMaterialIconEdit:st,getSVGRJMIconEraser:ut,getSVGRJMIconPointer:mt,getSVGMaterialIconAdd:ct,getSVGMaterialIconLooks:ht,getSVGMaterialAddAPhoto:pt,getSVGMaterialConstruction:gt,getSVGMaterialPhotoCamera:ft};function ye({rootGroup:e,x:t,y:a,nodeid:r,iconFn:n,transform:o}){const l=[r];let i=e.append("g").attr("transform","translate( "+t+" "+a+")").attr("class","nodeitem").data(l).attr("id",function(h){return"_"+h});i.append("circle").attr("r",20).attr("style","fill: lightblue;");let u=i.append("g").attr("transform",o);n({rootGroup:u})}function vt({rootGroup:e,nodeid:t}){var a=e.select("#_"+t);a.remove()}function bt({rootGroup:e,x:t,y:a,nodeid:r}){return ye({rootGroup:e,x:t,y:a,nodeid:r,iconFn:$.getSVGMaterialPhotoCamera,transform:"translate( -4 0) scale(0.5 0.5)"})}function _t({rootGroup:e,x:t,y:a,nodeid:r}){return ye({rootGroup:e,x:t,y:a,nodeid:r,iconFn:$.getSVGMaterialConstruction,transform:"translate( -4 0) scale(0.5 0.5)"})}function Ce({node:e,allbackgroudnitems:t,rootGroup:a,thencall:r}){const n=xe({nodecords:e.item_data.cords,allbackgroudnitems:t});e.type==="PICTURE"?bt({rootGroup:a,x:n.x,y:n.y,nodeid:e.id}):_t({rootGroup:a,x:n.x,y:n.y,nodeid:e.id})}function kt({rootGroup:e,allnodes:t,allbackgroudnitems:a,thencall:r}){let n=0;for(;n<t.length;)Ce({node:t[n],allbackgroudnitems:a,rootGroup:e,thencall:r}),n++}function xe({nodecords:e,allbackgroudnitems:t}){let a=0,r=0;for(;r<t.length;){if(e.backgrounditem===t[r].id)return{x:e.x,y:e.y+a};a+=t[r].item_data.height,r++}return{x:e.x,y:e.y}}function yt({svgcords:e,allbackgroudnitems:t}){let a=0,r=t[0].id,n=0,o=0;for(;o<t.length&&(r=t[o].id,a+=t[o].item_data.height,!(e.y<a));)n=a,o++;return{backgrounditem:r,x:e.x,y:e.y-n}}var P={drawAllNodes:kt,drawSingleNode:Ce,getSvgCordsFromNodeCords:xe,getNodeCordsFromSVGCords:yt,removeNodeById:vt};function j({leftX:e,rightX:t,panelHeight:a,isTopLeftCurved:r,isTopRightCurved:n,panelCurveWidth:o,panelCurveHeight:l,includeBottomLine:i}){var u=[e,0],h=[t,0],b=[e,-a],d=[t,-a],c=[];if(i?c.push(["M",...h]):(c.push(["M",...u]),c.push(["L",...h])),n){var _=[t,l-a],S=[t-o,-a];c.push(["L",..._]),c.push(["A",o,l,0,0,0,...S])}else c.push(["L",...d]);if(r){var k=[e,l-a],T=[e+o,-a];c.push(["L",...T]),c.push(["A",o,l,0,0,0,...k])}else c.push(["L",...b]);return c.push(["L",...u]),c.reduce(function(M,g,L,z){return g.reduce(function(V,R,Ie,Se){return V+R+" "},M)},"")}const Ct={name:"SVGPanel",props:{selectedCell:{type:Number,default:0}},data(){return{rootGroup:void 0,cellBackgroundArray:void 0,cellDrawArray:void 0,numCells:void 0,cellWidth:150,panelHeight:70,panelCurveWidth:50,panelCurveHeight:50,cellDivideLineYGap:10,includeBottomLineInMainPanel:!0,cellIconSVGArray:[]}},methods:{render({rootGroup:e,cellArray:t}){var a=this;this.numCells=t.length,this.rootGroup=e.append("g"),this.rootGroup.attr("style","pointer-events: auto;"),this.cellBackgroundArray=t.map(function(r,n,o){return a.cellIconSVGArray.push({title:r.title}),a.renderCellBackgroundAndReturnUpdateObj({cellNumber:n,selected:n===a.selectedCell,render:r.render})}),this.renderPanelOutline(),this.renderCellsAndSeperators()},renderCellsAndSeperators(){var e=this;this.cellBackgroundArray.map(function(t,a,r){var n=-(e.cellWidth*e.numCells)/2+e.cellWidth*a;a!==0&&e.rootGroup.append("line").attr("x1",n).attr("y1",-e.cellDivideLineYGap).attr("x2",n).attr("y2",e.cellDivideLineYGap-e.panelHeight).attr("style","stroke:rgb(0,0,0);stroke-width:2"),e.cellIconSVGArray[a]=t.g.append("g").attr("transform","translate("+(n+e.cellWidth/2)+" "+-(e.panelHeight/2)+")"),typeof t.render!="undefined"&&t.render({rootGroup:e.cellIconSVGArray[a]})})},renderPanelOutline(){this.rootGroup.append("path").attr("d",j({leftX:-(this.numCells*this.cellWidth)/2,rightX:this.numCells*this.cellWidth/2,panelHeight:this.panelHeight,isTopLeftCurved:!0,isTopRightCurved:!0,panelCurveWidth:this.panelCurveWidth,panelCurveHeight:this.panelCurveHeight,includeBottomLine:this.includeBottomLineInMainPanel})).attr("stroke","black").attr("stroke-width",5).attr("stroke-linecap","square").attr("fill","none")},getColor({selected:e}){return e?"grey":"lightgrey"},renderCellBackgroundAndReturnUpdateObj({cellNumber:e,selected:t,render:a}){var r=this,n=e*this.cellWidth-this.numCells*this.cellWidth/2,o=e,l=this.rootGroup.append("g").on("click",function(u,h){r.$emit("selectedCell",o)}),i=l.append("path").attr("d",j({leftX:n,rightX:n+this.cellWidth,panelHeight:this.panelHeight,isTopLeftCurved:e===0,isTopRightCurved:e===this.numCells-1,panelCurveWidth:this.panelCurveWidth,panelCurveHeight:this.panelCurveHeight,includeBottomLine:!0})).attr("fill",this.getColor({selected:t}));return typeof r.cellIconSVGArray[e].title!="undefined"&&l.append("title").text(r.cellIconSVGArray[e].title),{updateFn:function({selected:u}){i.attr("fill",r.getColor({selected:u}))},g:l,render:a}},rerenderIcon({index:e,newRenderFunction:t}){var a=this;a.cellIconSVGArray[e].selectAll("*").remove(),typeof t!="undefined"&&t({rootGroup:a.cellIconSVGArray[e]})}},watch:{selectedCell:function(e,t){this.cellBackgroundArray[t].updateFn({selected:t===this.selectedCell}),this.cellBackgroundArray[e].updateFn({selected:e===this.selectedCell})}}};function xt(e,t,a,r,n,o){return m(),I("div")}var It=D(Ct,[["render",xt]]);const St={name:"UserInterfaceSVGBottomToolbarMain",components:{svgPanel:It},props:[],data(){return{selectedPanelItem:0,cells:[{render:$.getSVGRJMIconPointer,inputMode:"POINTER",title:"Pointer mode - use to pan around"},{render:$.getSVGMaterialAddAPhoto,inputMode:"ADDPHOTO",title:"Photo mode - use to add photos to plan"},{render:$.getSVGMaterialConstruction,inputMode:"ADDWORKITEM",title:"Work item mode - use to add work items to plan"}]}},methods:{getCurrentInputMode(){return this.cells[this.selectedPanelItem].inputMode},setCurrentInputMode(e){let t=0;for(;t<this.cells.length;)this.cells[t].inputMode===e&&(this.selectedPanelItem=t),t++},toolbarClickItem(e){this.selectedPanelItem=e},render(e){var t=this,a=this.$refs.svgPanel.render({rootGroup:e.rootGroup,cellArray:t.cells});return a},activateSubscriptions(){},destroyed(){}}};function Dt(e,t,a,r,n,o){const l=A("svgPanel");return m(),I("div",null,[s(l,{ref:"svgPanel",selectedCell:n.selectedPanelItem,onSelectedCell:t[0]||(t[0]=i=>o.toolbarClickItem(i))},null,8,["selectedCell"])])}var Tt=D(St,[["render",Dt]]);const At={name:"ViewingChartComponent",components:{svgBottomToolbar:Tt,workitemDialog:lt},props:["refurbData"],data(){return{allzoomedelements:void 0,boudaryRect:void 0,svg:void 0,panelsvg:void 0,background_item_group:void 0,node_group:void 0,chartarea:{xmin:-650,xmax:650,ymin:-150,ymax:800}}},methods:{clickDIV(){},UIInputClickNode(e,t){const a=ue(e.srcElement.closest(".nodeitem")).data()[0],r=x.getNodeFromId({data:this.refurbData,nodeid:a});if(r.item_data.type==="WORK"){this.editWorkItem(r),event.preventDefault();return}},UIInputZoomedBackgroundClick(e,t){var a=this.svg.node(),r=a.createSVGPoint();r.x=event.clientX,r.y=event.clientY,r=r.matrixTransform(this.allzoomedelements.node().getCTM().inverse());const n=P.getNodeCordsFromSVGCords({svgcords:r,allbackgroudnitems:this.refurbData.background_items});P.getSvgCordsFromNodeCords({nodecords:n,allbackgroudnitems:this.refurbData.background_items});const o=this.$refs.svgBottomToolbar.getCurrentInputMode();o==="ADDWORKITEM"?this.addWorkItem(n):o==="ADDPHOTO"&&this.addPhoto(n),event.preventDefault()},editWorkItem(e){this.$refs.workitemDialog.launchDialog(e.item_data.cords,!0,e.item_data.description,e.id)},addWorkItem(e){this.$refs.workitemDialog.launchDialog(e,!1)},onDialogCompleteWorkitemDialogDeletee({nodeid:e}){P.removeNodeById({rootGroup:this.node_group,nodeid:e}),x.deleteNodeFromId({data:this.refurbData,nodeid:e})},onDialogCompleteWorkitemDialog({editMode:e,node:t}){if(e){const a=x.getNodeFromId({data:this.refurbData,nodeid:t.nodeid});a.item_data.description=t.description}else{const a=x.addNodeItem({data:this.refurbData,item_data:t});P.drawSingleNode({node:a,allbackgroudnitems:this.refurbData.background_items,rootGroup:this.node_group,thencall:void 0}),this.$refs.svgBottomToolbar.setCurrentInputMode("POINTER")}},addPhoto(e){console.log("TODO addPhoto")},updatechartsize(){let e=this.refurbData.background_items.reduce((t,a)=>t=t+a.item_data.height,0);this.boudaryRect.attr("height",e+200)},initChart(){for(var e=this,t=function(o){e.refurbData.background_items.sort((h,b)=>h.order-b.order);var l=800,i=800;o.svg=U("svg").attr("style","border: 1px solid black;position:fixed; top:0; left:0; height:100%; width:100%").attr("viewBox",[-l/2,-i/2,l,i]).attr("oncontextmenu","return false;"),o.panelsvg=U("svg").attr("style","position:fixed; top:0; left:0; height:100%; width:100%; pointer-events: none;").attr("viewBox",[-50,0,100,800]).attr("oncontextmenu","return false;"),o.allzoomedelements=o.svg.append("g"),e.boudaryRect=o.allzoomedelements.append("rect").attr("width",o.chartarea.xmax-o.chartarea.xmin).attr("height",o.chartarea.ymax-o.chartarea.ymin).attr("x",o.chartarea.xmin).attr("y",o.chartarea.ymin).attr("style","fill: white;stroke-width:3;stroke:rgb(0,0,0)").on("contextmenu",o.UIInputZoomedBackgroundContextMenu).on("dblclick",o.UIInputZoomedBackgroundDoubleClick).on("click",o.UIInputZoomedBackgroundClick),o.svg.call(ce().extent([[0,0],[l,i]]).scaleExtent([-5,10]).on("zoom",u)),o.svg.on("dblclick.zoom",null);function u(h,b){o.allzoomedelements.attr("transform",h.transform)}return o.allzoomedelements.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("x",0).attr("y",-70).attr("style","font-size: 40px; font-weight: 800;").text(h=>"Input Viewing Data").on("click",o.UIInputZoomedBackgroundClick),e.background_item_group=o.allzoomedelements.append("g"),e.background_item_group.on("click",o.UIInputZoomedBackgroundClick),F.drawAllBackgroundItems({backgroudnitem_group:e.refurbData.background_items,allzoomedelements:e.background_item_group,thencall:e.updatechartsize}),e.node_group=o.allzoomedelements.append("g").on("click",o.UIInputClickNode),P.drawAllNodes({rootGroup:e.node_group,allnodes:e.refurbData.node_items,allbackgroudnitems:e.refurbData.background_items}),o.svg.node()},a=document.getElementById("chartInsetionPoint_adsdsa");a.firstChild;)console.log("Removing old SVG"),a.removeChild(a.firstChild);a.appendChild(t(this));for(var r=document.getElementById("chartInsetionPointPanel_adsdsa");r.firstChild;)console.log("Removing old SVG2"),r.removeChild(r.firstChild);r.appendChild(this.panelsvg.node());var n=this.panelsvg.append("g").attr("transform","translate( 0 780) scale( 0.5 0.5 ) ");this.$refs.svgBottomToolbar.render({rootGroup:n})}},mounted(){this.initChart()},unmounted(){}},Vt=B("div",{id:"chartInsetionPointPanel_adsdsa"},null,-1);function wt(e,t,a,r,n,o){const l=A("svgBottomToolbar"),i=A("workitemDialog");return m(),I("div",null,[B("div",{id:"chartInsetionPoint_adsdsa",onClick:t[0]||(t[0]=u=>o.clickDIV(u))}),Vt,s(l,{ref:"svgBottomToolbar"},null,512),s(i,{ref:"workitemDialog",onOk:o.onDialogCompleteWorkitemDialog,onDeletee:o.onDialogCompleteWorkitemDialogDeletee},null,8,["onOk","onDeletee"])])}var Gt=D(At,[["render",wt]]);function Bt(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{var a=document.execCommand("copy"),r=a?"successful":"unsuccessful";console.log("Fallback: Copying text command was "+r)}catch(n){Notify.create("Fallback: Oops, unable to copy"+n)}document.body.removeChild(t)}function Mt(e,t){if(!navigator.clipboard){Bt(e);return}navigator.clipboard.writeText(e).then(function(){t.ok()},function(a){t.error("Copy Failed: "+a)})}var Pt={copyTextToClipboard:Mt};const qt={name:"JsonComponent",props:["modelValue"],emits:["update:modelValue"],computed:{value:{get(){return JSON.stringify(this.modelValue)},set(e){this.$emit("update:modelValue",JSON.parse(e))}}},methods:{copytoclipboard(){const e={ok:function(){N.create({color:"bg-grey-2",message:"Copied sucessfully",timeout:2e3})},error:function(t){N.create({color:"bg-grey-2",message:t,timeout:2e3})}};Pt.copyTextToClipboard(this.value,e)},resetdata(){var e=x.getNewlyCreatedDataSet();this.value=JSON.stringify(e),this.$emit("update:modelValue",e)}}},$t=B("h1",null,"Json Data",-1),Lt=B("div",null,"Use this page to save and restore data for this tool. To save the data copy to clipboard then store the text. To restore the data paste the copied text into the box below",-1);function zt(e,t,a,r,n,o){return m(),I("div",null,[$t,Lt,s(C,{label:"Copy to clipboard",color:"primary",icon:"content_copy",onClick:o.copytoclipboard},null,8,["onClick"]),s(C,{label:"Reset Data",icon:"delete",onClick:o.resetdata},null,8,["onClick"]),s(Z,{filled:"",type:"textarea",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l)},null,8,["modelValue"]),w(" modelValue: "+Y(a.modelValue)+" value: "+Y(o.value),1)])}var Ft=D(qt,[["render",zt]]);const Nt=Me({name:"CalcRefurbishment",components:{plansChart:rt,viewingChart:Gt,jsonView:Ft},data(){return{refurb_mode:"plans",refurb_data:x.getNewlyCreatedDataSet()}},methods:{click_refurb_menu(e){if(e==="viewing"&&this.refurb_data.background_items.length===0){N.create({color:"bg-grey-2",message:"Add floorplans before viewing",timeout:2e3});return}this.refurb_mode=e}},mounted(){var e=this;this.$bus.on("click_refurb_menu",t=>{e.click_refurb_menu(t)})},unmounted(){}}),Rt={class:"main-page fit col wrap justify-center items-center content-center"},Wt={key:0},Ut={key:1},Ht={key:2};function Et(e,t,a,r,n,o){const l=A("plansChart"),i=A("viewingChart"),u=A("jsonView");return m(),I("div",null,[s(De,{class:"flex flex-center"},{default:f(()=>[B("div",Rt,[e.refurb_mode==="plans"?(m(),I("div",Wt,[s(l,{ref:"plansChart",refurbData:e.refurb_data},null,8,["refurbData"])])):G("",!0),e.refurb_mode==="viewing"?(m(),I("div",Ut,[s(i,{ref:"viewingChart",refurbData:e.refurb_data},null,8,["refurbData"])])):G("",!0),e.refurb_mode==="json"?(m(),I("div",Ht,[s(u,{ref:"jsonView","model-value":e.refurb_data,"onUpdate:modelValue":t[0]||(t[0]=h=>e.refurb_data=h)},null,8,["model-value"])])):G("",!0)])]),_:1})])}var Yt=D(Nt,[["render",Et]]);export{Yt as default};

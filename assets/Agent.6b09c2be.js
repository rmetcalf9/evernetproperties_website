import{_ as g,d as p,N as n,r as u,o as a,c as l,w as m,e as s,K as d,L as o,t as h,a as c,Q as r}from"./index.472d76b1.js";import{Q as f}from"./QPage.49ece618.js";import{u as b}from"./backend_connection.2c8693ef.js";import{u as k}from"./data_caches.2dccc764.js";import{P as v}from"./PatchAgentNotes.aff20b67.js";import"./axios.6e1fcf85.js";import"./QExpansionItem.b0551d79.js";import"./QItemSection.a9d175d0.js";import"./QItemLabel.0436041d.js";import"./QMenu.c1c5566f.js";import"./position-engine.6a5e6f83.js";import"./QTooltip.551df188.js";import"./use-fullscreen.9d43c4ac.js";const y=p({name:"AgentPage",setup(){const e=b(),t=k();return{backend_connection_store:e,dataCachesStore:t}},components:{PatchAgentNotes:v},data(){return{loaded:!1}},computed:{patch_data(){return this.dataCachesStore.get_direct_from_cache({object_type:"patches",object_id:this.$route.params.patchid})},patchagents_data(){return this.dataCachesStore.get_direct_from_cache({object_type:"patchagents",object_id:this.$route.params.patchid})},selected_agent(){return this.patchagents_data.agents[this.$route.params.sellingagentid]}},methods:{refresh(){const e=this,t={ok:e.refresh_success,error:e.refresh_error};this.dataCachesStore.get({backend_connection_store:this.backend_connection_store,object_type:"patches",object_id:e.$route.params.patchid,skip_cache:!1,callback:t})},refresh_success(e){const t=this,i={ok:t.refresh_success2,error:t.refresh_error};this.dataCachesStore.get({backend_connection_store:this.backend_connection_store,object_type:"patchagents",object_id:t.$route.params.patchid,skip_cache:!1,callback:i})},refresh_success2(e){const t=this;this.loaded=!0,setTimeout(function(){t.$refs.PatchAgentNotes.init(t.selected_agent.agent_name,t.selected_agent.agent_notes,t.selected_agent.projects,void 0)},100)},refresh_error(e){n.create({color:"negative",message:"Failed to find patch information",timeout:2e3}),this.$router.push("/tools/cansave/patches")},clickcancelbtn(){this.$router.push("/tools/agents/"+this.$route.params.patchid)},clicksavebtn(){const e=this.$refs.PatchAgentNotes.get_agent_data();this.patchagents_data.agents[this.$route.params.sellingagentid].agent_name=e.agent_name,this.patchagents_data.agents[this.$route.params.sellingagentid].agent_notes=e.agent_notes;const t={ok:this.clicksavebtn_success,error:this.clicksavebtn_fail};this.dataCachesStore.save({backend_connection_store:this.backend_connection_store,object_type:"patchagents",object_data:this.patchagents_data,callback:t})},clicksavebtn_success(e){this.$router.push("/tools/agents/"+this.$route.params.patchid)},clicksavebtn_fail(e){if(console.log("clicksavebtn_fail",e),typeof e.response!="undefined"&&typeof e.response.data!="undefined"&&typeof e.response.data.message!="undefined"){n.create({color:"bg-grey-2",message:e.response.data.message,timeout:2e3,color:"negative"});return}n.create({color:"bg-grey-2",message:e.message,timeout:2e3,color:"negative"})},clickdeletebtn(){if(this.selected_agent.projects.length!==0)return;const e=this;this.$q.dialog({title:"Delete agent notes",message:"This will delete the notes for this agent ("+this.selected_agent.agent_name+"). Are you sure?",html:!1,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"}}).onOk(t=>{e.deleteagentconfirmed()})},deleteagentconfirmed(){delete this.patchagents_data.agents[this.$route.params.sellingagentid];const e={ok:this.clicksavebtn_success,error:this.clicksavebtn_fail};this.dataCachesStore.save({backend_connection_store:this.backend_connection_store,object_type:"patchagents",object_data:this.patchagents_data,callback:e})}},mounted(){this.loaded=!1,this.refresh()}}),C={class:"cols"},$={key:0},j={key:1},T={class:"agent-actionbuttons"};function N(e,t,i,A,S,P){const _=u("PatchAgentNotes");return a(),l(f,{class:"flex flex-center"},{default:m(()=>[s("div",C,[e.loaded?o("",!0):(a(),d("div",$," Loading... ")),e.loaded?(a(),d("div",j,[s("h1",null,h(e.patch_data.name),1),s("h2",null,"Agent Notes for "+h(e.selected_agent.agent_name),1),c(_,{ref:"PatchAgentNotes",openProjectInNewTab:!1},null,512)])):o("",!0),s("div",T,[c(r,{label:"Cancel",onClick:e.clickcancelbtn},null,8,["onClick"]),c(r,{color:"primary",icon:"save",label:"Save",onClick:e.clicksavebtn},null,8,["onClick"]),e.selected_agent.projects.length===0?(a(),l(r,{key:0,color:"negative",icon:"delete",label:"Delete",onClick:e.clickdeletebtn},null,8,["onClick"])):o("",!0)])])]),_:1})}var G=g(y,[["render",N]]);export{G as default};

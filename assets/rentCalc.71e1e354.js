import{a as Re,Q as Mt}from"./QTabs.2ee17ba0.js";import{Q as St}from"./QPage.8acc11c9.js";import{g as qt,az as $t,ay as Ht,av as It,aF as Ot,j as $,k as c,ax as Yt,m as J,q as u,a0 as Z,x as Lt,u as zt,aC as At,a3 as Ue,Q as M,d as ot,_ as nt,o as Q,c as it,w as T,a as _,K as ue,L as de,e as y,t as ve,f as ce,af as qe,a9 as Ge,ak as me,ae as Pt,aa as Nt,N as fe,r as I,al as Ke}from"./index.472238a3.js";import{u as Bt}from"./use-quasar.53d2dd82.js";import{T as Ft,B as Wt,L as xt}from"./Todos.cc407cd0.js";import{u as lt}from"./backend_connection.e16c3e51.js";import{u as Et}from"./data_caches.fe802113.js";import{L as Qt}from"./LeadInformation.669d347f.js";import{u as Rt,a as Ut,b as Gt,t as Je,g as O,f as Kt,c as Jt,j as $e,_ as Zt,Q as Xt}from"./QTime.9acde903.js";import{p as X}from"./QSelect.ed3cb3e1.js";import{Q as Ze}from"./QPopupProxy.7b192c51.js";import{C as Xe}from"./ClosePopup.f7b48909.js";import"./index.865826ad.js";import{r as ea}from"./utils.99aafcb0.js";import{D as et}from"./datetime.5361efaf.js";import{W as ta}from"./Workflow_main.512fc34f.js";import{A as aa,a as oa,P as na}from"./ProjectSerializer.9343dd0f.js";import{c as ia}from"./common_constants.94b43302.js";import"./QResizeObserver.07bee499.js";import"./QSpace.5c8bb129.js";import"./uuid.6153c38a.js";import"./TodoItem.bc15128a.js";import"./axios.6e1fcf85.js";import"./TouchPan.f1c18ea4.js";import"./position-engine.46155e66.js";import"./QItemLabel.5d4c2575.js";function la(){const t=new Map;return{getCache:function(r,v){return t[r]===void 0?t[r]=v:t[r]},getCacheWithFn:function(r,v){return t[r]===void 0?t[r]=v():t[r]}}}const P=20,ra=["Calendar","Years","Months"],tt=t=>ra.includes(t),He=t=>/^-?[\d]+\/[0-1]\d$/.test(t),E=" \u2014 ";function Y(t){return t.year+"/"+X(t.month)}var sa=qt({name:"QDate",props:{...Rt,...$t,...Ht,multiple:Boolean,range:Boolean,title:String,subtitle:String,mask:{default:"YYYY/MM/DD"},defaultYearMonth:{type:String,validator:He},yearsInMonthView:Boolean,events:[Array,Function],eventColor:[String,Function],emitImmediately:Boolean,options:[Array,Function],navigationMinYearMonth:{type:String,validator:He},navigationMaxYearMonth:{type:String,validator:He},noUnset:Boolean,firstDayOfWeek:[String,Number],todayBtn:Boolean,minimal:Boolean,defaultView:{type:String,default:"Calendar",validator:tt}},emits:[...Ut,"rangeStart","rangeEnd","navigation"],setup(t,{slots:r,emit:v}){const{proxy:p}=zt(),{$q:S}=p,_e=It(t,S),{getCache:h}=la(),{tabindex:j,headerClass:he,getLocale:ee,getCurrentDate:te}=Gt(t,S);let N;const ge=Ot(t),ye=At(ge),R=$(null),L=$(Ne()),g=$(ee()),rt=c(()=>Ne()),st=c(()=>ee()),q=c(()=>te()),s=$(Be(L.value,g.value)),C=$(t.defaultView),Ie=S.lang.rtl===!0?"right":"left",ae=$(Ie.value),pe=$(Ie.value),we=s.value.year,oe=$(we-we%P-(we<0?P:0)),k=$(null),ut=c(()=>{const e=t.landscape===!0?"landscape":"portrait";return`q-date q-date--${e} q-date--${e}-${t.minimal===!0?"minimal":"standard"}`+(_e.value===!0?" q-date--dark q-dark":"")+(t.bordered===!0?" q-date--bordered":"")+(t.square===!0?" q-date--square no-border-radius":"")+(t.flat===!0?" q-date--flat no-shadow":"")+(t.disable===!0?" disabled":t.readonly===!0?" q-date--readonly":"")}),z=c(()=>t.color||"primary"),B=c(()=>t.textColor||"white"),ne=c(()=>t.emitImmediately===!0&&t.multiple!==!0&&t.range!==!0),be=c(()=>Array.isArray(t.modelValue)===!0?t.modelValue:t.modelValue!==null&&t.modelValue!==void 0?[t.modelValue]:[]),V=c(()=>be.value.filter(e=>typeof e=="string").map(e=>De(e,L.value,g.value)).filter(e=>e.dateHash!==null&&e.day!==null&&e.month!==null&&e.year!==null)),F=c(()=>{const e=a=>De(a,L.value,g.value);return be.value.filter(a=>Yt(a)===!0&&a.from!==void 0&&a.to!==void 0).map(a=>({from:e(a.from),to:e(a.to)})).filter(a=>a.from.dateHash!==null&&a.to.dateHash!==null&&a.from.dateHash<a.to.dateHash)}),ie=c(()=>t.calendar!=="persian"?e=>new Date(e.year,e.month-1,e.day):e=>{const a=Je(e.year,e.month,e.day);return new Date(a.gy,a.gm-1,a.gd)}),ke=c(()=>t.calendar==="persian"?O:(e,a,o)=>Kt(new Date(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond),a===void 0?L.value:a,o===void 0?g.value:o,e.year,e.timezoneOffset)),U=c(()=>V.value.length+F.value.reduce((e,a)=>e+1+Jt(ie.value(a.to),ie.value(a.from)),0)),Oe=c(()=>{if(t.title!==void 0&&t.title!==null&&t.title.length!==0)return t.title;if(k.value!==null){const o=k.value.init,n=ie.value(o);return g.value.daysShort[n.getDay()]+", "+g.value.monthsShort[o.month-1]+" "+o.day+E+"?"}if(U.value===0)return E;if(U.value>1)return`${U.value} ${g.value.pluralDay}`;const e=V.value[0],a=ie.value(e);return isNaN(a.valueOf())===!0?E:g.value.headerTitle!==void 0?g.value.headerTitle(a,e):g.value.daysShort[a.getDay()]+", "+g.value.monthsShort[e.month-1]+" "+e.day}),dt=c(()=>V.value.concat(F.value.map(a=>a.from)).sort((a,o)=>a.year-o.year||a.month-o.month)[0]),ct=c(()=>V.value.concat(F.value.map(a=>a.to)).sort((a,o)=>o.year-a.year||o.month-a.month)[0]),Ye=c(()=>{if(t.subtitle!==void 0&&t.subtitle!==null&&t.subtitle.length!==0)return t.subtitle;if(U.value===0)return E;if(U.value>1){const e=dt.value,a=ct.value,o=g.value.monthsShort;return o[e.month-1]+(e.year!==a.year?" "+e.year+E+o[a.month-1]+" ":e.month!==a.month?E+o[a.month-1]:"")+" "+a.year}return V.value[0].year}),le=c(()=>{const e=[S.iconSet.datetime.arrowLeft,S.iconSet.datetime.arrowRight];return S.lang.rtl===!0?e.reverse():e}),Le=c(()=>t.firstDayOfWeek!==void 0?Number(t.firstDayOfWeek):g.value.firstDayOfWeek),ft=c(()=>{const e=g.value.daysShort,a=Le.value;return a>0?e.slice(a,7).concat(e.slice(0,a)):e}),H=c(()=>{const e=s.value;return t.calendar!=="persian"?new Date(e.year,e.month,0).getDate():$e(e.year,e.month)}),vt=c(()=>typeof t.eventColor=="function"?t.eventColor:()=>t.eventColor),w=c(()=>{if(t.navigationMinYearMonth===void 0)return null;const e=t.navigationMinYearMonth.split("/");return{year:parseInt(e[0],10),month:parseInt(e[1],10)}}),b=c(()=>{if(t.navigationMaxYearMonth===void 0)return null;const e=t.navigationMaxYearMonth.split("/");return{year:parseInt(e[0],10),month:parseInt(e[1],10)}}),je=c(()=>{const e={month:{prev:!0,next:!0},year:{prev:!0,next:!0}};return w.value!==null&&w.value.year>=s.value.year&&(e.year.prev=!1,w.value.year===s.value.year&&w.value.month>=s.value.month&&(e.month.prev=!1)),b.value!==null&&b.value.year<=s.value.year&&(e.year.next=!1,b.value.year===s.value.year&&b.value.month<=s.value.month&&(e.month.next=!1)),e}),re=c(()=>{const e={};return V.value.forEach(a=>{const o=Y(a);e[o]===void 0&&(e[o]=[]),e[o].push(a.day)}),e}),ze=c(()=>{const e={};return F.value.forEach(a=>{const o=Y(a.from),n=Y(a.to);if(e[o]===void 0&&(e[o]=[]),e[o].push({from:a.from.day,to:o===n?a.to.day:void 0,range:a}),o<n){let i;const{year:f,month:l}=a.from,d=l<12?{year:f,month:l+1}:{year:f+1,month:1};for(;(i=Y(d))<=n;)e[i]===void 0&&(e[i]=[]),e[i].push({from:void 0,to:i===n?a.to.day:void 0,range:a}),d.month++,d.month>12&&(d.year++,d.month=1)}}),e}),G=c(()=>{if(k.value===null)return;const{init:e,initHash:a,final:o,finalHash:n}=k.value,[i,f]=a<=n?[e,o]:[o,e],l=Y(i),d=Y(f);if(l!==D.value&&d!==D.value)return;const m={};return l===D.value?(m.from=i.day,m.includeFrom=!0):m.from=1,d===D.value?(m.to=f.day,m.includeTo=!0):m.to=H.value,m}),D=c(()=>Y(s.value)),mt=c(()=>{const e={};if(t.options===void 0){for(let o=1;o<=H.value;o++)e[o]=!0;return e}const a=typeof t.options=="function"?t.options:o=>t.options.includes(o);for(let o=1;o<=H.value;o++){const n=D.value+"/"+X(o);e[o]=a(n)}return e}),_t=c(()=>{const e={};if(t.events===void 0)for(let a=1;a<=H.value;a++)e[a]=!1;else{const a=typeof t.events=="function"?t.events:o=>t.events.includes(o);for(let o=1;o<=H.value;o++){const n=D.value+"/"+X(o);e[o]=a(n)===!0&&vt.value(n)}}return e}),ht=c(()=>{let e,a;const{year:o,month:n}=s.value;if(t.calendar!=="persian")e=new Date(o,n-1,1),a=new Date(o,n-1,0).getDate();else{const i=Je(o,n,1);e=new Date(i.gy,i.gm-1,i.gd);let f=n-1,l=o;f===0&&(f=12,l--),a=$e(l,f)}return{days:e.getDay()-Le.value-1,endDay:a}}),Ae=c(()=>{const e=[],{days:a,endDay:o}=ht.value,n=a<0?a+7:a;if(n<6)for(let l=o-n;l<=o;l++)e.push({i:l,fill:!0});const i=e.length;for(let l=1;l<=H.value;l++){const d={i:l,event:_t.value[l],classes:[]};mt.value[l]===!0&&(d.in=!0,d.flat=!0),e.push(d)}if(re.value[D.value]!==void 0&&re.value[D.value].forEach(l=>{const d=i+l-1;Object.assign(e[d],{selected:!0,unelevated:!0,flat:!1,color:z.value,textColor:B.value})}),ze.value[D.value]!==void 0&&ze.value[D.value].forEach(l=>{if(l.from!==void 0){const d=i+l.from-1,m=i+(l.to||H.value)-1;for(let K=d;K<=m;K++)Object.assign(e[K],{range:l.range,unelevated:!0,color:z.value,textColor:B.value});Object.assign(e[d],{rangeFrom:!0,flat:!1}),l.to!==void 0&&Object.assign(e[m],{rangeTo:!0,flat:!1})}else if(l.to!==void 0){const d=i+l.to-1;for(let m=i;m<=d;m++)Object.assign(e[m],{range:l.range,unelevated:!0,color:z.value,textColor:B.value});Object.assign(e[d],{flat:!1,rangeTo:!0})}else{const d=i+H.value-1;for(let m=i;m<=d;m++)Object.assign(e[m],{range:l.range,unelevated:!0,color:z.value,textColor:B.value})}}),G.value!==void 0){const l=i+G.value.from-1,d=i+G.value.to-1;for(let m=l;m<=d;m++)e[m].color=z.value,e[m].editRange=!0;G.value.includeFrom===!0&&(e[l].editRangeFrom=!0),G.value.includeTo===!0&&(e[d].editRangeTo=!0)}s.value.year===q.value.year&&s.value.month===q.value.month&&(e[i+q.value.day-1].today=!0);const f=e.length%7;if(f>0){const l=7-f;for(let d=1;d<=l;d++)e.push({i:d,fill:!0})}return e.forEach(l=>{let d="q-date__calendar-item ";l.fill===!0?d+="q-date__calendar-item--fill":(d+=`q-date__calendar-item--${l.in===!0?"in":"out"}`,l.range!==void 0&&(d+=` q-date__range${l.rangeTo===!0?"-to":l.rangeFrom===!0?"-from":""}`),l.editRange===!0&&(d+=` q-date__edit-range${l.editRangeFrom===!0?"-from":""}${l.editRangeTo===!0?"-to":""}`),(l.range!==void 0||l.editRange===!0)&&(d+=` text-${l.color}`)),l.classes=d}),e}),gt=c(()=>t.disable===!0?{"aria-disabled":"true"}:t.readonly===!0?{"aria-readonly":"true"}:{});J(()=>t.modelValue,e=>{if(N===e)N=0;else{const a=Be(L.value,g.value);W(a.year,a.month,a)}}),J(C,()=>{R.value!==null&&p.$el.contains(document.activeElement)===!0&&R.value.focus()}),J(()=>s.value.year+"|"+s.value.month,()=>{v("navigation",{year:s.value.year,month:s.value.month})}),J(rt,e=>{Qe(e,g.value,"mask"),L.value=e}),J(st,e=>{Qe(L.value,e,"locale"),g.value=e});function Pe(){const{year:e,month:a,day:o}=q.value,n={...s.value,year:e,month:a,day:o},i=re.value[Y(n)];(i===void 0||i.includes(n.day)===!1)&&Ve(n),Ce(n.year,n.month)}function yt(e){tt(e)===!0&&(C.value=e)}function pt(e,a){["month","year"].includes(e)&&(e==="month"?We:Te)(a===!0?-1:1)}function Ce(e,a){C.value="Calendar",W(e,a)}function wt(e,a){if(t.range===!1||!e){k.value=null;return}const o=Object.assign({...s.value},e),n=a!==void 0?Object.assign({...s.value},a):o;k.value={init:o,initHash:O(o),final:n,finalHash:O(n)},Ce(o.year,o.month)}function Ne(){return t.calendar==="persian"?"YYYY/MM/DD":t.mask}function De(e,a,o){return Zt(e,a,o,t.calendar,{hour:0,minute:0,second:0,millisecond:0})}function Be(e,a){const o=Array.isArray(t.modelValue)===!0?t.modelValue:t.modelValue?[t.modelValue]:[];if(o.length===0)return Fe();const n=o[o.length-1],i=De(n.from!==void 0?n.from:n,e,a);return i.dateHash===null?Fe():i}function Fe(){let e,a;if(t.defaultYearMonth!==void 0){const o=t.defaultYearMonth.split("/");e=parseInt(o[0],10),a=parseInt(o[1],10)}else{const o=q.value!==void 0?q.value:te();e=o.year,a=o.month}return{year:e,month:a,day:1,hour:0,minute:0,second:0,millisecond:0,dateHash:e+"/"+X(a)+"/01"}}function We(e){let a=s.value.year,o=Number(s.value.month)+e;o===13?(o=1,a++):o===0&&(o=12,a--),W(a,o),ne.value===!0&&se("month")}function Te(e){const a=Number(s.value.year)+e;W(a,s.value.month),ne.value===!0&&se("year")}function bt(e){W(e,s.value.month),C.value=t.defaultView==="Years"?"Months":"Calendar",ne.value===!0&&se("year")}function kt(e){W(s.value.year,e),C.value="Calendar",ne.value===!0&&se("month")}function jt(e,a){const o=re.value[a];(o!==void 0&&o.includes(e.day)===!0?Me:Ve)(e)}function A(e){return{year:e.year,month:e.month,day:e.day}}function W(e,a,o){if(w.value!==null&&e<=w.value.year&&((a<w.value.month||e<w.value.year)&&(a=w.value.month),e=w.value.year),b.value!==null&&e>=b.value.year&&((a>b.value.month||e>b.value.year)&&(a=b.value.month),e=b.value.year),o!==void 0){const{hour:i,minute:f,second:l,millisecond:d,timezoneOffset:m,timeHash:K}=o;Object.assign(s.value,{hour:i,minute:f,second:l,millisecond:d,timezoneOffset:m,timeHash:K})}const n=e+"/"+X(a)+"/01";n!==s.value.dateHash&&(ae.value=s.value.dateHash<n==(S.lang.rtl!==!0)?"left":"right",e!==s.value.year&&(pe.value=ae.value),Ue(()=>{oe.value=e-e%P-(e<0?P:0),Object.assign(s.value,{year:e,month:a,day:1,dateHash:n})}))}function xe(e,a,o){const n=e!==null&&e.length===1&&t.multiple===!1?e[0]:e;N=n;const{reason:i,details:f}=Ee(a,o);v("update:modelValue",n,i,f)}function se(e){const a=V.value[0]!==void 0&&V.value[0].dateHash!==null?{...V.value[0]}:{...s.value};Ue(()=>{a.year=s.value.year,a.month=s.value.month;const o=t.calendar!=="persian"?new Date(a.year,a.month,0).getDate():$e(a.year,a.month);a.day=Math.min(Math.max(1,a.day),o);const n=x(a);N=n;const{details:i}=Ee("",a);v("update:modelValue",n,e,i)})}function Ee(e,a){return a.from!==void 0?{reason:`${e}-range`,details:{...A(a.target),from:A(a.from),to:A(a.to)}}:{reason:`${e}-day`,details:A(a)}}function x(e,a,o){return e.from!==void 0?{from:ke.value(e.from,a,o),to:ke.value(e.to,a,o)}:ke.value(e,a,o)}function Ve(e){let a;if(t.multiple===!0)if(e.from!==void 0){const o=O(e.from),n=O(e.to),i=V.value.filter(l=>l.dateHash<o||l.dateHash>n),f=F.value.filter(({from:l,to:d})=>d.dateHash<o||l.dateHash>n);a=i.concat(f).concat(e).map(l=>x(l))}else{const o=be.value.slice();o.push(x(e)),a=o}else a=x(e);xe(a,"add",e)}function Me(e){if(t.noUnset===!0)return;let a=null;if(t.multiple===!0&&Array.isArray(t.modelValue)===!0){const o=x(e);e.from!==void 0?a=t.modelValue.filter(n=>n.from!==void 0?n.from!==o.from&&n.to!==o.to:!0):a=t.modelValue.filter(n=>n!==o),a.length===0&&(a=null)}xe(a,"remove",e)}function Qe(e,a,o){const n=V.value.concat(F.value).map(i=>x(i,e,a)).filter(i=>i.from!==void 0?i.from.dateHash!==null&&i.to.dateHash!==null:i.dateHash!==null);v("update:modelValue",(t.multiple===!0?n:n[0])||null,o)}function Ct(){if(t.minimal!==!0)return u("div",{class:"q-date__header "+he.value},[u("div",{class:"relative-position"},[u(Z,{name:"q-transition--fade"},()=>u("div",{key:"h-yr-"+Ye.value,class:"q-date__header-subtitle q-date__header-link "+(C.value==="Years"?"q-date__header-link--active":"cursor-pointer"),tabindex:j.value,...h("vY",{onClick(){C.value="Years"},onKeyup(e){e.keyCode===13&&(C.value="Years")}})},[Ye.value]))]),u("div",{class:"q-date__header-title relative-position flex no-wrap"},[u("div",{class:"relative-position col"},[u(Z,{name:"q-transition--fade"},()=>u("div",{key:"h-sub"+Oe.value,class:"q-date__header-title-label q-date__header-link "+(C.value==="Calendar"?"q-date__header-link--active":"cursor-pointer"),tabindex:j.value,...h("vC",{onClick(){C.value="Calendar"},onKeyup(e){e.keyCode===13&&(C.value="Calendar")}})},[Oe.value]))]),t.todayBtn===!0?u(M,{class:"q-date__header-today self-start",icon:S.iconSet.datetime.today,flat:!0,size:"sm",round:!0,tabindex:j.value,onClick:Pe}):null])])}function Se({label:e,type:a,key:o,dir:n,goTo:i,boundaries:f,cls:l}){return[u("div",{class:"row items-center q-date__arrow"},[u(M,{round:!0,dense:!0,size:"sm",flat:!0,icon:le.value[0],tabindex:j.value,disable:f.prev===!1,...h("go-#"+a,{onClick(){i(-1)}})})]),u("div",{class:"relative-position overflow-hidden flex flex-center"+l},[u(Z,{name:"q-transition--jump-"+n},()=>u("div",{key:o},[u(M,{flat:!0,dense:!0,noCaps:!0,label:e,tabindex:j.value,...h("view#"+a,{onClick:()=>{C.value=a}})})]))]),u("div",{class:"row items-center q-date__arrow"},[u(M,{round:!0,dense:!0,size:"sm",flat:!0,icon:le.value[1],tabindex:j.value,disable:f.next===!1,...h("go+#"+a,{onClick(){i(1)}})})])]}const Dt={Calendar:()=>[u("div",{key:"calendar-view",class:"q-date__view q-date__calendar"},[u("div",{class:"q-date__navigation row items-center no-wrap"},Se({label:g.value.months[s.value.month-1],type:"Months",key:s.value.month,dir:ae.value,goTo:We,boundaries:je.value.month,cls:" col"}).concat(Se({label:s.value.year,type:"Years",key:s.value.year,dir:pe.value,goTo:Te,boundaries:je.value.year,cls:""}))),u("div",{class:"q-date__calendar-weekdays row items-center no-wrap"},ft.value.map(e=>u("div",{class:"q-date__calendar-item"},[u("div",e)]))),u("div",{class:"q-date__calendar-days-container relative-position overflow-hidden"},[u(Z,{name:"q-transition--slide-"+ae.value},()=>u("div",{key:D.value,class:"q-date__calendar-days fit"},Ae.value.map(e=>u("div",{class:e.classes},[e.in===!0?u(M,{class:e.today===!0?"q-date__today":"",dense:!0,flat:e.flat,unelevated:e.unelevated,color:e.color,textColor:e.textColor,label:e.i,tabindex:j.value,...h("day#"+e.i,{onClick:()=>{Tt(e.i)},onMouseover:()=>{Vt(e.i)}})},e.event!==!1?()=>u("div",{class:"q-date__event bg-"+e.event}):null):u("div",""+e.i)]))))])])],Months(){const e=s.value.year===q.value.year,a=n=>w.value!==null&&s.value.year===w.value.year&&w.value.month>n||b.value!==null&&s.value.year===b.value.year&&b.value.month<n,o=g.value.monthsShort.map((n,i)=>{const f=s.value.month===i+1;return u("div",{class:"q-date__months-item flex flex-center"},[u(M,{class:e===!0&&q.value.month===i+1?"q-date__today":null,flat:f!==!0,label:n,unelevated:f,color:f===!0?z.value:null,textColor:f===!0?B.value:null,tabindex:j.value,disable:a(i+1),...h("month#"+i,{onClick:()=>{kt(i+1)}})})])});return t.yearsInMonthView===!0&&o.unshift(u("div",{class:"row no-wrap full-width"},[Se({label:s.value.year,type:"Years",key:s.value.year,dir:pe.value,goTo:Te,boundaries:je.value.year,cls:" col"})])),u("div",{key:"months-view",class:"q-date__view q-date__months flex flex-center"},o)},Years(){const e=oe.value,a=e+P,o=[],n=i=>w.value!==null&&w.value.year>i||b.value!==null&&b.value.year<i;for(let i=e;i<=a;i++){const f=s.value.year===i;o.push(u("div",{class:"q-date__years-item flex flex-center"},[u(M,{key:"yr"+i,class:q.value.year===i?"q-date__today":null,flat:!f,label:i,dense:!0,unelevated:f,color:f===!0?z.value:null,textColor:f===!0?B.value:null,tabindex:j.value,disable:n(i),...h("yr#"+i,{onClick:()=>{bt(i)}})})]))}return u("div",{class:"q-date__view q-date__years flex flex-center"},[u("div",{class:"col-auto"},[u(M,{round:!0,dense:!0,flat:!0,icon:le.value[0],tabindex:j.value,disable:n(e),...h("y-",{onClick:()=>{oe.value-=P}})})]),u("div",{class:"q-date__years-content col self-stretch row items-center"},o),u("div",{class:"col-auto"},[u(M,{round:!0,dense:!0,flat:!0,icon:le.value[1],tabindex:j.value,disable:n(a),...h("y+",{onClick:()=>{oe.value+=P}})})])])}};function Tt(e){const a={...s.value,day:e};if(t.range===!1){jt(a,D.value);return}if(k.value===null){const o=Ae.value.find(i=>i.fill!==!0&&i.i===e);if(t.noUnset!==!0&&o.range!==void 0){Me({target:a,from:o.range.from,to:o.range.to});return}if(o.selected===!0){Me(a);return}const n=O(a);k.value={init:a,initHash:n,final:a,finalHash:n},v("rangeStart",A(a))}else{const o=k.value.initHash,n=O(a),i=o<=n?{from:k.value.init,to:a}:{from:a,to:k.value.init};k.value=null,Ve(o===n?a:{target:a,...i}),v("rangeEnd",{from:A(i.from),to:A(i.to)})}}function Vt(e){if(k.value!==null){const a={...s.value,day:e};Object.assign(k.value,{final:a,finalHash:O(a)})}}return Object.assign(p,{setToday:Pe,setView:yt,offsetCalendar:pt,setCalendarTo:Ce,setEditingRange:wt}),()=>{const e=[u("div",{class:"q-date__content col relative-position"},[u(Z,{name:"q-transition--fade"},Dt[C.value])])],a=Lt(r.default);return a!==void 0&&e.push(u("div",{class:"q-date__actions"},a)),t.name!==void 0&&t.disable!==!0&&ye(e,"push"),u("div",{class:ut.value,...gt.value},[Ct(),u("div",{ref:R,class:"q-date__main col column",tabindex:-1},e)])}}});function at(){return{isViewingArranged:!1,isViewingHeld:!1}}const ua=ot({name:"ViewingInformationCard",props:["projectid","leadinformation"],components:{},setup(){return{backend_connection_store:lt()}},data(){return{emit_project_change_notification:!0,current_workflow_position:{workflow_used_id:-1,current_stage:-1},viewing_timestamp:"2025-04-19T10:50:44.066Z",call_timestamp:void 0,call_notes:""}},watch:{serializer_card_data(t){this.emit_project_change_notification&&this.$emit("projectchanged","ViewingInformation:serializer")}},computed:{calendar_start_time(){return et.fromISO(this.viewing_timestamp).toFormat("HH:mm")},calendar_end_time(){return et.fromISO(this.viewing_timestamp).plus({hours:1}).toFormat("HH:mm")},calendar_day(){return this.viewing_timestamp.substring(0,10)},calendar_description(){return ea({projectid:this.projectid,leadinformation:this.leadinformation,call_notes:this.call_notes})},callMadeOnText(){if(typeof this.call_timestamp=="undefined")return"Unknown";const t=new Date(this.call_timestamp),r=t.getHours().toString().padStart(2,"0"),v=t.getMinutes().toString().padStart(2,"0");return t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})+` at ${r}:${v}`},dateOnly:{get(){return new Date(this.viewing_timestamp).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})},set(t){const r=new Date(t);if(isNaN(r))return;const v=new Date(this.viewing_timestamp);r.setHours(v.getHours()),r.setMinutes(v.getMinutes()),r.setSeconds(0),r.setMilliseconds(0),this.viewing_timestamp=r.toISOString()}},timeOnly:{get(){const t=new Date(this.viewing_timestamp),r=t.getHours().toString().padStart(2,"0"),v=t.getMinutes().toString().padStart(2,"0");return`${r}:${v}`},set(t){const[r,v]=t.split(":").map(Number),p=new Date(this.viewing_timestamp);p.setHours(r),p.setMinutes(v),p.setSeconds(0),p.setMilliseconds(0),this.viewing_timestamp=p.toISOString()}},serializer_card_data(){return{viewing_timestamp:this.viewing_timestamp,call_timestamp:this.call_timestamp,call_notes:this.call_notes}},workflow_stage_data(){return this.current_workflow_position.workflow_used_id===-1||this.current_workflow_position.current_stage===-1?at():ta.workflows[this.current_workflow_position.workflow_used_id]._stage_calc_fn(this.current_workflow_position.current_stage)}},methods:{reset_data(){console.log("RESET DATA CALL"),this.emit_project_change_notification=!1;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)},serializer_load_data(t){this.emit_project_change_notification=!1,this.viewing_timestamp=t.viewing_timestamp,typeof t.call_timestamp=="undefined"?this.call_timestamp=void 0:this.call_timestamp=t.call_timestamp,typeof t.call_notes=="undefined"?this.call_notes="":this.call_notes=t.call_notes;const r=this;setTimeout(function(){r.emit_project_change_notification=!0},50)},setWorkflowInfo({workflow_used_id:t,current_stage:r}){console.log("setWorkflowInfo"),this.current_workflow_position.workflow_used_id=t,this.current_workflow_position.current_stage=r}}}),da=y("div",{class:"text-h6"},"Call for Viewing",-1),ca={key:0},fa={key:1},va={key:0},ma={class:"row viewinginfo-datetime-controls"},_a={class:"row items-center justify-end"},ha={class:"row items-center justify-end"},ga=["name","location","description","startDate","endDate","startTime","endTime"],ya={key:1};function pa(t,r,v,p,S,_e){return Q(),it(Nt,{inline:"",class:"q-ma-sm card-style col-grow"},{default:T(()=>[_(Pt,null,{default:T(()=>[da,t.workflow_stage_data.isViewingArranged?de("",!0):(Q(),ue("div",ca," No viewing has been arranged. ")),t.workflow_stage_data.isViewingArranged?(Q(),ue("div",fa,[t.workflow_stage_data.isViewingHeld?de("",!0):(Q(),ue("div",va,[y("div",null," Call made on "+ve(t.callMadeOnText),1),y("div",null,[ce(" Notes: "),_(qe,{filled:"",modelValue:t.call_notes,"onUpdate:modelValue":r[0]||(r[0]=h=>t.call_notes=h),label:"Notes from this call",autogrow:""},null,8,["modelValue"])]),y("div",ma,[y("div",null,[ce(" Viewing Date: "),_(qe,{filled:"",modelValue:t.dateOnly,"onUpdate:modelValue":r[2]||(r[2]=h=>t.dateOnly=h),readonly:""},{append:T(()=>[_(Ge,{name:"event",class:"cursor-pointer"},{default:T(()=>[_(Ze,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:T(()=>[_(sa,{modelValue:t.dateOnly,"onUpdate:modelValue":r[1]||(r[1]=h=>t.dateOnly=h),mask:"dddd, MMM D, YYYY"},{default:T(()=>[y("div",_a,[me(_(M,{label:"Close",color:"primary",flat:""},null,512),[[Xe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),y("div",null,[ce(" Viewing Time: "),_(qe,{filled:"",modelValue:t.timeOnly,"onUpdate:modelValue":r[4]||(r[4]=h=>t.timeOnly=h),mask:"time",rules:["time"],readonly:""},{append:T(()=>[_(Ge,{name:"access_time",class:"cursor-pointer"},{default:T(()=>[_(Ze,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:T(()=>[_(Xt,{modelValue:t.timeOnly,"onUpdate:modelValue":r[3]||(r[3]=h=>t.timeOnly=h)},{default:T(()=>[y("div",ha,[me(_(M,{label:"Close",color:"primary",flat:""},null,512),[[Xe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),y("div",null,[y("add-to-calendar-button",{name:"Viewing: "+t.leadinformation.address+", "+t.leadinformation.postcode,options:"'Apple','Google','Yahoo','iCal'",location:t.leadinformation.address+", "+t.leadinformation.postcode,description:t.calendar_description,startDate:t.calendar_day,endDate:t.calendar_day,startTime:t.calendar_start_time,endTime:t.calendar_end_time,timeZone:"Europe/London"},null,8,ga)])])),t.workflow_stage_data.isViewingHeld?(Q(),ue("div",ya,[y("div",null,"Viewing held "+ve(t.dateOnly)+" at "+ve(t.timeOnly),1),ce(" TODO result record ")])):de("",!0)])):de("",!0)]),_:1})]),_:1})}var wa=nt(ua,[["render",pa]]);const ba=ot({name:"CalcBrrToFlip",components:{LeadInformation:Qt,ActivityLog:aa,Workflow:oa,Todos:Ft,ProjectSerializer:na,BrrToolbar:Wt,ViewingInfo:wa,Location:xt},setup(){const t=lt(),r=Bt(),v=Et();return{q:r,backend_connection_store:t,dataCachesStore:v}},data(){return{tab:"main",isMounted:!1,loaded_project_id:"",sucessful_load_completed:!1}},computed:{leadinformation(){return this.isMounted?this.$refs.LeadInformation.serializer_card_data:{address:"",advert_information:"",advertweblinks:[],contact_email:"",contact_phone:"",landlord_name:"",lead_source:"Not Selected",patch_id:void 0,postcode:""}},project_type(){return ia.project_type_constants.project_type_rent},serialized_data(){return this.isMounted?{leadinformation:this.$refs.LeadInformation.serializer_card_data,viewinginformation:this.$refs.ViewingInfo.serializer_card_data}:{}}},methods:{createtodo(t){const r=this,v={ok:function(p){r.$refs.todos.add_single_todo(p.data.todo),fe.create({color:"bg-grey-2",message:"Todo added",timeout:2e3,color:"positive"})},error:function(p){fe.create({color:"bg-grey-2",message:p.message,timeout:2e3,color:"negative"})}};r.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+r.loaded_project_id+"/todos",method:"POST",data:t,callback:v})},save_project(){this.$refs.ProjectSerializer.save_project({dict_of_card_info:this.serialized_data,activity_log:this.$refs.ActivityLog.serializer_card_data,workflow:this.$refs.Workflow.serializer_card_data,patch_id:this.serialized_data.leadinformation.patch_id,location:this.$refs.Location.serializer_card_data,passthroughdata:void 0})},navigate_away(t){this.$router.push(t.dest)},call_load_api(){const t=this,r={ok:t.load_project_api_success,error:t.load_project_api_fail};t.dataCachesStore.get({backend_connection_store:t.backend_connection_store,object_type:"projects",object_id:t.$route.query.projectid,skip_cache:!1,callback:r})},load_project_api_success(t){this.loaded_project_id=t.data.id,this.load_project_into_cards(t.data),this.sucessful_load_completed=!0,fe.create({color:"bg-grey-2",message:"Project Loaded",timeout:2e3,color:"positive"}),this.load_complete()},load_project_api_fail(t){fe.create({color:"bg-grey-2",message:"Error loading project "+t,timeout:2e3,color:"negative"}),this.load_complete()},load_complete(){this.q.loading.hide();const t=this;setTimeout(function(){t.isMounted=!0},105)},load_project_into_cards(t){this.$refs.ProjectSerializer.serializer_load_data(t),typeof t.sub_section_details.leadinformation!="undefined"&&this.$refs.LeadInformation.serializer_load_data(t.sub_section_details.leadinformation),typeof t.sub_section_details.viewinginformation!="undefined"&&this.$refs.ViewingInfo.serializer_load_data(t.sub_section_details.viewinginformation),typeof t.location!="undefined"&&this.$refs.Location.serializer_load_data(t.location),this.$refs.ActivityLog.serializer_load_data(t.activity_log),this.$refs.Workflow.serializer_load_data(t.workflow),this.$refs.todos.serializer_load_data(t.todos),this.$refs.ViewingInfo.setWorkflowInfo(t.workflow)},save_project_complete({success:t,response:r,passthroughdata:v}){t&&(this.loaded_project_id=r.data.id),this.$refs.BrrToolbar.save_project_complete_notification({success:t,response:r})},projectchanged(t){if(console.log("rentCalc page received project changed from ",t),!this.isMounted){console.log("WARNING = projectchanged called when mounted is false");return}if(typeof this.$refs.BrrToolbar=="undefined")return console.log("WARNING = projectchanged called when BrrToolbar is undefined"),!1;t==="ActivityLog:log_activity:forcesave"?this.$refs.BrrToolbar.set_changed_true({autosave_seconds:0}):this.$refs.BrrToolbar.set_changed_true(),this.$refs.ViewingInfo.setWorkflowInfo(this.$refs.Workflow.serializer_card_data)},click_save_btn(){this.$refs.BrrToolbar.click_save_btn()},activity_log(t){if(!this.isMounted){console.log("ERROR - trying to log activity unmounted",t);return}this.$refs.ActivityLog.log_activity(t)}},mounted(){const t=this;if(this.q.loading.show(),typeof t.$route.query.projectid=="undefined"){this.$router.push("/tools");return}setTimeout(function(){t.call_load_api()},1e3)}}),ka={class:"rentcalc-page fit col wrap justify-center items-center content-center"},ja={class:"row"},Ca={class:"row"};function Da(t,r,v,p,S,_e){const h=I("BrrToolbar"),j=I("LeadInformation"),he=I("ViewingInfo"),ee=I("Location"),te=I("Workflow"),N=I("Todos"),ge=I("ActivityLog"),ye=I("ProjectSerializer");return Q(),it(St,{class:"flex"},{default:T(()=>[y("div",ka,[y("div",null,[y("h1",null,"Rent Project "+ve(t.sucessful_load_completed),1)]),_(h,{ref:"BrrToolbar",reason_project_not_savable:"",is_saved_project_with_id:!0,is_rent_project:!0,onActivity_log:t.activity_log,onSaveproject:t.save_project,onCreatetodo:t.createtodo},null,8,["onActivity_log","onSaveproject","onCreatetodo"]),_(Mt,{modelValue:t.tab,"onUpdate:modelValue":r[0]||(r[0]=R=>t.tab=R),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:T(()=>[_(Re,{name:"main",label:"Main"}),_(Re,{name:"project",label:"Project"})]),_:1},8,["modelValue"]),me(y("div",ja,[_(j,{ref:"LeadInformation",ever_saved:"true",onNavigate_away:t.navigate_away,onProjectchanged:t.projectchanged},null,8,["onNavigate_away","onProjectchanged"]),_(he,{ref:"ViewingInfo",projectid:t.loaded_project_id,leadinformation:t.leadinformation,onProjectchanged:t.projectchanged},null,8,["projectid","leadinformation","onProjectchanged"]),_(ee,{ref:"Location",onProjectchanged:t.projectchanged},null,8,["onProjectchanged"])],512),[[Ke,t.tab==="main"]]),me(y("div",Ca,[_(te,{ref:"Workflow",onProjectchanged:t.projectchanged,onActivity_log:t.activity_log,onClick_save_btn:t.click_save_btn},null,8,["onProjectchanged","onActivity_log","onClick_save_btn"]),_(N,{ref:"todos"},null,512),_(ge,{ref:"ActivityLog",onProjectchanged:t.projectchanged},null,8,["onProjectchanged"])],512),[[Ke,t.tab==="project"]])]),_(ye,{ref:"ProjectSerializer",onSaveprojectcomplete:t.save_project_complete,project_type:t.project_type,success_message:"Lead Saved"},null,8,["onSaveprojectcomplete","project_type"])]),_:1})}var Za=nt(ba,[["render",Da]]);export{Za as default};

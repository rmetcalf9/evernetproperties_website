import{d as y,_ as b,o as s,K as r,f as w,t as m,e as l,M as k,O as C,L as p,a as c,Q as f,w as g,a9 as q,ak as L,af as A,r as v,c as S,N,ae as H,ah as at,aa as it,at as nt,ag as lt}from"./index.c972e510.js";import{Q as ot}from"./QPage.b0a023ef.js";import{u as st}from"./backend_connection.c90a3b49.js";import{u as I}from"./utils.99aafcb0.js";import{W as Q}from"./Workflow_main.49d6358d.js";import{Q as rt}from"./QSelect.7b0945ab.js";import{Q as E}from"./QTime.bf9862f5.js";import{Q as R}from"./QPopupProxy.e7ddafa8.js";import{C as V}from"./ClosePopup.1d66274a.js";import{Q as dt}from"./QSpace.8b13c361.js";import{D as W}from"./datetime.5361efaf.js";import"./axios.6e1fcf85.js";import"./QItemLabel.92ff6eaf.js";import"./position-engine.82a546e9.js";import"./TouchPan.f661f946.js";function ct(t,{workflow_id:e,workflow_stage:i}){t.workflow.workflow_used_id=e,t.workflow.current_stage=i}function _t(t,{type:e,text:i,head_notes:a}){t.activity_log.push({id:I.uuidv4(),type:e,timestamp:new Date().toISOString(),text:i,head_notes:a})}function ut(t,{address:e,postcode:i}){t.type==="rent"&&(t.sub_section_details.leadinformation.address=e,t.sub_section_details.leadinformation.postcode=i),console.log("change_address proj",t)}function mt(t,{viewing_timestamp:e,call_timestamp:i,call_notes:a}){typeof t.sub_section_details.viewinginformation=="undefined"&&(t.sub_section_details.viewinginformation={viewing_timestamp:"",call_timestamp:void 0,call_notes:""}),typeof e!="undefined"&&(typeof t.sub_section_details.viewinginformation.viewing_timestamp=="undefined"&&(t.sub_section_details.viewinginformation.viewing_timestamp=""),t.sub_section_details.viewinginformation.viewing_timestamp=e),typeof i!="undefined"&&(typeof t.sub_section_details.viewinginformation.call_timestamp=="undefined"&&(t.sub_section_details.viewinginformation.call_timestamp=void 0),t.sub_section_details.viewinginformation.call_timestamp=i),typeof a!="undefined"&&(typeof t.sub_section_details.viewinginformation.call_notes=="undefined"&&(t.sub_section_details.viewinginformation.call_notes=""),t.sub_section_details.viewinginformation.call_notes=a)}function pt({backend_connection_store:t,projectId:e}){return new Promise(function(i,a){const o={ok:function(u){let n=u.data;i({active_change_object:{complete:function(d){const h={ok:function(j){typeof d!="undefined"&&d(j)},error:a};t.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects",method:"POST",data:n,callback:h})},change_workflow_state:function({workflow_id:d,workflow_stage:h,notes:j}){const P=n.workflow.workflow_used_id,B=n.workflow.current_stage;ct(n,{workflow_id:d,workflow_stage:h});const D="From "+Q.workflows[P].stages[B].name+" to "+Q.workflows[d].stages[h].name+"<BR>"+j;_t(n,{type:"wf_move",text:D,head_notes:"Progressed through workflow"})},change_address:function({address:d,postcode:h}){ut(n,{address:d,postcode:h})},change_viewing_information:function({viewing_timestamp:d,call_timestamp:h,call_notes:j}){mt(n,{viewing_timestamp:d,call_timestamp:h,call_notes:j})}}})},error:a};t.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e,method:"GET",data:void 0,callback:o})})}var U={startChange:pt};function ht(t,e){return e>t.length-2?!1:t[e]==="{"&&t[e+1]==="{"}function ft(t,e){for(var i=e;i<t.length-1;){if(t[i]==="}"&&t[i+1]==="}")return t.substr(e,i+2-e);i++}}function Z(t,e){if(t.length===1)return e[t];const i=t[0];return t.shift(),Z(t,e[i])}function x(t,e){var i=t.substr(2);if(i=i.substr(0,i.length-2).trim(),i==="")return"";const a=i.split(".");return Z(a,e)}function gt(t,e){if(typeof t!="undefined"){for(var i="",a=0;a<t.length;){if(ht(t,a)){const o=ft(t,a);typeof o=="undefined"?i+=t[a]:(i+=x(o,e),a+=o.length-1)}else i+=t[a];a++}return i}}var O={evalmustachstragainstcontext:gt,evalsinglemustach:x};const yt=y({name:"CallAssistCallItemShowCallAim",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{}},methods:{get_mustach_text(t){return O.evalmustachstragainstcontext(t,{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata,calldata:this.calldata})}}}),bt=l("h1",null,"Aim of this Call",-1);function vt(t,e,i,a,o,u){return s(),r("div",null,[bt,w(" "+m(t.get_mustach_text(t.calltemplate.aim)),1)])}var wt=b(yt,[["render",vt]]);const kt=y({name:"CallAssistCallItemShowStages",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{}}}),Ct=l("h1",null,"Call Plan",-1),St={key:0};function $t(t,e,i,a,o,u){return s(),r("div",null,[Ct,(s(!0),r(k,null,C(t.calltemplate.ordered_stages,n=>(s(),r("div",{key:n.id,class:"row"},[n.hide_from_plan?p("",!0):(s(),r("div",St,m(n.name),1))]))),128))])}var jt=b(kt,[["render",$t]]);const Ot=y({name:"CallAssistCallItemShowCallAim",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{}},methods:{weblink_display_text(t){return typeof t.display_text=="undefined"||t.display_text.length<1?t.label:t.display_text}}}),At={class:"CallAssistCallItemShowCallAim-maindiv"},It=l("h1",null,"Lead Information",-1),Tt=l("th",null,"Address:",-1),Nt=l("th",null,"Landlord:",-1),Lt=l("br",null,null,-1),Vt=l("br",null,null,-1),Pt=l("th",null,"Advert Notes",-1),Bt={key:0},Dt=l("br",null,null,-1),Ut=["href"],qt=l("th",null,"Source",-1);function Et(t,e,i,a,o,u){return s(),r("div",At,[It,l("div",null,[l("table",null,[l("tr",null,[Tt,l("td",null,m(t.current_lead.raw.sub_section_details.leadinformation.address)+", "+m(t.current_lead.raw.sub_section_details.leadinformation.postcode),1)]),l("tr",null,[Nt,l("td",null,[w(" Name: "+m(t.current_lead.raw.sub_section_details.leadinformation.landlord_name)+" ",1),Lt,w(" Phone: "+m(t.current_lead.raw.sub_section_details.leadinformation.contact_phone)+" ",1),Vt,w(" Email: "+m(t.current_lead.raw.sub_section_details.leadinformation.contact_email),1)])]),l("tr",null,[Pt,l("td",null,[typeof t.current_lead.raw.sub_section_details.leadinformation.advert_information!="undefined"&&t.current_lead.raw.sub_section_details.leadinformation.advert_information!==""?(s(),r("div",Bt,[(s(!0),r(k,null,C(t.current_lead.raw.sub_section_details.leadinformation.advert_information.split(`
`),n=>(s(),r("div",{key:n,class:"projecttablehead"},m(n),1))),128))])):p("",!0),Dt,(s(!0),r(k,null,C(t.current_lead.raw.sub_section_details.leadinformation.advertweblinks,n=>(s(),r("div",{key:n.id},[l("a",{href:n.label,target:"_new"},m(t.weblink_display_text(n)),9,Ut)]))),128))])]),l("tr",null,[qt,l("td",null,m(t.current_lead.raw.sub_section_details.leadinformation.lead_source),1)])])])])}var Rt=b(Ot,[["render",Et]]);const Mt=y({name:"CallAssistCallItemShowCallAim",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{}},methods:{get_line(t){return O.evalmustachstragainstcontext(t,{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata,calldata:this.calldata})}}}),Ht={class:"CallAssistCallItemShowCallAim-main"},Qt=l("h1",null,"Script Prompt",-1);function Wt(t,e,i,a,o,u){return s(),r("div",Ht,[Qt,l("ul",null,[(s(!0),r(k,null,C(t.item.lines,n=>(s(),r("li",{key:n},m(t.get_line(n)),1))),128))])])}var Ft=b(Mt,[["render",Wt]]);const Kt=y({name:"CallAssistCallItemCustomVariableDisplay",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{}},computed:{title(){return O.evalmustachstragainstcontext(this.item.title,{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata})},body(){return O.evalmustachstragainstcontext(this.item.body,{current_lead:this.current_lead,calltemplate:this.calltemplate,current_stage:this.current_stage,item:this.item,batchdata:this.batchdata})}}});function Jt(t,e,i,a,o,u){return s(),r("div",null,[l("h1",null,m(t.title),1),l("div",null,[(s(!0),r(k,null,C(t.body.split(`
`),n=>(s(),r("div",{key:n},m(n),1))),128))])])}var Gt=b(Kt,[["render",Jt]]);const Yt=t=>{if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}};function tt(t){let e=t.getMinutes();e===0?e="":e<10?e=":0"+e:e=":"+e.toString();let i="am",a=t.getHours();a>11&&(i="pm",a-=12,a===0&&(a=12));const o=a+e+i,n=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"][t.getDay()];return o+" "+n+" "+t.getDate().toString()+Yt(t.getDate())}function zt(t,e,i,a){return!(a<=t||i>=e)}function Xt(t,e,i){let a;return i.reserved_slots.map(function(o){let u=new Date(i.js_day_obj);u.setHours(o.start.substr(0,2),o.start.substr(3,2));let n=new Date(i.js_day_obj);n.setHours(o.end.substr(0,2),o.end.substr(3,2)),zt(t,e,u,n)&&(typeof a=="undefined"?a=new Date(n):a<n&&(a=new Date(n)))}),a}function M(t,e){let i=new Date(e.js_day_obj);i.setHours(18);let a=new Date(t),o=new Date(a);if(o.setTime(o.getTime()+60*60*1e3),o>i)return;let u=Xt(a,o,e);if(typeof u=="undefined")return{text:tt(a),start_js_day_obj:a,end_js_day_obj:o,day:e};if(!(u>i))return M(u,e)}function Zt(t){let e=[];return t.map(function(i){let a=new Date(i.js_day_obj);a.setHours(9);let o=M(a,i);for(;typeof o!="undefined";)e.push(o),a=new Date(o.end_js_day_obj),o=M(a,i)}),e}var xt={get_slot_text:tt,get_slots_from_viewing_days:Zt};function te(t){let e=parseInt(t.substr(0,2))+1;return e<10?e="0"+e.toString():e=e.toString(),e+t.substr(2)}function ee(t,e,i){if(!t.mounted)return;let a=!1;if(i.success_outcome_ids.map(function(n){e.outcome_id===n&&(a=!0)}),!a)return;let o=e.batchdata.viewing_days.items.filter(function(n){return n.id===t.selection_day.id})[0];const u={id:I.uuidv4(),start:t.selection_time,end:te(t.selection_time),text:e.current_lead.name};o.reserved_slots.push(u)}function ae(){return{mounted:!1,option1:"SETONMOUNT",option2:"SETONMOUNT",selection_day:"",selection_time:"09:00",slots:[],outcome_callback:void 0}}function ie(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function F(t){return t<10?"0"+t.toString():t.toString()}function K(t){let e=-1,i=-1;if(typeof t=="string"){let a=new Date(t);e=a.getHours(),i=a.getMinutes()}else e=t.getHours(),i=t.getMinutes();return F(e)+":"+F(i)}const ne=y({name:"CallAssistCallItemArrangeAppointment",emits:["update_item_data"],props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{viewing_days:"CACULATEDONMOUNT"}},computed:{selection_day:{get(){return this.calldata.item_data_vals[this.item.unique_id].selection_day},set(t){let e=this.calldata.item_data_vals[this.item.unique_id];e.selection_day=t,this.$emit("update_item_data",{item_id:this.item.unique_id,item_data:e})}},selection_time:{get(){return this.calldata.item_data_vals[this.item.unique_id].selection_time},set(t){let e=this.calldata.item_data_vals[this.item.unique_id];e.selection_time=t,this.$emit("update_item_data",{item_id:this.item.unique_id,item_data:e})}},busy_slots(){if(typeof this.viewing_days.items=="undefined")return[];let t=[];const e=this;return this.viewing_days.items.filter(function(a){return a.id===e.selection_day.id})[0].reserved_slots.map(function(a){t.push(a.start+" - "+a.end+" "+a.text)}),t},option1_text(){return this.calldata.item_data_vals[this.item.unique_id].option1.text},option2_text(){return this.calldata.item_data_vals[this.item.unique_id].option2.text},selection_day_options(){return this.viewing_days==="CACULATEDONMOUNT"?[]:this.viewing_days.items.map(function(t){return{id:t.id,name:t.text,day:t}})}},methods:{validate(t){return t.id==="skip_call"?!0:!!this.$refs.selection_day.validate()},click_select_opt1(){this.click_select_opt(this.calldata.item_data_vals[this.item.unique_id].option1)},click_select_opt2(){this.click_select_opt(this.calldata.item_data_vals[this.item.unique_id].option2)},click_select_opt(t){let e=this.calldata.item_data_vals[this.item.unique_id];e.selection_time=K(t.start_js_day_obj),e.selection_day=this.selection_day_options.filter(function(i){return i.id===t.day.id})[0],this.$emit("update_item_data",{item_id:this.item.unique_id,item_data:e})},get_output_text(t){return O.evalmustachstragainstcontext(t,{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata,option1:this.option1_text,option2:this.option2_text})},generate_option(t){const e=ie(0,t.items.length),i=t.items[e];let a=[];for(let o=0;o<t.items.length;o++)o!==e&&a.push(t.items[o]);return t.items=a,i}},mounted(){if(this.viewing_days=O.evalsinglemustach("{{"+this.item.viewing_day_var+"}}",{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata,option1:this.option1_text,option2:this.option2_text}),!this.calldata.item_data_vals[this.item.unique_id].mounted){let t={items:xt.get_slots_from_viewing_days(this.viewing_days.items)},e=this.generate_option(t);const i=JSON.parse(JSON.stringify(this.item));let a={mounted:!0,option1:e,option2:this.generate_option(t),selection_day:this.selection_day_options.filter(function(o){return o.id===e.day.id})[0],selection_time:K(e.start_js_day_obj),outcome_callback:function(o,u){return ee(o,u,i)}};this.$emit("update_item_data",{item_id:this.item.unique_id,item_data:a})}}}),le=l("h1",null,"Arrange Appointment",-1),oe={class:"itemarrangeapointment-button-line"},se={class:"row"},re={class:"row items-center justify-end"},de={class:"col"},ce=l("div",null,"Busy Times:",-1);function _e(t,e,i,a,o,u){return s(),r("div",null,[le,w(" "+m(t.get_output_text(t.item.prompt_text))+" ",1),l("div",null,[l("div",oe,[c(f,{label:t.option1_text,onClick:e[0]||(e[0]=n=>t.click_select_opt1())},null,8,["label"]),c(f,{label:t.option2_text,onClick:e[1]||(e[1]=n=>t.click_select_opt2())},null,8,["label"])]),l("div",se,[c(rt,{class:"itemarrangeapointment-selection-day",modelValue:t.selection_day,"onUpdate:modelValue":e[2]||(e[2]=n=>t.selection_day=n),options:t.selection_day_options,label:"Day","emit-value":"","option-label":"name"},null,8,["modelValue","options"]),c(A,{ref:"selection_day",class:"itemarrangeapointment-selection-day",filled:"",modelValue:t.selection_time,"onUpdate:modelValue":e[4]||(e[4]=n=>t.selection_time=n),mask:"time",rules:["time"]},{append:g(()=>[c(q,{name:"access_time",class:"cursor-pointer"},{default:g(()=>[c(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:g(()=>[c(E,{modelValue:t.selection_time,"onUpdate:modelValue":e[3]||(e[3]=n=>t.selection_time=n)},{default:g(()=>[l("div",re,[L(c(f,{label:"Close",color:"primary",flat:""},null,512),[[V]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l("div",de,[ce,(s(!0),r(k,null,C(t.busy_slots,n=>(s(),r("div",{key:n},m(n),1))),128))])])])])}var ue=b(ne,[["render",_e]]);const me=y({name:"CallAssistCallItemInlineActionList",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},emits:["click_action_button"],data(){return{}},methods:{get_mustach_text(t){return O.evalmustachstragainstcontext(t,{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata})},get_action_button_color(t){return typeof t.button_color!="undefined"?t.button_color:t.type==="Outcome"?"secondary":"primary"},get_action_button_text_color(t){if(typeof t.button_text_color!="undefined")return t.button_text_color},click_action_button(t){this.$emit("click_action_button",t)}}}),pe={class:"row"};function he(t,e,i,a,o,u){return s(),r("div",null,[l("h1",null,m(t.get_mustach_text(t.item.title)),1),w(" "+m(t.get_mustach_text(t.item.body))+" ",1),l("div",pe,[(s(!0),r(k,null,C(t.item.actions,n=>(s(),r("div",{key:n.id,class:"CallAssistCall-inlineactionlist"},[c(f,{label:n.button_label,color:t.get_action_button_color(n),"text-color":t.get_action_button_text_color(n),onClick:_=>t.click_action_button(n)},null,8,["label","color","text-color","onClick"])]))),128))])])}var fe=b(me,[["render",he]]);function ge(){return{mounted:!1,value:""}}const ye=y({name:"CallAssistCallItemShowCallAim",emits:["update_item_data"],props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},data(){return{}},computed:{value:{get(){return this.calldata.item_data_vals[this.item.unique_id].value},set(t){let e=this.calldata.item_data_vals[this.item.unique_id];e.value=t,this.$emit("update_item_data",{item_id:this.item.unique_id,item_data:e})}}},methods:{get_mustach_text(t){return O.evalmustachstragainstcontext(t,{current_lead:this.current_lead,current_stage:this.current_stage,calltemplate:this.calltemplate,item:this.item,batchdata:this.batchdata,calldata:this.calldata})}},mounted(){if(!this.calldata.item_data_vals[this.item.unique_id].mounted){const t={mounted:!0,value:this.get_mustach_text(this.item.default)};this.$emit("update_item_data",{item_id:this.item.unique_id,item_data:t})}}});function be(t,e,i,a,o,u){return s(),r("div",null,[c(A,{filled:"",clearable:"",modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value=n),label:t.get_mustach_text(t.item.label)},null,8,["modelValue","label"])])}var ve=b(ye,[["render",be]]);function we(t){return t==="ArrangeAppointment"?ae():t==="Field"?ge():{}}const ke=y({name:"CallAssistCallItems",props:{current_lead:{type:Object},current_stage:{type:Object},calltemplate:{type:Object},item:{type:Object},batchdata:{type:Object},calldata:{type:Object}},emits:["update_item_data","click_action_button"],components:{ItemShowCallAim:wt,ItemShowStages:jt,ItemShowLead:Rt,ItemScriptPrompt:Ft,ItemCustomVariableDisplay:Gt,ItemArrangeAppointment:ue,ItemInlineActionList:fe,ItemField:ve},data(){return{}},methods:{update_item_data(t){this.$emit("update_item_data",t)},click_action_button(t){this.$emit("click_action_button",t)},validate(t){return typeof this.$refs.item.validate=="function"?this.$refs.item.validate(t):!0}}});function Ce(t,e,i,a,o,u){const n=v("ItemShowCallAim"),_=v("ItemShowStages"),d=v("ItemShowLead"),h=v("ItemScriptPrompt"),j=v("ItemCustomVariableDisplay"),P=v("ItemArrangeAppointment"),B=v("ItemInlineActionList"),D=v("ItemField");return s(),r("div",null,[t.item.type==="ShowCallAim"?(s(),S(n,{key:0,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata"])):p("",!0),t.item.type==="ShowStages"?(s(),S(_,{key:1,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata"])):p("",!0),t.item.type==="ShowLead"?(s(),S(d,{key:2,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata"])):p("",!0),t.item.type==="ScriptPrompt"?(s(),S(h,{key:3,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata"])):p("",!0),t.item.type==="CustomVariableDisplay"?(s(),S(j,{key:4,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata"])):p("",!0),t.item.type==="ArrangeAppointment"?(s(),S(P,{key:5,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,onUpdate_item_data:t.update_item_data,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata","onUpdate_item_data"])):p("",!0),t.item.type==="InlineActionList"?(s(),S(B,{key:6,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,onUpdate_item_data:t.update_item_data,onClick_action_button:t.click_action_button,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata","onUpdate_item_data","onClick_action_button"])):p("",!0),t.item.type==="Field"?(s(),S(D,{key:7,current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:t.item,batchdata:t.batchdata,calldata:t.calldata,onUpdate_item_data:t.update_item_data,ref:"item"},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata","onUpdate_item_data"])):p("",!0)])}var Se=b(ke,[["render",Ce]]);function J(t){let e={};if(typeof t!="undefined"){let i=function(a){typeof a.unique_id!="undefined"&&(e[a.unique_id]=we(a.type))};Object.keys(t.stages).map(function(a){t.stages[a].items.map(i),t.stages[a].post_action_items.map(i)})}return{notes:"",item_data_vals:e}}const $e=y({name:"CallAssistCall",props:{current_lead:{type:Object},calltemplate:{type:Object},title_text:{type:String,default:""},batchdata:{type:Object}},emits:["outcome"],components:{CallAssistCallItems:Se},data(){return{current_stage_id:void 0,call_data:J()}},computed:{current_stage(){if(typeof this.current_stage_id!="undefined")return this.calltemplate.stages[this.current_stage_id]}},methods:{update_item_data(t){this.call_data.item_data_vals[t.item_id]=t.item_data},set_stage(t){this.current_stage_id=t},get_action_button_color(t){return typeof t.button_color!="undefined"?t.button_color:t.type==="Outcome"?"secondary":"primary"},get_action_button_text_color(t){if(typeof t.button_text_color!="undefined")return t.button_text_color},item_ref_list(){return Object.keys(this.$refs).filter(function(t){return t.substr(0,9)==="callitem-"})},click_action_button(t){const e=this;let i=!0;this.item_ref_list().map(function(a){e.$refs[a].map(function(o){o.validate(t)||(i=!1)})}),i&&(t.type==="Outcome"?this.click_outcome_action_button(t):this.click_next_stage_action_button(t))},click_outcome_action_button(t){window.scrollTo(0,0),this.$emit("outcome",{outcome_id:t.id,call_data:this.call_data})},click_next_stage_action_button(t){if(window.scrollTo(0,0),typeof this.calltemplate.stages[t.next_stage_id]=="undefined"){N.create({color:"negative",message:"Next stage not found",timeout:2e3});return}this.current_stage_id=t.next_stage_id},reset_call_data(){this.call_data=J(this.calltemplate)},reset_script(){window.scrollTo(0,0),this.set_stage(this.calltemplate.initial_stage_id)}}}),je={key:0},Oe={class:"CallAssistCallItems"},Ae=l("h2",null,"Call notes",-1),Ie=l("h2",null,"Actions",-1),Te={class:"row"},Ne={class:"CallAssistCallItems"};function Le(t,e,i,a,o,u){const n=v("CallAssistCallItems");return typeof t.current_stage_id!="undefined"?(s(),r("div",je,[l("h1",null,"Call Lead "+m(t.current_lead.name)+" "+m(t.title_text),1),l("h2",null,"Stage "+m(t.current_stage.name),1),l("div",Oe,[(s(!0),r(k,null,C(t.current_stage.items,_=>(s(),r("div",{key:_.id},[c(n,{current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:_,batchdata:t.batchdata,calldata:t.call_data,ref_for:!0,ref:"callitem-main-"+_.id,onUpdate_item_data:t.update_item_data,onClick_action_button:t.click_action_button},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata","onUpdate_item_data","onClick_action_button"])]))),128))]),Ae,l("div",null,[c(A,{filled:"",clearable:"",modelValue:t.call_data.notes,"onUpdate:modelValue":e[0]||(e[0]=_=>t.call_data.notes=_),label:"Notes from this call",autogrow:""},null,8,["modelValue"])]),Ie,l("div",Te,[(s(!0),r(k,null,C(t.current_stage.actions,_=>(s(),r("div",{key:_.id,class:"CallAssistCall-actionbutton"},[c(f,{label:_.button_label,color:t.get_action_button_color(_),"text-color":t.get_action_button_text_color(_),onClick:d=>t.click_action_button(_)},null,8,["label","color","text-color","onClick"])]))),128))]),t.current_stage_id!==t.calltemplate.initial_stage_id?(s(),S(f,{key:0,label:"Reset script to start",onClick:t.reset_script},null,8,["onClick"])):p("",!0),l("div",Ne,[(s(!0),r(k,null,C(t.current_stage.post_action_items,_=>(s(),r("div",{key:_.id},[c(n,{current_lead:t.current_lead,current_stage:t.current_stage,calltemplate:t.calltemplate,item:_,batchdata:t.batchdata,calldata:t.call_data,ref_for:!0,ref:"callitem-post-"+_.id,onUpdate_item_data:t.update_item_data,onClick_action_button:t.click_action_button},null,8,["current_lead","current_stage","calltemplate","item","batchdata","calldata","onUpdate_item_data","onClick_action_button"])]))),128))])])):p("",!0)}var Ve=b($e,[["render",Le]]);const G={skip_call_action:{type:"Outcome",id:"skip_call",button_label:"Skip and return to later",button_color:"white",button_text_color:"black"}},Pe=y({name:"CallAssist",emits:["outcome","fully_complete"],components:{CallAssistCall:Ve},data(){return{prepared:!1,calltemplate:void 0,remaining_leads:void 0,total_leads:void 0,batchdata:void 0}},computed:{current_lead(){if(typeof this.remaining_leads!="undefined"&&!(this.remaining_leads.length<1))return this.remaining_leads[0]},calltitletext(){return typeof this.total_leads=="undefined"?"":"("+this.remaining_leads.length.toString()+" leads remaining)"}},methods:{prepare(t,e,i){const a=this;this.calltemplate=JSON.parse(JSON.stringify(t)),this.batchdata=i;let o={id:I.uuidv4(),name:"Prepare for call",items:[{type:"ShowCallAim"},{type:"ShowStages"},{type:"ShowLead"}],actions:[G.skip_call_action,{type:"Next_Stage",next_stage_id:this.calltemplate.initial_stage_id,id:"Make_call",button_label:"Ready to Dial..."}],post_action_items:[]},u={};u[o.id]=o,this.calltemplate.ordered_stages=[],this.calltemplate.ordered_stages.push(o),this.calltemplate.stages.map(function(n){typeof n.hide_from_plan=="undefined"&&(n.hide_from_plan=!1);let _=[];_.push(G.skip_call_action),n.actions.map(function(d){_.push(d)}),a.calltemplate.common_actions.map(function(d){_.push(JSON.parse(JSON.stringify(d)))}),n.actions=_,u[n.id]=n,a.calltemplate.ordered_stages.push(n)}),this.calltemplate.stages=u,this.calltemplate.initial_stage_id=o.id,Object.keys(a.calltemplate.stages).map(function(n){let _=a.calltemplate.stages[n];_.items=_.items.map(function(d){return d.id=I.uuidv4(),d}),_.post_action_items=_.post_action_items.map(function(d){return d.id=I.uuidv4(),d})}),this.remaining_leads=e,this.total_leads=e.length,this.$refs.CallAssistCall.set_stage(this.calltemplate.initial_stage_id),setTimeout(function(){a.$refs.CallAssistCall.reset_call_data()},50),this.prepared=!0},outcome(t){const e={outcome_id:t.outcome_id,call_data:t.call_data,current_lead:this.current_lead,batchdata:this.batchdata};if(Object.keys(t.call_data.item_data_vals).map(function(i){typeof t.call_data.item_data_vals[i].outcome_callback!="undefined"&&t.call_data.item_data_vals[i].outcome_callback(t.call_data.item_data_vals[i],e)}),this.$emit("outcome",JSON.parse(JSON.stringify(e))),this.remaining_leads.length>1){this.remaining_leads.shift(),this.$refs.CallAssistCall.reset_call_data(),this.$refs.CallAssistCall.set_stage(this.calltemplate.initial_stage_id);return}this.$emit("fully_complete")}}}),Be={class:"callassist"},De={key:0};function Ue(t,e,i,a,o,u){const n=v("CallAssistCall");return s(),r("div",Be,[t.prepared?p("",!0):(s(),r("div",De,"Call assist not prepared")),c(n,{ref:"CallAssistCall",current_lead:t.current_lead,calltemplate:t.calltemplate,title_text:t.calltitletext,batchdata:t.batchdata,onOutcome:t.outcome},null,8,["current_lead","calltemplate","title_text","batchdata","onOutcome"])])}var qe=b(Pe,[["render",Ue]]),Ee={aim:"Schedule an in person viewing of the property",initial_stage_id:"1",stages:[{id:"1",name:"Qualify the lead",items:[{type:"ScriptPrompt",lines:["Am I speaking to...","I came across your advert for a room on .... ({{ current_lead.raw.sub_section_details.leadinformation.lead_source }})","Is the property still availiable? (If not ask if landlord has others)","Do you mind if I ask some questions about the property?"]}],actions:[{type:"Next_Stage",next_stage_id:"2",id:"Investigate",button_label:"Next Stage (Investigate Property)"},{type:"Outcome",id:"notavailaible",button_label:"Complete Call - no longer availiable"}],post_action_items:[{type:"ShowLead"}]},{id:"2",name:"Investigate the property",items:[{type:"ScriptPrompt",lines:["General condition","Are you looking for long term or short term tenant?","Is it furnished or unfurnished?","Does it have wifi?","Could it have office or working space for remote working"]}],actions:[{type:"Next_Stage",next_stage_id:"3",id:"landlord_pain",button_label:"Next Stage (Identify landlord pain points)"}],post_action_items:[{type:"ShowLead"}]},{id:"3",name:"Identify Landlord Pain Points",items:[{type:"ScriptPrompt",lines:["How long has it been vacant?","What kind of Tenants do you get in this property? (Professional, student, nurses, etc.)"]}],actions:[{type:"Next_Stage",next_stage_id:"4",id:"landlord_pain",button_label:"Next Stage (Introduce Myself)"}],post_action_items:[{type:"ShowLead"}]},{id:"4",name:"Introduce Myself",items:[{type:"ScriptPrompt",lines:["Can I tell you about myself?"]},{type:"CustomVariableDisplay",title:"My Introduction",body:"{{ batchdata.story_prompt }}"}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Next Stage (Close whilst mentioning company let)"}],post_action_items:[{type:"ShowLead"}]},{id:"5",name:"Close whilst Mentioning company let",items:[{type:"ScriptPrompt",lines:["It would be great to view the property and discuss further.","It won\u2019t be me staying in the property myself and I am looking for a company let <NO PAUSE>"]},{type:"ArrangeAppointment",prompt_text:"I am going to be in the area and I am free on {{ option1 }} and {{ option2 }}, which of these works for you?",viewing_day_var:"batchdata.viewing_days",unique_id:"appointment",success_outcome_ids:["complete"]},{type:"InlineActionList",title:"Handle Objections",body:void 0,actions:[{type:"Next_Stage",next_stage_id:"obj_subletting",id:"obj_subletting",button_label:"Is this subletting?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_who",id:"obj_who",button_label:"Who is going to be living here?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_how",id:"obj_how",button_label:"So how does it all work?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_callback",id:"obj_callback",button_label:"Can you send me an email?/Can I call you back?/Can I think about it?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_granuteerent",id:"obj_granuteerent",button_label:"How can you guarantee the rent?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_agent",id:"obj_agent",button_label:"Are you an agent?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_bills",id:"obj_bills",button_label:"Who takes care of the bills?",button_color:"negative"},{type:"Next_Stage",next_stage_id:"obj_airbnb",id:"obj_airbnb",button_label:"Will it be on Airbnb?",button_color:"negative"}]},{type:"InlineActionList",title:"Other useful notes",body:void 0,actions:[{type:"Next_Stage",next_stage_id:"oth_landlordbenefits",id:"oth_landlordbenefits",button_label:"Benefits to landlords",button_color:"primary"}]}],actions:[{type:"Next_Stage",next_stage_id:"6",id:"confirm_address",button_label:"Confirm Address"}],post_action_items:[{type:"ShowLead"}]},{id:"6",name:"Confirm address",items:[{type:"ScriptPrompt",lines:["Can I confirm the address"]},{type:"Field",unique_id:"address",label:"Address",default:"{{ current_lead.raw.sub_section_details.leadinformation.address }}"},{type:"Field",unique_id:"postcode",label:"Postcode",default:"{{ current_lead.raw.sub_section_details.leadinformation.postcode }}"},{type:"ScriptPrompt",lines:["Ok looking forward to seeing you {{ calldata.item_data_vals.appointment.selection_day.name }} at {{ calldata.item_data_vals.appointment.selection_time }}"]}],actions:[{type:"Outcome",id:"complete",button_label:"Complete Call - viewing arranged"},{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Alter appointment"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_subletting",hide_from_plan:!0,name:"Handle Subletting Objection",items:[{type:"ScriptPrompt",lines:["Empathise: I can understand how some people will think it\u2019s subletting","That term normally describes where the letting is done secretly without the landlord knowledge","In fact this is a common way of letting property","Lots of landlords do this as a way of guaranteeing rent","We do do checks to make sure your property is suitable","It\u2019s much easier to discuss in person, let's get this viewing booked in\u2026.. (BACK TO CLOSE)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_who",hide_from_plan:!0,name:"Explain who is going to be living here",items:[{type:"ScriptPrompt",lines:["Empathise: It\u2019s vital to know who will be staying in the property","It will be a mix of people depending on who needs it at the time but your one point of contact will be me","I will be paying the rent every month","(BACK TO CLOSE)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_how",hide_from_plan:!0,name:"Explain how the arrangement works",items:[{type:"ScriptPrompt",lines:["We enter into a company let agreement where my company rents your property for a fixed period, typically 3-5 years.","We then take care of the property, maintain it, and rent it out to tenants.","We handle all the tenant issues, maintenance, and even void periods.","You get a guaranteed rent every month, regardless of whether the property is occupied or not.","It's a hands-off experience for you as a landlord.","(BACK TO CLOSE)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_callback",hide_from_plan:!0,name:"Can you send email/callback/Can I think about it",items:[{type:"ScriptPrompt",lines:["Empathise: Of course, it\u2019s important fully understand this arrangement","Can I be totally honest with you? There are only three things to think about, do you mind if I share them with you?","1 Serious Intentions: Are you seriously considering this arrangement? If not, what are your reservations?","2 Affordability: Is the proposed rent within your budget? If not, what would be a more comfortable figure for you?","3 Perceived Value: Do you see the value in this arrangement? If not, what aspects are you unsure about?","(BACK TO CLOSE - and pick other objections)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_granuteerent",hide_from_plan:!0,name:"How can you guarantee the rent?",items:[{type:"ScriptPrompt",lines:["Empathise and state concern: I am glad you asked, it\u2019s important you can rely on consistent regular rent payments so you don\u2019t have the stress of wondering if you are getting paid.","Here's how you can be confident in the arrangement","Company Let Agreement - We will be entering into a company let agreement, where my company rents your property for a fixed period. This means that the responsibility for rent payments falls on my company, not individual tenants.","Regular Rent Payments - You will receive a fixed rent every month, regardless of whether the property is occupied or not. This means you have a guaranteed income from your property each month.","Handling Tenant Issues - My company will handle all tenant issues, maintenance, and even void periods. This means you won't have to worry about unpaid rent due to tenant issues.","Financial Stability - My company has a strong financial standing and the ability to cover the rent payments. This means you can have peace of mind knowing that your rent will be paid on time, every time.","Legal Obligations - As per our agreement, my company has a legal obligation to pay the rent. This provides an additional layer of security for you as the landlord, ensuring that your rent will be paid as agreed.","Easy Eviction - If for any reason my company fails to pay the rent, you have the right to evict us immediately. This is because we are a commercial tenant, and the laws are more favorable towards landlords in commercial agreements. This provides you with an extra layer of security and control over your property.","(BACK TO CLOSE - and pick other objections)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_agent",hide_from_plan:!0,name:"Are you an agent?",items:[{type:"ScriptPrompt",lines:["No, I'm not an estate agent. I'm a property investor","I run a property management company","We work with landlords to manage their properties, ensuring they receive a guaranteed rent each month and have a hands-off experience.","(BACK TO CLOSE - and pick other objections)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_bills",hide_from_plan:!0,name:"Who takes care of the bills?",items:[{type:"ScriptPrompt",lines:["Our company will take care of all the bills in the same way a tenant would.","This includes utilities like gas, electricity, and council tax.","This means you won't have to worry about any unexpected costs or unpaid bills.","(BACK TO CLOSE - and pick other objections)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"obj_airbnb",hide_from_plan:!0,name:"Will it be on Airbnb?",items:[{type:"ScriptPrompt",lines:["Yes, the property will be listed on Airbnb as well as other similar platforms.","This is part of our strategy to ensure maximum occupancy and income.","However, we handle all aspects of this, including managing bookings, guest communication, and property maintenance.","(BACK TO CLOSE - and pick other objections)"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]},{id:"oth_landlordbenefits",hide_from_plan:!0,name:"Benefits to landlords",items:[{type:"ScriptPrompt",lines:["Guaranteed Rent","No Management Hassles","No Agency Fees","Property Care","Legal Protection","Bill Payment","High Occupancy"]}],actions:[{type:"Next_Stage",next_stage_id:"5",id:"close",button_label:"Back to Close Stage"}],post_action_items:[{type:"ShowLead"}]}],common_actions:[{type:"Outcome",id:"reject_lead",button_label:"Reject Lead"}]};function Re(t){if(t.length!==5)return!1;const e=t.split(":");if(e.length!==2||e[0].length!==2||e[1].length!==2||isNaN(e[0])||isNaN(e[1]))return!1;const i=parseInt(e[0]);if(i<0||i>23)return!1;const a=parseInt(e[0]);return!(a<0||a>59)}function Y(t,e){for(t=t.toString();t.length<e;)t="0"+t;return t}class et{constructor(e,i){this.hour=e,this.minute=i}isBefore(e){return this.hour<e.hour?!0:this.hour>e.hour?!1:this.minute<e.minute?!0:!(this.minute>e.minute)}addHours(e){this.hour+=e,this.hour>=24&&(this.hour=23,this.minute=59)}toString(){return Y(this.hour,2)+":"+Y(this.minute,2)}}function Me(t){return new et(t.hour,t.minute)}function He(t){const e=t.split(":");return new et(parseInt(e[0]),parseInt(e[1]))}var $={isValidTimeStr:Re,get_time_obj:He,copy_time_obj:Me};const Qe=y({name:"BatchCallLeadsAddBlockDialog",data(){return{dialog_visible:!1,viewing_days:[],selected_day:void 0,selected_start_time:"09:00",selected_end_time:"10:00",text:"Busy"}},computed:{day_list(){return this.viewing_days.filter(function(t){return t.selected}).map(function(t){return{label:t.text,value:t.id}})}},methods:{show_dialog(t,e){this.viewing_days=t,this.selected_start_time="09:00",this.selected_end_time="10:00",this.selected_day=e,this.dialog_visible=!0},update_start_time(){if(!$.isValidTimeStr(this.selected_start_time)||!$.isValidTimeStr(this.selected_end_time))return;const t=$.get_time_obj(this.selected_start_time);if($.get_time_obj(this.selected_end_time).isBefore(t)){let i=$.copy_time_obj(t);i.addHours(1),this.selected_end_time=i.toString()}},notifyvalidationerror(t){N.create({color:"bg-grey-2",message:t,timeout:2e3,color:"negative"})},addbtnclick(){if(!$.isValidTimeStr(this.selected_start_time)){this.notifyvalidationerror("Invalid Start Time");return}if(!$.isValidTimeStr(this.selected_end_time)){this.notifyvalidationerror("Invalid End Time");return}const t=$.get_time_obj(this.selected_start_time);if($.get_time_obj(this.selected_end_time).isBefore(t)){this.notifyvalidationerror("End time must be after start time");return}const i=this;this.viewing_days.filter(function(o){return o.id===i.selected_day})[0].reserved_slots.push({id:I.uuidv4(),start:this.selected_start_time,end:this.selected_end_time,text:this.text}),this.dialog_visible=!1}}}),We=l("div",{class:"text-h6"},"Block out time",-1),Fe=l("div",null," Add time that are not availaible for viewings. ",-1),Ke={class:"row items-center justify-end"},Je={class:"row items-center justify-end"};function Ge(t,e,i,a,o,u){return s(),S(nt,{modelValue:t.dialog_visible,"onUpdate:modelValue":e[6]||(e[6]=n=>t.dialog_visible=n)},{default:g(()=>[c(it,null,{default:g(()=>[c(H,{class:"row items-center q-pb-none"},{default:g(()=>[We,c(dt),L(c(f,{icon:"close",flat:"",round:"",dense:""},null,512),[[V]])]),_:1}),c(H,null,{default:g(()=>[Fe,l("div",null,[w(" Text: "),c(A,{filled:"",modelValue:t.text,"onUpdate:modelValue":e[0]||(e[0]=n=>t.text=n)},null,8,["modelValue"]),w(" Start Time: "),c(A,{filled:"",modelValue:t.selected_start_time,"onUpdate:modelValue":[e[2]||(e[2]=n=>t.selected_start_time=n),t.update_start_time],mask:"time",rules:["time"]},{append:g(()=>[c(q,{name:"access_time",class:"cursor-pointer"},{default:g(()=>[c(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:g(()=>[c(E,{modelValue:t.selected_start_time,"onUpdate:modelValue":[e[1]||(e[1]=n=>t.selected_start_time=n),t.update_start_time]},{default:g(()=>[l("div",Ke,[L(c(f,{label:"Close",color:"primary",flat:""},null,512),[[V]])])]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",null,[w(" End Time: "),c(A,{filled:"",modelValue:t.selected_end_time,"onUpdate:modelValue":e[4]||(e[4]=n=>t.selected_end_time=n),mask:"time",rules:["time"]},{append:g(()=>[c(q,{name:"access_time",class:"cursor-pointer"},{default:g(()=>[c(R,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:g(()=>[c(E,{modelValue:t.selected_end_time,"onUpdate:modelValue":e[3]||(e[3]=n=>t.selected_end_time=n)},{default:g(()=>[l("div",Je,[L(c(f,{label:"Close",color:"primary",flat:""},null,512),[[V]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),c(at,{align:"right",class:"text-primary"},{default:g(()=>[c(f,{label:"Cancel",onClick:e[5]||(e[5]=n=>this.dialog_visible=!1)}),c(f,{color:"primary",label:"Add",onClick:t.addbtnclick},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Ye=b(Qe,[["render",Ge]]);const T="2",z="1",X="1.1",ze="2",Xe=y({name:"BatchCallLeads",components:{BatchCallLeadsAddBlockDialog:Ye,CallAssist:qe},setup(){return{backend_connection_store:st()}},data(){return{callassistactive:!1,story_prompt:"",viewing_days:[],leads_fully_loaded:!1,patches_to_scan:[],project_ids_to_load:[],leads:[]}},computed:{user_profile(){return this.backend_connection_store.user_profile},heading(){const t=this;if(this.$route.query.patchid==="all")return"Call All Leads";if(typeof this.user_profile.patches=="undefined")return"Call Leads";const e=this.user_profile.patches.filter(function(i){return i.id===t.$route.query.patchid});return e.length!==1?"Call Leads":"Call Leads for "+e[0].name}},methods:{outcome(t){const e=t.call_data.notes.replaceAll(`
`,"<BR>"),i=this;if(t.outcome_id==="reject_lead"){U.startChange({backend_connection_store:i.backend_connection_store,projectId:t.current_lead.id}).then(function({active_change_object:a}){a.change_workflow_state({workflow_id:T,workflow_stage:X,notes:e}),a.complete()},function(a){console.log("ERROR",a)});return}if(t.outcome_id==="notavailaible"){U.startChange({backend_connection_store:i.backend_connection_store,projectId:t.current_lead.id}).then(function({active_change_object:a}){a.change_workflow_state({workflow_id:T,workflow_stage:X,notes:"Property not available "+e}),a.complete()},function(a){console.log("ERROR",a)});return}if(t.outcome_id==="complete"){const a=t.call_data.item_data_vals.appointment.selection_day.day.js_day_obj.substring(0,10),o=t.call_data.item_data_vals.appointment.selection_time,n=W.fromISO(a+"T"+o,{zone:"Europe/London"}).toISO({includeOffset:!0,suppressMilliseconds:!1}),_=W.now().toISO();U.startChange({backend_connection_store:i.backend_connection_store,projectId:t.current_lead.id}).then(function({active_change_object:d}){d.change_workflow_state({workflow_id:T,workflow_stage:ze,notes:"Viewing booked for "+t.call_data.item_data_vals.appointment.selection_day.name+" at "+t.call_data.item_data_vals.appointment.selection_time+"<BR>"+e}),d.change_address({address:t.call_data.item_data_vals.address.value,postcode:t.call_data.item_data_vals.postcode.value}),d.change_viewing_information({viewing_timestamp:n,call_timestamp:_,call_notes:t.call_data.notes}),d.complete()},function(d){console.log("ERROR",d)});return}},fully_complete(){N.create({color:"positive",message:"Batch Complete",timeout:2e3}),this.$route.query.patchid!=="all"?this.$router.push("/tools/cansave/patches/"+this.$route.query.patchid+"?starttab=rent_projects"):this.$router.push("/tools")},addreservedslot(t){this.$refs.BatchCallLeadsAddBlockDialog.show_dialog(this.viewing_days,t.id)},delreservedslot(t,e){t.reserved_slots=t.reserved_slots.filter(function(i){return i.id!==e})},click_readytogo(){window.scrollTo(0,0),this.callassistactive=!0;const t=this;setTimeout(function(){var e=t.story_prompt;e===""&&(e="No story prompt provided");let i=[];Object.keys(t.viewing_days).map(function(a){t.viewing_days[a].selected&&i.push(t.viewing_days[a])}),t.$refs.CallAssist.prepare(Ee,t.leads.map(function(a){return{id:a.id,name:a.project_name,raw:a}}),{story_prompt:e,viewing_days:{items:i}})},10)},recursive_get_list_of_projects_to_load(){const t=this;if(this.patches_to_scan.length===0){t.recursive_load_projects();return}const e=this.patches_to_scan.pop(),i={ok:function(a){typeof a.data.workflow_lookup[T]!="undefined"&&typeof a.data.workflow_lookup[T][z]!="undefined"&&a.data.workflow_lookup[T][z].map(function(o){t.project_ids_to_load.push(o)}),t.recursive_get_list_of_projects_to_load()},error:function(a){N.create({color:"negative",message:"Unable to load leads (patches) - please try again later",timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/patches/"+e,method:"GET",data:void 0,callback:i})},recursive_load_projects(){const t=this;if(this.project_ids_to_load.length===0){t.leads_fully_loaded=!0;return}const e=this.project_ids_to_load.pop(),i={ok:function(a){t.leads.push(a.data),t.recursive_load_projects()},error:function(a){N.create({color:"negative",message:"Unable to load leads (project) - please try again later",timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e,method:"GET",data:void 0,callback:i})}},mounted(){const t=this;this.viewing_days=[];const e=new Date;e.setHours(2,0,0,0);for(let a=1;a<8;a++){var i=new Date(e);i.setDate(i.getDate()+a),this.viewing_days.push({id:a.toString(),text:I.format_date_as_string_without_year(i),js_day_obj:i,selected:!0,reserved_slots:[]})}setTimeout(function(){t.$route.query.patchid==="all"?t.patches_data=t.user_profile.patches.map(function(a){t.patches_to_scan.push(a.id)}):t.patches_to_scan.push(t.$route.query.patchid),t.recursive_get_list_of_projects_to_load()},300)}}),Ze={key:0,class:"fit column wrap justify-start items-start content-center"},xe=l("div",{class:"text-h4"},"Aim:",-1),ta=l("div",null,"The aim of the phone call is to secure a views on potential properties.",-1),ea=l("div",null,"We also want to introduce the idea of a company let and make sure the landlord does not get a surprise when we make the viewing.",-1),aa=l("div",{class:"text-h4"},"Story Prompt:",-1),ia=l("div",null,"Enter a prompt that you will use to explain who you are and why you are looking for rent to rent properties to landlords.",-1),na={class:"batchcallleads-storydiv"},la=l("div",{class:"text-h4"},"Free days and time slots",-1),oa=l("div",null,"What days are you free for viewings? (This is used for suggestion prompts)",-1),sa=l("div",null,"Random suggestions will be made between 9am and 6pm on the days selected. You can block off times as required.",-1),ra={class:"row"},da={key:0,class:"batchcallleads-blockouttimebutton"},ca={key:0},_a={key:0,class:"text-h6"},ua={key:1},ma={key:0},pa=l("div",{class:"text-h4"},"There are currently no leads to call",-1),ha={key:0},fa={key:1,class:"batchcallleads-buttongroup"},ga={key:1},ya={class:"text-h4"},ba={key:1,class:"fit column wrap justify-start items-start content-center batchcallleads-storydiv"};function va(t,e,i,a,o,u){const n=v("BatchCallLeadsAddBlockDialog"),_=v("CallAssist");return s(),S(ot,{class:"flex flex-center"},{default:g(()=>[t.callassistactive?p("",!0):(s(),r("div",Ze,[l("h2",null,m(t.heading),1),xe,ta,ea,aa,ia,l("div",na,[c(A,{filled:"",clearable:"",modelValue:t.story_prompt,"onUpdate:modelValue":e[0]||(e[0]=d=>t.story_prompt=d),label:"Story Prompt",autogrow:""},null,8,["modelValue"])]),la,oa,sa,(s(!0),r(k,null,C(t.viewing_days,d=>(s(),r("div",{key:d.id,class:"batchcallleads-daycheckbox"},[l("div",ra,[c(lt,{dense:"",modelValue:d.selected,"onUpdate:modelValue":h=>d.selected=h,label:d.text},null,8,["modelValue","onUpdate:modelValue","label"]),d.selected?(s(),r("div",da,[c(f,{color:"primary",size:"xs",label:"Exclude Time",onClick:h=>t.addreservedslot(d)},null,8,["onClick"])])):p("",!0)]),d.selected?(s(),r("div",ca,[(s(!0),r(k,null,C(d.reserved_slots,h=>(s(),r("div",{key:h.id},[w(" Not "+m(h.start)+"-"+m(h.end)+" "+m(h.text),1),c(f,{round:"",color:"primary",size:"xs",icon:"delete",onClick:j=>t.delreservedslot(d,h.id)},null,8,["onClick"])]))),128))])):p("",!0)]))),128)),w(" \xA0 "),t.leads_fully_loaded?p("",!0):(s(),r("div",_a," Please wait - loading lead information... ")),t.leads_fully_loaded?(s(),r("div",ua,[t.leads.length===0?(s(),r("div",ma,[pa,t.$route.query.patchid==="all"?(s(),r("div",ha,[c(f,{color:"primary",label:"Add Lead",onClick:e[1]||(e[1]=d=>t.$router.push("/tools/rentproject/enterlead"))}),c(f,{color:"primary",label:"Tools",onClick:e[2]||(e[2]=d=>t.$router.push("/tools"))})])):p("",!0),t.$route.query.patchid!=="all"?(s(),r("div",fa,[c(f,{color:"primary",label:"Add Lead",onClick:e[3]||(e[3]=d=>t.$router.push("/tools/rentproject/enterlead?defaultpatch="+t.$route.query.patchid))}),c(f,{color:"primary",label:"Patch Info",onClick:e[4]||(e[4]=d=>t.$router.push("/tools/cansave/patches/"+t.$route.query.patchid+"?starttab=rent_projects"))}),c(f,{color:"primary",label:"Tools",onClick:e[5]||(e[5]=d=>t.$router.push("/tools"))})])):p("",!0)])):p("",!0),t.leads.length!==0?(s(),r("div",ga,[l("div",ya,"You have "+m(t.leads.length)+" leads to call",1),w(" \xA0 "),c(f,{label:"Ready to start making calls...",onClick:t.click_readytogo,color:"secondary"},null,8,["onClick"])])):p("",!0)])):p("",!0),c(n,{ref:"BatchCallLeadsAddBlockDialog"},null,512)])),t.callassistactive?(s(),r("div",ba,[c(_,{ref:"CallAssist",onOutcome:t.outcome,onFully_complete:t.fully_complete},null,8,["onOutcome","onFully_complete"])])):p("",!0)]),_:1})}var Da=b(Xe,[["render",va]]);export{Da as default};

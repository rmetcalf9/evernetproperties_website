import{d as g,N as b,_ as w,r as j,o as n,K as r,L as _,e as s,f as h,a as c,ak as T,M as p,O as f,t as k,Q as D}from"./index.d2ef3ad6.js";import{u as C}from"./backend_connection.dd5f4fd4.js";import{T as N}from"./TodoItem.494d9ff5.js";import{W as y}from"./Workflow_main.60013326.js";import{u as v}from"./utils.3f2e20ba.js";const U=g({name:"TodoDisplayComponent",props:{patch_id:{type:String,default:void 0}},components:{TodoItem:N},setup(){return{backend_connection_store:C()}},data(){return{show_only_active:!0,loaded:!1,loaded_todo_data:void 0,group_by:"group",group_by_options:[{label:"None",value:"none"},{label:"Group",value:"group"},{label:"Project",value:"project"}]}},computed:{display_groups(){const e=this;let d=[],o={"":{name:"",link_url:void 0,filter:void 0}};return this.group_by==="none"?o[""]={name:"",filter:function(t){return!0}}:this.loaded_todo_data.forEach(function(t){e.group_by==="group"&&(o[t.group]={name:t.group,link_url:void 0,filter:function(l){return l.group===t.group}}),e.group_by==="project"&&(o[t.project_name]={name:t.project_name,link_url:"/tools/brrcalc?projectid="+t.project_id,filter:function(l){return l.project_id===t.project_id}})}),Object.keys(o).map(function(t){if(typeof o[t].filter!="undefined"){let l=o[t].name;l===""&&(l="Ungrouped"),d.push({name:l,link_url:o[t].link_url,due_items:e.loaded_todo_data.filter(o[t].filter).filter(function(u){return u.due}),nondue_items:e.loaded_todo_data.filter(o[t].filter).filter(function(u){return!u.due})})}}),d}},methods:{refresh(){const e=this;let d="/me/todos?done=false";typeof this.patch_id!="undefined"&&(d="/me/todos?done=false&patch_id="+this.patch_id);const o={ok:e.refresh_success,error:function(t){b.create({color:"negative",message:"Failed to load todos",timeout:2e3}),e.$router.push("/tools")}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:d,method:"GET",data:void 0,callback:o})},refresh_success(e){const d=this;this.loaded_todo_data=e.data.todos.filter(function(o){return d.show_only_active?(console.log("aa",v.boolean_undefined_to_false(y.workflows[o.project_workflow.workflow_used_id].stages[o.project_workflow.current_stage].active)),v.boolean_undefined_to_false(y.workflows[o.project_workflow.workflow_used_id].stages[o.project_workflow.current_stage].active)):!0}),this.loaded=!0}},mounted(){this.loaded=!1,this.refresh()}}),V={class:"tododisplayclass"},$={key:0},B=s("h1",null,"Loading...",-1),G=[B],I={key:1},E={class:"flex"},L={key:0},O={key:1},P={class:"row"};function Q(e,d,o,t,l,u){const m=j("TodoItem");return n(),r("div",V,[e.loaded?_("",!0):(n(),r("div",$,G)),e.loaded?(n(),r("div",I,[s("div",null,[s("div",null,[s("div",E,[h("Group: "),c(T,{modelValue:e.group_by,"onUpdate:modelValue":d[0]||(d[0]=i=>e.group_by=i),options:e.group_by_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),(n(!0),r(p,null,f(e.display_groups,i=>(n(),r("div",{key:i.name},[typeof i.link_url=="undefined"?(n(),r("div",L,[s("h2",null,k(i.name),1)])):_("",!0),typeof i.link_url!="undefined"?(n(),r("div",O,[s("h2",null,[h(k(i.name)+" ",1),c(D,{color:"primary",icon:"arrow_forward",onClick:a=>e.$router.push(i.link_url)},null,8,["onClick"])])])):_("",!0),s("div",P,[(n(!0),r(p,null,f(i.due_items,a=>(n(),r("div",{key:a.id},[c(m,{todo:a,include_project:e.group_by!="project",onUpdate_todo_item:e.refresh,onDelete_todo_item:e.refresh},null,8,["todo","include_project","onUpdate_todo_item","onDelete_todo_item"])]))),128)),(n(!0),r(p,null,f(i.nondue_items,a=>(n(),r("div",{key:a.id},[c(m,{todo:a,include_project:e.group_by!="project",onUpdate_todo_item:e.refresh,onDelete_todo_item:e.refresh},null,8,["todo","include_project","onUpdate_todo_item","onDelete_todo_item"])]))),128))])]))),128))])])):_("",!0)])}var M=w(U,[["render",Q]]);export{M as T};

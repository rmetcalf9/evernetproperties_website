import{d as f,j,_ as h,o as a,K as n,a as o,Q as u,w as l,aa as k,ae as p,ai as C,e as i,af as _,ah as V,aj as w,L as $,f as S,aC as U,c as Q,r as I,a9 as L,M as b,O as y,t as N}from"./index.472d76b1.js";import{Q as D}from"./QSpace.3895a146.js";import{C as B}from"./ClosePopup.f0ade88d.js";import{Q as O}from"./QSelect.efaf96f6.js";import{c as q}from"./common_constants.94b43302.js";import{u as z}from"./uuid.6153c38a.js";import{u as R}from"./backend_connection.2c8693ef.js";import{T as E}from"./TodoItem.69a3b3ec.js";const G=f({name:"BrrCalcToolbarResearchCall",emits:["activity_log"],data(){return{dialog_visible:j(!1),spoke_to:"",notes:""}},computed:{isDisabled(){return this.spoke_to.length<1||this.notes<3}},methods:{open_dialog(){this.dialog_visible=!0,this.spoke_to="",this.notes=""},click_selling_agent_btn(){const e={type:"research_call",text:"Research call with ("+this.spoke_to+") - "+this.notes,head_notes:void 0};this.$emit("activity_log",e),this.dialog_visible=!1}}}),A={class:"brrcalctoolbar"},M=i("div",{class:"text-h6"},"Log research call",-1);function F(e,t,d,c,g,v){return a(),n("div",A,[o(u,{color:"primary",icon:"call",label:"Research",onClick:e.open_dialog},null,8,["onClick"]),o(w,{modelValue:e.dialog_visible,"onUpdate:modelValue":t[3]||(t[3]=s=>e.dialog_visible=s)},{default:l(()=>[o(k,null,{default:l(()=>[o(p,{class:"row items-center q-pb-none"},{default:l(()=>[M,o(D),C(o(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[B]])]),_:1}),o(p,null,{default:l(()=>[i("div",null,[o(_,{filled:"",clearable:"",modelValue:e.spoke_to,"onUpdate:modelValue":t[0]||(t[0]=s=>e.spoke_to=s),label:"Spoke to",rules:[s=>s.length>2||"Too short"]},null,8,["modelValue","rules"])]),i("div",null,[o(_,{filled:"",autogrow:"",modelValue:e.notes,"onUpdate:modelValue":t[1]||(t[1]=s=>e.notes=s),label:"Notes",rules:[s=>s.length>2||"Too short"]},null,8,["modelValue","rules"])]),o(V,{align:"right",class:"text-primary"},{default:l(()=>[o(u,{label:"Cancel",onClick:t[2]||(t[2]=s=>this.dialog_visible=!1)}),o(u,{color:"primary",icon:"call",label:"Save",onClick:e.click_selling_agent_btn,disable:e.isDisabled},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var $e=h(G,[["render",F]]);const H=2,K=f({name:"BrrCalcToolbarSaveButton",props:["reason_project_not_savable"],emits:["saveproject"],data(){return{changed:!1,autosave_seconds_left:60,ever_saved:!1,save_in_progress:!1,save_monitor_function_running:!1,pending_set_changed:!1}},computed:{no_save_message(){return this.reason_project_not_savable!==""?this.reason_project_not_savable:this.save_in_progress?"Saving...":""},can_save(){return this.save_in_progress?!1:!!this.changed},save_btn_text(){return this.save_in_progress?"Saving...":this.no_save_message!==""?"Not able to save ("+this.no_save_message+")":this.changed?this.autosave_seconds_left===-1?"Save Now":"Save now (auto save in "+this.autosave_seconds_left+")":this.ever_saved?"Saved":"Not able to save (No changes)"},is_project_changed(){return this.changed}},methods:{serializer_load_data(e){this.ever_saved=!0},click_btn(){if(!!this.changed){if(this.no_save_message!==""){this.$q.dialog({title:"Not currently able to save",message:this.no_save_message,html:!0});return}this.autosave_seconds_left=-1,this.save_now()}},set_changed_true(e){if(this.pending_set_changed){console.log("SaveButton.vue:set_changed_true - set changed called but there is already one pending");return}if(this.save_in_progress){console.log("SaveButton.vue:set_changed_true - Delay set changed due to save in progress");const t=this;setTimeout(function(){t.pending_set_changed=!1,t.set_changed_true()},1e3);return}this.changed=!0,this.no_save_message===""&&(typeof e!="undefined"&&typeof e.autosave_seconds!="undefined"?this.autosave_seconds_left=e.autosave_seconds:this.autosave_seconds_left=H,this.start_save_monitor_function())},start_save_monitor_function(){this.save_monitor_function_running||this.save_monitor_function()},save_monitor_function(){if(this.save_monitor_function_running=!0,this.save_in_progress)return;if(this.autosave_seconds_left===-1){this.save_monitor_function_running=!1;return}const e=this;if(e.autosave_seconds_left=e.autosave_seconds_left-1,e.autosave_seconds_left<1){this.save_monitor_function_running=!1,this.save_now();return}setTimeout(e.save_monitor_function,1e3)},save_now(){!this.can_save||(this.save_in_progress=!0,this.$emit("saveproject"))},save_project_complete_notification({success:e,response:t}){console.log("SaveButton - Save completed notification recieved"),this.save_in_progress=!1,e?(this.changed=!1,this.ever_saved=!0):this.autosave_seconds_left=-1}}}),P={class:"brrcalctoolbar"};function J(e,t,d,c,g,v){return a(),n("div",P,[o(u,{color:"primary",icon:"save",label:e.save_btn_text,onClick:e.click_btn},null,8,["label","onClick"])])}var Te=h(K,[["render",J]]);function T(){return{due:"1",description:"",type:"other",group:""}}const W=f({name:"BrrCalcToolbarTodoButton",emits:["createtodo"],data(){return{dialog_visible:!1,dialog_data:T(),type_options:q.todo_item_types,due_options:[{label:"1 Day",value:"1"},{label:"3 Days",value:"3"},{label:"5 Days",value:"5"}]}},computed:{isDisabled(){return!1}},methods:{open_dialog(){this.dialog_data=T(),this.dialog_visible=!0},click_ok(){if(this.$refs.field_description.validate(),this.$refs.field_description.hasError)return;let e=this.dialog_data.group;this.dialog_data.type==="agent"&&(e=""),this.dialog_data.type==="sourcer"&&(e="");const t=parseInt(this.dialog_data.due),d=new Date(new Date().getTime()+t*24*60*60*1e3),c={id:z(),weight:"100",due_date:d.toISOString(),description:this.dialog_data.description,done:!1,done_date:"",group:e,type:this.dialog_data.type,done_text:""};this.$emit("createtodo",c),this.dialog_visible=!1},helpgrouping(){this.$q.dialog({title:"Todo Item Grouping",message:"The grouping field can be left blank. It can be used to group todo items together in displays.",html:!1}).onOk(()=>{})}}}),X={class:"brrcalctoolbar-todobutton"},Y=i("div",{class:"text-h6"},"Log todo task for this project",-1),Z={class:"brrcalctoolbar-field"},x={key:0,class:"brrcalctoolbar-field col flex"},ee={class:"brrcalctoolbar-field"},te={class:"brrcalctoolbar-field"};function oe(e,t,d,c,g,v){return a(),n("div",X,[o(u,{color:"primary",icon:"rule",label:"Add TODO",onClick:e.open_dialog},null,8,["onClick"]),o(w,{modelValue:e.dialog_visible,"onUpdate:modelValue":t[5]||(t[5]=s=>e.dialog_visible=s)},{default:l(()=>[o(k,{class:"brrcalctoolbar-card"},{default:l(()=>[o(p,{class:"row items-center q-pb-none"},{default:l(()=>[Y,o(D),C(o(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[B]])]),_:1}),o(p,null,{default:l(()=>[i("div",null,[i("div",Z,[o(O,{modelValue:e.dialog_data.type,"onUpdate:modelValue":t[0]||(t[0]=s=>e.dialog_data.type=s),options:e.type_options,label:"Type of Task","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e.dialog_data.type==="other"?(a(),n("div",x,[o(_,{modelValue:e.dialog_data.group,"onUpdate:modelValue":t[1]||(t[1]=s=>e.dialog_data.group=s),label:"Grouping",class:"col-grow"},null,8,["modelValue"]),o(u,{round:"",dense:"",flat:"",icon:"info",onClick:e.helpgrouping},null,8,["onClick"])])):$("",!0),i("div",ee,[o(_,{modelValue:e.dialog_data.description,"onUpdate:modelValue":t[2]||(t[2]=s=>e.dialog_data.description=s),label:"Description",autogrow:"",rules:[s=>s.trim().length>3||"Minimum 4 characters"],ref:"field_description"},null,8,["modelValue","rules"])]),i("div",te,[S("How long until it's due: "),o(U,{modelValue:e.dialog_data.due,"onUpdate:modelValue":t[3]||(t[3]=s=>e.dialog_data.due=s),options:e.due_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),o(V,{align:"right",class:"text-primary"},{default:l(()=>[o(u,{label:"Cancel",onClick:t[4]||(t[4]=s=>this.dialog_visible=!1)}),o(u,{color:"primary",icon:"rule",label:"Ok",onClick:e.click_ok,disable:e.isDisabled},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ce=h(W,[["render",oe]]);const se=f({name:"CommonCalcLocation",emits:["projectchanged"],data(){return{coords:{lat:"",long:""},entry_mode:""}},computed:{serializer_card_data(){return{coords:this.coords,entry_mode:this.entry_mode}}},watch:{serializer_card_data(e){this.setchanged()}},methods:{setchanged(){this.emit_project_change_notification&&this.$emit("projectchanged","Location")},serializer_load_data(e){this.emit_project_change_notification=!1,this.coords={lat:"",long:""},this.entry_mode="",typeof e.coords!="undefined"&&(this.coords=e.coords),typeof e.entry_mode!="undefined"&&(this.entry_mode=e.entry_mode);const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)}}}),ae=i("div",{class:"text-h6"},"Location",-1),ne={class:"row"};function ie(e,t,d,c,g,v){return a(),Q(k,{inline:"",class:"q-ma-sm card-style"},{default:l(()=>[o(p,null,{default:l(()=>[ae,i("div",ne,[o(_,{modelValue:e.coords.lat,"onUpdate:modelValue":t[0]||(t[0]=s=>e.coords.lat=s),label:"Latitude",class:"",readonly:""},null,8,["modelValue"]),o(_,{modelValue:e.coords.long,"onUpdate:modelValue":t[1]||(t[1]=s=>e.coords.long=s),label:"Longitude",class:"",readonly:""},null,8,["modelValue"]),o(_,{modelValue:e.entry_mode,"onUpdate:modelValue":t[2]||(t[2]=s=>e.entry_mode=s),label:"Entered mode",class:"",readonly:""},null,8,["modelValue"])])]),_:1})]),_:1})}var Ve=h(se,[["render",ie]]);const le=f({name:"BrrCalcTodos",components:{TodoItem:E},setup(){return{backend_connection_store:R()}},data(){return{todos:[]}},computed:{todo_groups(){let e={"":!0};return this.todos.forEach(function(t){e[t.group]=!0}),e},done_todos(){return this.todos.filter(function(e){return e.done===!0})}},methods:{due_todos(e){return this.todos.filter(function(t){return t.group===e&&t.done===!1&&t.due===!0})},notdone_todos(e){return this.todos.filter(function(t){return t.group===e&&t.done===!1&&t.due===!1})},serializer_load_data(e){this.todos=e},add_single_todo(e){this.todos.push(e)},update_todo_item(e){const t=this;t.todos=t.todos.map(function(d){return d.id==e.id&&(d=e),d})},delete_todo_item(e){const t=this;t.todos=t.todos.filter(function(d){return d.id!==e})}}}),de={class:"text-h6 todos-card-head"},re={style:{width:"100%","max-width":"400px"}},ue={key:0},_e={key:0,class:"todos-grouptitle"},ce=i("div",null,"Completed Items",-1);function pe(e,t,d,c,g,v){const s=I("TodoItem");return a(),n("div",null,[o(k,{inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:l(()=>[o(p,null,{default:l(()=>[i("div",de,[o(L,{name:"rule",size:"30px"}),S(" Todo Items")]),i("div",re,[(a(!0),n(b,null,y(Object.keys(e.todo_groups),r=>(a(),n("div",{key:r},[e.due_todos(r).length+e.notdone_todos(r).length>0?(a(),n("div",ue,[r!==""?(a(),n("div",_e,N(r),1)):$("",!0),i("div",null,[(a(!0),n(b,null,y(e.due_todos(r),m=>(a(),n("div",{key:m.id},[o(s,{todo:m,onUpdate_todo_item:e.update_todo_item,onDelete_todo_item:e.delete_todo_item},null,8,["todo","onUpdate_todo_item","onDelete_todo_item"])]))),128)),(a(!0),n(b,null,y(e.notdone_todos(r),m=>(a(),n("div",{key:m.id},[o(s,{todo:m,onUpdate_todo_item:e.update_todo_item,onDelete_todo_item:e.delete_todo_item},null,8,["todo","onUpdate_todo_item","onDelete_todo_item"])]))),128))])])):$("",!0)]))),128)),i("div",null,[ce,(a(!0),n(b,null,y(e.done_todos,r=>(a(),n("div",{key:r.id},[o(s,{todo:r,onUpdate_todo_item:e.update_todo_item,onDelete_todo_item:e.delete_todo_item},null,8,["todo","onUpdate_todo_item","onDelete_todo_item"])]))),128))])])]),_:1})]),_:1})])}var we=h(le,[["render",pe]]);export{Ve as L,$e as R,Te as S,Ce as T,we as a};

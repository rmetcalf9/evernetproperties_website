import{a as Q}from"./QSelect.c5caaaa0.js";import{d as S,N as k,_ as q,o as l,K as c,M as x,O as z,a as o,w as _,f as W,t as b,Q as h,aa as L,ae as j,e as u,af as A,ah as D,ai as U,aj as M,g as R,k as v,q as d,aG as J,c as N,L as y}from"./index.1f7450dc.js";import{C as G}from"./ClosePopup.53b30211.js";import{W as C}from"./Workflow_main.60013326.js";import{u as I}from"./backend_connection.97610f97.js";function E(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16))}function O(e,t){return{id:E(),label:e,displaytext:t}}const F=S({name:"WebLinksComponent",props:["weblinks"],emits:["updateweblinks"],data(){return{edit_dialog:{visible:!1,record:{},title:"",message:""}}},computed:{weblinkdisplay(){return this.weblinks.map(function(e){if(typeof e.displaytext!="undefined"&&e.displaytext!=null&&e.displaytext.trim().length>0)return{id:e.id,label:e.label,text:e.displaytext,icon:"star"};const t=new URL(e.label);let i="web",s=t.hostname;return t.hostname==="www.google.com"&&(t.pathname.startsWith("/maps/@")&&(t.pathname.includes("/data=")?(s="Google Streetview",i="streetview"):(s="Google Map",i="map")),t.pathname.startsWith("/maps/place")&&(s="Google Place",i="place")),{id:e.id,label:e.label,text:s,icon:i}})}},methods:{editweblink(e){this.edit_dialog.record=JSON.parse(JSON.stringify(this.weblinks.filter(function(t){return t.id===e})[0])),this.edit_dialog.title="Edit Weblink",this.edit_dialog.message="",this.edit_dialog.visible=!0},editweblinkok(){if(!this.validate_weblink(this.edit_dialog.record))return;const e=this,t=this.weblinks.filter(function(i){return e.edit_dialog.record.id!==i.id});t.push(this.edit_dialog.record),this.edit_dialog.visible=!1,e.$emit("updateweblinks",t)},apiaddweblink({url:e,displaytext:t}){const i=this.weblinks.filter(function(s){return!0});i.push(O(e,t)),this.$emit("updateweblinks",i)},clickweblink(e){window.open(e.label,"_blank").focus()},delweblink(e){const t=this.weblinks.filter(function(i){return e!==i.id});this.edit_dialog.visible=!1,this.$emit("updateweblinks",t)},validate_weblink(e){return typeof e.label=="undefined"?(k.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"}),!1):e.label===null?(k.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"}),!1):e.label.startsWith("http")?!0:(k.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"}),!1)},addweblink(){this.edit_dialog.title="Add Weblink",this.edit_dialog.message="Add weblink to information about this property (rightmove, zoopla, etc.)",this.edit_dialog.record=O("",""),this.edit_dialog.visible=!0}}}),K={class:"text-h6"},X={style:{width:"25vw"}};function Y(e,t,i,s,f,m){return l(),c("div",null,[(l(!0),c(x,null,z(e.weblinkdisplay,a=>(l(),c("div",{key:a},[o(Q,{clickable:"",onClick:n=>e.clickweblink(a),removable:"",onRemove:n=>e.editweblink(a.id),color:"primary","text-color":"white",icon:a.icon,"icon-remove":"edit"},{default:_(()=>[W(b(a.text),1)]),_:2},1032,["onClick","onRemove","icon"])]))),128)),o(h,{round:"",color:"primary",icon:"add",onClick:e.addweblink},null,8,["onClick"]),o(M,{modelValue:e.edit_dialog.visible,"onUpdate:modelValue":t[3]||(t[3]=a=>e.edit_dialog.visible=a)},{default:_(()=>[o(L,null,{default:_(()=>[o(j,null,{default:_(()=>[u("div",K,b(e.edit_dialog.title),1)]),_:1}),o(j,{class:"q-pt-none"},{default:_(()=>[u("div",X,[W(b(e.edit_dialog.message)+" ",1),o(A,{modelValue:e.edit_dialog.record.displaytext,"onUpdate:modelValue":t[0]||(t[0]=a=>e.edit_dialog.record.displaytext=a),label:"Display Text",clearable:""},null,8,["modelValue"]),o(A,{modelValue:e.edit_dialog.record.label,"onUpdate:modelValue":t[1]||(t[1]=a=>e.edit_dialog.record.label=a),label:"URL",clearable:""},null,8,["modelValue"])])]),_:1}),o(D,{align:"right"},{default:_(()=>[o(h,{flat:"",label:"Delete",color:"negative",onClick:t[2]||(t[2]=a=>e.delweblink(e.edit_dialog.record.id))}),U(o(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[G]]),o(h,{flat:"",label:"OK",onClick:e.editweblinkok},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var ke=q(F,[["render",Y]]),B=R({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:t}){const i=v(()=>e.sent===!0?"sent":"received"),s=v(()=>`q-message-text-content q-message-text-content--${i.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),f=v(()=>`q-message-text q-message-text--${i.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),m=v(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),a=v(()=>e.size!==void 0?`col-${e.size}`:""),n=v(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function T(r){return t.stamp!==void 0?[r,d("div",{class:"q-message-stamp"},t.stamp())]:e.stamp?[r,d("div",{class:"q-message-stamp",[n.value.stamp]:e.stamp})]:[r]}function $(r,g){const w=g===!0?r.length>1?p=>p:p=>d("div",[p]):p=>d("div",{[n.value.msg]:p});return r.map((p,P)=>d("div",{key:P,class:f.value},[d("div",{class:s.value},T(w(p)))]))}return()=>{const r=[];t.avatar!==void 0?r.push(t.avatar()):e.avatar!==void 0&&r.push(d("img",{class:`q-message-avatar q-message-avatar--${i.value}`,src:e.avatar,"aria-hidden":"true"}));const g=[];t.name!==void 0?g.push(d("div",{class:`q-message-name q-message-name--${i.value}`},t.name())):e.name!==void 0&&g.push(d("div",{class:`q-message-name q-message-name--${i.value}`,[n.value.name]:e.name})),t.default!==void 0?g.push($(J(t.default()),!0)):e.text!==void 0&&g.push($(e.text)),r.push(d("div",{class:a.value},g));const w=[];return t.label!==void 0?w.push(d("div",{class:"q-message-label"},t.label())):e.label!==void 0&&w.push(d("div",{class:"q-message-label",[n.value.label]:e.label})),w.push(d("div",{class:m.value},r)),d("div",{class:`q-message q-message-${i.value}`},w)}}});function H(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16))}const Z=S({name:"BrrCalcActivityJob",emits:["projectchanged"],data(){return{activity_log:[],emit_project_change_notification:!0}},computed:{serializer_card_data(){return this.activity_log},activity_log_display(){let e=[];const t={book_viewing:{sent:!0,name:"Viewing booked"},hold_viewing:{sent:!1,name:"Viewing"},call_agent:{sent:!0,name:"Call to agent"},research_call:{sent:!0,name:"Research Call"},wf_move:{sent:!1,name:"Workflow"},admin:{sent:!1,name:"Admin action"},offer_made:{sent:!0,name:"Offer made"},offer_rejected:{sent:!1,name:"Offer rejected"},offer_accepted:{sent:!1,name:"Offer accepted"}};let i="";return this.activity_log.forEach(function(s){const f=new Date(s.timestamp),m=f.toDateString(),a=f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});i!==m&&(i=m,e=e.concat([{id:H(),label:i}]));let n=t[s.type].name;typeof s.head_notes!="undefined"&&(n=n+" ("+s.head_notes+")"),e=e.concat({id:s.t,label:void 0,name:n,text:s.text,sent:t[s.type].sent,stamp:a,avatar:"activity_log_icon_"+s.type+".png"})}),e}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged","ActivityLog:serializer")}},methods:{log_activity(e){var t=this.activity_log.filter(function(i){return!0});t.push({id:H(),type:e.type,timestamp:new Date().toISOString(),text:e.text,head_notes:e.head_notes}),this.activity_log=t,this.$emit("projectchanged","ActivityLog:log_activity")},serializer_load_data(e){this.emit_project_change_notification=!1,this.activity_log=e;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)}}}),ee=u("div",{class:"text-h6"},"Activity Log",-1),te={style:{width:"100%","max-width":"400px"}},ae={key:0},ie={key:1},se=["src"];function oe(e,t,i,s,f,m){return l(),N(L,{inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:_(()=>[o(j,null,{default:_(()=>[ee,u("div",te,[(l(!0),c(x,null,z(e.activity_log_display,a=>(l(),c("div",{key:a.id},[typeof a.label=="string"?(l(),c("div",ae,[o(B,{label:a.label},null,8,["label"])])):y("",!0),typeof a.label=="undefined"?(l(),c("div",ie,[o(B,{name:a.name,text:[a.text],sent:a.sent,stamp:a.stamp,avatar:a.avatar},{avatar:_(()=>[u("img",{class:"q-message-avatar q-message-avatar--sent",alt:"Avatar",src:"/"+a.avatar},null,8,se)]),_:2},1032,["name","text","sent","stamp","avatar"])])):y("",!0)]))),128))])]),_:1})]),_:1})}var be=q(Z,[["render",oe]]);function V(e){return{workflow_used_id:e,current_stage:C.workflows[e].initial_stage}}const le=S({name:"BrrCalcWorkflow",emits:["projectchanged","activity_log"],props:{default_workflow_id:{type:String,default:C.default_workflow_id}},data(){return{workflow_data:V(C.default_workflow_id),emit_project_change_notification:!0}},computed:{serializer_card_data(){return this.workflow_data},workflow_model(){return C.workflows[this.workflow_data.workflow_used_id]}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged","Workflow")}},methods:{progress(e){const t={type:"wf_move",text:"From "+this.workflow_model.stages[this.workflow_data.current_stage].name+" to "+this.workflow_model.stages[e].name,head_notes:"Progressed through workflow"};this.workflow_data.current_stage=e,this.$emit("activity_log",t)},serializer_load_data(e){this.emit_project_change_notification=!1,typeof e.workflow_used_id=="undefined"?this.workflow_data=V(this.default_workflow_id):this.workflow_data=e;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)}},mounted(){this.workflow_data=V(this.default_workflow_id)}}),ne={class:"text-h6"},re={class:"col"},de={key:0},ce={key:0},ue={key:1,class:"resetbuttondiv"};function me(e,t,i,s,f,m){return l(),N(L,{inline:"",class:"q-ma-sm card-style"},{default:_(()=>[o(j,null,{default:_(()=>[u("div",ne,"Workflow - "+b(e.workflow_model.name),1),u("div",re,[u("div",null,[u("h3",null,"Stage: "+b(e.workflow_model.stages[e.workflow_data.current_stage].name),1)]),typeof e.workflow_model.stages[e.workflow_data.current_stage].progression!="undefined"?(l(),c("table",de,[u("tbody",null,[u("tr",null,[u("td",null,[(l(!0),c(x,null,z(e.workflow_model.stages[e.workflow_data.current_stage].progression.success,a=>(l(),c("div",{key:a.next_stage},[o(h,{color:"positive",icon:"donut_large",label:"Progress to next stage ("+e.workflow_model.stages[a.next_stage].name+")",onClick:n=>e.progress(a.next_stage)},null,8,["label","onClick"])]))),128))]),typeof e.workflow_model.stages[e.workflow_data.current_stage].progression.failed!="undefined"?(l(),c("td",ce,[o(h,{color:"negative",icon:"directions_off",label:e.workflow_model.stages[e.workflow_model.stages[e.workflow_data.current_stage].progression.failed].name,onClick:t[0]||(t[0]=a=>e.progress(e.workflow_model.stages[e.workflow_data.current_stage].progression.failed))},null,8,["label"])])):y("",!0)])])])):y("",!0),e.workflow_data.current_stage!==e.workflow_model.initial_stage?(l(),c("div",ue,[o(h,{icon:"donut_large",label:"Reset workflow",onClick:t[1]||(t[1]=a=>e.progress(e.workflow_model.initial_stage))})])):y("",!0)])]),_:1})]),_:1})}var ye=q(le,[["render",me]]);const _e=S({name:"ProjectSerializer",emits:["saveprojectcomplete"],props:{project_type:{type:String,default:"Unknown"},success_message:{type:String,default:"Project Saved"}},setup(){return{backend_connection_store:I()}},data(){return{loaded_project_id:void 0,proj_summary_data:{metadata:void 0,timestamp_first_entered:void 0},passthroughdata:void 0}},methods:{serializer_load_data(e){this.loaded_project_id=e.id,this.proj_summary_data.timestamp_first_entered=e.timestamp_first_entered,this.proj_summary_data.metadata=e.metadata},save_project({dict_of_card_info:e,activity_log:t,workflow:i,patch_id:s,passthroughdata:f}){this.passthroughdata=f;const m={};for(const $ in Object.keys(e)){const r=Object.keys(e)[$];m[r]=JSON.parse(JSON.stringify(e[r]))}const a={user_id:this.backend_connection_store.user_profile.id,patch_id:s,timestamp_first_entered:this.proj_summary_data.timestamp_first_entered,initial_phase:{total_money_in:0,start_value:0,end_value:0,flip_roi:0},reoccurring_phase:[],location:{},workflow:i,activity_log:t,sub_section_details:m,tags:[],risks:[],type:this.project_type};typeof this.loaded_project_id!="undefined"?(a.id=this.loaded_project_id,a.metadata=this.proj_summary_data.metadata):a.timestamp_first_entered=new Date().toISOString();const n=this,T={ok:n.save_api_call_success,error:n.save_api_call_fail};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects",method:"POST",data:a,callback:T})},save_api_call_success(e){this.$emit("saveprojectcomplete",{success:!0,response:e,passthroughdata:this.passthroughdata}),this.serializer_load_data(e.data),k.create({color:"positive",message:this.success_message,timeout:2e3})},save_api_call_fail(e){this.$emit("saveprojectcomplete",{success:!1,response:e,passthroughdata:this.passthroughdata}),k.create({color:"negative",message:"Save failed - "+e.response.data.message,timeout:2e3})}},mounted(){}});function fe(e,t,i,s,f,m){return l(),c("div")}var $e=q(_e,[["render",fe]]);export{be as A,$e as P,ke as W,ye as a};

import{Q as T}from"./QPage.1d268709.js";import{u as h}from"./backend_connection.50679ed3.js";import{d as f,_ as m,r as k,o as n,g as i,e as c,a as t,w as a,f as _,t as b,ad as j,a7 as $,aq as l,N as g,c as w}from"./index.007b0c12.js";import{b as C,Q as P}from"./QTable.89d9beba.js";import{Q as y}from"./QTr.a01851d0.js";import{C as R}from"./CommonBRRToolLink.034c1cd7.js";import"./axios.6e1fcf85.js";import"./QItemLabel.df83f7bf.js";import"./position-engine.851437de.js";const B=f({name:"ToolsCansavePatchePage",props:["patch_data_projects"],components:{CommonBRRToolLink:R},setup(){return{backend_connection_store:h()}},data(){return{rows:[],filter:"",columns:[{name:"address",required:!0,label:"Address",align:"left",field:"address",sortable:!0}]}},computed:{user_profile(){return this.backend_connection_store.user_profile}},methods:{onRowClick(e){this.$router.push("/tools/brrcalc?projectid="+e.id)},recursive_load_project_details(){const e=this.rows.filter(function(r){return r.loaded===!1});if(e.length===0)return;const o=e[0],d=this,p={ok:function(r){o.loaded=!0,o.address=r.data.sub_section_details.dealbasicinfo.address,d.recursive_load_project_details()},error:function(r){o.loaded=!0,o.address="TODO LOAD FAIL",d.recursive_load_project_details()}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+o.id,method:"GET",data:void 0,callback:p})}},mounted(){this.rows=this.patch_data_projects.map(function(e){return{id:e,loaded:!1,address:"loading..."}}),this.recursive_load_project_details()}}),Q={class:"q-pa-md"},N={key:0},V={key:1};function I(e,o,d,p,r,v){const u=k("CommonBRRToolLink");return n(),i("div",null,[c("div",Q,[t(P,{flat:"",bordered:"",title:"Projects",rows:e.rows,columns:e.columns,filter:e.filter,"no-data-label":"I didn't find anything for you","no-results-label":"The filter didn't uncover any results","row-key":"name"},{body:a(s=>[t(y,{props:s,onClick:F=>e.onRowClick(s.row)},{default:a(()=>[t(C,{key:"address",props:s},{default:a(()=>[_(b(s.row.address),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),"top-right":a(()=>[t(j,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":o[0]||(o[0]=s=>e.filter=s),clearable:"",placeholder:"Search"},{append:a(()=>[t($,{name:"search"})]),_:1},8,["modelValue"])]),"no-data":a(({})=>[c("div",null,[e.rows.length===0?(n(),i("div",N,[_(" No projects in this patch - use the BRR calculator to create one "),t(u)])):l("",!0),e.rows.length!==0?(n(),i("div",V," No projects match the filter ")):l("",!0)])]),_:1},8,["rows","columns","filter"])])])}var L=m(B,[["render",I]]);const A=f({name:"ToolsCansavePatchePage",components:{ProjectTable:L},setup(){return{backend_connection_store:h()}},data(){return{loaded:!1,patch_data:{}}},computed:{user_profile(){return this.backend_connection_store.user_profile}},methods:{click_brrr_card(){this.$router.push("/tools/brrcalc")},refresh(){const e=this,o={ok:e.refresh_success,error:function(d){g.create({color:"negative",message:"Failed to find patch information",timeout:2e3}),e.$router.push("/tools/cansave/patches")}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/patches/"+e.$route.params.patchid,method:"GET",data:void 0,callback:o})},refresh_success(e){this.patch_data=e.data,this.loaded=!0}},mounted(){this.loaded=!1,this.refresh()}}),q={key:0},D=c("h1",null,"Loading...",-1),E=[D],O={key:1},S=c("h2",null,"Projects",-1);function U(e,o,d,p,r,v){const u=k("ProjectTable");return n(),w(T,{class:"flex flex-center"},{default:a(()=>[e.loaded?l("",!0):(n(),i("div",q,E)),e.loaded?(n(),i("div",O,[c("h1",null,b(e.patch_data.name),1),S,c("div",null,[t(u,{patch_data_projects:e.patch_data.projects},null,8,["patch_data_projects"])])])):l("",!0)]),_:1})}var Y=m(A,[["render",U]]);export{Y as default};

import{d as g,N as c,_ as y,r as l,o as s,c as v,w as d,a as o,K as k,L as f,f as b,Q as p,t as V,e as n,af as r,a9 as S,ae as C,aa as z}from"./index.1f7450dc.js";import{Q as I}from"./QPage.3ab2d3f1.js";import{u as T}from"./use-quasar.d04a86b1.js";import{Q as w}from"./QSelect.c5caaaa0.js";import{u as P,a as A}from"./backend_connection.97610f97.js";import{W as N,A as E,a as U,P as W}from"./ProjectSerializer.d4adbf71.js";import{W as Q}from"./Workflow_main.60013326.js";import{c as q}from"./common_constants.94b43302.js";import"./QItemLabel.91c57b4a.js";import"./format.bf98ba85.js";import"./position-engine.32b80e69.js";import"./axios.6e1fcf85.js";import"./ClosePopup.53b30211.js";const B=g({name:"LeadInformationCard",emits:["projectchanged"],props:["ever_saved"],components:{Weblinks:N},setup(){return{backend_connection_store:P()}},data(){return{emit_project_change_notification:!0,patch:{id:"notset",name:"Not Set"},address:"",postcode:"",landlord_name:"",contact_phone:"",contact_email:"",advert_information:"",advertweblinks:[],lead_source:"Not Selected",lead_source_options:["Not Selected","Gumtree","Facebook","Spareroom","Networking","Open Rent","Council HMO List","Referral","Response to Campaign","Other"]}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged","LeadInformation:serializer")}},computed:{serializer_card_data(){return{patch_id:this.patch.id,address:this.address,postcode:this.postcode,landlord_name:this.landlord_name,contact_phone:this.contact_phone,contact_email:this.contact_email,advert_information:this.advert_information,advertweblinks:this.advertweblinks,lead_source:this.lead_source}},patch_list(){return this.backend_connection_store.user_profile.patches.concat([{id:"create",name:"Add..."}])}},methods:{reset_data(){console.log("RESET DATA CALL"),this.emit_project_change_notification=!1,this.patch={id:"notset",name:"Not Set"},this.address="",this.postcode="",this.landlord_name="",this.contact_phone="",this.contact_email="",this.advert_information="",this.advertweblinks=[],this.lead_source="Not Selected";const e=this;setTimeout(function(){e.emit_project_change_notification=!0},50)},serializer_load_data(e){this.emit_project_change_notification=!1,this.address=e.address,this.postcode=e.postcode,this.landlord_name=e.landlord_name,this.contact_phone=e.contact_phone,this.contact_email=e.contact_email,this.advert_information=e.advert_information,this.lead_source=e.lead_source,this.patch=this.patch_list.filter(function(i){return i.id===e.patch_id})[0],typeof e.advertweblinks=="undefined"?this.advertweblinks=[]:this.advertweblinks=e.advertweblinks;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)},isEmpty(e){return e==null?!0:e.length==0},copy_text(e){const t={ok:function(i){c.create({color:"bg-grey-2",message:"Copied to clipboard",timeout:2e3})},error:function(i){c.create({color:"negative",message:"Copy failed",timeout:2e3})}};A.copyTextToClipboard2(e,t)},select_patch_by_id(e){console.log("LeadInformation select_patch_by_id",e),this.patch=this.patch_list.filter(function(t){return t.id===e})[0]},select_patch(e){if(e.id==="create"){const t=this;this.$q.dialog({title:"Add new patch",message:"Enter the name for the new patch",html:!1,ok:{push:!0,label:"Ok"},cancel:{push:!0,label:"Cancel"},prompt:{model:"",type:"text"}}).onOk(i=>{t.new_patch_value=i;const m={ok:t.createpatchcallback,error:function(u){c.create({color:"negative",message:"Create patch failed "+u.response.data.message,timeout:2e3})}},_={patch_name:i};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/patches",method:"POST",data:_,callback:m})})}},createpatchcallback(e){this.backend_connection_store.update_user_profile({user_profile:e.data.user_profile,then:this.createpatchcallback2})},createpatchcallback2(){const e=this;this.patch=this.patch_list.filter(function(t){return t.name===e.new_patch_value})[0],this.new_patch_value=""},updateadvertweblinks(e){this.advertweblinks=e,this.emit_project_change_notification&&this.$emit("projectchanged","LeadInformation:updateweblinks")}}}),O=n("div",{class:"text-h6"},"Lead Information",-1),R={key:0},D={key:1,class:"brrcalc-dealbasicinfo-patch"},F=n("div",null,"Advert Links",-1),G=n("div",null,"Lead Source Gumtree/Facebook/Spareroom",-1);function H(e,t,i,m,_,u){const h=l("Weblinks");return s(),v(z,{inline:"",class:"q-ma-sm card-style col-grow"},{default:d(()=>[o(C,null,{default:d(()=>[O,e.ever_saved?f("",!0):(s(),k("div",R,[o(w,{modelValue:e.patch,"onUpdate:modelValue":[t[0]||(t[0]=a=>e.patch=a),e.select_patch],options:e.patch_list,label:"Patch","emit-value":"","option-label":"name"},null,8,["modelValue","options","onUpdate:modelValue"])])),e.ever_saved?(s(),k("div",D,[b(" Patch: "),o(p,{flat:"",onClick:t[1]||(t[1]=a=>e.$emit("navigate_away",{dest:"/tools/cansave/patches/"+e.patch.id}))},{default:d(()=>[b(V(e.patch.name),1)]),_:1})])):f("",!0),n("div",null,[o(r,{filled:"",clearable:"",modelValue:e.address,"onUpdate:modelValue":t[2]||(t[2]=a=>e.address=a),label:"Address"},null,8,["modelValue"])]),n("div",null,[o(r,{filled:"",clearable:"",modelValue:e.postcode,"onUpdate:modelValue":t[4]||(t[4]=a=>e.postcode=a),label:"Postcode"},{append:d(()=>[e.isEmpty(e.postcode)?f("",!0):(s(),v(S,{key:0,class:"q-field__focusable-action",name:"content_copy",onClick:t[3]||(t[3]=a=>e.copy_text(e.postcode))}))]),_:1},8,["modelValue"])]),n("div",null,[o(r,{filled:"",clearable:"",modelValue:e.landlord_name,"onUpdate:modelValue":t[5]||(t[5]=a=>e.landlord_name=a),label:"Landlord Name"},null,8,["modelValue"])]),n("div",null,[o(r,{filled:"",clearable:"",modelValue:e.contact_phone,"onUpdate:modelValue":t[6]||(t[6]=a=>e.contact_phone=a),label:"Contact Phone"},null,8,["modelValue"])]),n("div",null,[o(r,{filled:"",clearable:"",modelValue:e.contact_email,"onUpdate:modelValue":t[7]||(t[7]=a=>e.contact_email=a),label:"Contact Email"},null,8,["modelValue"])]),n("div",null,[o(r,{filled:"",clearable:"",modelValue:e.advert_information,"onUpdate:modelValue":t[8]||(t[8]=a=>e.advert_information=a),label:"Advert Information",autogrow:""},null,8,["modelValue"])]),F,o(h,{ref:"Weblinks",weblinks:e.advertweblinks,onUpdateweblinks:e.updateadvertweblinks},null,8,["weblinks","onUpdateweblinks"]),G,o(w,{modelValue:e.lead_source,"onUpdate:modelValue":t[9]||(t[9]=a=>e.lead_source=a),options:e.lead_source_options,label:"Lead Source","emit-value":"","option-label":"name"},null,8,["modelValue","options"])]),_:1})]),_:1})}var K=y(B,[["render",H]]);const M=g({name:"RentProjectEnterLead",components:{LeadInformation:K,ActivityLog:E,Workflow:U,ProjectSerializer:W},setup(){return{q:T()}},data(){return{}},computed:{default_workflow_id(){return Q.default_rent_workflow_id},project_type(){return q.project_type_constants.project_type_rent},no_save_reason(){return this.$refs.LeadInformation.serializer_card_data.patch_id==="notset"?(console.log("Patch error",this.$refs.LeadInformation.serializer_card_data.patch_id),"You must select a patch"):this.$refs.LeadInformation.serializer_card_data.landlord_name.length<3?"Enter landlord name":this.$refs.LeadInformation.serializer_card_data.contact_phone.length<3?"Enter a contact phonenumber":""},serialized_data(){return{leadinformation:this.$refs.LeadInformation.serializer_card_data}}},methods:{click_cancel(){this.$router.push("/tools")},click_save(e){if(this.no_save_reason!==""){c.create({color:"negative",message:this.no_save_reason,timeout:2e3});return}this.q.loading.show({message:"Saving lead..."}),this.$refs.ProjectSerializer.save_project({dict_of_card_info:this.serialized_data,activity_log:this.$refs.ActivityLog.serializer_card_data,workflow:this.$refs.Workflow.serializer_card_data,patch_id:this.serialized_data.leadinformation.patch_id,passthroughdata:{add_another:e,patch_id:this.serialized_data.leadinformation.patch_id}})},save_project_complete({success:e,response:t,passthroughdata:i}){this.q.loading.hide(),e&&(i.add_another?(this.reset_data(),this.$refs.LeadInformation.select_patch_by_id(i.patch_id)):this.$router.push("/tools"))},reset_data(){this.$refs.LeadInformation.reset_data()}}}),Y={class:"fit column wrap justify-start items-start content-center"},J=n("h2",null,"Enter new Rental Lead",-1),X=n("p",null,"Enter a new rental lead to follow up later.",-1),Z={class:"enterlead-btnbar"},x={class:"enterlead-hiddenparts"};function ee(e,t,i,m,_,u){const h=l("LeadInformation"),a=l("ProjectSerializer"),$=l("ActivityLog"),L=l("Workflow");return s(),v(I,{class:""},{default:d(()=>[n("div",Y,[J,X,o(h,{ref:"LeadInformation"},null,512),n("div",Z,[o(p,{label:"Cancel",onClick:e.click_cancel},null,8,["onClick"]),o(p,{color:"primary",label:"Save",onClick:t[0]||(t[0]=j=>e.click_save(!1))}),o(p,{color:"primary",label:"Save and add another",onClick:t[1]||(t[1]=j=>e.click_save(!0))})]),o(a,{ref:"ProjectSerializer",onSaveprojectcomplete:e.save_project_complete,project_type:e.project_type,success_message:"Lead Saved"},null,8,["onSaveprojectcomplete","project_type"]),n("div",x,[o($,{ref:"ActivityLog"},null,512),o(L,{ref:"Workflow",default_workflow_id:e.default_workflow_id},null,8,["default_workflow_id"])])])]),_:1})}var ue=y(M,[["render",ee]]);export{ue as default};

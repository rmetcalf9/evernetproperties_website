import{d as k,_ as v,N as g,r as C,o as i,K as l,e as s,f as m,a as t,w as p,t as _,L as n,Q as u,aa as D,ae as h,ai as T,af as f,aC as j,ah as N,aj as V,ad as w}from"./index.1dd362fa.js";import{Q as S}from"./QSpace.bd472c8e.js";import{Q as $}from"./QSelect.4af34799.js";import{C as O}from"./ClosePopup.5767cfaa.js";import{u as U}from"./backend_connection.ccda3c90.js";import{u as E}from"./data_caches.0b3bf1a7.js";import{c as y}from"./common_constants.94b43302.js";function I(e,o){const r=Math.abs(e-o);return Math.round(r/864e5)}const Q=k({name:"BrrCalcTodoItem",props:{todo:{type:Object,default:void 0},include_project:{type:Boolean,default:!1}},emits:["update_todo_item","delete_todo_item"],setup(){const e=U(),o=E();return{backend_connection_store:e,dataCachesStore:o}},data(){return{dialog_visible:!1,type_options:y.todo_item_types,dialog_data:{description:"",type:"other",group:"",due:"UNCHANGED",loaded_todo:void 0},due_options:[{label:"Unchanged",value:"UNCHANGED"},{label:"1 Day",value:"1"},{label:"3 Days",value:"3"},{label:"5 Days",value:"5"}]}},computed:{get_item_class(){return this.todo.done?"todoitem-tododoneitem todoitem-all":this.todo.due?"todoitem-duetodoitem todoitem-all flex col":"todoitem-todoitem todoitem-all flex col"}},methods:{helpgrouping(){this.$q.dialog({title:"Todo Item Grouping",message:"The grouping field can be left blank. It can be used to group todo items together in displays.",html:!1}).onOk(()=>{})},get_multiline_html(e){return e.replaceAll(`
`,"<br/>")},get_todo_item_type(e){return y.todo_item_types.filter(function(o){return o.value===e})[0].label},due_date_text(e){if(e.due)return"Due by: NOW!";const o=I(new Date,new Date(e.due_date));return o===1?"Due in: "+o+" day":"Due in: "+o+" days"},done_date_text(e){const o=new Date(e),d={weekday:"short",year:"numeric",month:"short",day:"numeric"};return o.toLocaleDateString("en-GB",d)},btn_edit(e){this.dialog_data.description=e.description,this.dialog_data.type=e.type,this.dialog_data.group=e.group,this.dialog_data.due="UNCHANGED",this.dialog_data.loaded_todo=e,this.dialog_visible=!0},click_dialog_ok(){if(this.dialog_data.loaded_todo.description=this.dialog_data.description,this.dialog_data.loaded_todo.type=this.dialog_data.type,this.dialog_data.loaded_todo.group=this.dialog_data.group,this.dialog_data.due!=="UNCHANGED"){const e=parseInt(this.dialog_data.due),o=new Date(new Date().getTime()+e*24*60*60*1e3);this.dialog_data.loaded_todo.due_date=o.toISOString()}this.exec_update_todo_item(this.dialog_data.loaded_todo),this.dialog_visible=!1},btn_mark_done(e){const o=this;this.$q.dialog({title:"Completion Notes",message:"Description: "+e.description+" - Enter notes around completion of this task.",html:!1,ok:{push:!0,label:"Ok",color:"primary"},cancel:{push:!0,label:"Cancel",color:"secondary"},prompt:{model:e.done_text,type:"text"}}).onOk(d=>{e.done_text=d,e.done_date=new Date().toISOString(),e.done=!0,o.exec_update_todo_item(e)})},btn_mark_undone(e){e.done=!1,this.exec_update_todo_item(e)},exec_update_todo_item(e){const o=this,d={ok:function(r){o.$emit("update_todo_item",r.data.todo)},error:function(r){g.create({color:"bg-grey-2",message:r.message,timeout:2e3,color:"negative"})}};o.dataCachesStore.invalidate({object_type:"projects",object_id:e.project_id}),o.dataCachesStore.invalidate({object_type:"patches",object_id:e.patch_id}),o.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e.project_id+"/todos",method:"POST",data:e,callback:d})},btn_delete(e){const o=this;this.$q.dialog({title:"Delete Todo",message:'Are you sure you want to delete "'+e.description+'"?',html:!1,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"}}).onOk(d=>{o.exec_delete(e)})},exec_delete(e){const o=this,d=e.id,r={ok:function(c){o.$emit("delete_todo_item",d)},error:function(c){g.create({color:"bg-grey-2",message:c.message,timeout:2e3,color:"negative"})}};o.dataCachesStore.invalidate({object_type:"projects",object_id:e.project_id}),o.dataCachesStore.invalidate({object_type:"patches",object_id:e.patch_id}),o.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e.project_id+"/todos/"+e.id,method:"DELETE",callback:r})}}}),A={class:"col-grow"},G={key:0},B={key:1},L=["innerHTML"],M={key:2},P={key:3},H={key:4},q={key:0,class:"todoitem-btn"},R={key:1,class:"todoitem-btn"},Y={key:2},z={class:"todoitem-btn"},K=s("div",{class:"text-h6"},"Edit Todo Item",-1),W={class:"todoitem-dialogfield"},F={key:0,class:"todoitem-dialogfield col flex"},J={class:"todoitem-dialogfield"},X={class:"todoitem-dialogfield"};function Z(e,o,d,r,c,x){const b=C("RouterLink");return typeof e.todo!="undefined"?(i(),l("div",{key:0,class:w(e.get_item_class)},[s("div",A,[e.include_project?(i(),l("div",G,[m("Project: "),t(b,{style:{color:"white"},to:"/tools/brrcalc?projectid="+e.todo.project_id},{default:p(()=>[m(_(e.todo.project_name),1)]),_:1},8,["to"])])):n("",!0),s("div",null,"Type: "+_(e.get_todo_item_type(e.todo.type)),1),e.todo.group!==""?(i(),l("div",B,"Group: "+_(e.todo.group),1)):n("",!0),s("div",{innerHTML:e.get_multiline_html(e.todo.description)},null,8,L),e.todo.done?n("",!0):(i(),l("div",M,_(e.due_date_text(e.todo)),1)),e.todo.done?(i(),l("div",P,"Completion Notes: "+_(e.todo.done_text),1)):n("",!0),e.todo.done?(i(),l("div",H,"Date Completed: "+_(e.done_date_text(e.todo.done_date)),1)):n("",!0)]),s("div",null,[e.todo.done?n("",!0):(i(),l("div",q,[t(u,{icon:"edit",round:"",color:"secondary",onClick:o[0]||(o[0]=a=>e.btn_edit(e.todo))})])),e.todo.done?n("",!0):(i(),l("div",R,[t(u,{icon:"check",round:"",color:"secondary",onClick:o[1]||(o[1]=a=>e.btn_mark_done(e.todo))})])),e.todo.done?(i(),l("div",Y,[t(u,{label:"Mark Undone",color:"secondary",onClick:o[2]||(o[2]=a=>e.btn_mark_undone(e.todo))})])):n("",!0),s("div",z,[t(u,{icon:"delete",round:"",color:"negative",onClick:o[3]||(o[3]=a=>e.btn_delete(e.todo))})])]),t(V,{modelValue:e.dialog_visible,"onUpdate:modelValue":o[9]||(o[9]=a=>e.dialog_visible=a)},{default:p(()=>[t(D,{class:"todoitem-dialogcard"},{default:p(()=>[t(h,{class:"row items-center q-pb-none"},{default:p(()=>[K,t(S),T(t(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[O]])]),_:1}),t(h,null,{default:p(()=>[s("div",null,[s("div",W,[t($,{modelValue:e.dialog_data.type,"onUpdate:modelValue":o[4]||(o[4]=a=>e.dialog_data.type=a),options:e.type_options,label:"Type of Task","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e.dialog_data.type==="other"?(i(),l("div",F,[t(f,{modelValue:e.dialog_data.group,"onUpdate:modelValue":o[5]||(o[5]=a=>e.dialog_data.group=a),label:"Grouping",class:"col-grow"},null,8,["modelValue"]),t(u,{round:"",dense:"",flat:"",icon:"info",onClick:e.helpgrouping},null,8,["onClick"])])):n("",!0),s("div",J,[t(f,{modelValue:e.dialog_data.description,"onUpdate:modelValue":o[6]||(o[6]=a=>e.dialog_data.description=a),label:"Description",autogrow:"",rules:[a=>a.trim().length>3||"Minimum 4 characters"],ref:"field_description"},null,8,["modelValue","rules"])]),s("div",X,[m("Due: "),t(j,{modelValue:e.dialog_data.due,"onUpdate:modelValue":o[7]||(o[7]=a=>e.dialog_data.due=a),options:e.due_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),t(N,{align:"right",class:"text-primary"},{default:p(()=>[t(u,{label:"Cancel",onClick:o[8]||(o[8]=a=>this.dialog_visible=!1)}),t(u,{color:"primary",icon:"rule",label:"Ok",onClick:e.click_dialog_ok},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],2)):n("",!0)}var ne=v(Q,[["render",Z]]);export{ne as T};

import{a as Ke,Q as $t}from"./QTabs.bfa4b3d3.js";import{Q as Vt}from"./QPage.04a4d3d7.js";import{d as Ie,_ as Oe,r as M,o as A,K as te,a as _,c as ze,L as ae,g as Mt,ay as qt,ax as Ht,au as It,aD as Ot,j as I,k as c,aw as zt,m as X,q as u,a0 as ee,x as Yt,u as At,aB as Lt,a3 as Je,Q as V,w as S,e as p,t as Ve,f as me,af as Me,a9 as Ze,ai as _e,ae as Pt,aa as Rt,N as fe,am as Xe}from"./index.dcf5bd07.js";import{u as Nt}from"./use-quasar.486d50b4.js";import{R as Bt,S as Ft,T as Wt,a as xt,L as Et}from"./Todos.cf709673.js";import{u as lt}from"./backend_connection.a998e507.js";import{u as Qt}from"./data_caches.cca91325.js";import{L as Ut}from"./LeadInformation.1aa552d3.js";import{u as Gt,a as Kt,b as Jt,t as et,g as z,f as Zt,c as Xt,j as qe,_ as ea,Q as ta}from"./QTime.7c1e58aa.js";import{p as oe}from"./QSelect.07b2efb0.js";import{Q as tt}from"./QPopupProxy.74f44ab4.js";import{C as at}from"./ClosePopup.33ed933f.js";import"./index.865826ad.js";import{r as aa}from"./utils.99aafcb0.js";import{D as ot}from"./datetime.5361efaf.js";import{W as oa}from"./Workflow_main.512fc34f.js";import{A as na,a as ia,P as la}from"./ProjectSerializer.0557d855.js";import{c as ra}from"./common_constants.94b43302.js";import"./QResizeObserver.51e21ec0.js";import"./QSpace.de86180e.js";import"./uuid.6153c38a.js";import"./TodoItem.29b52032.js";import"./axios.6e1fcf85.js";import"./TouchPan.31b27033.js";import"./position-engine.f970e859.js";import"./QItemSection.8e582f7b.js";import"./QItemLabel.79f88a5d.js";import"./QMenu.e629a3a9.js";const sa=Ie({name:"BrrCalcToolbar",props:{reason_project_not_savable:{type:String},is_saved_project_with_id:{type:Boolean}},emits:["activity_log","saveproject","createtodo"],components:{ResearchCall:Bt,SaveButton:Ft,TodoButton:Wt},data(){return{}},computed:{ever_saved(){return this.$refs.SaveToolbar.ever_saved},is_project_changed(){return this.$refs.SaveToolbar.is_project_changed}},methods:{click_save_btn(){this.$refs.SaveToolbar.click_btn()},set_changed_true(t){this.$refs.SaveToolbar.set_changed_true(t)},save_project_complete_notification(t){this.$refs.SaveToolbar.save_project_complete_notification(t)},serializer_load_data(t){this.$refs.SaveToolbar.serializer_load_data(t)}}}),ua={class:"row brrcalctoolbar"};function da(t,l,m,y,D,ne){const h=M("SaveButton"),w=M("ResearchCall"),U=M("TodoButton");return A(),te("div",ua,[_(h,{ref:"SaveToolbar",onSaveproject:l[0]||(l[0]=q=>t.$emit("saveproject")),reason_project_not_savable:t.reason_project_not_savable},null,8,["reason_project_not_savable"]),_(w,{onActivity_log:l[1]||(l[1]=q=>t.$emit("activity_log",q))}),t.is_saved_project_with_id?(A(),ze(U,{key:0,onCreatetodo:l[2]||(l[2]=q=>t.$emit("createtodo",q))})):ae("",!0)])}var ca=Oe(sa,[["render",da]]);function va(){const t=new Map;return{getCache:function(l,m){return t[l]===void 0?t[l]=m:t[l]},getCacheWithFn:function(l,m){return t[l]===void 0?t[l]=m():t[l]}}}const N=20,ma=["Calendar","Years","Months"],nt=t=>ma.includes(t),He=t=>/^-?[\d]+\/[0-1]\d$/.test(t),Q=" \u2014 ";function Y(t){return t.year+"/"+oe(t.month)}var fa=Mt({name:"QDate",props:{...Gt,...qt,...Ht,multiple:Boolean,range:Boolean,title:String,subtitle:String,mask:{default:"YYYY/MM/DD"},defaultYearMonth:{type:String,validator:He},yearsInMonthView:Boolean,events:[Array,Function],eventColor:[String,Function],emitImmediately:Boolean,options:[Array,Function],navigationMinYearMonth:{type:String,validator:He},navigationMaxYearMonth:{type:String,validator:He},noUnset:Boolean,firstDayOfWeek:[String,Number],todayBtn:Boolean,minimal:Boolean,defaultView:{type:String,default:"Calendar",validator:nt}},emits:[...Kt,"rangeStart","rangeEnd","navigation"],setup(t,{slots:l,emit:m}){const{proxy:y}=At(),{$q:D}=y,ne=It(t,D),{getCache:h}=va(),{tabindex:w,headerClass:U,getLocale:q,getCurrentDate:ie}=Jt(t,D);let B;const he=Ot(t),ge=Lt(he),G=I(null),L=I(Fe()),g=I(q()),rt=c(()=>Fe()),st=c(()=>q()),H=c(()=>ie()),s=I(We(L.value,g.value)),C=I(t.defaultView),Ye=D.lang.rtl===!0?"right":"left",le=I(Ye.value),ye=I(Ye.value),pe=s.value.year,re=I(pe-pe%N-(pe<0?N:0)),k=I(null),ut=c(()=>{const e=t.landscape===!0?"landscape":"portrait";return`q-date q-date--${e} q-date--${e}-${t.minimal===!0?"minimal":"standard"}`+(ne.value===!0?" q-date--dark q-dark":"")+(t.bordered===!0?" q-date--bordered":"")+(t.square===!0?" q-date--square no-border-radius":"")+(t.flat===!0?" q-date--flat no-shadow":"")+(t.disable===!0?" disabled":t.readonly===!0?" q-date--readonly":"")}),P=c(()=>t.color||"primary"),F=c(()=>t.textColor||"white"),se=c(()=>t.emitImmediately===!0&&t.multiple!==!0&&t.range!==!0),we=c(()=>Array.isArray(t.modelValue)===!0?t.modelValue:t.modelValue!==null&&t.modelValue!==void 0?[t.modelValue]:[]),$=c(()=>we.value.filter(e=>typeof e=="string").map(e=>Ce(e,L.value,g.value)).filter(e=>e.dateHash!==null&&e.day!==null&&e.month!==null&&e.year!==null)),W=c(()=>{const e=a=>Ce(a,L.value,g.value);return we.value.filter(a=>zt(a)===!0&&a.from!==void 0&&a.to!==void 0).map(a=>({from:e(a.from),to:e(a.to)})).filter(a=>a.from.dateHash!==null&&a.to.dateHash!==null&&a.from.dateHash<a.to.dateHash)}),ue=c(()=>t.calendar!=="persian"?e=>new Date(e.year,e.month-1,e.day):e=>{const a=et(e.year,e.month,e.day);return new Date(a.gy,a.gm-1,a.gd)}),be=c(()=>t.calendar==="persian"?z:(e,a,o)=>Zt(new Date(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond),a===void 0?L.value:a,o===void 0?g.value:o,e.year,e.timezoneOffset)),K=c(()=>$.value.length+W.value.reduce((e,a)=>e+1+Xt(ue.value(a.to),ue.value(a.from)),0)),Ae=c(()=>{if(t.title!==void 0&&t.title!==null&&t.title.length!==0)return t.title;if(k.value!==null){const o=k.value.init,n=ue.value(o);return g.value.daysShort[n.getDay()]+", "+g.value.monthsShort[o.month-1]+" "+o.day+Q+"?"}if(K.value===0)return Q;if(K.value>1)return`${K.value} ${g.value.pluralDay}`;const e=$.value[0],a=ue.value(e);return isNaN(a.valueOf())===!0?Q:g.value.headerTitle!==void 0?g.value.headerTitle(a,e):g.value.daysShort[a.getDay()]+", "+g.value.monthsShort[e.month-1]+" "+e.day}),dt=c(()=>$.value.concat(W.value.map(a=>a.from)).sort((a,o)=>a.year-o.year||a.month-o.month)[0]),ct=c(()=>$.value.concat(W.value.map(a=>a.to)).sort((a,o)=>o.year-a.year||o.month-a.month)[0]),Le=c(()=>{if(t.subtitle!==void 0&&t.subtitle!==null&&t.subtitle.length!==0)return t.subtitle;if(K.value===0)return Q;if(K.value>1){const e=dt.value,a=ct.value,o=g.value.monthsShort;return o[e.month-1]+(e.year!==a.year?" "+e.year+Q+o[a.month-1]+" ":e.month!==a.month?Q+o[a.month-1]:"")+" "+a.year}return $.value[0].year}),de=c(()=>{const e=[D.iconSet.datetime.arrowLeft,D.iconSet.datetime.arrowRight];return D.lang.rtl===!0?e.reverse():e}),Pe=c(()=>t.firstDayOfWeek!==void 0?Number(t.firstDayOfWeek):g.value.firstDayOfWeek),vt=c(()=>{const e=g.value.daysShort,a=Pe.value;return a>0?e.slice(a,7).concat(e.slice(0,a)):e}),O=c(()=>{const e=s.value;return t.calendar!=="persian"?new Date(e.year,e.month,0).getDate():qe(e.year,e.month)}),mt=c(()=>typeof t.eventColor=="function"?t.eventColor:()=>t.eventColor),b=c(()=>{if(t.navigationMinYearMonth===void 0)return null;const e=t.navigationMinYearMonth.split("/");return{year:parseInt(e[0],10),month:parseInt(e[1],10)}}),j=c(()=>{if(t.navigationMaxYearMonth===void 0)return null;const e=t.navigationMaxYearMonth.split("/");return{year:parseInt(e[0],10),month:parseInt(e[1],10)}}),je=c(()=>{const e={month:{prev:!0,next:!0},year:{prev:!0,next:!0}};return b.value!==null&&b.value.year>=s.value.year&&(e.year.prev=!1,b.value.year===s.value.year&&b.value.month>=s.value.month&&(e.month.prev=!1)),j.value!==null&&j.value.year<=s.value.year&&(e.year.next=!1,j.value.year===s.value.year&&j.value.month<=s.value.month&&(e.month.next=!1)),e}),ce=c(()=>{const e={};return $.value.forEach(a=>{const o=Y(a);e[o]===void 0&&(e[o]=[]),e[o].push(a.day)}),e}),Re=c(()=>{const e={};return W.value.forEach(a=>{const o=Y(a.from),n=Y(a.to);if(e[o]===void 0&&(e[o]=[]),e[o].push({from:a.from.day,to:o===n?a.to.day:void 0,range:a}),o<n){let i;const{year:v,month:r}=a.from,d=r<12?{year:v,month:r+1}:{year:v+1,month:1};for(;(i=Y(d))<=n;)e[i]===void 0&&(e[i]=[]),e[i].push({from:void 0,to:i===n?a.to.day:void 0,range:a}),d.month++,d.month>12&&(d.year++,d.month=1)}}),e}),J=c(()=>{if(k.value===null)return;const{init:e,initHash:a,final:o,finalHash:n}=k.value,[i,v]=a<=n?[e,o]:[o,e],r=Y(i),d=Y(v);if(r!==T.value&&d!==T.value)return;const f={};return r===T.value?(f.from=i.day,f.includeFrom=!0):f.from=1,d===T.value?(f.to=v.day,f.includeTo=!0):f.to=O.value,f}),T=c(()=>Y(s.value)),ft=c(()=>{const e={};if(t.options===void 0){for(let o=1;o<=O.value;o++)e[o]=!0;return e}const a=typeof t.options=="function"?t.options:o=>t.options.includes(o);for(let o=1;o<=O.value;o++){const n=T.value+"/"+oe(o);e[o]=a(n)}return e}),_t=c(()=>{const e={};if(t.events===void 0)for(let a=1;a<=O.value;a++)e[a]=!1;else{const a=typeof t.events=="function"?t.events:o=>t.events.includes(o);for(let o=1;o<=O.value;o++){const n=T.value+"/"+oe(o);e[o]=a(n)===!0&&mt.value(n)}}return e}),ht=c(()=>{let e,a;const{year:o,month:n}=s.value;if(t.calendar!=="persian")e=new Date(o,n-1,1),a=new Date(o,n-1,0).getDate();else{const i=et(o,n,1);e=new Date(i.gy,i.gm-1,i.gd);let v=n-1,r=o;v===0&&(v=12,r--),a=qe(r,v)}return{days:e.getDay()-Pe.value-1,endDay:a}}),Ne=c(()=>{const e=[],{days:a,endDay:o}=ht.value,n=a<0?a+7:a;if(n<6)for(let r=o-n;r<=o;r++)e.push({i:r,fill:!0});const i=e.length;for(let r=1;r<=O.value;r++){const d={i:r,event:_t.value[r],classes:[]};ft.value[r]===!0&&(d.in=!0,d.flat=!0),e.push(d)}if(ce.value[T.value]!==void 0&&ce.value[T.value].forEach(r=>{const d=i+r-1;Object.assign(e[d],{selected:!0,unelevated:!0,flat:!1,color:P.value,textColor:F.value})}),Re.value[T.value]!==void 0&&Re.value[T.value].forEach(r=>{if(r.from!==void 0){const d=i+r.from-1,f=i+(r.to||O.value)-1;for(let Z=d;Z<=f;Z++)Object.assign(e[Z],{range:r.range,unelevated:!0,color:P.value,textColor:F.value});Object.assign(e[d],{rangeFrom:!0,flat:!1}),r.to!==void 0&&Object.assign(e[f],{rangeTo:!0,flat:!1})}else if(r.to!==void 0){const d=i+r.to-1;for(let f=i;f<=d;f++)Object.assign(e[f],{range:r.range,unelevated:!0,color:P.value,textColor:F.value});Object.assign(e[d],{flat:!1,rangeTo:!0})}else{const d=i+O.value-1;for(let f=i;f<=d;f++)Object.assign(e[f],{range:r.range,unelevated:!0,color:P.value,textColor:F.value})}}),J.value!==void 0){const r=i+J.value.from-1,d=i+J.value.to-1;for(let f=r;f<=d;f++)e[f].color=P.value,e[f].editRange=!0;J.value.includeFrom===!0&&(e[r].editRangeFrom=!0),J.value.includeTo===!0&&(e[d].editRangeTo=!0)}s.value.year===H.value.year&&s.value.month===H.value.month&&(e[i+H.value.day-1].today=!0);const v=e.length%7;if(v>0){const r=7-v;for(let d=1;d<=r;d++)e.push({i:d,fill:!0})}return e.forEach(r=>{let d="q-date__calendar-item ";r.fill===!0?d+="q-date__calendar-item--fill":(d+=`q-date__calendar-item--${r.in===!0?"in":"out"}`,r.range!==void 0&&(d+=` q-date__range${r.rangeTo===!0?"-to":r.rangeFrom===!0?"-from":""}`),r.editRange===!0&&(d+=` q-date__edit-range${r.editRangeFrom===!0?"-from":""}${r.editRangeTo===!0?"-to":""}`),(r.range!==void 0||r.editRange===!0)&&(d+=` text-${r.color}`)),r.classes=d}),e}),gt=c(()=>t.disable===!0?{"aria-disabled":"true"}:t.readonly===!0?{"aria-readonly":"true"}:{});X(()=>t.modelValue,e=>{if(B===e)B=0;else{const a=We(L.value,g.value);x(a.year,a.month,a)}}),X(C,()=>{G.value!==null&&y.$el.contains(document.activeElement)===!0&&G.value.focus()}),X(()=>s.value.year+"|"+s.value.month,()=>{m("navigation",{year:s.value.year,month:s.value.month})}),X(rt,e=>{Ge(e,g.value,"mask"),L.value=e}),X(st,e=>{Ge(L.value,e,"locale"),g.value=e});function Be(){const{year:e,month:a,day:o}=H.value,n={...s.value,year:e,month:a,day:o},i=ce.value[Y(n)];(i===void 0||i.includes(n.day)===!1)&&Se(n),ke(n.year,n.month)}function yt(e){nt(e)===!0&&(C.value=e)}function pt(e,a){["month","year"].includes(e)&&(e==="month"?Ee:Te)(a===!0?-1:1)}function ke(e,a){C.value="Calendar",x(e,a)}function wt(e,a){if(t.range===!1||!e){k.value=null;return}const o=Object.assign({...s.value},e),n=a!==void 0?Object.assign({...s.value},a):o;k.value={init:o,initHash:z(o),final:n,finalHash:z(n)},ke(o.year,o.month)}function Fe(){return t.calendar==="persian"?"YYYY/MM/DD":t.mask}function Ce(e,a,o){return ea(e,a,o,t.calendar,{hour:0,minute:0,second:0,millisecond:0})}function We(e,a){const o=Array.isArray(t.modelValue)===!0?t.modelValue:t.modelValue?[t.modelValue]:[];if(o.length===0)return xe();const n=o[o.length-1],i=Ce(n.from!==void 0?n.from:n,e,a);return i.dateHash===null?xe():i}function xe(){let e,a;if(t.defaultYearMonth!==void 0){const o=t.defaultYearMonth.split("/");e=parseInt(o[0],10),a=parseInt(o[1],10)}else{const o=H.value!==void 0?H.value:ie();e=o.year,a=o.month}return{year:e,month:a,day:1,hour:0,minute:0,second:0,millisecond:0,dateHash:e+"/"+oe(a)+"/01"}}function Ee(e){let a=s.value.year,o=Number(s.value.month)+e;o===13?(o=1,a++):o===0&&(o=12,a--),x(a,o),se.value===!0&&ve("month")}function Te(e){const a=Number(s.value.year)+e;x(a,s.value.month),se.value===!0&&ve("year")}function bt(e){x(e,s.value.month),C.value=t.defaultView==="Years"?"Months":"Calendar",se.value===!0&&ve("year")}function jt(e){x(s.value.year,e),C.value="Calendar",se.value===!0&&ve("month")}function kt(e,a){const o=ce.value[a];(o!==void 0&&o.includes(e.day)===!0?De:Se)(e)}function R(e){return{year:e.year,month:e.month,day:e.day}}function x(e,a,o){if(b.value!==null&&e<=b.value.year&&((a<b.value.month||e<b.value.year)&&(a=b.value.month),e=b.value.year),j.value!==null&&e>=j.value.year&&((a>j.value.month||e>j.value.year)&&(a=j.value.month),e=j.value.year),o!==void 0){const{hour:i,minute:v,second:r,millisecond:d,timezoneOffset:f,timeHash:Z}=o;Object.assign(s.value,{hour:i,minute:v,second:r,millisecond:d,timezoneOffset:f,timeHash:Z})}const n=e+"/"+oe(a)+"/01";n!==s.value.dateHash&&(le.value=s.value.dateHash<n==(D.lang.rtl!==!0)?"left":"right",e!==s.value.year&&(ye.value=le.value),Je(()=>{re.value=e-e%N-(e<0?N:0),Object.assign(s.value,{year:e,month:a,day:1,dateHash:n})}))}function Qe(e,a,o){const n=e!==null&&e.length===1&&t.multiple===!1?e[0]:e;B=n;const{reason:i,details:v}=Ue(a,o);m("update:modelValue",n,i,v)}function ve(e){const a=$.value[0]!==void 0&&$.value[0].dateHash!==null?{...$.value[0]}:{...s.value};Je(()=>{a.year=s.value.year,a.month=s.value.month;const o=t.calendar!=="persian"?new Date(a.year,a.month,0).getDate():qe(a.year,a.month);a.day=Math.min(Math.max(1,a.day),o);const n=E(a);B=n;const{details:i}=Ue("",a);m("update:modelValue",n,e,i)})}function Ue(e,a){return a.from!==void 0?{reason:`${e}-range`,details:{...R(a.target),from:R(a.from),to:R(a.to)}}:{reason:`${e}-day`,details:R(a)}}function E(e,a,o){return e.from!==void 0?{from:be.value(e.from,a,o),to:be.value(e.to,a,o)}:be.value(e,a,o)}function Se(e){let a;if(t.multiple===!0)if(e.from!==void 0){const o=z(e.from),n=z(e.to),i=$.value.filter(r=>r.dateHash<o||r.dateHash>n),v=W.value.filter(({from:r,to:d})=>d.dateHash<o||r.dateHash>n);a=i.concat(v).concat(e).map(r=>E(r))}else{const o=we.value.slice();o.push(E(e)),a=o}else a=E(e);Qe(a,"add",e)}function De(e){if(t.noUnset===!0)return;let a=null;if(t.multiple===!0&&Array.isArray(t.modelValue)===!0){const o=E(e);e.from!==void 0?a=t.modelValue.filter(n=>n.from!==void 0?n.from!==o.from&&n.to!==o.to:!0):a=t.modelValue.filter(n=>n!==o),a.length===0&&(a=null)}Qe(a,"remove",e)}function Ge(e,a,o){const n=$.value.concat(W.value).map(i=>E(i,e,a)).filter(i=>i.from!==void 0?i.from.dateHash!==null&&i.to.dateHash!==null:i.dateHash!==null);m("update:modelValue",(t.multiple===!0?n:n[0])||null,o)}function Ct(){if(t.minimal!==!0)return u("div",{class:"q-date__header "+U.value},[u("div",{class:"relative-position"},[u(ee,{name:"q-transition--fade"},()=>u("div",{key:"h-yr-"+Le.value,class:"q-date__header-subtitle q-date__header-link "+(C.value==="Years"?"q-date__header-link--active":"cursor-pointer"),tabindex:w.value,...h("vY",{onClick(){C.value="Years"},onKeyup(e){e.keyCode===13&&(C.value="Years")}})},[Le.value]))]),u("div",{class:"q-date__header-title relative-position flex no-wrap"},[u("div",{class:"relative-position col"},[u(ee,{name:"q-transition--fade"},()=>u("div",{key:"h-sub"+Ae.value,class:"q-date__header-title-label q-date__header-link "+(C.value==="Calendar"?"q-date__header-link--active":"cursor-pointer"),tabindex:w.value,...h("vC",{onClick(){C.value="Calendar"},onKeyup(e){e.keyCode===13&&(C.value="Calendar")}})},[Ae.value]))]),t.todayBtn===!0?u(V,{class:"q-date__header-today self-start",icon:D.iconSet.datetime.today,flat:!0,size:"sm",round:!0,tabindex:w.value,onClick:Be}):null])])}function $e({label:e,type:a,key:o,dir:n,goTo:i,boundaries:v,cls:r}){return[u("div",{class:"row items-center q-date__arrow"},[u(V,{round:!0,dense:!0,size:"sm",flat:!0,icon:de.value[0],tabindex:w.value,disable:v.prev===!1,...h("go-#"+a,{onClick(){i(-1)}})})]),u("div",{class:"relative-position overflow-hidden flex flex-center"+r},[u(ee,{name:"q-transition--jump-"+n},()=>u("div",{key:o},[u(V,{flat:!0,dense:!0,noCaps:!0,label:e,tabindex:w.value,...h("view#"+a,{onClick:()=>{C.value=a}})})]))]),u("div",{class:"row items-center q-date__arrow"},[u(V,{round:!0,dense:!0,size:"sm",flat:!0,icon:de.value[1],tabindex:w.value,disable:v.next===!1,...h("go+#"+a,{onClick(){i(1)}})})])]}const Tt={Calendar:()=>[u("div",{key:"calendar-view",class:"q-date__view q-date__calendar"},[u("div",{class:"q-date__navigation row items-center no-wrap"},$e({label:g.value.months[s.value.month-1],type:"Months",key:s.value.month,dir:le.value,goTo:Ee,boundaries:je.value.month,cls:" col"}).concat($e({label:s.value.year,type:"Years",key:s.value.year,dir:ye.value,goTo:Te,boundaries:je.value.year,cls:""}))),u("div",{class:"q-date__calendar-weekdays row items-center no-wrap"},vt.value.map(e=>u("div",{class:"q-date__calendar-item"},[u("div",e)]))),u("div",{class:"q-date__calendar-days-container relative-position overflow-hidden"},[u(ee,{name:"q-transition--slide-"+le.value},()=>u("div",{key:T.value,class:"q-date__calendar-days fit"},Ne.value.map(e=>u("div",{class:e.classes},[e.in===!0?u(V,{class:e.today===!0?"q-date__today":"",dense:!0,flat:e.flat,unelevated:e.unelevated,color:e.color,textColor:e.textColor,label:e.i,tabindex:w.value,...h("day#"+e.i,{onClick:()=>{St(e.i)},onMouseover:()=>{Dt(e.i)}})},e.event!==!1?()=>u("div",{class:"q-date__event bg-"+e.event}):null):u("div",""+e.i)]))))])])],Months(){const e=s.value.year===H.value.year,a=n=>b.value!==null&&s.value.year===b.value.year&&b.value.month>n||j.value!==null&&s.value.year===j.value.year&&j.value.month<n,o=g.value.monthsShort.map((n,i)=>{const v=s.value.month===i+1;return u("div",{class:"q-date__months-item flex flex-center"},[u(V,{class:e===!0&&H.value.month===i+1?"q-date__today":null,flat:v!==!0,label:n,unelevated:v,color:v===!0?P.value:null,textColor:v===!0?F.value:null,tabindex:w.value,disable:a(i+1),...h("month#"+i,{onClick:()=>{jt(i+1)}})})])});return t.yearsInMonthView===!0&&o.unshift(u("div",{class:"row no-wrap full-width"},[$e({label:s.value.year,type:"Years",key:s.value.year,dir:ye.value,goTo:Te,boundaries:je.value.year,cls:" col"})])),u("div",{key:"months-view",class:"q-date__view q-date__months flex flex-center"},o)},Years(){const e=re.value,a=e+N,o=[],n=i=>b.value!==null&&b.value.year>i||j.value!==null&&j.value.year<i;for(let i=e;i<=a;i++){const v=s.value.year===i;o.push(u("div",{class:"q-date__years-item flex flex-center"},[u(V,{key:"yr"+i,class:H.value.year===i?"q-date__today":null,flat:!v,label:i,dense:!0,unelevated:v,color:v===!0?P.value:null,textColor:v===!0?F.value:null,tabindex:w.value,disable:n(i),...h("yr#"+i,{onClick:()=>{bt(i)}})})]))}return u("div",{class:"q-date__view q-date__years flex flex-center"},[u("div",{class:"col-auto"},[u(V,{round:!0,dense:!0,flat:!0,icon:de.value[0],tabindex:w.value,disable:n(e),...h("y-",{onClick:()=>{re.value-=N}})})]),u("div",{class:"q-date__years-content col self-stretch row items-center"},o),u("div",{class:"col-auto"},[u(V,{round:!0,dense:!0,flat:!0,icon:de.value[1],tabindex:w.value,disable:n(a),...h("y+",{onClick:()=>{re.value+=N}})})])])}};function St(e){const a={...s.value,day:e};if(t.range===!1){kt(a,T.value);return}if(k.value===null){const o=Ne.value.find(i=>i.fill!==!0&&i.i===e);if(t.noUnset!==!0&&o.range!==void 0){De({target:a,from:o.range.from,to:o.range.to});return}if(o.selected===!0){De(a);return}const n=z(a);k.value={init:a,initHash:n,final:a,finalHash:n},m("rangeStart",R(a))}else{const o=k.value.initHash,n=z(a),i=o<=n?{from:k.value.init,to:a}:{from:a,to:k.value.init};k.value=null,Se(o===n?a:{target:a,...i}),m("rangeEnd",{from:R(i.from),to:R(i.to)})}}function Dt(e){if(k.value!==null){const a={...s.value,day:e};Object.assign(k.value,{final:a,finalHash:z(a)})}}return Object.assign(y,{setToday:Be,setView:yt,offsetCalendar:pt,setCalendarTo:ke,setEditingRange:wt}),()=>{const e=[u("div",{class:"q-date__content col relative-position"},[u(ee,{name:"q-transition--fade"},Tt[C.value])])],a=Yt(l.default);return a!==void 0&&e.push(u("div",{class:"q-date__actions"},a)),t.name!==void 0&&t.disable!==!0&&ge(e,"push"),u("div",{class:ut.value,...gt.value},[Ct(),u("div",{ref:G,class:"q-date__main col column",tabindex:-1},e)])}}});function it(){return{isViewingArranged:!1,isViewingHeld:!1}}const _a=Ie({name:"ViewingInformationCard",props:["projectid","leadinformation"],components:{},setup(){return{backend_connection_store:lt()}},data(){return{emit_project_change_notification:!0,current_workflow_position:{workflow_used_id:-1,current_stage:-1},viewing_timestamp:"2025-04-19T10:50:44.066Z",call_timestamp:void 0,call_notes:""}},watch:{serializer_card_data(t){this.emit_project_change_notification&&this.$emit("projectchanged","ViewingInformation:serializer")}},computed:{calendar_start_time(){return ot.fromISO(this.viewing_timestamp).toFormat("HH:mm")},calendar_end_time(){return ot.fromISO(this.viewing_timestamp).plus({hours:1}).toFormat("HH:mm")},calendar_day(){return this.viewing_timestamp.substring(0,10)},calendar_description(){return aa({projectid:this.projectid,leadinformation:this.leadinformation,call_notes:this.call_notes})},callMadeOnText(){if(typeof this.call_timestamp=="undefined")return"Unknown";const t=new Date(this.call_timestamp),l=t.getHours().toString().padStart(2,"0"),m=t.getMinutes().toString().padStart(2,"0");return t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})+` at ${l}:${m}`},dateOnly:{get(){return new Date(this.viewing_timestamp).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})},set(t){const l=new Date(t);if(isNaN(l))return;const m=new Date(this.viewing_timestamp);l.setHours(m.getHours()),l.setMinutes(m.getMinutes()),l.setSeconds(0),l.setMilliseconds(0),this.viewing_timestamp=l.toISOString()}},timeOnly:{get(){const t=new Date(this.viewing_timestamp),l=t.getHours().toString().padStart(2,"0"),m=t.getMinutes().toString().padStart(2,"0");return`${l}:${m}`},set(t){const[l,m]=t.split(":").map(Number),y=new Date(this.viewing_timestamp);y.setHours(l),y.setMinutes(m),y.setSeconds(0),y.setMilliseconds(0),this.viewing_timestamp=y.toISOString()}},serializer_card_data(){return{viewing_timestamp:this.viewing_timestamp,call_timestamp:this.call_timestamp,call_notes:this.call_notes}},workflow_stage_data(){return this.current_workflow_position.workflow_used_id===-1||this.current_workflow_position.current_stage===-1?it():oa.workflows[this.current_workflow_position.workflow_used_id]._stage_calc_fn(this.current_workflow_position.current_stage)}},methods:{reset_data(){console.log("RESET DATA CALL"),this.emit_project_change_notification=!1;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)},serializer_load_data(t){this.emit_project_change_notification=!1,this.viewing_timestamp=t.viewing_timestamp,typeof t.call_timestamp=="undefined"?this.call_timestamp=void 0:this.call_timestamp=t.call_timestamp,typeof t.call_notes=="undefined"?this.call_notes="":this.call_notes=t.call_notes;const l=this;setTimeout(function(){l.emit_project_change_notification=!0},50)},setWorkflowInfo({workflow_used_id:t,current_stage:l}){console.log("setWorkflowInfo"),this.current_workflow_position.workflow_used_id=t,this.current_workflow_position.current_stage=l}}}),ha=p("div",{class:"text-h6"},"Call for Viewing",-1),ga={key:0},ya={key:1},pa={key:0},wa={class:"row viewinginfo-datetime-controls"},ba={class:"row items-center justify-end"},ja={class:"row items-center justify-end"},ka=["name","location","description","startDate","endDate","startTime","endTime"],Ca={key:1};function Ta(t,l,m,y,D,ne){return A(),ze(Rt,{inline:"",class:"q-ma-sm card-style col-grow"},{default:S(()=>[_(Pt,null,{default:S(()=>[ha,t.workflow_stage_data.isViewingArranged?ae("",!0):(A(),te("div",ga," No viewing has been arranged. ")),t.workflow_stage_data.isViewingArranged?(A(),te("div",ya,[t.workflow_stage_data.isViewingHeld?ae("",!0):(A(),te("div",pa,[p("div",null," Call made on "+Ve(t.callMadeOnText),1),p("div",null,[me(" Notes: "),_(Me,{filled:"",modelValue:t.call_notes,"onUpdate:modelValue":l[0]||(l[0]=h=>t.call_notes=h),label:"Notes from this call",autogrow:""},null,8,["modelValue"])]),p("div",wa,[p("div",null,[me(" Viewing Date: "),_(Me,{filled:"",modelValue:t.dateOnly,"onUpdate:modelValue":l[2]||(l[2]=h=>t.dateOnly=h),readonly:""},{append:S(()=>[_(Ze,{name:"event",class:"cursor-pointer"},{default:S(()=>[_(tt,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:S(()=>[_(fa,{modelValue:t.dateOnly,"onUpdate:modelValue":l[1]||(l[1]=h=>t.dateOnly=h),mask:"dddd, MMM D, YYYY"},{default:S(()=>[p("div",ba,[_e(_(V,{label:"Close",color:"primary",flat:""},null,512),[[at]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),p("div",null,[me(" Viewing Time: "),_(Me,{filled:"",modelValue:t.timeOnly,"onUpdate:modelValue":l[4]||(l[4]=h=>t.timeOnly=h),mask:"time",rules:["time"],readonly:""},{append:S(()=>[_(Ze,{name:"access_time",class:"cursor-pointer"},{default:S(()=>[_(tt,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:S(()=>[_(ta,{modelValue:t.timeOnly,"onUpdate:modelValue":l[3]||(l[3]=h=>t.timeOnly=h)},{default:S(()=>[p("div",ja,[_e(_(V,{label:"Close",color:"primary",flat:""},null,512),[[at]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),p("div",null,[p("add-to-calendar-button",{name:"Viewing: "+t.leadinformation.address+", "+t.leadinformation.postcode,options:"'Apple','Google','Yahoo','iCal'",location:t.leadinformation.address+", "+t.leadinformation.postcode,description:t.calendar_description,startDate:t.calendar_day,endDate:t.calendar_day,startTime:t.calendar_start_time,endTime:t.calendar_end_time,timeZone:"Europe/London"},null,8,ka)])])),t.workflow_stage_data.isViewingHeld?(A(),te("div",Ca,[p("div",null,"Viewing held "+Ve(t.dateOnly)+" at "+Ve(t.timeOnly),1),me(" TODO result record ")])):ae("",!0)])):ae("",!0)]),_:1})]),_:1})}var Sa=Oe(_a,[["render",Ta]]);const Da=Ie({name:"CalcBrrToFlip",components:{LeadInformation:Ut,ActivityLog:na,Workflow:ia,Todos:xt,ProjectSerializer:la,RentCalcToolbar:ca,ViewingInfo:Sa,Location:Et},setup(){const t=lt(),l=Nt(),m=Qt();return{q:l,backend_connection_store:t,dataCachesStore:m}},data(){return{tab:"main",isMounted:!1,loaded_project_id:"",sucessful_load_completed:!1}},computed:{leadinformation(){return this.isMounted?this.$refs.LeadInformation.serializer_card_data:{address:"",advert_information:"",advertweblinks:[],contact_email:"",contact_phone:"",landlord_name:"",lead_source:"Not Selected",patch_id:void 0,postcode:""}},project_type(){return ra.project_type_constants.project_type_rent},serialized_data(){return this.isMounted?{leadinformation:this.$refs.LeadInformation.serializer_card_data,viewinginformation:this.$refs.ViewingInfo.serializer_card_data}:{}}},methods:{createtodo(t){const l=this,m={ok:function(y){l.$refs.todos.add_single_todo(y.data.todo),fe.create({color:"bg-grey-2",message:"Todo added",timeout:2e3,color:"positive"})},error:function(y){fe.create({color:"bg-grey-2",message:y.message,timeout:2e3,color:"negative"})}};l.dataCachesStore.invalidate({object_type:"projects",object_id:l.loaded_project_id}),l.dataCachesStore.invalidate({object_type:"patches",object_id:l.serialized_data.leadinformation.patch_id}),l.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+l.loaded_project_id+"/todos",method:"POST",data:t,callback:m})},save_project(){this.$refs.ProjectSerializer.save_project({dict_of_card_info:this.serialized_data,activity_log:this.$refs.ActivityLog.serializer_card_data,workflow:this.$refs.Workflow.serializer_card_data,patch_id:this.serialized_data.leadinformation.patch_id,location:this.$refs.Location.serializer_card_data,passthroughdata:void 0})},navigate_away(t){this.$router.push(t.dest)},call_load_api(){const t=this,l={ok:t.load_project_api_success,error:t.load_project_api_fail};t.dataCachesStore.get({backend_connection_store:t.backend_connection_store,object_type:"projects",object_id:t.$route.query.projectid,skip_cache:!1,callback:l})},load_project_api_success(t){this.loaded_project_id=t.data.id,this.load_project_into_cards(t.data),this.sucessful_load_completed=!0,fe.create({color:"bg-grey-2",message:"Project Loaded",timeout:2e3,color:"positive"}),this.load_complete()},load_project_api_fail(t){fe.create({color:"bg-grey-2",message:"Error loading project "+t,timeout:2e3,color:"negative"}),this.load_complete()},load_complete(){this.q.loading.hide();const t=this;setTimeout(function(){t.isMounted=!0},105)},load_project_into_cards(t){this.$refs.ProjectSerializer.serializer_load_data(t),typeof t.sub_section_details.leadinformation!="undefined"&&this.$refs.LeadInformation.serializer_load_data(t.sub_section_details.leadinformation),typeof t.sub_section_details.viewinginformation!="undefined"&&this.$refs.ViewingInfo.serializer_load_data(t.sub_section_details.viewinginformation),typeof t.location!="undefined"&&this.$refs.Location.serializer_load_data(t.location),this.$refs.ActivityLog.serializer_load_data(t.activity_log),this.$refs.Workflow.serializer_load_data(t.workflow),this.$refs.todos.serializer_load_data(t.todos),this.$refs.ViewingInfo.setWorkflowInfo(t.workflow)},save_project_complete({success:t,response:l,passthroughdata:m}){t&&(this.loaded_project_id=l.data.id),this.$refs.RentCalcToolbar.save_project_complete_notification({success:t,response:l})},projectchanged(t){if(console.log("rentCalc page received project changed from ",t),!this.isMounted){console.log("WARNING = projectchanged called when mounted is false");return}if(typeof this.$refs.RentCalcToolbar=="undefined")return console.log("WARNING = projectchanged called when RentCalcToolbar is undefined"),!1;t==="ActivityLog:log_activity:forcesave"?this.$refs.RentCalcToolbar.set_changed_true({autosave_seconds:0}):this.$refs.RentCalcToolbar.set_changed_true(),this.$refs.ViewingInfo.setWorkflowInfo(this.$refs.Workflow.serializer_card_data)},click_save_btn(){this.$refs.RentCalcToolbar.click_save_btn()},activity_log(t){if(!this.isMounted){console.log("ERROR - trying to log activity unmounted",t);return}this.$refs.ActivityLog.log_activity(t)}},mounted(){const t=this;if(this.q.loading.show(),typeof t.$route.query.projectid=="undefined"){this.$router.push("/tools");return}setTimeout(function(){t.call_load_api()},1e3)}}),$a={class:"rentcalc-page fit col wrap justify-center items-center content-center"},Va=p("div",null,[p("h1",null,"Rent Project")],-1),Ma={class:"row"},qa={class:"row"};function Ha(t,l,m,y,D,ne){const h=M("RentCalcToolbar"),w=M("LeadInformation"),U=M("ViewingInfo"),q=M("Location"),ie=M("Workflow"),B=M("Todos"),he=M("ActivityLog"),ge=M("ProjectSerializer");return A(),ze(Vt,{class:"flex"},{default:S(()=>[p("div",$a,[Va,_(h,{ref:"RentCalcToolbar",reason_project_not_savable:"",is_saved_project_with_id:!0,onActivity_log:t.activity_log,onSaveproject:t.save_project,onCreatetodo:t.createtodo},null,8,["onActivity_log","onSaveproject","onCreatetodo"]),_($t,{modelValue:t.tab,"onUpdate:modelValue":l[0]||(l[0]=G=>t.tab=G),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:S(()=>[_(Ke,{name:"main",label:"Main"}),_(Ke,{name:"project",label:"Project"})]),_:1},8,["modelValue"]),_e(p("div",Ma,[_(w,{ref:"LeadInformation",ever_saved:"true",onNavigate_away:t.navigate_away,onProjectchanged:t.projectchanged},null,8,["onNavigate_away","onProjectchanged"]),_(U,{ref:"ViewingInfo",projectid:t.loaded_project_id,leadinformation:t.leadinformation,onProjectchanged:t.projectchanged},null,8,["projectid","leadinformation","onProjectchanged"]),_(q,{ref:"Location",onProjectchanged:t.projectchanged},null,8,["onProjectchanged"])],512),[[Xe,t.tab==="main"]]),_e(p("div",qa,[_(ie,{ref:"Workflow",onProjectchanged:t.projectchanged,onActivity_log:t.activity_log,onClick_save_btn:t.click_save_btn},null,8,["onProjectchanged","onActivity_log","onClick_save_btn"]),_(B,{ref:"todos"},null,512),_(he,{ref:"ActivityLog",onProjectchanged:t.projectchanged},null,8,["onProjectchanged"])],512),[[Xe,t.tab==="project"]])]),_(ge,{ref:"ProjectSerializer",onSaveprojectcomplete:t.save_project_complete,project_type:t.project_type,success_message:"Lead Saved"},null,8,["onSaveprojectcomplete","project_type"])]),_:1})}var ro=Oe(Da,[["render",Ha]]);export{ro as default};

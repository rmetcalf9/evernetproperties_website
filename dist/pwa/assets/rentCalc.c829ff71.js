import{a as Re,Q as Mt}from"./QTabs.12d9bd32.js";import{Q as St}from"./QPage.9c2f0846.js";import{g as qt,az as $t,ay as Ht,av as It,aF as Ot,j as $,k as c,ax as Yt,m as K,q as u,a0 as J,x as At,u as zt,aC as Pt,a3 as Ue,Q as M,d as ot,_ as nt,o as Q,c as lt,w as T,a as h,K as se,L as ue,e as y,t as ve,f as de,af as qe,a9 as Ge,ak as me,ae as Nt,aa as Bt,N as ce,r as P,al as Ke}from"./index.981c98b5.js";import{u as Lt}from"./use-quasar.c64ae64d.js";import{T as Ft,B as xt}from"./Todos.7bea7e83.js";import{u as it}from"./backend_connection.67473e1e.js";import{u as Wt}from"./data_caches.ade18858.js";import{L as Et}from"./LeadInformation.60bfbcc6.js";import{u as Qt,a as Rt,b as Ut,t as Je,g as I,f as Gt,c as Kt,j as $e,_ as Jt,Q as Zt}from"./QTime.86dc22dc.js";import{p as Z}from"./QSelect.20e0f76e.js";import{Q as Ze}from"./QPopupProxy.45990650.js";import{C as Xe}from"./ClosePopup.2d46bd32.js";import"./index.865826ad.js";import{r as Xt}from"./utils.99aafcb0.js";import{D as et}from"./datetime.5361efaf.js";import{W as ea}from"./Workflow_main.49d6358d.js";import{A as ta,a as aa,P as oa}from"./ProjectSerializer.fa8d8c94.js";import{c as na}from"./common_constants.94b43302.js";import"./QResizeObserver.ecfc3e54.js";import"./QSpace.fbd4debe.js";import"./uuid.6153c38a.js";import"./TodoItem.e93bec5a.js";import"./axios.6e1fcf85.js";import"./TouchPan.fea3e821.js";import"./position-engine.a3140e0d.js";import"./QItemLabel.d2859ba2.js";function la(){const t=new Map;return{getCache:function(r,m){return t[r]===void 0?t[r]=m:t[r]},getCacheWithFn:function(r,m){return t[r]===void 0?t[r]=m():t[r]}}}const N=20,ia=["Calendar","Years","Months"],tt=t=>ia.includes(t),He=t=>/^-?[\d]+\/[0-1]\d$/.test(t),E=" \u2014 ";function O(t){return t.year+"/"+Z(t.month)}var ra=qt({name:"QDate",props:{...Qt,...$t,...Ht,multiple:Boolean,range:Boolean,title:String,subtitle:String,mask:{default:"YYYY/MM/DD"},defaultYearMonth:{type:String,validator:He},yearsInMonthView:Boolean,events:[Array,Function],eventColor:[String,Function],emitImmediately:Boolean,options:[Array,Function],navigationMinYearMonth:{type:String,validator:He},navigationMaxYearMonth:{type:String,validator:He},noUnset:Boolean,firstDayOfWeek:[String,Number],todayBtn:Boolean,minimal:Boolean,defaultView:{type:String,default:"Calendar",validator:tt}},emits:[...Rt,"rangeStart","rangeEnd","navigation"],setup(t,{slots:r,emit:m}){const{proxy:w}=zt(),{$q:S}=w,fe=It(t,S),{getCache:_}=la(),{tabindex:j,headerClass:_e,getLocale:X,getCurrentDate:ee}=Ut(t,S);let B;const he=Ot(t),ge=Pt(he),ye=$(null),Y=$(Be()),g=$(X()),rt=c(()=>Be()),st=c(()=>X()),q=c(()=>ee()),s=$(Le(Y.value,g.value)),C=$(t.defaultView),Ie=S.lang.rtl===!0?"right":"left",te=$(Ie.value),we=$(Ie.value),pe=s.value.year,ae=$(pe-pe%N-(pe<0?N:0)),k=$(null),ut=c(()=>{const e=t.landscape===!0?"landscape":"portrait";return`q-date q-date--${e} q-date--${e}-${t.minimal===!0?"minimal":"standard"}`+(fe.value===!0?" q-date--dark q-dark":"")+(t.bordered===!0?" q-date--bordered":"")+(t.square===!0?" q-date--square no-border-radius":"")+(t.flat===!0?" q-date--flat no-shadow":"")+(t.disable===!0?" disabled":t.readonly===!0?" q-date--readonly":"")}),A=c(()=>t.color||"primary"),L=c(()=>t.textColor||"white"),oe=c(()=>t.emitImmediately===!0&&t.multiple!==!0&&t.range!==!0),be=c(()=>Array.isArray(t.modelValue)===!0?t.modelValue:t.modelValue!==null&&t.modelValue!==void 0?[t.modelValue]:[]),V=c(()=>be.value.filter(e=>typeof e=="string").map(e=>De(e,Y.value,g.value)).filter(e=>e.dateHash!==null&&e.day!==null&&e.month!==null&&e.year!==null)),F=c(()=>{const e=a=>De(a,Y.value,g.value);return be.value.filter(a=>Yt(a)===!0&&a.from!==void 0&&a.to!==void 0).map(a=>({from:e(a.from),to:e(a.to)})).filter(a=>a.from.dateHash!==null&&a.to.dateHash!==null&&a.from.dateHash<a.to.dateHash)}),ne=c(()=>t.calendar!=="persian"?e=>new Date(e.year,e.month-1,e.day):e=>{const a=Je(e.year,e.month,e.day);return new Date(a.gy,a.gm-1,a.gd)}),ke=c(()=>t.calendar==="persian"?I:(e,a,o)=>Gt(new Date(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond),a===void 0?Y.value:a,o===void 0?g.value:o,e.year,e.timezoneOffset)),R=c(()=>V.value.length+F.value.reduce((e,a)=>e+1+Kt(ne.value(a.to),ne.value(a.from)),0)),Oe=c(()=>{if(t.title!==void 0&&t.title!==null&&t.title.length!==0)return t.title;if(k.value!==null){const o=k.value.init,n=ne.value(o);return g.value.daysShort[n.getDay()]+", "+g.value.monthsShort[o.month-1]+" "+o.day+E+"?"}if(R.value===0)return E;if(R.value>1)return`${R.value} ${g.value.pluralDay}`;const e=V.value[0],a=ne.value(e);return isNaN(a.valueOf())===!0?E:g.value.headerTitle!==void 0?g.value.headerTitle(a,e):g.value.daysShort[a.getDay()]+", "+g.value.monthsShort[e.month-1]+" "+e.day}),dt=c(()=>V.value.concat(F.value.map(a=>a.from)).sort((a,o)=>a.year-o.year||a.month-o.month)[0]),ct=c(()=>V.value.concat(F.value.map(a=>a.to)).sort((a,o)=>o.year-a.year||o.month-a.month)[0]),Ye=c(()=>{if(t.subtitle!==void 0&&t.subtitle!==null&&t.subtitle.length!==0)return t.subtitle;if(R.value===0)return E;if(R.value>1){const e=dt.value,a=ct.value,o=g.value.monthsShort;return o[e.month-1]+(e.year!==a.year?" "+e.year+E+o[a.month-1]+" ":e.month!==a.month?E+o[a.month-1]:"")+" "+a.year}return V.value[0].year}),le=c(()=>{const e=[S.iconSet.datetime.arrowLeft,S.iconSet.datetime.arrowRight];return S.lang.rtl===!0?e.reverse():e}),Ae=c(()=>t.firstDayOfWeek!==void 0?Number(t.firstDayOfWeek):g.value.firstDayOfWeek),vt=c(()=>{const e=g.value.daysShort,a=Ae.value;return a>0?e.slice(a,7).concat(e.slice(0,a)):e}),H=c(()=>{const e=s.value;return t.calendar!=="persian"?new Date(e.year,e.month,0).getDate():$e(e.year,e.month)}),mt=c(()=>typeof t.eventColor=="function"?t.eventColor:()=>t.eventColor),p=c(()=>{if(t.navigationMinYearMonth===void 0)return null;const e=t.navigationMinYearMonth.split("/");return{year:parseInt(e[0],10),month:parseInt(e[1],10)}}),b=c(()=>{if(t.navigationMaxYearMonth===void 0)return null;const e=t.navigationMaxYearMonth.split("/");return{year:parseInt(e[0],10),month:parseInt(e[1],10)}}),je=c(()=>{const e={month:{prev:!0,next:!0},year:{prev:!0,next:!0}};return p.value!==null&&p.value.year>=s.value.year&&(e.year.prev=!1,p.value.year===s.value.year&&p.value.month>=s.value.month&&(e.month.prev=!1)),b.value!==null&&b.value.year<=s.value.year&&(e.year.next=!1,b.value.year===s.value.year&&b.value.month<=s.value.month&&(e.month.next=!1)),e}),ie=c(()=>{const e={};return V.value.forEach(a=>{const o=O(a);e[o]===void 0&&(e[o]=[]),e[o].push(a.day)}),e}),ze=c(()=>{const e={};return F.value.forEach(a=>{const o=O(a.from),n=O(a.to);if(e[o]===void 0&&(e[o]=[]),e[o].push({from:a.from.day,to:o===n?a.to.day:void 0,range:a}),o<n){let l;const{year:v,month:i}=a.from,d=i<12?{year:v,month:i+1}:{year:v+1,month:1};for(;(l=O(d))<=n;)e[l]===void 0&&(e[l]=[]),e[l].push({from:void 0,to:l===n?a.to.day:void 0,range:a}),d.month++,d.month>12&&(d.year++,d.month=1)}}),e}),U=c(()=>{if(k.value===null)return;const{init:e,initHash:a,final:o,finalHash:n}=k.value,[l,v]=a<=n?[e,o]:[o,e],i=O(l),d=O(v);if(i!==D.value&&d!==D.value)return;const f={};return i===D.value?(f.from=l.day,f.includeFrom=!0):f.from=1,d===D.value?(f.to=v.day,f.includeTo=!0):f.to=H.value,f}),D=c(()=>O(s.value)),ft=c(()=>{const e={};if(t.options===void 0){for(let o=1;o<=H.value;o++)e[o]=!0;return e}const a=typeof t.options=="function"?t.options:o=>t.options.includes(o);for(let o=1;o<=H.value;o++){const n=D.value+"/"+Z(o);e[o]=a(n)}return e}),_t=c(()=>{const e={};if(t.events===void 0)for(let a=1;a<=H.value;a++)e[a]=!1;else{const a=typeof t.events=="function"?t.events:o=>t.events.includes(o);for(let o=1;o<=H.value;o++){const n=D.value+"/"+Z(o);e[o]=a(n)===!0&&mt.value(n)}}return e}),ht=c(()=>{let e,a;const{year:o,month:n}=s.value;if(t.calendar!=="persian")e=new Date(o,n-1,1),a=new Date(o,n-1,0).getDate();else{const l=Je(o,n,1);e=new Date(l.gy,l.gm-1,l.gd);let v=n-1,i=o;v===0&&(v=12,i--),a=$e(i,v)}return{days:e.getDay()-Ae.value-1,endDay:a}}),Pe=c(()=>{const e=[],{days:a,endDay:o}=ht.value,n=a<0?a+7:a;if(n<6)for(let i=o-n;i<=o;i++)e.push({i,fill:!0});const l=e.length;for(let i=1;i<=H.value;i++){const d={i,event:_t.value[i],classes:[]};ft.value[i]===!0&&(d.in=!0,d.flat=!0),e.push(d)}if(ie.value[D.value]!==void 0&&ie.value[D.value].forEach(i=>{const d=l+i-1;Object.assign(e[d],{selected:!0,unelevated:!0,flat:!1,color:A.value,textColor:L.value})}),ze.value[D.value]!==void 0&&ze.value[D.value].forEach(i=>{if(i.from!==void 0){const d=l+i.from-1,f=l+(i.to||H.value)-1;for(let G=d;G<=f;G++)Object.assign(e[G],{range:i.range,unelevated:!0,color:A.value,textColor:L.value});Object.assign(e[d],{rangeFrom:!0,flat:!1}),i.to!==void 0&&Object.assign(e[f],{rangeTo:!0,flat:!1})}else if(i.to!==void 0){const d=l+i.to-1;for(let f=l;f<=d;f++)Object.assign(e[f],{range:i.range,unelevated:!0,color:A.value,textColor:L.value});Object.assign(e[d],{flat:!1,rangeTo:!0})}else{const d=l+H.value-1;for(let f=l;f<=d;f++)Object.assign(e[f],{range:i.range,unelevated:!0,color:A.value,textColor:L.value})}}),U.value!==void 0){const i=l+U.value.from-1,d=l+U.value.to-1;for(let f=i;f<=d;f++)e[f].color=A.value,e[f].editRange=!0;U.value.includeFrom===!0&&(e[i].editRangeFrom=!0),U.value.includeTo===!0&&(e[d].editRangeTo=!0)}s.value.year===q.value.year&&s.value.month===q.value.month&&(e[l+q.value.day-1].today=!0);const v=e.length%7;if(v>0){const i=7-v;for(let d=1;d<=i;d++)e.push({i:d,fill:!0})}return e.forEach(i=>{let d="q-date__calendar-item ";i.fill===!0?d+="q-date__calendar-item--fill":(d+=`q-date__calendar-item--${i.in===!0?"in":"out"}`,i.range!==void 0&&(d+=` q-date__range${i.rangeTo===!0?"-to":i.rangeFrom===!0?"-from":""}`),i.editRange===!0&&(d+=` q-date__edit-range${i.editRangeFrom===!0?"-from":""}${i.editRangeTo===!0?"-to":""}`),(i.range!==void 0||i.editRange===!0)&&(d+=` text-${i.color}`)),i.classes=d}),e}),gt=c(()=>t.disable===!0?{"aria-disabled":"true"}:t.readonly===!0?{"aria-readonly":"true"}:{});K(()=>t.modelValue,e=>{if(B===e)B=0;else{const a=Le(Y.value,g.value);x(a.year,a.month,a)}}),K(C,()=>{ye.value!==null&&w.$el.contains(document.activeElement)===!0&&ye.value.focus()}),K(()=>s.value.year+"|"+s.value.month,()=>{m("navigation",{year:s.value.year,month:s.value.month})}),K(rt,e=>{Qe(e,g.value,"mask"),Y.value=e}),K(st,e=>{Qe(Y.value,e,"locale"),g.value=e});function Ne(){const{year:e,month:a,day:o}=q.value,n={...s.value,year:e,month:a,day:o},l=ie.value[O(n)];(l===void 0||l.includes(n.day)===!1)&&Ve(n),Ce(n.year,n.month)}function yt(e){tt(e)===!0&&(C.value=e)}function wt(e,a){["month","year"].includes(e)&&(e==="month"?xe:Te)(a===!0?-1:1)}function Ce(e,a){C.value="Calendar",x(e,a)}function pt(e,a){if(t.range===!1||!e){k.value=null;return}const o=Object.assign({...s.value},e),n=a!==void 0?Object.assign({...s.value},a):o;k.value={init:o,initHash:I(o),final:n,finalHash:I(n)},Ce(o.year,o.month)}function Be(){return t.calendar==="persian"?"YYYY/MM/DD":t.mask}function De(e,a,o){return Jt(e,a,o,t.calendar,{hour:0,minute:0,second:0,millisecond:0})}function Le(e,a){const o=Array.isArray(t.modelValue)===!0?t.modelValue:t.modelValue?[t.modelValue]:[];if(o.length===0)return Fe();const n=o[o.length-1],l=De(n.from!==void 0?n.from:n,e,a);return l.dateHash===null?Fe():l}function Fe(){let e,a;if(t.defaultYearMonth!==void 0){const o=t.defaultYearMonth.split("/");e=parseInt(o[0],10),a=parseInt(o[1],10)}else{const o=q.value!==void 0?q.value:ee();e=o.year,a=o.month}return{year:e,month:a,day:1,hour:0,minute:0,second:0,millisecond:0,dateHash:e+"/"+Z(a)+"/01"}}function xe(e){let a=s.value.year,o=Number(s.value.month)+e;o===13?(o=1,a++):o===0&&(o=12,a--),x(a,o),oe.value===!0&&re("month")}function Te(e){const a=Number(s.value.year)+e;x(a,s.value.month),oe.value===!0&&re("year")}function bt(e){x(e,s.value.month),C.value=t.defaultView==="Years"?"Months":"Calendar",oe.value===!0&&re("year")}function kt(e){x(s.value.year,e),C.value="Calendar",oe.value===!0&&re("month")}function jt(e,a){const o=ie.value[a];(o!==void 0&&o.includes(e.day)===!0?Me:Ve)(e)}function z(e){return{year:e.year,month:e.month,day:e.day}}function x(e,a,o){if(p.value!==null&&e<=p.value.year&&((a<p.value.month||e<p.value.year)&&(a=p.value.month),e=p.value.year),b.value!==null&&e>=b.value.year&&((a>b.value.month||e>b.value.year)&&(a=b.value.month),e=b.value.year),o!==void 0){const{hour:l,minute:v,second:i,millisecond:d,timezoneOffset:f,timeHash:G}=o;Object.assign(s.value,{hour:l,minute:v,second:i,millisecond:d,timezoneOffset:f,timeHash:G})}const n=e+"/"+Z(a)+"/01";n!==s.value.dateHash&&(te.value=s.value.dateHash<n==(S.lang.rtl!==!0)?"left":"right",e!==s.value.year&&(we.value=te.value),Ue(()=>{ae.value=e-e%N-(e<0?N:0),Object.assign(s.value,{year:e,month:a,day:1,dateHash:n})}))}function We(e,a,o){const n=e!==null&&e.length===1&&t.multiple===!1?e[0]:e;B=n;const{reason:l,details:v}=Ee(a,o);m("update:modelValue",n,l,v)}function re(e){const a=V.value[0]!==void 0&&V.value[0].dateHash!==null?{...V.value[0]}:{...s.value};Ue(()=>{a.year=s.value.year,a.month=s.value.month;const o=t.calendar!=="persian"?new Date(a.year,a.month,0).getDate():$e(a.year,a.month);a.day=Math.min(Math.max(1,a.day),o);const n=W(a);B=n;const{details:l}=Ee("",a);m("update:modelValue",n,e,l)})}function Ee(e,a){return a.from!==void 0?{reason:`${e}-range`,details:{...z(a.target),from:z(a.from),to:z(a.to)}}:{reason:`${e}-day`,details:z(a)}}function W(e,a,o){return e.from!==void 0?{from:ke.value(e.from,a,o),to:ke.value(e.to,a,o)}:ke.value(e,a,o)}function Ve(e){let a;if(t.multiple===!0)if(e.from!==void 0){const o=I(e.from),n=I(e.to),l=V.value.filter(i=>i.dateHash<o||i.dateHash>n),v=F.value.filter(({from:i,to:d})=>d.dateHash<o||i.dateHash>n);a=l.concat(v).concat(e).map(i=>W(i))}else{const o=be.value.slice();o.push(W(e)),a=o}else a=W(e);We(a,"add",e)}function Me(e){if(t.noUnset===!0)return;let a=null;if(t.multiple===!0&&Array.isArray(t.modelValue)===!0){const o=W(e);e.from!==void 0?a=t.modelValue.filter(n=>n.from!==void 0?n.from!==o.from&&n.to!==o.to:!0):a=t.modelValue.filter(n=>n!==o),a.length===0&&(a=null)}We(a,"remove",e)}function Qe(e,a,o){const n=V.value.concat(F.value).map(l=>W(l,e,a)).filter(l=>l.from!==void 0?l.from.dateHash!==null&&l.to.dateHash!==null:l.dateHash!==null);m("update:modelValue",(t.multiple===!0?n:n[0])||null,o)}function Ct(){if(t.minimal!==!0)return u("div",{class:"q-date__header "+_e.value},[u("div",{class:"relative-position"},[u(J,{name:"q-transition--fade"},()=>u("div",{key:"h-yr-"+Ye.value,class:"q-date__header-subtitle q-date__header-link "+(C.value==="Years"?"q-date__header-link--active":"cursor-pointer"),tabindex:j.value,..._("vY",{onClick(){C.value="Years"},onKeyup(e){e.keyCode===13&&(C.value="Years")}})},[Ye.value]))]),u("div",{class:"q-date__header-title relative-position flex no-wrap"},[u("div",{class:"relative-position col"},[u(J,{name:"q-transition--fade"},()=>u("div",{key:"h-sub"+Oe.value,class:"q-date__header-title-label q-date__header-link "+(C.value==="Calendar"?"q-date__header-link--active":"cursor-pointer"),tabindex:j.value,..._("vC",{onClick(){C.value="Calendar"},onKeyup(e){e.keyCode===13&&(C.value="Calendar")}})},[Oe.value]))]),t.todayBtn===!0?u(M,{class:"q-date__header-today self-start",icon:S.iconSet.datetime.today,flat:!0,size:"sm",round:!0,tabindex:j.value,onClick:Ne}):null])])}function Se({label:e,type:a,key:o,dir:n,goTo:l,boundaries:v,cls:i}){return[u("div",{class:"row items-center q-date__arrow"},[u(M,{round:!0,dense:!0,size:"sm",flat:!0,icon:le.value[0],tabindex:j.value,disable:v.prev===!1,..._("go-#"+a,{onClick(){l(-1)}})})]),u("div",{class:"relative-position overflow-hidden flex flex-center"+i},[u(J,{name:"q-transition--jump-"+n},()=>u("div",{key:o},[u(M,{flat:!0,dense:!0,noCaps:!0,label:e,tabindex:j.value,..._("view#"+a,{onClick:()=>{C.value=a}})})]))]),u("div",{class:"row items-center q-date__arrow"},[u(M,{round:!0,dense:!0,size:"sm",flat:!0,icon:le.value[1],tabindex:j.value,disable:v.next===!1,..._("go+#"+a,{onClick(){l(1)}})})])]}const Dt={Calendar:()=>[u("div",{key:"calendar-view",class:"q-date__view q-date__calendar"},[u("div",{class:"q-date__navigation row items-center no-wrap"},Se({label:g.value.months[s.value.month-1],type:"Months",key:s.value.month,dir:te.value,goTo:xe,boundaries:je.value.month,cls:" col"}).concat(Se({label:s.value.year,type:"Years",key:s.value.year,dir:we.value,goTo:Te,boundaries:je.value.year,cls:""}))),u("div",{class:"q-date__calendar-weekdays row items-center no-wrap"},vt.value.map(e=>u("div",{class:"q-date__calendar-item"},[u("div",e)]))),u("div",{class:"q-date__calendar-days-container relative-position overflow-hidden"},[u(J,{name:"q-transition--slide-"+te.value},()=>u("div",{key:D.value,class:"q-date__calendar-days fit"},Pe.value.map(e=>u("div",{class:e.classes},[e.in===!0?u(M,{class:e.today===!0?"q-date__today":"",dense:!0,flat:e.flat,unelevated:e.unelevated,color:e.color,textColor:e.textColor,label:e.i,tabindex:j.value,..._("day#"+e.i,{onClick:()=>{Tt(e.i)},onMouseover:()=>{Vt(e.i)}})},e.event!==!1?()=>u("div",{class:"q-date__event bg-"+e.event}):null):u("div",""+e.i)]))))])])],Months(){const e=s.value.year===q.value.year,a=n=>p.value!==null&&s.value.year===p.value.year&&p.value.month>n||b.value!==null&&s.value.year===b.value.year&&b.value.month<n,o=g.value.monthsShort.map((n,l)=>{const v=s.value.month===l+1;return u("div",{class:"q-date__months-item flex flex-center"},[u(M,{class:e===!0&&q.value.month===l+1?"q-date__today":null,flat:v!==!0,label:n,unelevated:v,color:v===!0?A.value:null,textColor:v===!0?L.value:null,tabindex:j.value,disable:a(l+1),..._("month#"+l,{onClick:()=>{kt(l+1)}})})])});return t.yearsInMonthView===!0&&o.unshift(u("div",{class:"row no-wrap full-width"},[Se({label:s.value.year,type:"Years",key:s.value.year,dir:we.value,goTo:Te,boundaries:je.value.year,cls:" col"})])),u("div",{key:"months-view",class:"q-date__view q-date__months flex flex-center"},o)},Years(){const e=ae.value,a=e+N,o=[],n=l=>p.value!==null&&p.value.year>l||b.value!==null&&b.value.year<l;for(let l=e;l<=a;l++){const v=s.value.year===l;o.push(u("div",{class:"q-date__years-item flex flex-center"},[u(M,{key:"yr"+l,class:q.value.year===l?"q-date__today":null,flat:!v,label:l,dense:!0,unelevated:v,color:v===!0?A.value:null,textColor:v===!0?L.value:null,tabindex:j.value,disable:n(l),..._("yr#"+l,{onClick:()=>{bt(l)}})})]))}return u("div",{class:"q-date__view q-date__years flex flex-center"},[u("div",{class:"col-auto"},[u(M,{round:!0,dense:!0,flat:!0,icon:le.value[0],tabindex:j.value,disable:n(e),..._("y-",{onClick:()=>{ae.value-=N}})})]),u("div",{class:"q-date__years-content col self-stretch row items-center"},o),u("div",{class:"col-auto"},[u(M,{round:!0,dense:!0,flat:!0,icon:le.value[1],tabindex:j.value,disable:n(a),..._("y+",{onClick:()=>{ae.value+=N}})})])])}};function Tt(e){const a={...s.value,day:e};if(t.range===!1){jt(a,D.value);return}if(k.value===null){const o=Pe.value.find(l=>l.fill!==!0&&l.i===e);if(t.noUnset!==!0&&o.range!==void 0){Me({target:a,from:o.range.from,to:o.range.to});return}if(o.selected===!0){Me(a);return}const n=I(a);k.value={init:a,initHash:n,final:a,finalHash:n},m("rangeStart",z(a))}else{const o=k.value.initHash,n=I(a),l=o<=n?{from:k.value.init,to:a}:{from:a,to:k.value.init};k.value=null,Ve(o===n?a:{target:a,...l}),m("rangeEnd",{from:z(l.from),to:z(l.to)})}}function Vt(e){if(k.value!==null){const a={...s.value,day:e};Object.assign(k.value,{final:a,finalHash:I(a)})}}return Object.assign(w,{setToday:Ne,setView:yt,offsetCalendar:wt,setCalendarTo:Ce,setEditingRange:pt}),()=>{const e=[u("div",{class:"q-date__content col relative-position"},[u(J,{name:"q-transition--fade"},Dt[C.value])])],a=At(r.default);return a!==void 0&&e.push(u("div",{class:"q-date__actions"},a)),t.name!==void 0&&t.disable!==!0&&ge(e,"push"),u("div",{class:ut.value,...gt.value},[Ct(),u("div",{ref:ye,class:"q-date__main col column",tabindex:-1},e)])}}});function at(){return{isViewingArranged:!1,isViewingHeld:!1}}const sa=ot({name:"ViewingInformationCard",props:["projectid","leadinformation"],components:{},setup(){return{backend_connection_store:it()}},data(){return{emit_project_change_notification:!0,current_workflow_position:{workflow_used_id:-1,current_stage:-1},viewing_timestamp:"2025-04-19T10:50:44.066Z",call_timestamp:void 0,call_notes:""}},watch:{serializer_card_data(t){this.emit_project_change_notification&&this.$emit("projectchanged","ViewingInformation:serializer")}},computed:{calendar_start_time(){return et.fromISO(this.viewing_timestamp).toFormat("HH:mm")},calendar_end_time(){return et.fromISO(this.viewing_timestamp).plus({hours:1}).toFormat("HH:mm")},calendar_day(){return this.viewing_timestamp.substring(0,10)},calendar_description(){return Xt({projectid:this.projectid,leadinformation:this.leadinformation,call_notes:this.call_notes})},callMadeOnText(){if(typeof this.call_timestamp=="undefined")return"Unknown";const t=new Date(this.call_timestamp),r=t.getHours().toString().padStart(2,"0"),m=t.getMinutes().toString().padStart(2,"0");return t.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})+` at ${r}:${m}`},dateOnly:{get(){return new Date(this.viewing_timestamp).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric",year:"numeric"})},set(t){const r=new Date(t);if(isNaN(r))return;const m=new Date(this.viewing_timestamp);r.setHours(m.getHours()),r.setMinutes(m.getMinutes()),r.setSeconds(0),r.setMilliseconds(0),this.viewing_timestamp=r.toISOString()}},timeOnly:{get(){const t=new Date(this.viewing_timestamp),r=t.getHours().toString().padStart(2,"0"),m=t.getMinutes().toString().padStart(2,"0");return`${r}:${m}`},set(t){const[r,m]=t.split(":").map(Number),w=new Date(this.viewing_timestamp);w.setHours(r),w.setMinutes(m),w.setSeconds(0),w.setMilliseconds(0),this.viewing_timestamp=w.toISOString()}},serializer_card_data(){return{viewing_timestamp:this.viewing_timestamp,call_timestamp:this.call_timestamp,call_notes:this.call_notes}},workflow_stage_data(){return this.current_workflow_position.workflow_used_id===-1||this.current_workflow_position.current_stage===-1?at():ea.workflows[this.current_workflow_position.workflow_used_id]._stage_calc_fn(this.current_workflow_position.current_stage)}},methods:{reset_data(){console.log("RESET DATA CALL"),this.emit_project_change_notification=!1;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)},serializer_load_data(t){this.emit_project_change_notification=!1,this.viewing_timestamp=t.viewing_timestamp,typeof t.call_timestamp=="undefined"?this.call_timestamp=void 0:this.call_timestamp=t.call_timestamp,typeof t.call_notes=="undefined"?this.call_notes="":this.call_notes=t.call_notes;const r=this;setTimeout(function(){r.emit_project_change_notification=!0},50)},setWorkflowInfo({workflow_used_id:t,current_stage:r}){console.log("setWorkflowInfo"),this.current_workflow_position.workflow_used_id=t,this.current_workflow_position.current_stage=r}}}),ua=y("div",{class:"text-h6"},"Call for Viewing",-1),da={key:0},ca={key:1},va={key:0},ma={class:"row viewinginfo-datetime-controls"},fa={class:"row items-center justify-end"},_a={class:"row items-center justify-end"},ha=["name","location","description","startDate","endDate","startTime","endTime"],ga={key:1};function ya(t,r,m,w,S,fe){return Q(),lt(Bt,{inline:"",class:"q-ma-sm card-style col-grow"},{default:T(()=>[h(Nt,null,{default:T(()=>[ua,t.workflow_stage_data.isViewingArranged?ue("",!0):(Q(),se("div",da," No viewing has been arranged. ")),t.workflow_stage_data.isViewingArranged?(Q(),se("div",ca,[t.workflow_stage_data.isViewingHeld?ue("",!0):(Q(),se("div",va,[y("div",null," Call made on "+ve(t.callMadeOnText),1),y("div",null,[de(" Notes: "),h(qe,{filled:"",modelValue:t.call_notes,"onUpdate:modelValue":r[0]||(r[0]=_=>t.call_notes=_),label:"Notes from this call",autogrow:""},null,8,["modelValue"])]),y("div",ma,[y("div",null,[de(" Viewing Date: "),h(qe,{filled:"",modelValue:t.dateOnly,"onUpdate:modelValue":r[2]||(r[2]=_=>t.dateOnly=_),readonly:""},{append:T(()=>[h(Ge,{name:"event",class:"cursor-pointer"},{default:T(()=>[h(Ze,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:T(()=>[h(ra,{modelValue:t.dateOnly,"onUpdate:modelValue":r[1]||(r[1]=_=>t.dateOnly=_),mask:"dddd, MMM D, YYYY"},{default:T(()=>[y("div",fa,[me(h(M,{label:"Close",color:"primary",flat:""},null,512),[[Xe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),y("div",null,[de(" Viewing Time: "),h(qe,{filled:"",modelValue:t.timeOnly,"onUpdate:modelValue":r[4]||(r[4]=_=>t.timeOnly=_),mask:"time",rules:["time"],readonly:""},{append:T(()=>[h(Ge,{name:"access_time",class:"cursor-pointer"},{default:T(()=>[h(Ze,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:T(()=>[h(Zt,{modelValue:t.timeOnly,"onUpdate:modelValue":r[3]||(r[3]=_=>t.timeOnly=_)},{default:T(()=>[y("div",_a,[me(h(M,{label:"Close",color:"primary",flat:""},null,512),[[Xe]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),y("div",null,[y("add-to-calendar-button",{name:"Viewing: "+t.leadinformation.address+", "+t.leadinformation.postcode,options:"'Apple','Google','Yahoo','iCal'",location:t.leadinformation.address+", "+t.leadinformation.postcode,description:t.calendar_description,startDate:t.calendar_day,endDate:t.calendar_day,startTime:t.calendar_start_time,endTime:t.calendar_end_time,timeZone:"Europe/London"},null,8,ha)])])),t.workflow_stage_data.isViewingHeld?(Q(),se("div",ga,[y("div",null,"Viewing held "+ve(t.dateOnly)+" at "+ve(t.timeOnly),1),de(" TODO result record ")])):ue("",!0)])):ue("",!0)]),_:1})]),_:1})}var wa=nt(sa,[["render",ya]]);const pa=ot({name:"CalcBrrToFlip",components:{LeadInformation:Et,ActivityLog:ta,Workflow:aa,Todos:Ft,ProjectSerializer:oa,BrrToolbar:xt,ViewingInfo:wa},setup(){const t=it(),r=Lt(),m=Wt();return{q:r,backend_connection_store:t,dataCachesStore:m}},data(){return{tab:"main",isMounted:!1,loaded_project_id:"",sucessful_load_completed:!1}},computed:{leadinformation(){return this.isMounted?this.$refs.LeadInformation.serializer_card_data:{address:"",advert_information:"",advertweblinks:[],contact_email:"",contact_phone:"",landlord_name:"",lead_source:"Not Selected",patch_id:void 0,postcode:""}},project_type(){return na.project_type_constants.project_type_rent},serialized_data(){return this.isMounted?{leadinformation:this.$refs.LeadInformation.serializer_card_data,viewinginformation:this.$refs.ViewingInfo.serializer_card_data}:{}}},methods:{createtodo(t){const r=this,m={ok:function(w){r.$refs.todos.add_single_todo(w.data.todo),ce.create({color:"bg-grey-2",message:"Todo added",timeout:2e3,color:"positive"})},error:function(w){ce.create({color:"bg-grey-2",message:w.message,timeout:2e3,color:"negative"})}};r.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+r.loaded_project_id+"/todos",method:"POST",data:t,callback:m})},save_project(){this.$refs.ProjectSerializer.save_project({dict_of_card_info:this.serialized_data,activity_log:this.$refs.ActivityLog.serializer_card_data,workflow:this.$refs.Workflow.serializer_card_data,patch_id:this.serialized_data.leadinformation.patch_id,passthroughdata:void 0})},navigate_away(t){this.$router.push(t.dest)},call_load_api(){const t=this,r={ok:t.load_project_api_success,error:t.load_project_api_fail};t.dataCachesStore.get({backend_connection_store:t.backend_connection_store,object_type:"projects",object_id:t.$route.query.projectid,skip_cache:!1,callback:r})},load_project_api_success(t){this.loaded_project_id=t.data.id,this.load_project_into_cards(t.data),this.sucessful_load_completed=!0,ce.create({color:"bg-grey-2",message:"Project Loaded",timeout:2e3,color:"positive"}),this.load_complete()},load_project_api_fail(t){ce.create({color:"bg-grey-2",message:"Error loading project "+t,timeout:2e3,color:"negative"}),this.load_complete()},load_complete(){this.q.loading.hide();const t=this;setTimeout(function(){t.isMounted=!0},105)},load_project_into_cards(t){this.$refs.ProjectSerializer.serializer_load_data(t),typeof t.sub_section_details.leadinformation!="undefined"&&this.$refs.LeadInformation.serializer_load_data(t.sub_section_details.leadinformation),typeof t.sub_section_details.viewinginformation!="undefined"&&this.$refs.ViewingInfo.serializer_load_data(t.sub_section_details.viewinginformation),this.$refs.ActivityLog.serializer_load_data(t.activity_log),this.$refs.Workflow.serializer_load_data(t.workflow),this.$refs.todos.serializer_load_data(t.todos),this.$refs.ViewingInfo.setWorkflowInfo(t.workflow)},save_project_complete({success:t,response:r,passthroughdata:m}){t&&(this.loaded_project_id=r.data.id),this.$refs.BrrToolbar.save_project_complete_notification({success:t,response:r})},projectchanged(t){if(console.log("rentCalc page received project changed from ",t),!this.isMounted){console.log("WARNING = projectchanged called when mounted is false");return}if(typeof this.$refs.BrrToolbar=="undefined")return console.log("WARNING = projectchanged called when BrrToolbar is undefined"),!1;this.$refs.BrrToolbar.set_changed_true(),this.$refs.ViewingInfo.setWorkflowInfo(this.$refs.Workflow.serializer_card_data)},click_save_btn(){this.$refs.BrrToolbar.click_save_btn()},activity_log(t){if(!this.isMounted){console.log("ERROR - trying to log activity unmounted",t);return}this.$refs.ActivityLog.log_activity(t)}},mounted(){const t=this;if(this.q.loading.show(),typeof t.$route.query.projectid=="undefined"){this.$router.push("/tools");return}setTimeout(function(){t.call_load_api()},1e3)}}),ba={class:"rentcalc-page fit col wrap justify-center items-center content-center"},ka={class:"row"},ja={class:"row"};function Ca(t,r,m,w,S,fe){const _=P("BrrToolbar"),j=P("LeadInformation"),_e=P("ViewingInfo"),X=P("Workflow"),ee=P("Todos"),B=P("ActivityLog"),he=P("ProjectSerializer");return Q(),lt(St,{class:"flex"},{default:T(()=>[y("div",ba,[y("div",null,[y("h1",null,"Rent Project "+ve(t.sucessful_load_completed),1)]),h(_,{ref:"BrrToolbar",reason_project_not_savable:"",is_saved_project_with_id:!0,is_rent_project:!0,onActivity_log:t.activity_log,onSaveproject:t.save_project,onCreatetodo:t.createtodo},null,8,["onActivity_log","onSaveproject","onCreatetodo"]),h(Mt,{modelValue:t.tab,"onUpdate:modelValue":r[0]||(r[0]=ge=>t.tab=ge),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:T(()=>[h(Re,{name:"main",label:"Main"}),h(Re,{name:"project",label:"Project"})]),_:1},8,["modelValue"]),me(y("div",ka,[h(j,{ref:"LeadInformation",ever_saved:"true",onNavigate_away:t.navigate_away,onProjectchanged:t.projectchanged},null,8,["onNavigate_away","onProjectchanged"]),h(_e,{ref:"ViewingInfo",projectid:t.loaded_project_id,leadinformation:t.leadinformation,onProjectchanged:t.projectchanged},null,8,["projectid","leadinformation","onProjectchanged"])],512),[[Ke,t.tab==="main"]]),me(y("div",ja,[h(X,{ref:"Workflow",onProjectchanged:t.projectchanged,onActivity_log:t.activity_log,onClick_save_btn:t.click_save_btn},null,8,["onProjectchanged","onActivity_log","onClick_save_btn"]),h(ee,{ref:"todos"},null,512),h(B,{ref:"ActivityLog",onProjectchanged:t.projectchanged},null,8,["onProjectchanged"])],512),[[Ke,t.tab==="project"]])]),h(he,{ref:"ProjectSerializer",onSaveprojectcomplete:t.save_project_complete,project_type:t.project_type,success_message:"Lead Saved"},null,8,["onSaveprojectcomplete","project_type"])]),_:1})}var Ja=nt(pa,[["render",Ca]]);export{Ja as default};

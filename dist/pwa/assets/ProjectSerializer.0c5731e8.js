import{a as M}from"./QSelect.b7dff7c0.js";import{d as T,N as b,_ as q,o as l,K as c,M as V,O as W,a as o,w as m,f as N,t as y,Q as h,aa as A,ae as S,e as u,af as B,ah as U,ai as E,aj as I,g as J,k as v,q as r,aE as R,c as z,L as k}from"./index.69d4ee77.js";import{C as F}from"./ClosePopup.e4ecd437.js";import{u as K}from"./utils.99aafcb0.js";import{u as L}from"./uuid.6153c38a.js";import{u as H}from"./backend_connection.a3f6274f.js";import{u as Q}from"./data_caches.cd56a1ba.js";import{W as j}from"./Workflow_main.1e4e793e.js";function O(e,t){return{id:L(),label:e,displaytext:t}}function G(e){const t=e.match(/\s\((\d+)\)$/);if(t){const i=parseInt(t[1],10)+1;return e.replace(/\s\(\d+\)$/,` (${i})`)}else return e+" (1)"}const X=T({name:"WebLinksComponent",props:["weblinks"],emits:["updateweblinks"],data(){return{edit_dialog:{visible:!1,record:{},title:"",message:""}}},computed:{weblinkdisplay(){return this.weblinks.map(function(e){if(typeof e.displaytext!="undefined"&&e.displaytext!=null&&e.displaytext.trim().length>0)return{id:e.id,label:e.label,text:e.displaytext,icon:"star"};const t=K.getDefaultWeblinkDisplayTextAndIcon(e.label);return{id:e.id,label:e.label,text:t.text,icon:t.icon}})}},methods:{editweblink(e){this.edit_dialog.record=JSON.parse(JSON.stringify(this.weblinks.filter(function(t){return t.id===e})[0])),this.edit_dialog.title="Edit Weblink",this.edit_dialog.message="",this.edit_dialog.visible=!0},editweblinkok(){if(!this.validate_weblink(this.edit_dialog.record))return;const e=this,t=this.weblinks.filter(function(i){return e.edit_dialog.record.id!==i.id});t.push(this.edit_dialog.record),this.edit_dialog.visible=!1,e.$emit("updateweblinks",t)},get_uinque_weblink_display_text(e){return this.weblinks.filter(function(i){return i.displaytext===e}).length===0?e:this.get_uinque_weblink_display_text(G(e))},apiaddweblink({url:e,displaytext:t}){console.log("apiaddweblink",this.weblinks);const i=this.weblinks.filter(function(s){return!0});i.push(O(e,this.get_uinque_weblink_display_text(t))),this.$emit("updateweblinks",i)},clickweblink(e){window.open(e.label,"_blank").focus()},delweblink(e){const t=this.weblinks.filter(function(i){return e!==i.id});this.edit_dialog.visible=!1,this.$emit("updateweblinks",t)},validate_weblink(e){return typeof e.label=="undefined"?(b.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"}),!1):e.label===null?(b.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"}),!1):e.label.startsWith("http")?!0:(b.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"}),!1)},addweblink(){this.edit_dialog.title="Add Weblink",this.edit_dialog.message="Add weblink to information about this property (rightmove, zoopla, etc.)",this.edit_dialog.record=O("",""),this.edit_dialog.visible=!0}}}),Y={class:"text-h6"},Z={style:{width:"25vw"}};function ee(e,t,i,s,_,f){return l(),c("div",null,[(l(!0),c(V,null,W(e.weblinkdisplay,a=>(l(),c("div",{key:a},[o(M,{clickable:"",onClick:n=>e.clickweblink(a),removable:"",onRemove:n=>e.editweblink(a.id),color:"primary","text-color":"white",icon:a.icon,"icon-remove":"edit"},{default:m(()=>[N(y(a.text),1)]),_:2},1032,["onClick","onRemove","icon"])]))),128)),o(h,{round:"",color:"primary",icon:"add",onClick:e.addweblink},null,8,["onClick"]),o(I,{modelValue:e.edit_dialog.visible,"onUpdate:modelValue":t[3]||(t[3]=a=>e.edit_dialog.visible=a)},{default:m(()=>[o(A,null,{default:m(()=>[o(S,null,{default:m(()=>[u("div",Y,y(e.edit_dialog.title),1)]),_:1}),o(S,{class:"q-pt-none"},{default:m(()=>[u("div",Z,[N(y(e.edit_dialog.message)+" ",1),o(B,{modelValue:e.edit_dialog.record.displaytext,"onUpdate:modelValue":t[0]||(t[0]=a=>e.edit_dialog.record.displaytext=a),label:"Display Text",clearable:""},null,8,["modelValue"]),o(B,{modelValue:e.edit_dialog.record.label,"onUpdate:modelValue":t[1]||(t[1]=a=>e.edit_dialog.record.label=a),label:"URL",clearable:""},null,8,["modelValue"])])]),_:1}),o(U,{align:"right"},{default:m(()=>[o(h,{flat:"",label:"Delete",color:"negative",onClick:t[2]||(t[2]=a=>e.delweblink(e.edit_dialog.record.id))}),E(o(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[F]]),o(h,{flat:"",label:"OK",onClick:e.editweblinkok},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var je=q(X,[["render",ee]]),D=J({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:t}){const i=v(()=>e.sent===!0?"sent":"received"),s=v(()=>`q-message-text-content q-message-text-content--${i.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),_=v(()=>`q-message-text q-message-text--${i.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),f=v(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),a=v(()=>e.size!==void 0?`col-${e.size}`:""),n=v(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function $(d){return t.stamp!==void 0?[d,r("div",{class:"q-message-stamp"},t.stamp())]:e.stamp?[d,r("div",{class:"q-message-stamp",[n.value.stamp]:e.stamp})]:[d]}function C(d,g){const w=g===!0?d.length>1?p=>p:p=>r("div",[p]):p=>r("div",{[n.value.msg]:p});return d.map((p,P)=>r("div",{key:P,class:_.value},[r("div",{class:s.value},$(w(p)))]))}return()=>{const d=[];t.avatar!==void 0?d.push(t.avatar()):e.avatar!==void 0&&d.push(r("img",{class:`q-message-avatar q-message-avatar--${i.value}`,src:e.avatar,"aria-hidden":"true"}));const g=[];t.name!==void 0?g.push(r("div",{class:`q-message-name q-message-name--${i.value}`},t.name())):e.name!==void 0&&g.push(r("div",{class:`q-message-name q-message-name--${i.value}`,[n.value.name]:e.name})),t.default!==void 0?g.push(C(R(t.default()),!0)):e.text!==void 0&&g.push(C(e.text)),d.push(r("div",{class:a.value},g));const w=[];return t.label!==void 0?w.push(r("div",{class:"q-message-label"},t.label())):e.label!==void 0&&w.push(r("div",{class:"q-message-label",[n.value.label]:e.label})),w.push(r("div",{class:f.value},d)),r("div",{class:`q-message q-message-${i.value}`},w)}}});const te=T({name:"BrrCalcActivityJob",emits:["projectchanged"],data(){return{activity_log:[],emit_project_change_notification:!0}},computed:{serializer_card_data(){return this.activity_log},activity_log_display(){let e=[];const t={book_viewing:{sent:!0,name:"Viewing booked"},hold_viewing:{sent:!1,name:"Viewing"},call_agent:{sent:!0,name:"Call to agent"},research_call:{sent:!0,name:"Research Call"},wf_move:{sent:!1,name:"Workflow"},admin:{sent:!1,name:"Admin action"},offer_made:{sent:!0,name:"Offer made"},offer_rejected:{sent:!1,name:"Offer rejected"},offer_accepted:{sent:!1,name:"Offer accepted"}};let i="";return this.activity_log.forEach(function(s){const _=new Date(s.timestamp),f=_.toDateString(),a=_.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});i!==f&&(i=f,e=e.concat([{id:L(),label:i}]));let n=t[s.type].name;typeof s.head_notes!="undefined"&&(n=n+" ("+s.head_notes+")"),e=e.concat({id:s.t,label:void 0,name:n,text:s.text,sent:t[s.type].sent,stamp:a,avatar:"activity_log_icon_"+s.type+".png"})}),e}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged","ActivityLog:serializer")}},methods:{log_activity(e){const t=this;var i=this.activity_log.filter(function(s){return!0});i.push({id:L(),type:e.type,timestamp:new Date().toISOString(),text:e.text,head_notes:e.head_notes}),this.activity_log=i,this.emit_project_change_notification=!1,typeof e.immediate_save_after_log!="undefined"&&e.immediate_save_after_log?this.$emit("projectchanged","ActivityLog:log_activity:forcesave"):this.$emit("projectchanged","ActivityLog:log_activity"),setTimeout(function(){t.emit_project_change_notification=!0},50)},serializer_load_data(e){this.emit_project_change_notification=!1,this.activity_log=e;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)}}}),ae=u("div",{class:"text-h6"},"Activity Log",-1),ie={style:{width:"100%","max-width":"400px"}},se={key:0},oe={key:1},ne=["src"];function le(e,t,i,s,_,f){return l(),z(A,{inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:m(()=>[o(S,null,{default:m(()=>[ae,u("div",ie,[(l(!0),c(V,null,W(e.activity_log_display,a=>(l(),c("div",{key:a.id},[typeof a.label=="string"?(l(),c("div",se,[o(D,{label:a.label},null,8,["label"])])):k("",!0),typeof a.label=="undefined"?(l(),c("div",oe,[o(D,{name:a.name,text:[a.text],"text-html":"",sent:a.sent,stamp:a.stamp,avatar:a.avatar},{avatar:m(()=>[u("img",{class:"q-message-avatar q-message-avatar--sent",alt:"Avatar",src:"/"+a.avatar},null,8,ne)]),_:2},1032,["name","text","sent","stamp","avatar"])])):k("",!0)]))),128))])]),_:1})]),_:1})}var Se=q(te,[["render",le]]);function x(e){return{workflow_used_id:e,current_stage:j.get_default_workflow_initial_stage(e)}}const re=T({name:"BrrCalcWorkflow",emits:["projectchanged","activity_log","click_save_btn"],props:{default_workflow_id:{type:String,default:j.default_workflow_id}},setup(){const e=H(),t=Q();return{backend_connection_store:e,dataCachesStore:t}},data(){return{loaded:!1,workflows:void 0,workflow_data:x(j.default_workflow_id),emit_project_change_notification:!0}},computed:{serializer_card_data(){return this.workflow_data},workflow_model(){return this.workflows[this.workflow_data.workflow_used_id]}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged","Workflow")}},methods:{progress(e){const t={type:"wf_move",text:"From "+this.workflow_model.stages[this.workflow_data.current_stage].name+" to "+this.workflow_model.stages[e].name,head_notes:"Progressed through workflow",immediate_save_after_log:!0};this.workflow_data.current_stage=e,this.$emit("activity_log",t)},serializer_load_data(e){this.emit_project_change_notification=!1,typeof e.workflow_used_id=="undefined"?this.workflow_data=x(this.default_workflow_id):this.workflow_data=e;const t=this;setTimeout(function(){t.emit_project_change_notification=!0},50)}},mounted(){this.workflow_data=x(this.default_workflow_id),this.loaded=!1;const e=this,t={ok:function(i){e.workflows=i,e.loaded=!0},error:function(i){Notify.create({color:"bg-grey-2",message:"Unable to load workflow information",timeout:2e3,color:"negative"})}};j.workflow3(this.backend_connection_store,this.dataCachesStore,t)}}),de={class:"text-h6"},ce={class:"col"},_e={key:0},ue={key:0},me={key:1,class:"resetbuttondiv"};function fe(e,t,i,s,_,f){return l(),z(A,{inline:"",class:"q-ma-sm card-style"},{default:m(()=>[e.loaded?(l(),z(S,{key:0},{default:m(()=>[u("div",de,"Workflow - "+y(e.workflow_model.name),1),u("div",ce,[u("div",null,[u("h3",null,"Stage: "+y(e.workflow_model.stages[e.workflow_data.current_stage].name),1)]),typeof e.workflow_model.stages[e.workflow_data.current_stage].progression!="undefined"?(l(),c("table",_e,[u("tbody",null,[u("tr",null,[u("td",null,[(l(!0),c(V,null,W(e.workflow_model.stages[e.workflow_data.current_stage].progression.success,a=>(l(),c("div",{class:"workflow_success_progress_button_div",key:a.next_stage},[o(h,{color:"positive",icon:"donut_large",label:"Progress to next stage ("+e.workflow_model.stages[a.next_stage].name+")",onClick:n=>e.progress(a.next_stage)},null,8,["label","onClick"])]))),128))]),typeof e.workflow_model.stages[e.workflow_data.current_stage].progression.failed!="undefined"?(l(),c("td",ue,[o(h,{color:"negative",icon:"directions_off",label:e.workflow_model.stages[e.workflow_model.stages[e.workflow_data.current_stage].progression.failed].name,onClick:t[0]||(t[0]=a=>e.progress(e.workflow_model.stages[e.workflow_data.current_stage].progression.failed))},null,8,["label"])])):k("",!0)])])])):k("",!0),e.workflow_data.current_stage!==e.workflow_model.initial_stage?(l(),c("div",me,[o(h,{icon:"donut_large",label:"Reset workflow",onClick:t[1]||(t[1]=a=>e.progress(e.workflow_model.initial_stage))})])):k("",!0)])]),_:1})):k("",!0)]),_:1})}var Te=q(re,[["render",fe]]);const ge=T({name:"ProjectSerializer",emits:["saveprojectcomplete"],props:{project_type:{type:String,default:"Unknown"},success_message:{type:String,default:"Project Saved"}},setup(){const e=H(),t=Q();return{backend_connection_store:e,dataCachesStore:t}},data(){return{loaded_project_id:void 0,proj_summary_data:{metadata:void 0,timestamp_first_entered:void 0,external_category:void 0},passthroughdata:void 0}},methods:{serializer_load_data(e){this.loaded_project_id=e.id,this.proj_summary_data.timestamp_first_entered=e.timestamp_first_entered,this.proj_summary_data.metadata=e.metadata,this.proj_summary_data.external_category=e.external_category},save_project({dict_of_card_info:e,activity_log:t,workflow:i,patch_id:s,location:_,passthroughdata:f}){typeof _=="undefined"&&(_={}),this.passthroughdata=f;const a={};for(const d in Object.keys(e)){const g=Object.keys(e)[d];a[g]=JSON.parse(JSON.stringify(e[g]))}typeof this.proj_summary_data.external_category=="undefined"&&(this.proj_summary_data.external_category={});const n={user_id:this.backend_connection_store.user_profile.id,patch_id:s,timestamp_first_entered:this.proj_summary_data.timestamp_first_entered,initial_phase:{total_money_in:0,start_value:0,end_value:0,flip_roi:0},reoccurring_phase:[],location:_,workflow:i,activity_log:t,sub_section_details:a,tags:[],risks:[],type:this.project_type,external_category:this.proj_summary_data.external_category};typeof this.loaded_project_id!="undefined"?(n.id=this.loaded_project_id,n.metadata=this.proj_summary_data.metadata):n.timestamp_first_entered=new Date().toISOString();const $=this,C={ok:$.save_api_call_success,error:$.save_api_call_fail};this.dataCachesStore.save({backend_connection_store:this.backend_connection_store,object_type:"projects",object_data:n,callback:C})},save_api_call_success(e){this.$emit("saveprojectcomplete",{success:!0,response:e,passthroughdata:this.passthroughdata}),this.serializer_load_data(e.data),b.create({color:"positive",message:this.success_message,timeout:2e3})},save_api_call_fail(e){this.$emit("saveprojectcomplete",{success:!1,response:e,passthroughdata:this.passthroughdata}),b.create({color:"negative",message:"Save failed - "+e.response.data.message,timeout:2e3})}},mounted(){}});function pe(e,t,i,s,_,f){return l(),c("div")}var qe=q(ge,[["render",pe]]);export{Se as A,qe as P,je as W,Te as a};

import{a2 as b,_ as E,d as A,N as f,o as l,c as p,w as O,e as r,K as _,L as u,t as m,a as d,Q as a}from"./index.de212354.js";import{Q as S}from"./QSelect.1e9cbc45.js";import{Q as P}from"./QPage.baabd1d8.js";import{a as w}from"./axios.6e1fcf85.js";import"./QItemLabel.41fadb9f.js";import"./position-engine.266cd77d.js";function T({attemptsRemaining:o,bestAttemptSoFar:e,callback:t,allowLowAccuracy:n}){var i=8e3,c=!0,s=0;if(typeof n=="undefined"&&(n=!1),n&&(o=1,i=void 0,c=!1,s=void 0),e.coords.accuracy<11&&(o=0),o===0){var L={coords:{latitude:e.coords.latitude,longitude:e.coords.longitude,speed:e.coords.speed,heading:e.coords.heading,altitude:e.coords.altitude,accuracy:e.coords.accuracy,altitudeAccuracy:e.coords.altitudeAccuracy},timestamp:e.timestamp};t.ok(L);return}navigator.geolocation.getCurrentPosition(g=>{g.coords.accuracy<e.coords.accuracy&&(e=g),T({attemptsRemaining:o-1,bestAttemptSoFar:e,callback:t})},g=>{t.error(g)},{maximumAge:s,timeout:i,enableHighAccuracy:c})}function R(o,e,t){let n={method:"get",maxBodyLength:1/0,url:"https://api.postcodes.io/postcodes?longitude="+e+"&latitude="+t,headers:{Accept:"application/json"}};w.request(n).then(i=>{o.ok(i)}).catch(i=>{o.error(i)})}function N(o,e,t,n){n.getLocationCode(e+"+"+t,o)}var h={getLocation:T,getPostcode:R,getRightmoveLocationCode:N};const D=b("rightmoveLocationCode",{state:()=>({code_responses:{}}),getters:{},actions:{getLocationCode(o,e){const t=this;Object.keys(t.code_responses).includes(o)&&e.ok(t.code_responses[o]);let n={method:"get",maxBodyLength:1/0,url:"https://api.metcarob.com/property_backend/v0/public/api/rmproxy/typeahead?query="+o+"&limit=10&exclude=STREET"};w.request(n).then(i=>{t.code_responses[o]=i,e.ok(i)}).catch(i=>{e.error(i)})}}});const y=2,k=3,v=4,C=5,$=A({name:"ToolsLocationPage",components:{},setup(){return{rightmoveLocationCode_store:D()}},data(){return{status:0,error_message:"",cur_location:{},postcodes:[],cur_postcode:"",rmlocationcodes:{}}},computed:{useDevLocation(){return window.location.href.startsWith("http://localhost:")},postcode_data_div(){var o="<table>";const e=this;function t(n,i){typeof e.cur_postcode_data[i]!="undefined"&&(o+='<tr><td class="postcode_data_title_field">'+n+"</td><td>"+e.cur_postcode_data[i]+"</td></tr>")}return t("Postcode","postcode"),t("nhs ha","nhs_ha"),t("European Electoral Region","european_electoral_region"),t("Primary Care Trust","primary_care_trust"),t("Region","region"),t("Parliamentary Constituency","parliamentary_constituency"),t("Parliamentary Constituency (2024)","parliamentary_constituency_2024"),t("Admin District","admin_district"),t("Parish","parish"),t("Admin Ward","admin_ward"),t("ccg","ccg"),t("nuts","nuts"),t("pfa","pfa"),o+="</table>",o},cur_postcode_data(){const o=this;return this.postcodes===null?{postcode:"AAA AAA",outcode:"AAA",incode:"AAA"}:this.postcodes.filter(function(e){return e.postcode===o.cur_postcode})[0]},button_toggle_options(){return this.postcodes===null?[]:this.postcodes.map(function(o){return{label:o.postcode,value:o.postcode}})},status_text(){return this.status===0?"Initial":this.status===1?"Finding Location...":this.status===y?"Failed to find location - "+this.error_message:this.status===k?"Location Found - finding postcode...":this.status===v?"Failed to find postcode - "+this.error_message:this.status===C?"Postcode Found":"Unknown"}},methods:{is_rightmoveid_loaded(o){return Object.prototype.hasOwnProperty.call(this.rmlocationcodes,o.postcode)},get_rightmove_url(o,e){var t="property-for-sale",n="0.25";return e==="RENT"&&(t="property-to-rent"),e==="STUDENTS_RENT"&&(t="student-accommodation"),e==="COMMERCIAL_RENT"&&(t="commercial-property-to-let",n="0.5"),e==="COMMERCIAL_BUY"&&(t="commercial-property-for-sale",n="0.5"),"https://www.rightmove.co.uk/"+t+"/map.html?keywords=&sortType=2&viewType=MAP&channel="+e+"&index=0&radius="+n+"&locationIdentifier=POSTCODE%5E"+this.rmlocationcodes[o.postcode]},get_police_postcode(o){return o.outcode.toUpperCase()+o.incode.toUpperCase()},get_census_postcode(o){return o.outcode.toLowerCase()+"%20"+o.incode.toLowerCase()},get_lharate_postcode(o){return o.outcode.toUpperCase()+"%2b"+o.incode.toUpperCase()},get_streetcheck_postcode(o){return o.outcode.toLowerCase()+o.incode.toLowerCase()},get_ukgovplanningurl(o){return"https://www.planning.data.gov.uk/map/#"+o.latitude+","+o.longitude+",14.800276418264161z"},get_rightmovesold_postcode(o){return o.outcode.toLowerCase()+"-"+o.incode.toLowerCase()},get_epc_postcode(o){return o.postcode.replace(" ","+").toLowerCase()},goto_url(o){window.location.href=o},rescan(){this.status=1,this.cur_location={},this.postcodes=[],this.cur_postcode="";var o={coords:{accuracy:99999}},e={ok:this.rescan_positive,error:this.rescan_negative};this.useDevLocation?e.ok({coords:{latitude:52.5645684,longitude:-.2632206}}):h.getLocation({attemptsRemaining:4,bestAttemptSoFar:o,callback:e,allowLowAccuracy:!1})},rescan_positive(o){this.status=k,this.cur_location=o;var e={ok:this.findpostcode_positive,error:this.findpostcode_negative};h.getPostcode(e,this.cur_location.coords.longitude,this.cur_location.coords.latitude)},rescan_negative(o){this.status=y,this.error_message=o.message,console.log("rescan_negative",o),f.create({color:"bg-grey-2",message:"Failed to access location services",timeout:2e3,color:"negative"})},findpostcode_positive(o){console.log("findpostcode_positive",o);const e=this;if(this.status=C,o.data.result===null){this.status=v,this.error_message="Failed to find postcode - No postcodes found for this location";return}this.postcodes=o.data.result,this.postcodes.length>0&&(this.cur_postcode=this.postcodes[0].postcode);var t=[];Object.keys(this.postcodes).forEach(function(i){const c=e.postcodes[i];e.rmlocationcodes.hasOwnProperty(c.postcode)||t.push(c)});function n(){if(t.length===0)return;const i=t.pop(),c={ok:function(s){e.rmlocationcodes={...e.rmlocationcodes,[i.postcode]:JSON.parse(s.data).matches[0].id},n()},error:function(s){console.log("Error looking up rightmove location code",s)}};h.getRightmoveLocationCode(c,i.outcode,i.incode,e.rightmoveLocationCode_store)}n()},findpostcode_negative(o){this.status=v,this.error_message="Failed to find postcode - "+JSON.stringify(o),console.log("findpostcode_negative",o),f.create({color:"bg-grey-2",message:"Failed to find postcode",timeout:2e3,color:"negative"})}},mounted(){this.rescan()}}),U={class:"cols locationpage-main-div"},I=r("h1",null,"Area Research",-1),B={key:0,class:"locationpage-devnotice"},M=r("td",null,"Status:",-1),F={key:0},V=r("td",null,"Location:",-1),H=r("td",null,null,-1),Q={key:1},j={class:"locationpage-postcodeselector"},G=r("div",null,"Links to external sites providing information about this area",-1),Y={class:"locationpage-extlinkbuttonlist row"},q={class:"locationpage-extlinkbuttonlist-rightmove column wrap justify-center items-center content-center"},J=r("h1",null,"Rightmove",-1),K=["innerHTML"];function W(o,e,t,n,i,c){return l(),p(P,{class:"flex flex-center locationpage-main"},{default:O(()=>[r("div",U,[I,o.useDevLocation?(l(),_("div",B,"DEBUG DEV LOCATION")):u("",!0),r("table",null,[r("tr",null,[M,r("td",null,m(o.status_text),1),r("td",null,[d(a,{round:"",color:"primary",icon:"refresh",onClick:o.rescan},null,8,["onClick"])])]),o.status>2?(l(),_("tr",F,[V,r("td",null,m(o.cur_location.coords.latitude)+", "+m(o.cur_location.coords.longitude),1),H])):u("",!0)]),o.status>4?(l(),_("div",Q,[r("div",j,[d(S,{modelValue:o.cur_postcode,"onUpdate:modelValue":e[0]||(e[0]=s=>o.cur_postcode=s),options:o.button_toggle_options,label:o.button_toggle_options.length.toString()+" postcodes found","emit-value":""},null,8,["modelValue","options","label"])]),G,r("div",Y,[r("div",q,[J,r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(l(),p(a,{key:0,label:"Sale",onClick:e[1]||(e[1]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"BUY"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(l(),p(a,{key:0,label:"Rent",onClick:e[2]||(e[2]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"RENT"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(l(),p(a,{key:0,label:"Student Rent",onClick:e[3]||(e[3]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"STUDENTS_RENT"))),color:"primary"})):u("",!0)]),r("div",null,[d(a,{label:"Sold House Prices",onClick:e[4]||(e[4]=s=>o.goto_url("https://www.rightmove.co.uk/house-prices/"+o.get_rightmovesold_postcode(o.cur_postcode_data)+".html?radius=0.5")),color:"primary"})]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(l(),p(a,{key:0,label:"Commercial Sale",onClick:e[5]||(e[5]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"COMMERCIAL_BUY"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(l(),p(a,{key:0,label:"Commercial Rent",onClick:e[6]||(e[6]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"COMMERCIAL_RENT"))),color:"primary"})):u("",!0)])]),r("div",null,[d(a,{label:"Spareroom",onClick:e[7]||(e[7]=s=>o.goto_url("https://www.spareroom.co.uk/flatshare/?search_id=&location="+o.get_police_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"Openrent",onClick:e[8]||(e[8]=s=>o.goto_url("https://www.openrent.co.uk/properties-to-rent/"+o.get_rightmovesold_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"AirBnb",onClick:e[9]||(e[9]=s=>o.goto_url("https://www.airbnb.co.uk/s/"+o.get_rightmovesold_postcode(o.cur_postcode_data)+"/homes?refinement_paths%5B%5D=%2Fhomes&flexible_trip_lengths%5B%5D=one_week&price_filter_input_type=2&channel=EXPLORE&search_type=search_query")),color:"primary"})]),r("div",null,[d(a,{label:"EPCs",onClick:e[10]||(e[10]=s=>o.goto_url("https://find-energy-certificate.service.gov.uk/find-a-certificate/search-by-postcode?postcode="+o.get_epc_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"UK Gov planning data",onClick:e[11]||(e[11]=s=>o.goto_url(o.get_ukgovplanningurl(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"Streetcheck",onClick:e[12]||(e[12]=s=>o.goto_url("https://www.streetcheck.co.uk/postcode/"+o.get_streetcheck_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"LHA Rates",onClick:e[13]||(e[13]=s=>o.goto_url("https://lha-direct.voa.gov.uk/SearchResults.aspx?Postcode="+o.get_lharate_postcode(o.cur_postcode_data)+"&LHACategory=999&Month=5&Year=2025&SearchPageParameters=true")),color:"primary"})]),r("div",null,[d(a,{label:"Google Search",onClick:e[14]||(e[14]=s=>o.goto_url("https://www.google.com/search?q="+o.get_epc_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"Census",onClick:e[15]||(e[15]=s=>o.goto_url("https://www.nomisweb.co.uk/reports/localarea?search="+o.get_census_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[d(a,{label:"Crime",onClick:e[16]||(e[16]=s=>o.goto_url("https://www.police.uk/pu/your-area/?q="+o.get_police_postcode(o.cur_postcode_data))),color:"primary"})])]),r("div",{innerHTML:o.postcode_data_div},null,8,K)])):u("",!0)])]),_:1})}var to=E($,[["render",W]]);export{to as default};

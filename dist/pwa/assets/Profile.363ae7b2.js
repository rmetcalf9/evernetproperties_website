import{_ as g,d as v,N as n,o as l,c as k,w as d,e as i,K as m,a as t,a8 as p,f as r,ar as h,t as f,M as y,L as I,af as u,a7 as P,ag as b,ae as _,aw as M,an as C,ax as S}from"./index.e93b3b1c.js";import{Q as E}from"./QPage.e3ca7ed4.js";import{C as T}from"./ClosePopup.03d52245.js";import{u as V,a as w}from"./backend_connection.733ae8dd.js";import"./axios.6e1fcf85.js";const N=v({name:"ProfilePage",setup(){return{backend_connection_store:V()}},components:{},data(){return{enterpimsdialog:{visible:!1,number:"",first_name:"",last_name:""}}},computed:{isLoggedin(){return this.backend_connection_store.isLoggedin},user_profile(){return this.backend_connection_store.user_profile},pimsverfiylink(){const e=window.location.origin+"/v/"+this.user_profile.pims.verify_code+"/"+this.user_profile.pims.number;return"Robert - Please verify my PIMS "+this.user_profile.pims.first_name+"/"+this.user_profile.pims.last_name+" ("+this.user_profile.pims.number+') <a href="'+e+'" target="_new">'+e+"</a>"}},methods:{clickcopypimsverfiylink(){const e=this,s={ok:function(c){n.create({color:"bg-grey-2",message:"Copied text to clipboard "+e.pimsverfiylink,timeout:2e3})},error:function(c){n.create({color:"negative",message:"Copy to clipboard failed",timeout:2e3})}};w.copyTextToClipboard2(this.pimsverfiylink,s)},logout(){this.backend_connection_store.logout(),this.$router.push("/tools")},clickenterpimsinformation(){this.enterpimsdialog.number="",this.enterpimsdialog.first_name="",this.enterpimsdialog.last_name="",this.enterpimsdialog.visible=!0},pimsinfo(){const e=this;let s="Enter PIMS details";this.user_profile.pims.state==="WAITINGVERIFICATION"&&(s="Change PIMS details"),this.$q.dialog({title:"PIMS Membership Details",message:"Extra site features are available to users who have a verified PIMS membership.",html:!0,ok:{push:!0,label:s,color:"secondary"},cancel:{push:!0,label:"Close",color:"primary"}}).onOk(()=>{e.clickenterpimsinformation()})},enterpimsdialogclick(){const e=["numberref","first_nameref","last_nameref"];for(const a of e)this.$refs[a].validate();for(const a of e)if(this.$refs[a].hasError)return;const s={number:this.enterpimsdialog.number,first_name:this.enterpimsdialog.first_name,last_name:this.enterpimsdialog.last_name},c={ok:this.submitpimsinfo_success,error:this.submitpimsinfo_fail};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/pimsdetails",method:"POST",data:s,callback:c}),this.enterpimsdialog.visible=!1},submitpimsinfo_success(e){this.backend_connection_store.update_user_profile({user_profile:e.data}),n.create({color:"bg-grey-2",message:"New PIMS details saved - Please request Verification",timeout:2e3})},submitpimsinfo_fail(e){console.log("ERROR failed to update PIMS information ",e),n.create({color:"bg-grey-2",message:"Failed to update PIMS information "+e,timeout:2e3})},deleteaccount(){const e=this;this.$q.dialog({title:"Delete Account",message:"Deleting your account will wipe all your user data from our system. This inclues all saved properties. Are you sure? (Type DELETE below to confirm)",html:!1,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(s=>{if(s.trim()!=="DELETE"){n.create({color:"red",message:"Failed - You must type DELETE in the text box",timeout:2e3});return}const c={ok:function(a){e.logout(),n.create({color:"bg-grey-2",message:"User account deleted",timeout:2e3})},error:function(a){n.create({color:"bg-grey-2",message:"Account deletion failed "+a,timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/delete",method:"GET",data:s,callback:c})})}},mounted(){this.isLoggedin||this.$router.push("/tools")}}),D={rows:""},A=i("h3",{style:{margin:"0px"}},"User Profile",-1),L={key:0,class:"notice"},R=i("h4",null,"Details",-1),$={class:"section"},F={class:"section"},Q={key:0},U=i("div",null,"PIMS Membership details not entered - Extra site features are available to Academy/PIMS members.",-1),O={align:"center"},B={key:1},z=i("div",null,"PIMS details entered but not verified. To verify please send a message in the Samuel Leeds Academy chat with the following text:",-1),q=["innerHTML"],x={key:2},G=i("div",null,[i("h5",null,"PIMS member")],-1),H={key:3},W=i("div",null,"Extra site features are available to Academy/PIMS members. PIMS Membership details verification failed",-1),Y={align:"center"},K={class:"bottom-buttons"},j=i("div",{class:"text-h6"},"Your PIMS membership details",-1),J=i("div",null,[r("Details must match what appears on the "),i("a",{href:"https://www.thepims.co.uk/members/",target:"_new"},"PIMS website"),r(".")],-1);function X(e,s,c,a,Z,ee){return l(),k(E,{class:"flex flex-center"},{default:d(()=>[i("div",D,[A,e.user_profile.pims.state!=="VERIFIED"?(l(),m("div",L,[t(p,{name:"info",size:"md",color:"green"}),r(" Enter and verify your PIMS membership details to activate Property Pipeline Builder early access.")])):h("",!0),R,i("div",$,[i("div",null,"User: "+f(e.user_profile.name),1),i("div",null,"Email: "+f(e.user_profile.email),1),i("div",null,[r("Roles: "),i("ul",null,[(l(!0),m(I,null,y(e.user_profile.roles,o=>(l(),m("div",{key:o},[i("li",null,f(o),1)]))),128))])])]),i("div",F,[i("h4",null,[r("PIMS Membership "),t(u,{round:"",dense:"",flat:"",icon:"info",onClick:e.pimsinfo},null,8,["onClick"])]),e.user_profile.pims.state==="NOTENTERED"?(l(),m("div",Q,[U,i("div",O,[t(u,{label:"Enter PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[r("PIMS Membership verified: "),t(p,{name:"cancel",color:"red",size:"32px"})])])):h("",!0),e.user_profile.pims.state==="WAITINGVERIFICATION"?(l(),m("div",B,[z,i("div",{class:"pimstext",onClick:s[0]||(s[0]=(...o)=>e.clickcopypimsverfiylink&&e.clickcopypimsverfiylink(...o))},[i("div",{innerHTML:e.pimsverfiylink},null,8,q),r("\xA0 "),t(p,{class:"float-right",name:"content_copy",size:"16px"})]),i("div",null,[r("PIMS Membership verified: "),t(p,{name:"cancel",color:"red",size:"32px"})])])):h("",!0),e.user_profile.pims.state==="VERIFIED"?(l(),m("div",x,[G,i("div",null,f(e.user_profile.pims.first_name)+" "+f(e.user_profile.pims.last_name)+" - PIMS number "+f(e.user_profile.pims.number),1),i("div",null,[r("PIMS Membership verified: "),t(p,{name:"check_box",color:"green",size:"32px"})])])):h("",!0),e.user_profile.pims.state==="VERIFICATIONFAILED"?(l(),m("div",H,[W,i("div",Y,[t(u,{label:"Retry entering PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[r("PIMS Membership verified: "),t(p,{name:"cancel",color:"red",size:"32px"})])])):h("",!0)]),i("div",K,[t(u,{class:"bottom-button",onClick:e.logout,color:"secondary",label:"Logout"},null,8,["onClick"]),t(u,{class:"bottom-button",onClick:e.deleteaccount,color:"red",label:"Delete my account"},null,8,["onClick"])])]),t(S,{modelValue:e.enterpimsdialog.visible,"onUpdate:modelValue":s[4]||(s[4]=o=>e.enterpimsdialog.visible=o),persistent:""},{default:d(()=>[t(P,null,{default:d(()=>[t(b,null,{default:d(()=>[j]),_:1}),t(b,{class:"q-pt-none"},{default:d(()=>[J,t(_,{modelValue:e.enterpimsdialog.number,"onUpdate:modelValue":s[1]||(s[1]=o=>e.enterpimsdialog.number=o),label:"PIMS Number",rules:[o=>o.trim().length>4||"Minimum 5 characters",o=>o.trim().match(/^\d+$/)!==null||"Numeric characters only"],ref:"numberref"},null,8,["modelValue","rules"]),t(_,{modelValue:e.enterpimsdialog.first_name,"onUpdate:modelValue":s[2]||(s[2]=o=>e.enterpimsdialog.first_name=o),label:"First Name",rules:[o=>o.trim().length>1||"Minimum 2 characters"],ref:"first_nameref"},null,8,["modelValue","rules"]),t(_,{modelValue:e.enterpimsdialog.last_name,"onUpdate:modelValue":s[3]||(s[3]=o=>e.enterpimsdialog.last_name=o),label:"Last Name",rules:[o=>o.trim().length>1||"Minimum 2 characters"],ref:"last_nameref"},null,8,["modelValue","rules"])]),_:1}),t(M,{align:"right"},{default:d(()=>[C(t(u,{flat:"",label:"Cancel"},null,512),[[T]]),t(u,{flat:"",label:"Submit for Verification",color:"secondary",onClick:e.enterpimsdialogclick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var le=g(N,[["render",X]]);export{le as default};

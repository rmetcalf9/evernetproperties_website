import{d as b,_ as v,N as g,r as C,o as i,K as l,e as s,f as c,a as t,w as p,t as _,L as n,Q as u,aa as D,ae as f,ak as T,af as y,au as N,ah as V,at as w,ad as $}from"./index.e4eb8b92.js";import{Q as j}from"./QSpace.912dc4f1.js";import{Q as O}from"./QSelect.1d8e8ebb.js";import{C as U}from"./ClosePopup.0a4e261e.js";import{u as E}from"./backend_connection.4751007b.js";import{c as h}from"./common_constants.94b43302.js";function I(e,o){const r=Math.abs(e-o);return Math.round(r/864e5)}const Q=b({name:"BrrCalcTodoItem",props:{todo:{type:Object,default:void 0},include_project:{type:Boolean,default:!1}},emits:["update_todo_item","delete_todo_item"],setup(){return{backend_connection_store:E()}},data(){return{dialog_visible:!1,type_options:h.todo_item_types,dialog_data:{description:"",type:"other",group:"",due:"UNCHANGED",loaded_todo:void 0},due_options:[{label:"Unchanged",value:"UNCHANGED"},{label:"1 Day",value:"1"},{label:"3 Days",value:"3"},{label:"5 Days",value:"5"}]}},computed:{get_item_class(){return this.todo.done?"todoitem-tododoneitem todoitem-all":this.todo.due?"todoitem-duetodoitem todoitem-all flex col":"todoitem-todoitem todoitem-all flex col"}},methods:{helpgrouping(){this.$q.dialog({title:"Todo Item Grouping",message:"The grouping field can be left blank. It can be used to group todo items together in displays.",html:!1}).onOk(()=>{})},get_multiline_html(e){return e.replaceAll(`
`,"<br/>")},get_todo_item_type(e){return h.todo_item_types.filter(function(o){return o.value===e})[0].label},due_date_text(e){if(e.due)return"Due by: NOW!";const o=I(new Date,new Date(e.due_date));return o===1?"Due in: "+o+" day":"Due in: "+o+" days"},done_date_text(e){const o=new Date(e),a={weekday:"short",year:"numeric",month:"short",day:"numeric"};return o.toLocaleDateString("en-GB",a)},btn_edit(e){this.dialog_data.description=e.description,this.dialog_data.type=e.type,this.dialog_data.group=e.group,this.dialog_data.due="UNCHANGED",this.dialog_data.loaded_todo=e,this.dialog_visible=!0},click_dialog_ok(){if(this.dialog_data.loaded_todo.description=this.dialog_data.description,this.dialog_data.loaded_todo.type=this.dialog_data.type,this.dialog_data.loaded_todo.group=this.dialog_data.group,this.dialog_data.due!=="UNCHANGED"){const e=parseInt(this.dialog_data.due),o=new Date(new Date().getTime()+e*24*60*60*1e3);this.dialog_data.loaded_todo.due_date=o.toISOString()}this.exec_update_todo_item(this.dialog_data.loaded_todo),this.dialog_visible=!1},btn_mark_done(e){const o=this;this.$q.dialog({title:"Completion Notes",message:"Description: "+e.description+" - Enter notes around completion of this task.",html:!1,ok:{push:!0,label:"Ok",color:"primary"},cancel:{push:!0,label:"Cancel",color:"secondary"},prompt:{model:e.done_text,type:"text"}}).onOk(a=>{e.done_text=a,e.done_date=new Date().toISOString(),e.done=!0,o.exec_update_todo_item(e)})},btn_mark_undone(e){e.done=!1,this.exec_update_todo_item(e)},exec_update_todo_item(e){const o=this,a={ok:function(r){o.$emit("update_todo_item",r.data.todo)},error:function(r){g.create({color:"bg-grey-2",message:r.message,timeout:2e3,color:"negative"})}};o.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e.project_id+"/todos",method:"POST",data:e,callback:a})},btn_delete(e){const o=this;this.$q.dialog({title:"Delete Todo",message:'Are you sure you want to delete "'+e.description+'"?',html:!1,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"}}).onOk(a=>{o.exec_delete(e)})},exec_delete(e){const o=this,a=e.id,r={ok:function(m){o.$emit("delete_todo_item",a)},error:function(m){g.create({color:"bg-grey-2",message:m.message,timeout:2e3,color:"negative"})}};o.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e.project_id+"/todos/"+e.id,method:"DELETE",callback:r})}}}),A={class:"col-grow"},S={key:0},G={key:1},B=["innerHTML"],L={key:2},M={key:3},P={key:4},H={key:0,class:"todoitem-btn"},q={key:1,class:"todoitem-btn"},R={key:2},Y={class:"todoitem-btn"},z=s("div",{class:"text-h6"},"Edit Todo Item",-1),K={class:"todoitem-dialogfield"},W={key:0,class:"todoitem-dialogfield col flex"},F={class:"todoitem-dialogfield"},J={class:"todoitem-dialogfield"};function X(e,o,a,r,m,Z){const k=C("RouterLink");return typeof e.todo!="undefined"?(i(),l("div",{key:0,class:$(e.get_item_class)},[s("div",A,[e.include_project?(i(),l("div",S,[c("Project: "),t(k,{style:{color:"white"},to:"/tools/brrcalc?projectid="+e.todo.project_id},{default:p(()=>[c(_(e.todo.project_name),1)]),_:1},8,["to"])])):n("",!0),s("div",null,"Type: "+_(e.get_todo_item_type(e.todo.type)),1),e.todo.group!==""?(i(),l("div",G,"Group: "+_(e.todo.group),1)):n("",!0),s("div",{innerHTML:e.get_multiline_html(e.todo.description)},null,8,B),e.todo.done?n("",!0):(i(),l("div",L,_(e.due_date_text(e.todo)),1)),e.todo.done?(i(),l("div",M,"Completion Notes: "+_(e.todo.done_text),1)):n("",!0),e.todo.done?(i(),l("div",P,"Date Completed: "+_(e.done_date_text(e.todo.done_date)),1)):n("",!0)]),s("div",null,[e.todo.done?n("",!0):(i(),l("div",H,[t(u,{icon:"edit",round:"",color:"secondary",onClick:o[0]||(o[0]=d=>e.btn_edit(e.todo))})])),e.todo.done?n("",!0):(i(),l("div",q,[t(u,{icon:"check",round:"",color:"secondary",onClick:o[1]||(o[1]=d=>e.btn_mark_done(e.todo))})])),e.todo.done?(i(),l("div",R,[t(u,{label:"Mark Undone",color:"secondary",onClick:o[2]||(o[2]=d=>e.btn_mark_undone(e.todo))})])):n("",!0),s("div",Y,[t(u,{icon:"delete",round:"",color:"negative",onClick:o[3]||(o[3]=d=>e.btn_delete(e.todo))})])]),t(w,{modelValue:e.dialog_visible,"onUpdate:modelValue":o[9]||(o[9]=d=>e.dialog_visible=d)},{default:p(()=>[t(D,{class:"todoitem-dialogcard"},{default:p(()=>[t(f,{class:"row items-center q-pb-none"},{default:p(()=>[z,t(j),T(t(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[U]])]),_:1}),t(f,null,{default:p(()=>[s("div",null,[s("div",K,[t(O,{modelValue:e.dialog_data.type,"onUpdate:modelValue":o[4]||(o[4]=d=>e.dialog_data.type=d),options:e.type_options,label:"Type of Task","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e.dialog_data.type==="other"?(i(),l("div",W,[t(y,{modelValue:e.dialog_data.group,"onUpdate:modelValue":o[5]||(o[5]=d=>e.dialog_data.group=d),label:"Grouping",class:"col-grow"},null,8,["modelValue"]),t(u,{round:"",dense:"",flat:"",icon:"info",onClick:e.helpgrouping},null,8,["onClick"])])):n("",!0),s("div",F,[t(y,{modelValue:e.dialog_data.description,"onUpdate:modelValue":o[6]||(o[6]=d=>e.dialog_data.description=d),label:"Description",autogrow:"",rules:[d=>d.trim().length>3||"Minimum 4 characters"],ref:"field_description"},null,8,["modelValue","rules"])]),s("div",J,[c("Due: "),t(N,{modelValue:e.dialog_data.due,"onUpdate:modelValue":o[7]||(o[7]=d=>e.dialog_data.due=d),options:e.due_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),t(V,{align:"right",class:"text-primary"},{default:p(()=>[t(u,{label:"Cancel",onClick:o[8]||(o[8]=d=>this.dialog_visible=!1)}),t(u,{color:"primary",icon:"rule",label:"Ok",onClick:e.click_dialog_ok},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],2)):n("",!0)}var ie=v(Q,[["render",X]]);export{ie as T};

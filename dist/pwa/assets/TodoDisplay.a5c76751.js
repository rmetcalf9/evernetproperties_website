import{d as v,N as h,_ as g,r as b,o as r,K as s,L as _,e as a,f as k,a as c,aC as w,M as p,O as f,t as y,Q as T}from"./index.69d4ee77.js";import{u as j}from"./backend_connection.a3f6274f.js";import{u as C}from"./data_caches.cd56a1ba.js";import{T as D}from"./TodoItem.b838d5c3.js";import{W as U}from"./Workflow_main.1e4e793e.js";import{u as N}from"./utils.99aafcb0.js";const V=v({name:"TodoDisplayComponent",props:{patch_id:{type:String,default:void 0}},components:{TodoItem:D},setup(){const e=j(),n=C();return{backend_connection_store:e,dataCachesStore:n}},data(){return{workflows:void 0,show_only_active:!0,loaded:!1,loaded_todo_data:void 0,group_by:"group",group_by_options:[{label:"None",value:"none"},{label:"Group",value:"group"},{label:"Project",value:"project"}]}},computed:{display_groups(){const e=this;let n=[],o={"":{name:"",link_url:void 0,filter:void 0}};return this.group_by==="none"?o[""]={name:"",filter:function(t){return!0}}:this.loaded_todo_data.forEach(function(t){e.group_by==="group"&&(o[t.group]={name:t.group,link_url:void 0,filter:function(i){return i.group===t.group}}),e.group_by==="project"&&(o[t.project_name]={name:t.project_name,link_url:"/tools/brrcalc?projectid="+t.project_id,filter:function(i){return i.project_id===t.project_id}})}),Object.keys(o).map(function(t){if(typeof o[t].filter!="undefined"){let i=o[t].name;i===""&&(i="Ungrouped"),n.push({name:i,link_url:o[t].link_url,due_items:e.loaded_todo_data.filter(o[t].filter).filter(function(u){return u.due}),nondue_items:e.loaded_todo_data.filter(o[t].filter).filter(function(u){return!u.due})})}}),n}},methods:{refresh(){const e=this,n={ok:function(o){e.workflows=o,e.refresh_second()},error:function(o){h.create({color:"bg-grey-2",message:"Unable to load workflow information",timeout:2e3,color:"negative"})}};U.workflow3(this.backend_connection_store,this.dataCachesStore,n)},refresh_second(){const e=this;let n="/me/todos?done=false";typeof this.patch_id!="undefined"&&(n="/me/todos?done=false&patch_id="+this.patch_id);const o={ok:e.refresh_success,error:function(t){h.create({color:"negative",message:"Failed to load todos",timeout:2e3}),e.$router.push("/tools")}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:n,method:"GET",data:void 0,callback:o})},refresh_success(e){const n=this;this.loaded_todo_data=e.data.todos.filter(function(o){return n.show_only_active?N.boolean_undefined_to_false(n.workflows[o.project_workflow.workflow_used_id].stages[o.project_workflow.current_stage].active):!0}),this.loaded=!0}},mounted(){this.loaded=!1,this.refresh()}}),$={class:"tododisplayclass"},S={key:0},B=a("h1",null,"Loading...",-1),G=[B],I={key:1},E={class:"flex"},L={key:0},O={key:1},P={class:"row"};function Q(e,n,o,t,i,u){const m=b("TodoItem");return r(),s("div",$,[e.loaded?_("",!0):(r(),s("div",S,G)),e.loaded?(r(),s("div",I,[a("div",null,[a("div",null,[a("div",E,[k("Group: "),c(w,{modelValue:e.group_by,"onUpdate:modelValue":n[0]||(n[0]=d=>e.group_by=d),options:e.group_by_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),(r(!0),s(p,null,f(e.display_groups,d=>(r(),s("div",{key:d.name},[typeof d.link_url=="undefined"?(r(),s("div",L,[a("h2",null,y(d.name),1)])):_("",!0),typeof d.link_url!="undefined"?(r(),s("div",O,[a("h2",null,[k(y(d.name)+" ",1),c(T,{color:"primary",icon:"arrow_forward",onClick:l=>e.$router.push(d.link_url)},null,8,["onClick"])])])):_("",!0),a("div",P,[(r(!0),s(p,null,f(d.due_items,l=>(r(),s("div",{key:l.id},[c(m,{todo:l,include_project:e.group_by!="project",onUpdate_todo_item:e.refresh,onDelete_todo_item:e.refresh},null,8,["todo","include_project","onUpdate_todo_item","onDelete_todo_item"])]))),128)),(r(!0),s(p,null,f(d.nondue_items,l=>(r(),s("div",{key:l.id},[c(m,{todo:l,include_project:e.group_by!="project",onUpdate_todo_item:e.refresh,onDelete_todo_item:e.refresh},null,8,["todo","include_project","onUpdate_todo_item","onDelete_todo_item"])]))),128))])]))),128))])])):_("",!0)])}var z=g(V,[["render",Q]]);export{z as T};

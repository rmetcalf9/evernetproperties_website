import{i as ft,h as ke,ar as We,j as N,k as q,n as Ge,B as ht,an as ge,as as mt,q as b,$ as Ve,a3 as pt,at as gt,a7 as de,A as vt,u as He,au as bt,al as wt,g as ve,S as Ce,T as Le,m as pe,v as yt,a8 as $t,a9 as St,x as kt,d as O,_ as U,o as g,K as F,a as i,ae as ee,w as d,af as te,ag as B,e as n,ad as ne,av as Ct,aw as Tt,r as k,c as A,f as $,ax as qt,t as f,aq as L,N as J,L as Ke,M as Je,ay as Te,az as Pt,ao as Ee}from"./index.543dd2f3.js";import{Q as Rt}from"./QResizeObserver.07488fd8.js";import{r as At,Q as Bt,a as Q,b as se,c as It,d as Mt}from"./QTable.6d56966b.js";import{Q as zt}from"./QPage.28eeac77.js";import{C as jt}from"./ClosePopup.a9bf9d6b.js";import{Q as Dt,I as Ye,F as Vt,G as Lt,P as Et,R as Ft,S as Ot,O as Ut,a as Nt}from"./FeatureTable.beb383ca.js";import{u as ce}from"./utils.7b533ce3.js";import{Q as ue}from"./QTr.8aa5d573.js";import{Q as Qt}from"./QExpansionItem.43d94961.js";import{u as Wt}from"./utils.5f33790e.js";import{u as be}from"./backend_connection.f8ef3263.js";import"./QItemLabel.687225ad.js";import"./position-engine.306e4a0d.js";import"./axios.6e1fcf85.js";let Gt=0;const Ht=["click","keydown"],Kt={icon:String,label:[Number,String],alert:[Boolean,String],alertIcon:String,name:{type:[Number,String],default:()=>`t_${Gt++}`},noCaps:Boolean,tabindex:[String,Number],disable:Boolean,contentClass:String,ripple:{type:[Boolean,Object],default:!0}};function Jt(e,r,s,t){const a=ft(We,ke);if(a===ke)return console.error("QTab/QRouteTab component needs to be child of QTabs"),ke;const{proxy:c}=He(),l=N(null),u=N(null),v=N(null),z=q(()=>e.disable===!0||e.ripple===!1?!1:Object.assign({keyCodes:[13,32],early:!0},e.ripple===!0?{}:e.ripple)),y=q(()=>a.currentModel.value===e.name),I=q(()=>"q-tab relative-position self-stretch flex flex-center text-center"+(y.value===!0?" q-tab--active"+(a.tabProps.value.activeClass?" "+a.tabProps.value.activeClass:"")+(a.tabProps.value.activeColor?` text-${a.tabProps.value.activeColor}`:"")+(a.tabProps.value.activeBgColor?` bg-${a.tabProps.value.activeBgColor}`:""):" q-tab--inactive")+(e.icon&&e.label&&a.tabProps.value.inlineLabel===!1?" q-tab--full":"")+(e.noCaps===!0||a.tabProps.value.noCaps===!0?" q-tab--no-caps":"")+(e.disable===!0?" disabled":" q-focusable q-hoverable cursor-pointer")+(t!==void 0?t.linkClass.value:"")),P=q(()=>"q-tab__content self-stretch flex-center relative-position q-anchor--skip non-selectable "+(a.tabProps.value.inlineLabel===!0?"row no-wrap q-tab__content--inline":"column")+(e.contentClass!==void 0?` ${e.contentClass}`:"")),S=q(()=>e.disable===!0||a.hasFocus.value===!0||y.value===!1&&a.hasActiveTab.value===!0?-1:e.tabindex||0);function E(m,j){if(j!==!0&&l.value!==null&&l.value.focus(),e.disable===!0){t!==void 0&&t.hasRouterLink.value===!0&&Ve(m);return}if(t===void 0){a.updateModel({name:e.name}),s("click",m);return}if(t.hasRouterLink.value===!0){const M=(D={})=>{let W;const H=D.to===void 0||bt(D.to,e.to)===!0?a.avoidRouteWatcher=wt():null;return t.navigateToRouterLink(m,{...D,returnRouterError:!0}).catch(re=>{W=re}).then(re=>{if(H===a.avoidRouteWatcher&&(a.avoidRouteWatcher=!1,W===void 0&&(re===void 0||re.message.startsWith("Avoided redundant navigation")===!0)&&a.updateModel({name:e.name})),D.returnRouterError===!0)return W!==void 0?Promise.reject(W):re})};s("click",m,M),m.defaultPrevented!==!0&&M();return}s("click",m)}function G(m){pt(m,[13,32])?E(m,!0):gt(m)!==!0&&m.keyCode>=35&&m.keyCode<=40&&m.altKey!==!0&&m.metaKey!==!0&&a.onKbdNavigate(m.keyCode,c.$el)===!0&&Ve(m),s("keydown",m)}function ae(){const m=a.tabProps.value.narrowIndicator,j=[],M=b("div",{ref:v,class:["q-tab__indicator",a.tabProps.value.indicatorClass]});e.icon!==void 0&&j.push(b(de,{class:"q-tab__icon",name:e.icon})),e.label!==void 0&&j.push(b("div",{class:"q-tab__label"},e.label)),e.alert!==!1&&j.push(e.alertIcon!==void 0?b(de,{class:"q-tab__alert-icon",color:e.alert!==!0?e.alert:void 0,name:e.alertIcon}):b("div",{class:"q-tab__alert"+(e.alert!==!0?` text-${e.alert}`:"")})),m===!0&&j.push(M);const D=[b("div",{class:"q-focus-helper",tabindex:-1,ref:l}),b("div",{class:P.value},vt(r.default,j))];return m===!1&&D.push(M),D}const Y={name:q(()=>e.name),rootRef:u,tabIndicatorRef:v,routeData:t};Ge(()=>{a.unregisterTab(Y)}),ht(()=>{a.registerTab(Y)});function ie(m,j){const M={ref:u,class:I.value,tabindex:S.value,role:"tab","aria-selected":y.value===!0?"true":"false","aria-disabled":e.disable===!0?"true":void 0,onClick:E,onKeydown:G,...j};return ge(b(m,M,ae()),[[mt,z.value]])}return{renderTab:ie,$tabs:a}}var Fe=ve({name:"QTab",props:Kt,emits:Ht,setup(e,{slots:r,emit:s}){const{renderTab:t}=Jt(e,r,s);return()=>t("div")}});function Yt(e,r,s){const t=s===!0?["left","right"]:["top","bottom"];return`absolute-${r===!0?t[0]:t[1]}${e?` text-${e}`:""}`}const Xt=["left","center","right","justify"];var Zt=ve({name:"QTabs",props:{modelValue:[Number,String],align:{type:String,default:"center",validator:e=>Xt.includes(e)},breakpoint:{type:[String,Number],default:600},vertical:Boolean,shrink:Boolean,stretch:Boolean,activeClass:String,activeColor:String,activeBgColor:String,indicatorColor:String,leftIcon:String,rightIcon:String,outsideArrows:Boolean,mobileArrows:Boolean,switchIndicator:Boolean,narrowIndicator:Boolean,inlineLabel:Boolean,noCaps:Boolean,dense:Boolean,contentClass:String,"onUpdate:modelValue":[Function,Array]},setup(e,{slots:r,emit:s}){const{proxy:t}=He(),{$q:a}=t,{registerTick:c}=Ce(),{registerTick:l}=Ce(),{registerTick:u}=Ce(),{registerTimeout:v,removeTimeout:z}=Le(),{registerTimeout:y,removeTimeout:I}=Le(),P=N(null),S=N(null),E=N(e.modelValue),G=N(!1),ae=N(!0),Y=N(!1),ie=N(!1),m=[],j=N(0),M=N(!1);let D=null,W=null,H;const re=q(()=>({activeClass:e.activeClass,activeColor:e.activeColor,activeBgColor:e.activeBgColor,indicatorClass:Yt(e.indicatorColor,e.switchIndicator,e.vertical),narrowIndicator:e.narrowIndicator,inlineLabel:e.inlineLabel,noCaps:e.noCaps})),Ze=q(()=>{const o=j.value,_=E.value;for(let h=0;h<o;h++)if(m[h].name.value===_)return!0;return!1}),xe=q(()=>`q-tabs__content--align-${G.value===!0?"left":ie.value===!0?"justify":e.align}`),et=q(()=>`q-tabs row no-wrap items-center q-tabs--${G.value===!0?"":"not-"}scrollable q-tabs--${e.vertical===!0?"vertical":"horizontal"} q-tabs__arrows--${e.outsideArrows===!0?"outside":"inside"} q-tabs--mobile-with${e.mobileArrows===!0?"":"out"}-arrows`+(e.dense===!0?" q-tabs--dense":"")+(e.shrink===!0?" col-shrink":"")+(e.stretch===!0?" self-stretch":"")),tt=q(()=>"q-tabs__content scroll--mobile row no-wrap items-center self-stretch hide-scrollbar relative-position "+xe.value+(e.contentClass!==void 0?` ${e.contentClass}`:"")),_e=q(()=>e.vertical===!0?{container:"height",content:"offsetHeight",scroll:"scrollHeight"}:{container:"width",content:"offsetWidth",scroll:"scrollWidth"}),fe=q(()=>e.vertical!==!0&&a.lang.rtl===!0),we=q(()=>At===!1&&fe.value===!0);pe(fe,oe),pe(()=>e.modelValue,o=>{ye({name:o,setCurrent:!0,skipEmit:!0})}),pe(()=>e.outsideArrows,he);function ye({name:o,setCurrent:_,skipEmit:h}){E.value!==o&&(h!==!0&&e["onUpdate:modelValue"]!==void 0&&s("update:modelValue",o),(_===!0||e["onUpdate:modelValue"]===void 0)&&(at(E.value,o),E.value=o))}function he(){c(()=>{Pe({width:P.value.offsetWidth,height:P.value.offsetHeight})})}function Pe(o){if(_e.value===void 0||S.value===null)return;const _=o[_e.value.container],h=Math.min(S.value[_e.value.scroll],Array.prototype.reduce.call(S.value.children,(T,w)=>T+(w[_e.value.content]||0),0)),C=_>0&&h>_;G.value=C,C===!0&&l(oe),ie.value=_<parseInt(e.breakpoint,10)}function at(o,_){const h=o!=null&&o!==""?m.find(T=>T.name.value===o):null,C=_!=null&&_!==""?m.find(T=>T.name.value===_):null;if(h&&C){const T=h.tabIndicatorRef.value,w=C.tabIndicatorRef.value;D!==null&&(clearTimeout(D),D=null),T.style.transition="none",T.style.transform="none",w.style.transition="none",w.style.transform="none";const p=T.getBoundingClientRect(),V=w.getBoundingClientRect();w.style.transform=e.vertical===!0?`translate3d(0,${p.top-V.top}px,0) scale3d(1,${V.height?p.height/V.height:1},1)`:`translate3d(${p.left-V.left}px,0,0) scale3d(${V.width?p.width/V.width:1},1,1)`,u(()=>{D=setTimeout(()=>{D=null,w.style.transition="transform .25s cubic-bezier(.4, 0, .2, 1)",w.style.transform="none"},70)})}C&&G.value===!0&&le(C.rootRef.value)}function le(o){const{left:_,width:h,top:C,height:T}=S.value.getBoundingClientRect(),w=o.getBoundingClientRect();let p=e.vertical===!0?w.top-C:w.left-_;if(p<0){S.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.floor(p),oe();return}p+=e.vertical===!0?w.height-T:w.width-h,p>0&&(S.value[e.vertical===!0?"scrollTop":"scrollLeft"]+=Math.ceil(p),oe())}function oe(){const o=S.value;if(o===null)return;const _=o.getBoundingClientRect(),h=e.vertical===!0?o.scrollTop:Math.abs(o.scrollLeft);fe.value===!0?(ae.value=Math.ceil(h+_.width)<o.scrollWidth-1,Y.value=h>0):(ae.value=h>0,Y.value=e.vertical===!0?Math.ceil(h+_.height)<o.scrollHeight:Math.ceil(h+_.width)<o.scrollWidth)}function Re(o){W!==null&&clearInterval(W),W=setInterval(()=>{nt(o)===!0&&X()},5)}function Ae(){Re(we.value===!0?Number.MAX_SAFE_INTEGER:0)}function Be(){Re(we.value===!0?0:Number.MAX_SAFE_INTEGER)}function X(){W!==null&&(clearInterval(W),W=null)}function rt(o,_){const h=Array.prototype.filter.call(S.value.children,V=>V===_||V.matches&&V.matches(".q-tab.q-focusable")===!0),C=h.length;if(C===0)return;if(o===36)return le(h[0]),h[0].focus(),!0;if(o===35)return le(h[C-1]),h[C-1].focus(),!0;const T=o===(e.vertical===!0?38:37),w=o===(e.vertical===!0?40:39),p=T===!0?-1:w===!0?1:void 0;if(p!==void 0){const V=fe.value===!0?-1:1,K=h.indexOf(_)+p*V;return K>=0&&K<C&&(le(h[K]),h[K].focus({preventScroll:!0})),!0}}const st=q(()=>we.value===!0?{get:o=>Math.abs(o.scrollLeft),set:(o,_)=>{o.scrollLeft=-_}}:e.vertical===!0?{get:o=>o.scrollTop,set:(o,_)=>{o.scrollTop=_}}:{get:o=>o.scrollLeft,set:(o,_)=>{o.scrollLeft=_}});function nt(o){const _=S.value,{get:h,set:C}=st.value;let T=!1,w=h(_);const p=o<w?-1:1;return w+=p*5,w<0?(T=!0,w=0):(p===-1&&w<=o||p===1&&w>=o)&&(T=!0,w=o),C(_,w),oe(),T}function Ie(o,_){for(const h in o)if(o[h]!==_[h])return!1;return!0}function it(){let o=null,_={matchedLen:0,queryDiff:9999,hrefLen:0};const h=m.filter(p=>p.routeData!==void 0&&p.routeData.hasRouterLink.value===!0),{hash:C,query:T}=t.$route,w=Object.keys(T).length;for(const p of h){const V=p.routeData.exact.value===!0;if(p.routeData[V===!0?"linkIsExactActive":"linkIsActive"].value!==!0)continue;const{hash:K,query:$e,matched:dt,href:_t}=p.routeData.resolvedLink.value,Se=Object.keys($e).length;if(V===!0){if(K!==C||Se!==w||Ie(T,$e)===!1)continue;o=p.name.value;break}if(K!==""&&K!==C||Se!==0&&Ie($e,T)===!1)continue;const Z={matchedLen:dt.length,queryDiff:w-Se,hrefLen:_t.length-K.length};if(Z.matchedLen>_.matchedLen){o=p.name.value,_=Z;continue}else if(Z.matchedLen!==_.matchedLen)continue;if(Z.queryDiff<_.queryDiff)o=p.name.value,_=Z;else if(Z.queryDiff!==_.queryDiff)continue;Z.hrefLen>_.hrefLen&&(o=p.name.value,_=Z)}o===null&&m.some(p=>p.routeData===void 0&&p.name.value===E.value)===!0||ye({name:o,setCurrent:!0})}function lt(o){if(z(),M.value!==!0&&P.value!==null&&o.target&&typeof o.target.closest=="function"){const _=o.target.closest(".q-tab");_&&P.value.contains(_)===!0&&(M.value=!0,G.value===!0&&le(_))}}function ot(){v(()=>{M.value=!1},30)}function me(){ze.avoidRouteWatcher===!1?y(it):I()}function Me(){if(H===void 0){const o=pe(()=>t.$route.fullPath,me);H=()=>{o(),H=void 0}}}function ct(o){m.push(o),j.value++,he(),o.routeData===void 0||t.$route===void 0?y(()=>{if(G.value===!0){const _=E.value,h=_!=null&&_!==""?m.find(C=>C.name.value===_):null;h&&le(h.rootRef.value)}}):(Me(),o.routeData.hasRouterLink.value===!0&&me())}function ut(o){m.splice(m.indexOf(o),1),j.value--,he(),H!==void 0&&o.routeData!==void 0&&(m.every(_=>_.routeData===void 0)===!0&&H(),me())}const ze={currentModel:E,tabProps:re,hasFocus:M,hasActiveTab:Ze,registerTab:ct,unregisterTab:ut,verifyRouteModel:me,updateModel:ye,onKbdNavigate:rt,avoidRouteWatcher:!1};yt(We,ze);function je(){D!==null&&clearTimeout(D),X(),H!==void 0&&H()}let De;return Ge(je),$t(()=>{De=H!==void 0,je()}),St(()=>{De===!0&&Me(),he()}),()=>b("div",{ref:P,class:et.value,role:"tablist",onFocusin:lt,onFocusout:ot},[b(Rt,{onResize:Pe}),b("div",{ref:S,class:tt.value,onScroll:oe},kt(r.default)),b(de,{class:"q-tabs__arrow q-tabs__arrow--left absolute q-tab__icon"+(ae.value===!0?"":" q-tabs__arrow--faded"),name:e.leftIcon||a.iconSet.tabs[e.vertical===!0?"up":"left"],onMousedownPassive:Ae,onTouchstartPassive:Ae,onMouseupPassive:X,onMouseleavePassive:X,onTouchendPassive:X}),b(de,{class:"q-tabs__arrow q-tabs__arrow--right absolute q-tab__icon"+(Y.value===!0?"":" q-tabs__arrow--faded"),name:e.rightIcon||a.iconSet.tabs[e.vertical===!0?"down":"right"],onMousedownPassive:Be,onTouchstartPassive:Be,onMouseupPassive:X,onMouseleavePassive:X,onTouchendPassive:X})])}});const xt=b("div",{class:"q-space"});var ea=ve({name:"QSpace",setup(){return()=>xt}});const ta=O({name:"BrrCalcToolbarCallSellingAgent",emits:["activity_log"],data(){return{dialog_visible:N(!1),spoke_to:"",notes:""}},computed:{isDisabled(){return this.spoke_to.length<1||this.notes<3}},methods:{open_dialog(){this.dialog_visible=!0,this.spoke_to="",this.notes=""},click_selling_agent_btn(){const e={type:"call_agent",text:"Called selling agent spoke to ("+this.spoke_to+") - "+this.notes,head_notes:void 0};console.log("out",e),this.$emit("activity_log",e),this.dialog_visible=!1}}}),aa={class:"brrcalctoolbar"},ra=n("div",{class:"text-h6"},"Log call with selling agent",-1);function sa(e,r,s,t,a,c){return g(),F("div",aa,[i(ee,{color:"primary",icon:"call",label:"Selling agent",onClick:e.open_dialog},null,8,["onClick"]),i(Tt,{modelValue:e.dialog_visible,"onUpdate:modelValue":r[3]||(r[3]=l=>e.dialog_visible=l)},{default:d(()=>[i(te,null,{default:d(()=>[i(B,{class:"row items-center q-pb-none"},{default:d(()=>[ra,i(ea),ge(i(ee,{icon:"close",flat:"",round:"",dense:""},null,512),[[jt]])]),_:1}),i(B,null,{default:d(()=>[n("div",null,[i(ne,{filled:"",clearable:"",modelValue:e.spoke_to,"onUpdate:modelValue":r[0]||(r[0]=l=>e.spoke_to=l),label:"Spoke to",rules:[l=>l.length>2||"Too short"]},null,8,["modelValue","rules"])]),n("div",null,[i(ne,{filled:"",autogrow:"",modelValue:e.notes,"onUpdate:modelValue":r[1]||(r[1]=l=>e.notes=l),label:"Notes",rules:[l=>l.length>2||"Too short"]},null,8,["modelValue","rules"])]),i(Ct,{align:"right",class:"text-primary"},{default:d(()=>[i(ee,{icon:"call",label:"Cancel",onClick:r[2]||(r[2]=l=>this.dialog_visible=!1)}),i(ee,{color:"primary",icon:"call",label:"Save",onClick:e.click_selling_agent_btn,disable:e.isDisabled},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var na=U(ta,[["render",sa]]);const ia=O({name:"BrrCalcToolbar",emits:["activity_log"],components:{CallSellingAgent:na},data(){return{}},methods:{}}),la={class:"brrcalctoolbar"};function oa(e,r,s,t,a,c){const l=k("CallSellingAgent");return g(),F("div",la,[i(l,{onActivity_log:r[0]||(r[0]=u=>e.$emit("activity_log",u))})])}var ca=U(ia,[["render",oa]]);const ua=O({name:"BrrCalcVision",emits:["projectchanged"],data(){return{devplan:"",emit_project_change_notification:!0}},computed:{serializer_card_data(){return{devplan:this.devplan}}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged")}},methods:{helpdevplan(){this.$q.dialog({title:"What is the development plan?",message:"Enter the development plan. E.g. Split into two flats"}).onOk(()=>{})},serializer_load_data(e){this.emit_project_change_notification=!1,this.devplan=e.devplan;const r=this;setTimeout(function(){r.emit_project_change_notification=!0},50)}}}),da=n("div",{class:"text-h6"},"Vision",-1),_a={class:"row"};function fa(e,r,s,t,a,c){return g(),A(te,{inline:"",class:"q-ma-sm card-style"},{default:d(()=>[i(B,null,{default:d(()=>[da,n("div",_a,[i(ne,{modelValue:e.devplan,"onUpdate:modelValue":r[0]||(r[0]=l=>e.devplan=l),label:"What is the development plan?",class:"col-grow"},null,8,["modelValue"]),i(ee,{round:"",color:"primary",icon:"info",onClick:e.helpdevplan},null,8,["onClick"])])]),_:1})]),_:1})}var ha=U(ua,[["render",fa]]);const ma=O({name:"BrrCalcFinance",emits:["projectchanged"],props:["gdv_total"],data(){return{refinance:{userefinance:!0,ltv:{min:75,max:75}},emit_project_change_notification:!0}},methods:{format_currency(e){return ce.format_currency(e)},serializer_load_data(e){this.emit_project_change_notification=!1,this.refinance.userefinance=e.refinance_userefinance,this.refinance.ltv=e.refinance_userefinance_ltv;const r=this;setTimeout(function(){r.emit_project_change_notification=!0},50)}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged")}},computed:{serializer_card_data(){return{refinance_userefinance:this.refinance.userefinance,refinance_userefinance_ltv:this.refinance.ltv}},get_refinance(){return this.refinance},refinanceamount(){return{worst:this.gdv_total.min*(this.refinance.ltv.min/100),best:this.gdv_total.max*(this.refinance.ltv.max/100)}},refinance_out_items(){let e=[];return this.refinance.userefinance&&e.push({name:"Mortgage Refinance",worst:this.refinanceamount.worst,best:this.refinanceamount.best}),e}}}),pa=n("div",{class:"text-h6"},"Refinance",-1),ga={key:0};function va(e,r,s,t,a,c){return g(),A(te,{inline:"",class:"q-ma-sm card-style"},{default:d(()=>[i(B,null,{default:d(()=>[pa,$(" This section is for adding refinance details. After the refurbishment is complete the refinance stage can be used to pull money out of the deal. "),i(qt,{modelValue:e.refinance.userefinance,"onUpdate:modelValue":r[0]||(r[0]=l=>e.refinance.userefinance=l),label:"Refinance after refurbishment"},null,8,["modelValue"]),e.refinance.userefinance?(g(),F("div",ga,[$(" Refinance LTV "+f(e.refinance.ltv.min)+"% - "+f(e.refinance.ltv.max)+"% ",1),i(Dt,{modelValue:e.refinance.ltv,"onUpdate:modelValue":r[1]||(r[1]=l=>e.refinance.ltv=l),min:0,max:100,step:5,"thumb-size":"40px","drag-range":"",label:"","left-label-value":e.refinance.ltv.min+"%","right-label-value":e.refinance.ltv.max+"%"},null,8,["modelValue","left-label-value","right-label-value"]),n("div",null,"Refinance amount: "+f(e.format_currency(e.refinanceamount.worst))+" - "+f(e.format_currency(e.refinanceamount.best)),1)])):L("",!0)]),_:1})]),_:1})}var ba=U(ma,[["render",va]]);function Xe(e){return e.filter(function(r){return r.type==="ledger"})}function qe(e,r){e.push({type:"blank",key:e.length}),e.push({type:"title",key:e.length,name:r})}function x(e,r,s,t){let a=Xe(e);var c=void 0,l=void 0;a.length>0&&(c=a[a.length-1].worst,l=a[a.length-1].best);function u(v,z){var y=0;typeof v!="undefined"&&(y=v.bal);var I="",P="";return z>0?I=z:P=z,{in:I,out:P,bal:y+z}}e.push({type:"ledger",key:e.length,name:r,worst:u(c,s),best:u(l,t)})}const wa=O({name:"BrrCalcDealSummary",props:["is_valid_input","purchaserange","finance_in_items","purchase_items","stampduty_items","othercosts_items","refurb_cost_items","gdv_total","refurbmonths","finance_out_items","refinance_out_items","finance_during_items"],components:{InvalidMessage:Ye},data(){return{table:{columns:[{name:"item",label:"Item",field:"item"},{name:"win",label:"In",field:"win"},{name:"wout",label:"Out",field:"wout"},{name:"wbal",label:"Balance",field:"wbal"},{name:"bin",label:"In",field:"bin"},{name:"bout",label:"Out",field:"bout"},{name:"bbal",label:"Balance",field:"bbal"}]}}},methods:{format_currency(e){return typeof e=="string"&&e===""?"":ce.format_currency(e)}},computed:{final_bal(){let e=Xe(this.items);return e.length===0?{worst:0,best:0}:{worst:e[e.length-1].worst.bal,best:e[e.length-1].best.bal}},money_in(){var e=this.finance_in_items.reduce((s,t)=>s+t.worst,0),r=this.finance_in_items.reduce((s,t)=>s+t.best,0);return{worst:e,best:r}},items(){var e=[];typeof this.finance_in_items!="undefined"&&this.finance_in_items.map(function(s){x(e,s.name,s.worst,s.best)}),typeof this.purchase_items!="undefined"&&this.purchase_items.map(function(s){x(e,s.name,s.worst,s.best)}),typeof this.stampduty_items!="undefined"&&this.stampduty_items.map(function(s){x(e,s.name,s.worst,s.best)}),typeof this.othercosts_items!="undefined"&&this.othercosts_items.map(function(s){x(e,s.name,s.worst,s.best)}),qe(e,"During Project"),typeof this.finance_during_items!="undefined"&&this.finance_during_items.map(function(s){x(e,s.name,s.worst,s.best)}),typeof this.refurb_cost_items!="undefined"&&this.refurb_cost_items.map(function(s){x(e,s.name,s.worst,s.best)});let r=!1;return typeof this.refinance_out_items!="undefined"&&(this.refinance_out_items.length>0&&(r=!0,qe(e,"Exit finance")),this.refinance_out_items.map(function(s){x(e,s.name,s.worst,s.best)})),typeof this.finance_out_items!="undefined"&&(this.finance_out_items.length>0&&(r||qe(e,"Exit finance")),this.finance_out_items.map(function(s){x(e,s.name,s.worst,s.best)})),e}}}),ya=n("div",{class:"text-h6"},"Cashflow Summary",-1),$a=n("div",{class:"text-subtitle2"},"This section gives a break down of money in and out of the deal. It is broken down twice, for best and worst case figures.",-1),Sa=n("div",null," \xA0 ",-1);function ka(e,r,s,t,a,c){const l=k("InvalidMessage");return g(),A(te,{inline:"",class:"q-ma-sm card-style maincard col-grow"},{default:d(()=>[i(B,null,{default:d(()=>[ya,$a]),_:1}),i(B,null,{default:d(()=>[i(l,{is_valid_input:e.is_valid_input},null,8,["is_valid_input"]),n("div",null,[i(Bt,{columns:e.table.columns,rows:e.items,"hide-bottom":"","rows-per-page-options":[100]},{header:d(u=>[i(ue,null,{default:d(()=>[i(Q),i(Q,{colspan:"3",class:"worstcasetablecell"},{default:d(()=>[$("Worst Case")]),_:1}),i(Q,{colspan:"3"},{default:d(()=>[$("Best Case")]),_:1})]),_:1}),i(ue,{props:u},{default:d(()=>[i(Q,null,{default:d(()=>[$(" Item ")]),_:1}),i(Q,{class:"worstcasetablecell"},{default:d(()=>[$(" In ")]),_:1}),i(Q,{class:"worstcasetablecell"},{default:d(()=>[$(" Out ")]),_:1}),i(Q,{class:"worstcasetablecell"},{default:d(()=>[$(" Balance ")]),_:1}),i(Q,null,{default:d(()=>[$(" In ")]),_:1}),i(Q,null,{default:d(()=>[$(" Out ")]),_:1}),i(Q,null,{default:d(()=>[$(" Balance ")]),_:1})]),_:2},1032,["props"])]),body:d(u=>[u.row.type==="ledger"?(g(),A(ue,{key:0},{default:d(()=>[i(se,{class:"tablerowcell"},{default:d(()=>[$(f(u.row.name),1)]),_:2},1024),i(se,{class:"worstcasetablecell valuetablecell tablerowcell"},{default:d(()=>[$(f(e.format_currency(u.row.worst.in)),1)]),_:2},1024),i(se,{class:"worstcasetablecell valuetablecell tablerowcell"},{default:d(()=>[$(f(e.format_currency(u.row.worst.out)),1)]),_:2},1024),i(se,{class:"worstcasetablecell valuetablecell tablerowcell"},{default:d(()=>[$(f(e.format_currency(u.row.worst.bal)),1)]),_:2},1024),i(se,{class:"valuetablecell tablerowcell"},{default:d(()=>[$(f(e.format_currency(u.row.best.in)),1)]),_:2},1024),i(se,{class:"valuetablecell tablerowcell"},{default:d(()=>[$(f(e.format_currency(u.row.best.out)),1)]),_:2},1024),i(se,{class:"valuetablecell tablerowcell"},{default:d(()=>[$(f(e.format_currency(u.row.best.bal)),1)]),_:2},1024)]),_:2},1024)):L("",!0),u.row.type==="blank"?(g(),A(ue,{key:1},{default:d(()=>[i(Q,{colspan:"7"},{default:d(()=>[$("\xA0")]),_:1})]),_:1})):L("",!0),u.row.type==="title"?(g(),A(ue,{key:2},{default:d(()=>[i(Q,{colspan:"7"},{default:d(()=>[$(f(u.row.name),1)]),_:2},1024)]),_:2},1024)):L("",!0)]),_:1},8,["columns","rows"])]),Sa]),_:1})]),_:1})}var Ca=U(wa,[["render",ka]]);const Ta=O({name:"BrrCalcDealRatingAlternativeSummary",props:["purchaserange","finance_refinance","stampduty_total","othercosts_total","refurb_cost_total","gdv_total"],methods:{format_currency(e){return ce.format_currency(e)}},computed:{mortgage_rate_display(){return this.finance_refinance.userefinance?{best:this.finance_refinance.ltv.max+"%",worst:this.finance_refinance.ltv.min+"%"}:{best:"N/A",worst:"N/A"}},mortgage(){return this.finance_refinance.userefinance?{best:this.finance_refinance.ltv.max/100*this.purchaserange.min,worst:this.finance_refinance.ltv.min/100*this.purchaserange.max}:{best:0,worst:0}},deposit(){return{best:this.purchaserange.min-this.mortgage.best,worst:this.purchaserange.max-this.mortgage.worst}},total_money_in(){return{best:this.mortgage.best+this.deposit.best+this.stampduty_total.min+this.othercosts_total.min+this.refurb_cost_total.min,worst:this.mortgage.worst+this.deposit.worst+this.stampduty_total.max+this.othercosts_total.max+this.refurb_cost_total.max}},new_mortgage_amount(){return{best:this.gdv_total.max*(this.finance_refinance.ltv.max/100),worst:this.gdv_total.min*(this.finance_refinance.ltv.min/100)}},monay_pulled_out(){return{best:this.gdv_total.max-this.new_mortgage_amount.best,worst:this.gdv_total.min-this.new_mortgage_amount.worst}},profit(){return{best:this.gdv_total.max-this.total_money_in.best,worst:this.gdv_total.min-this.total_money_in.worst}},money_left_in(){return{best:this.monay_pulled_out.best-this.profit.best,worst:this.monay_pulled_out.worst-this.profit.worst}}}}),qa={class:"alternativetable"},Pa=n("thead",null,[n("tr",null,[n("th",{class:"text-left alternativetablecell"}),n("th",{class:"text-center alternativetablecell worstcasetablecell"},"Worst case"),n("th",{class:"text-center alternativetablecell"},"Best case")])],-1),Ra=n("td",{class:"text-left alternativetablecell"},"Price offered",-1),Aa={class:"text-right alternativetablecell yellowtablecell totaltablecell"},Ba={class:"text-right alternativetablecell yellowtablecell totaltablecell"},Ia=n("td",{class:"text-left alternativetablecell"},"Mortgage %",-1),Ma={class:"text-right alternativetablecell yellowtablecell totaltablecell"},za={class:"text-right alternativetablecell yellowtablecell totaltablecell"},ja=n("td",{class:"text-left alternativetablecell"},"Mortgage",-1),Da={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},Va={class:"text-right alternativetablecell totaltablecell"},La=n("td",{class:"text-left alternativetablecell"},"Deposit",-1),Ea={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},Fa={class:"text-right alternativetablecell totaltablecell"},Oa=n("td",{class:"text-left alternativetablecell"},"Stamp Duty",-1),Ua={class:"text-right alternativetablecell yellowtablecell totaltablecell"},Na={class:"text-right alternativetablecell yellowtablecell totaltablecell"},Qa=n("td",{class:"text-left alternativetablecell"},"Other costs (Legals, etc)",-1),Wa={class:"text-right alternativetablecell yellowtablecell totaltablecell"},Ga={class:"text-right alternativetablecell yellowtablecell totaltablecell"},Ha=n("td",{class:"text-left alternativetablecell"},"Total Refurb Costs",-1),Ka={class:"text-right alternativetablecell bluetablecell totaltablecell"},Ja={class:"text-right alternativetablecell bluetablecell totaltablecell"},Ya=n("td",{class:"text-left alternativetablecell"},"Total Money In",-1),Xa={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},Za={class:"text-right alternativetablecell totaltablecell"},xa=n("tr",null,[n("td",null,"\xA0"),n("td",{class:"worstcasetablecell"}),n("td")],-1),er=n("td",{class:"text-left alternativetablecell"},"End Value",-1),tr={class:"text-right alternativetablecell yellowtablecell totaltablecell"},ar={class:"text-right alternativetablecell yellowtablecell totaltablecell"},rr=n("td",{class:"text-left alternativetablecell"},"New Mortgage Amount",-1),sr={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},nr={class:"text-right alternativetablecell totaltablecell"},ir=n("td",{class:"text-left alternativetablecell"},"Money Pulled Out",-1),lr={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},or={class:"text-right alternativetablecell totaltablecell"},cr=n("tr",null,[n("td",null,"\xA0"),n("td",{class:"worstcasetablecell"}),n("td")],-1),ur=n("td",{class:"text-left alternativetablecell"},"Profit",-1),dr={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},_r={class:"text-right alternativetablecell totaltablecell"},fr=n("td",{class:"text-left alternativetablecell"},"Money Left In",-1),hr={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},mr={class:"text-right alternativetablecell totaltablecell"};function pr(e,r,s,t,a,c){return g(),A(Qt,{"expand-separator":"",label:"Alternative summary format"},{default:d(()=>[n("div",null,[$(" This is another way of viewing the project numbers that is commonly used. I have included this for comparison. "),n("table",qa,[Pa,n("tbody",null,[n("tr",null,[Ra,n("td",Aa,f(e.format_currency(e.purchaserange.max)),1),n("td",Ba,f(e.format_currency(e.purchaserange.min)),1)]),n("tr",null,[Ia,n("td",Ma,f(e.mortgage_rate_display.worst),1),n("td",za,f(e.mortgage_rate_display.best),1)]),n("tr",null,[ja,n("td",Da,f(e.format_currency(e.mortgage.worst)),1),n("td",Va,f(e.format_currency(e.mortgage.best)),1)]),n("tr",null,[La,n("td",Ea,f(e.format_currency(e.deposit.worst)),1),n("td",Fa,f(e.format_currency(e.deposit.best)),1)]),n("tr",null,[Oa,n("td",Ua,f(e.format_currency(e.stampduty_total.max)),1),n("td",Na,f(e.format_currency(e.stampduty_total.min)),1)]),n("tr",null,[Qa,n("td",Wa,f(e.format_currency(e.othercosts_total.max)),1),n("td",Ga,f(e.format_currency(e.othercosts_total.min)),1)]),n("tr",null,[Ha,n("td",Ka,f(e.format_currency(e.refurb_cost_total.max)),1),n("td",Ja,f(e.format_currency(e.refurb_cost_total.min)),1)]),n("tr",null,[Ya,n("th",Xa,f(e.format_currency(e.total_money_in.worst)),1),n("th",Za,f(e.format_currency(e.total_money_in.best)),1)]),xa,n("tr",null,[er,n("td",tr,f(e.format_currency(e.gdv_total.min)),1),n("td",ar,f(e.format_currency(e.gdv_total.max)),1)]),n("tr",null,[rr,n("td",sr,f(e.format_currency(e.new_mortgage_amount.worst)),1),n("td",nr,f(e.format_currency(e.new_mortgage_amount.best)),1)]),n("tr",null,[ir,n("td",lr,f(e.format_currency(e.monay_pulled_out.worst)),1),n("td",or,f(e.format_currency(e.monay_pulled_out.best)),1)]),cr,n("tr",null,[ur,n("td",dr,f(e.format_currency(e.profit.worst)),1),n("td",_r,f(e.format_currency(e.profit.best)),1)]),n("tr",null,[fr,n("td",hr,f(e.format_currency(e.money_left_in.worst)),1),n("td",mr,f(e.format_currency(e.money_left_in.best)),1)])])]),$(" Note: The profit amounts may not match because this method does not take into account finance costs. ")])]),_:1})}var gr=U(Ta,[["render",pr]]);const vr=O({name:"BrrCalcDealRatingCompareDoneup",props:["purchaserange","refurb_cost_total","gdv_total"],methods:{format_currency(e){return ce.format_currency(e)},format_percent(e){return ce.format_percent(e)}},computed:{total_spent(){return{worst:this.purchaserange.max+this.refurb_cost_total.max,best:this.purchaserange.min+this.refurb_cost_total.min}},gain(){return{worst:this.gdv_total.min-this.total_spent.worst,best:this.gdv_total.max-this.total_spent.best}},profit_percentage(){return{worst:this.gain.worst/this.total_spent.worst,best:this.gain.best/this.total_spent.best}}}}),br=n("div",{class:"text-h5"},"Compare this project to buying a done up property",-1),wr=n("div",null,"This section compares this project with buying a property that is already done up. To account for the time and risk involved with a refurbishment we expect the end value of the property to be more than if we had just bought one.",-1),yr={class:"alternativetable"},$r=n("thead",null,[n("tr",null,[n("th",{class:"text-left alternativetablecell"}),n("th",{class:"text-center alternativetablecell worstcasetablecell"},"Worst case"),n("th",{class:"text-center alternativetablecell"},"Best case")])],-1),Sr=n("td",{class:"text-left alternativetablecell"},"Purchase + Refurb",-1),kr={class:"text-right alternativetablecell worstcasetablecell"},Cr={class:"text-right alternativetablecell"},Tr=n("td",{class:"text-left alternativetablecell"},"End Value",-1),qr={class:"text-right alternativetablecell worstcasetablecell"},Pr={class:"text-right alternativetablecell"},Rr=n("td",{class:"text-left alternativetablecell totaltablecell"},"Gain",-1),Ar={class:"text-right alternativetablecell worstcasetablecell totaltablecell"},Br={class:"text-right alternativetablecell totaltablecell"},Ir=n("td",{class:"text-left alternativetablecell totaltablecell"},"Percentage",-1),Mr={class:"text-right alternativetablecell worstcasetablecell finaltotaltablecell"},zr={class:"text-right alternativetablecell finaltotaltablecell"};function jr(e,r,s,t,a,c){return g(),F("div",null,[br,wr,n("table",yr,[$r,n("tbody",null,[n("tr",null,[Sr,n("td",kr,f(e.format_currency(e.total_spent.worst)),1),n("td",Cr,f(e.format_currency(e.total_spent.best)),1)]),n("tr",null,[Tr,n("td",qr,f(e.format_currency(e.gdv_total.min)),1),n("td",Pr,f(e.format_currency(e.gdv_total.max)),1)]),n("tr",null,[Rr,n("td",Ar,f(e.format_currency(e.gain.worst)),1),n("td",Br,f(e.format_currency(e.gain.best)),1)]),n("tr",null,[Ir,n("td",Mr,f(e.format_percent(e.profit_percentage.worst)),1),n("td",zr,f(e.format_percent(e.profit_percentage.best)),1)])])])])}var Dr=U(vr,[["render",jr]]);const Vr=O({name:"BrrCalcDealRating",props:["is_valid_input","finance_totalmoneyneeded","deal_summary_final_bal","finance_refinance","gdv_total","refurbmonths","purchaserange","stampduty_total","othercosts_total","refurb_cost_total"],components:{dealRatingAlternativeSummary:gr,FeatureTable:Vt,InvalidMessage:Ye,dealRatingCompareDoneup:Dr},data(){return{}},methods:{format_currency(e){return ce.format_currency(e)}},computed:{features(){let e=[];var r=Math.min(this.cash_out_of_deal_minus_cash_in.best,this.cash_out_of_deal_minus_cash_in.worst);r>0?e.push({type:"positive",text:"All money out deal! - All initial investment returned plus at least "+this.format_currency(r)}):e.push({type:"negative",text:"Not all money out deal! - Might leave "+this.format_currency(-1*r)+" in."});var s=Math.min(this.profit.best,this.profit.worst);s<0?e.push({type:"negative",text:"Deal makes a loss! - End value might be "+this.format_currency(-1*s)+" less than investment."}):s<this.gdv_total.min*.25?e.push({type:"negative",text:"Low amount of profit! - Low profit "+this.format_currency(s)+" less than 25% of gdv."}):e.push({type:"positive",text:"Profit making deal! - Profit of "+this.format_currency(s)+"!"});var t=Math.min(this.annualroi.worst,this.annualroi.best);return t<3?e.push({type:"negative",text:"Very low ROI! "+t.toFixed(1)+"%"}):t>10&&e.push({type:"positive",text:"Good ROI! "+t.toFixed(1)+"%"}),e},cash_out_of_deal_minus_cash_in(){return{best:this.deal_summary_final_bal.best-this.finance_totalmoneyneeded.best,worst:this.deal_summary_final_bal.worst-this.finance_totalmoneyneeded.worst}},percent_left_in(){return this.finance_refinance.userefinance?{best:100-this.finance_refinance.ltv.max,worst:100-this.finance_refinance.ltv.min}:{best:100,worst:100}},amount_equity_left_in(){return{best:this.gdv_total.max*(this.percent_left_in.best/100),worst:this.gdv_total.min*(this.percent_left_in.worst/100)}},total_end_value(){return{best:this.amount_equity_left_in.best+this.deal_summary_final_bal.best,worst:this.amount_equity_left_in.worst+this.deal_summary_final_bal.worst}},profit(){return{best:this.total_end_value.best-this.finance_totalmoneyneeded.best,worst:this.total_end_value.worst-this.finance_totalmoneyneeded.worst}},roi(){return{best:100*this.profit.best/this.finance_totalmoneyneeded.best,worst:100*this.profit.worst/this.finance_totalmoneyneeded.worst}},annualroi(){return{worst:this.roi.worst*(12/this.refurbmonths.worst),best:this.roi.best*(12/this.refurbmonths.best)}}}}),Lr=n("div",{class:"text-h6"},"Project Rating",-1),Er=n("div",{class:"text-subtitle2"},"How good is this project?",-1),Fr=n("div",{class:"text-h5"},"Profit/Loss",-1),Or=n("div",null,"Compare what we have put into the deal vs what we get out of it. These calculations won't account for time invested or the risk taken on in the project",-1),Ur={class:"text-h5"},Nr=n("div",{class:"text-h6"},"Deal Features",-1);function Qr(e,r,s,t,a,c){const l=k("InvalidMessage"),u=k("dealRatingCompareDoneup"),v=k("dealRatingAlternativeSummary"),z=k("FeatureTable");return g(),A(te,{inline:"",class:"q-ma-sm card-style maincard col-grow"},{default:d(()=>[i(B,null,{default:d(()=>[Lr,Er]),_:1}),i(B,null,{default:d(()=>[i(l,{is_valid_input:e.is_valid_input},null,8,["is_valid_input"]),Fr,Or,n("div",Ur,"Total cash in: "+f(e.format_currency(e.finance_totalmoneyneeded.worst))+" - "+f(e.format_currency(e.finance_totalmoneyneeded.best))+" Worst - Best",1),i(u,{purchaserange:e.purchaserange,refurb_cost_total:e.refurb_cost_total,gdv_total:e.gdv_total},null,8,["purchaserange","refurb_cost_total","gdv_total"])]),_:1}),i(B,null,{default:d(()=>[i(v,{purchaserange:e.purchaserange,finance_refinance:e.finance_refinance,stampduty_total:e.stampduty_total,othercosts_total:e.othercosts_total,refurb_cost_total:e.refurb_cost_total,gdv_total:e.gdv_total},null,8,["purchaserange","finance_refinance","stampduty_total","othercosts_total","refurb_cost_total","gdv_total"])]),_:1}),i(B,null,{default:d(()=>[Nr,i(z,{features:e.features,"onUpdate:features":r[0]||(r[0]=y=>e.features=y)},null,8,["features"])]),_:1})]),_:1})}var Wr=U(Vr,[["render",Qr]]);function Gr(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16))}const Hr=O({name:"WebLinksComponent",props:["weblinks"],emits:["updateweblinks"],data(){return{}},computed:{weblinkdisplay(){return this.weblinks.map(function(e){const r=new URL(e.label);let s="web",t=r.hostname;return r.hostname==="www.google.com"&&(r.pathname.startsWith("/maps/@")&&(r.pathname.includes("/data=")?(t="Google Streetview",s="streetview"):(t="Google Map",s="map")),r.pathname.startsWith("/maps/place")&&(t="Google Place",s="place")),{id:e.id,label:e.label,text:t,icon:s}})}},methods:{clickweblink(e){window.open(e.label,"_blank").focus()},delweblink(e){const r=this.weblinks.filter(function(s){return e!==s.id});this.$emit("updateweblinks",r)},addweblink(){const e=this;this.$q.dialog({title:"Add weblink",message:"Add weblink to information about this property (rightmove, zoopla, etc.)",html:!1,ok:{push:!0,label:"Ok"},cancel:{push:!0,label:"Cancel"},prompt:{model:"",type:"text"}}).onOk(r=>{if(r=r.trim(),!r.startsWith("http")){J.create({color:"bg-grey-2",message:"Link must start with http",timeout:2e3,color:"negative"});return}const s=e.weblinks;s.push({id:Gr(),label:r}),this.$emit("updateweblinks",s)})}}});function Kr(e,r,s,t,a,c){return g(),F("div",null,[(g(!0),F(Ke,null,Je(e.weblinkdisplay,l=>(g(),F("div",{key:l},[i(It,{clickable:"",onClick:u=>e.clickweblink(l),removable:"",onRemove:u=>e.delweblink(l.id),color:"primary","text-color":"white",icon:l.icon},{default:d(()=>[$(f(l.text),1)]),_:2},1032,["onClick","onRemove","icon"])]))),128)),i(ee,{round:"",color:"primary",icon:"add",onClick:e.addweblink},null,8,["onClick"])])}var Jr=U(Hr,[["render",Kr]]);const Yr=O({name:"DealBasicInfo",emits:["saveproject"],components:{Weblinks:Jr},setup(){return{backend_connection_store:be()}},data(){return{patch:{id:"notset",name:"Not Set"},address:"",postcode:"",weblinks:[],new_patch_value:"",selling_agent:"",notes:"",changed:!1,autosave_seconds_left:60,ever_saved:!1,save_in_progress:!1,save_monitor_function_running:!1}},watch:{serializer_card_data(e){this.set_changed_true()}},computed:{serializer_card_data(){return{patch_id:this.patch.id,address:this.address,postcode:this.postcode,weblinks:this.weblinks,selling_agent:this.selling_agent,notes:this.notes}},no_save_message(){return this.patch.id==="notset"?"Select patch":this.address.length<3?"Enter address":this.save_in_progress?"Saving...":""},can_save(){return this.save_in_progress?!1:!!this.changed},save_btn_text(){return this.no_save_message!==""?"Not able to save ("+this.no_save_message+")":this.changed?this.autosave_seconds_left===-1?"Save Now":"Save now (auto save in "+this.autosave_seconds_left+")":this.ever_saved?"Saved":"Not able to save (No changes)"},security_role_cansave(){return this.backend_connection_store.security_role_cansave},patch_list(){return this.backend_connection_store.user_profile.patches.concat([{id:"create",name:"Add..."}])}},methods:{updateweblinks(e){this.weblinks=e,this.set_changed_true()},serializer_load_data(e){this.address=e.address,this.postcode=e.postcode,this.weblinks=e.weblinks,this.selling_agent=e.selling_agent,this.notes=e.notes,this.patch=this.patch_list.filter(function(s){return s.id===e.patch_id})[0],this.ever_saved=!0;const r=this;setTimeout(function(){r.changed=!1,r.autosave_seconds_left=-1},50)},set_changed_true(){this.changed=!0,this.no_save_message===""&&(this.autosave_seconds_left=10,this.start_save_monitor_function())},start_save_monitor_function(){this.save_monitor_function_running||this.save_monitor_function()},save_monitor_function(){if(this.save_monitor_function_running=!0,this.save_in_progress)return;if(this.autosave_seconds_left===-1){this.save_monitor_function_running=!1;return}const e=this;if(e.autosave_seconds_left=e.autosave_seconds_left-1,e.autosave_seconds_left<1){this.save_monitor_function_running=!1,this.save_now();return}setTimeout(e.save_monitor_function,1e3)},click_save_btn(){this.autosave_seconds_left=-1,this.save_now()},save_now(){!this.can_save||(this.save_in_progress=!0,this.$emit("saveproject"))},save_project_complete_notification({success:e,response:r}){console.log("save complet notif"),this.save_in_progress=!1,e?(this.changed=!1,this.ever_saved=!0):this.autosave_seconds_left=-1},select_patch_by_id(e){console.log("TODO select_patch_by_id",e),this.patch=this.patch_list.filter(function(r){return r.id===e})[0]},select_patch(e){if(e.id==="create"){const r=this;this.$q.dialog({title:"Add new patch",message:"Enter the name for the new patch",html:!1,ok:{push:!0,label:"Ok"},cancel:{push:!0,label:"Cancel"},prompt:{model:"",type:"text"}}).onOk(s=>{r.new_patch_value=s;const t={ok:r.createpatchcallback,error:function(c){console.log("s",c),J.create({color:"negative",message:"Create patch failed "+c.response.data.message,timeout:2e3})}},a={patch_name:s};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/patches",method:"POST",data:a,callback:t})})}},createpatchcallback(e){this.backend_connection_store.update_user_profile({user_profile:e.data.user_profile,then:this.createpatchcallback2})},createpatchcallback2(){const e=this;this.patch=this.patch_list.filter(function(r){return r.name===e.new_patch_value})[0],this.new_patch_value=""},isEmpty(e){return e==null?!0:e.length==0},copy_text(e){const r={ok:function(s){J.create({color:"bg-grey-2",message:"Copied to clipboard",timeout:2e3})},error:function(s){J.create({color:"negative",message:"Copy failed",timeout:2e3})}};Wt.copyTextToClipboard2(e,r)}}}),Xr=n("div",{class:"text-h6"},"Basic Information",-1),Zr=n("div",{class:"text-subtitle2"},"Basic information about this project",-1),xr={key:0},es={key:1},ts=n("div",{class:"text-h6"},"Weblinks",-1);function as(e,r,s,t,a,c){const l=k("Weblinks");return e.security_role_cansave?(g(),A(te,{key:0,inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:d(()=>[i(B,null,{default:d(()=>[Xr,Zr]),_:1}),i(B,null,{default:d(()=>[e.ever_saved?L("",!0):(g(),F("div",xr,[i(Mt,{modelValue:e.patch,"onUpdate:modelValue":[r[0]||(r[0]=u=>e.patch=u),e.select_patch],options:e.patch_list,label:"Patch","emit-value":"","option-label":"name"},null,8,["modelValue","options","onUpdate:modelValue"])])),e.ever_saved?(g(),F("div",es," Patch: "+f(e.patch.name),1)):L("",!0),n("div",null,[i(ne,{filled:"",clearable:"",modelValue:e.address,"onUpdate:modelValue":r[1]||(r[1]=u=>e.address=u),label:"Address"},null,8,["modelValue"])]),n("div",null,[i(ne,{filled:"",clearable:"",modelValue:e.postcode,"onUpdate:modelValue":r[3]||(r[3]=u=>e.postcode=u),label:"Postcode"},{append:d(()=>[e.isEmpty(e.postcode)?L("",!0):(g(),A(de,{key:0,class:"q-field__focusable-action",name:"content_copy",onClick:r[2]||(r[2]=u=>e.copy_text(e.postcode))}))]),_:1},8,["modelValue"])])]),_:1}),i(B,null,{default:d(()=>[n("div",null,[ts,i(l,{weblinks:e.weblinks,onUpdateweblinks:e.updateweblinks},null,8,["weblinks","onUpdateweblinks"])]),n("div",null,[i(ne,{filled:"",clearable:"",modelValue:e.selling_agent,"onUpdate:modelValue":r[4]||(r[4]=u=>e.selling_agent=u),label:"Selling Agent"},null,8,["modelValue"])]),n("div",null,[i(ne,{filled:"",autogrow:"",modelValue:e.notes,"onUpdate:modelValue":r[5]||(r[5]=u=>e.notes=u),label:"Notes"},null,8,["modelValue"])])]),_:1}),i(B,null,{default:d(()=>[n("div",null,[i(ee,{color:"primary",icon:"save",label:e.save_btn_text,onClick:e.click_save_btn},null,8,["label","onClick"])])]),_:1})]),_:1})):L("",!0)}var rs=U(Yr,[["render",as]]);function ss(e,r,s){const t=[];t.push({range:"Main!A1",values:[['=HYPERLINK("www.evernetproperties.com", "Project calculation generated by www.evernetproperties.com")']]}),t.push({range:"Main!A2:B2",values:[["Patch:",r.patch.name]]}),t.push({range:"Main!A3:B3",values:[["Address:",r.serialized_data.dealbasicinfo.address]]}),t.push({range:"Main!E3:E3",values:[[r.serialized_data.dealbasicinfo.postcode]]}),t.push({range:"Main!A4:A4",values:[["Links:"]]});let a=3;return r.serialized_data.dealbasicinfo.weblinks.forEach(function(c){a=a+1,t.push({range:"Main!B"+a.toString()+":B"+a.toString(),values:[['=HYPERLINK("'+c.label+'", "'+c.label+'")']]})}),a=a+1,a=a+1,t.push({range:"Main!A"+a.toString()+":B"+a.toString(),values:[["Selling Agent:",r.serialized_data.dealbasicinfo.selling_agent]]}),a=a+1,t.push({range:"Main!A"+a.toString()+":B"+a.toString(),values:[["Notes:",r.serialized_data.dealbasicinfo.notes]]}),a=a+1,t.push({range:"Main!A"+a.toString()+":B"+a.toString(),values:[["Vision:",r.serialized_data.vision.devplan]]}),a=a+1,a=a+1,t.push({range:"Main!A"+a.toString()+":A"+a.toString(),values:[["Caculations provided here are for reference only and should be manually checked."]]}),t}function ns(e,r,s){const t=[];return t.push({repeatCell:{range:{sheetId:s.Main,startRowIndex:0,endRowIndex:r.serialized_data.dealbasicinfo.weblinks.length+6+1,startColumnIndex:0,endColumnIndex:1},cell:{userEnteredFormat:{textFormat:{bold:!0},verticalAlignment:"TOP"}},fields:"userEnteredFormat(textFormat, verticalAlignment)"}}),t}var Oe={get_sheet_main_values:ss,get_sheet_main:ns};function is(e){function r(s,t,a,c,l){return{repeatCell:{range:{sheetId:e,startRowIndex:s,endRowIndex:t,startColumnIndex:a,endColumnIndex:c},cell:{userEnteredFormat:{numberFormat:{type:"NUMBER",pattern:l}}},fields:"userEnteredFormat.numberFormat"}}}return{makeboldandvaligntop:function(s,t,a,c){return{repeatCell:{range:{sheetId:e,startRowIndex:s,endRowIndex:t,startColumnIndex:a,endColumnIndex:c},cell:{userEnteredFormat:{textFormat:{bold:!0},verticalAlignment:"TOP"}},fields:"userEnteredFormat(textFormat, verticalAlignment)"}}},makeitalicandvaligntop:function(s,t,a,c){return{repeatCell:{range:{sheetId:e,startRowIndex:s,endRowIndex:t,startColumnIndex:a,endColumnIndex:c},cell:{userEnteredFormat:{textFormat:{italic:!0},verticalAlignment:"TOP"}},fields:"userEnteredFormat(textFormat, verticalAlignment)"}}},formatnumbermisc:function(s,t,a,c,l){return r(s,t,a,c,l)},formatcurrency:function(s,t,a,c){return r(s,t,a,c,"[$\xA3-809]#,##0.00")},formatpercentage:function(s,t,a,c){return r(s,t,a,c,"0.00%")},adjustcolumnwidth:function(s,t){return{updateDimensionProperties:{range:{sheetId:e,dimension:"COLUMNS",startIndex:s,endIndex:s+1},properties:{pixelSize:t},fields:"pixelSize"}}}}}var ls={get_sheet_utils:is};const R="Purchase Phase";function os(e,r,s){return{name:"Buying Cash",pre_stage:function(t){},start_details:function(t){return[["Purchase Price",r.serialized_data.purchaseprice.purchaserangevalue.max,r.serialized_data.purchaseprice.purchaserangevalue.min]]},end_details:function(t){return[]}}}function cs(e,r,s){return{name:"Buying with a Mortgage",pre_stage:function(t,a){const c=[],l=t.cur_row;t.cur_row=t.cur_row+1,t.value_requests.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["","Worst","Best"]]}),t.requests.push(a.makeboldandvaligntop(t.cur_row-1,t.cur_row,1,3)),t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Purchase Price",r.serialized_data.purchaseprice.purchaserangevalue.max,r.serialized_data.purchaseprice.purchaserangevalue.min]]}),t.requests.push(a.formatcurrency(l,t.cur_row,1,3)),t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Mortage Rate",r.serialized_data.finance.mortgage.rate.max/100,r.serialized_data.finance.mortgage.rate.min/100]]}),t.requests.push(a.formatpercentage(t.cur_row-1,t.cur_row,1,3)),t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Mortgage LTV",r.serialized_data.finance.mortgage.ltv.max/100,r.serialized_data.finance.mortgage.ltv.min/100]]}),t.requests.push(a.formatpercentage(t.cur_row-1,t.cur_row,1,3)),t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Total Mortgage","=B"+(l+2).toString()+"*B"+(t.cur_row-1).toString(),"=C"+(l+2).toString()+"*C"+(t.cur_row-1).toString()]]}),t.requests.push(a.formatcurrency(t.cur_row-1,t.cur_row,1,3)),t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Monthly Payments","=(B"+(t.cur_row-1).toString()+"*B"+(l+3).toString()+")/12","=(C"+(t.cur_row-1).toString()+"*C"+(l+3).toString()+")/12"]]}),t.requests.push(a.formatcurrency(t.cur_row-1,t.cur_row,1,3)),t.misc_data.monthly_payments_row=t.cur_row,t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Deposit","=B"+(l+2).toString()+"-B"+(t.cur_row-2).toString(),"=C"+(l+2).toString()+"-C"+(t.cur_row-2).toString()]]}),t.requests.push(a.formatcurrency(t.cur_row-1,t.cur_row,1,3)),t.misc_data.deposit_row=t.cur_row,t.cur_row=t.cur_row+1,c.push({range:R+"!A"+t.cur_row.toString()+":C"+t.cur_row.toString(),values:[["Refurb Duration Months",r.serialized_data.refurbcost.refurbtimerange.max,r.serialized_data.refurbcost.refurbtimerange.min]]}),t.requests.push(a.formatnumbermisc(t.cur_row-1,t.cur_row,1,3,"0")),t.misc_data.refurb_duration_row=t.cur_row,t.requests.push(a.makeboldandvaligntop(l,t.cur_row,0,1)),t.cur_row=t.cur_row+1,t.value_requests.push(c)},start_details:function(t){return[["Deposit","=B"+t.misc_data.deposit_row.toString(),"=C"+t.misc_data.deposit_row.toString()],["Mortgage Arangement",r.serialized_data.finance.mortgage.arrangementfee,r.serialized_data.finance.mortgage.arrangementfee]]},end_details:function(t){return[["Mortgage Payments","=B"+t.misc_data.monthly_payments_row.toString()+"*B"+t.misc_data.refurb_duration_row.toString(),"=C"+t.misc_data.monthly_payments_row.toString()+"*C"+t.misc_data.refurb_duration_row.toString()],["(During refurbishment)","",""]]}}}function us(e,r,s){return{name:"Buying with a Bridge",pre_stage:function(t){},start_details:function(t){return[["Purchase Price",r.serialized_data.purchaseprice.purchaserangevalue.max,r.serialized_data.purchaseprice.purchaserangevalue.min]]},end_details:function(t){return[["Bridge Costs",r.finance_bridgecost.worst,r.finance_bridgecost.best]]}}}function ds(e,r,s){return r.serialized_data.finance.mortgage.usemortgage?cs(e,r):r.serialized_data.finance.bridge.usebridge?us(e,r):os(e,r)}function _s(e,r,s){const t=ls.get_sheet_utils(s[R]);let a={cur_row:0,requests:[],value_requests:[],misc_data:{}};a.requests.push(t.adjustcolumnwidth(0,170)),a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString(),values:[['=HYPERLINK("www.evernetproperties.com", "Project calculation generated by www.evernetproperties.com")']]}),a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString()+":B"+a.cur_row.toString(),values:[["Patch:",r.patch.name]]}),a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString()+":B"+a.cur_row.toString(),values:[["Address:",r.serialized_data.dealbasicinfo.address]]}),a.value_requests.push({range:R+"!E"+a.cur_row.toString()+":E"+a.cur_row.toString(),values:[[r.serialized_data.dealbasicinfo.postcode]]}),a.requests.push(t.makeboldandvaligntop(0,a.cur_row,0,1)),a.cur_row=a.cur_row+1;const c=ds(e,r);a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString()+":A"+a.cur_row.toString(),values:[[c.name]]}),a.requests.push(t.makeboldandvaligntop(a.cur_row-1,a.cur_row,0,1)),c.pre_stage(a,t),a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString()+":C"+a.cur_row.toString(),values:[["","Worst","Best"]]}),a.requests.push(t.makeboldandvaligntop(a.cur_row-1,a.cur_row,1,3));const l=a.cur_row;let u=c.start_details(a);return u.push(["Refurbishment",r.refurb_cost_total.max,r.refurb_cost_total.min]),u.push(["Stamp Duty",r.stampduty_total.max,r.stampduty_total.min]),r.othercosts_items_detail.forEach(function(v){u.push([v.name,-1*v.worst,-1*v.best])}),r.caculated_loan_details.forEach(function(v){u.push([v.name+" interest",v.interest,v.interest])}),u=u.concat(c.end_details(a)),u.forEach(function(v){a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString()+":C"+a.cur_row.toString(),values:[[v[0],v[1],v[2]]]}),v[0]==="(During refurbishment)"?a.requests.push(t.makeitalicandvaligntop(a.cur_row-1,a.cur_row,0,1)):a.requests.push(t.makeboldandvaligntop(a.cur_row-1,a.cur_row,0,1))}),a.cur_row=a.cur_row+1,a.cur_row=a.cur_row+1,a.value_requests.push({range:R+"!A"+a.cur_row.toString()+":C"+a.cur_row.toString(),values:[["Total Money needed","=SUM(B"+(l+1).toString()+":B"+(a.cur_row-1).toString()+")","=SUM(C"+(l+1).toString()+":C"+(a.cur_row-1).toString()+")"]]}),a.requests.push(t.makeboldandvaligntop(a.cur_row-1,a.cur_row,0,3)),a.requests.push(t.formatcurrency(l,a.cur_row,1,3)),{value_requests:a.value_requests,requests:a.requests}}var Ue={sheet_name:R,get_sheet_values:_s};const fs=O({name:"SaveToGoogleSheetCompoennt",props:["serialized_data","patch","refurb_cost_total","stampduty_total","othercosts_items_detail","caculated_loan_details","finance_bridgecost"],setup(){return{backend_connection_store:be()}},data(){return{}},computed:{security_role_cansave(){return this.backend_connection_store.security_role_cansave}},methods:{click_export(){Te.show();const e=google.accounts.oauth2.initTokenClient({client_id:this.$rjmgclientid,scope:this.$rjmgscopes,callback:this.execute_export});gapi.client.getToken()===null?e.requestAccessToken({prompt:"consent"}):e.requestAccessToken({prompt:""})},execute_export(){try{gapi.client.sheets.spreadsheets.create({properties:{title:"evernetproperties.com-"+this.patch.name+"-"+this.serialized_data.dealbasicinfo.address}}).then(e=>{this.spreadsheets_batchupdate(e.result)})}catch(e){this.sheet_api_error_handler(e);return}},spreadsheets_batchupdate(e){let r={Main:e.sheets[0].properties.sheetId},s=[];s.push({updateSheetProperties:{properties:{sheetId:e.sheets[0].properties.sheetId,title:"Main"},fields:"title"}});const t=[Ue.sheet_name];t.forEach(function(c){s.push({addSheet:{properties:{title:c}}})}),s=s.concat(Oe.get_sheet_main(e,this,r));const a={requests:s};try{gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:e.spreadsheetId,resource:a}).then(c=>{const l=c.result;console.log("spreadsheet Batch Update result",c.result.replies),c.result.replies.forEach(function(u){typeof u.addSheet!="undefined"&&t.forEach(function(v){u.addSheet.properties.title===v&&(r[v]=u.addSheet.properties.sheetId)})}),this.spreadsheets_batchupdate_after_all_sheets_added(e,r)})}catch(c){this.sheet_api_error_handler(c);return}},spreadsheets_batchupdate_after_all_sheets_added(e,r){let s=[],t=[];t=t.concat(Oe.get_sheet_main_values(e,this,r));let a=Ue.get_sheet_values(e,this,r);if(s=s.concat(a.requests),t=t.concat(a.value_requests),s.length===0){console.log("No requests required"),this.spreadsheets_values_batchupdate(e,r,t);return}const c={requests:s};try{gapi.client.sheets.spreadsheets.batchUpdate({spreadsheetId:e.spreadsheetId,resource:c}).then(l=>{const u=l.result;console.log("spreadsheet Batch Update after all sheets added result",l.result.replies),this.spreadsheets_values_batchupdate(e,r,t)})}catch(l){this.sheet_api_error_handler(l);return}},spreadsheets_values_batchupdate(e,r,s){const t={data:s,valueInputOption:"USER_ENTERED"};try{gapi.client.sheets.spreadsheets.values.batchUpdate({spreadsheetId:e.spreadsheetId,resource:t}).then(a=>{const c=a.result;console.log(`${c.totalUpdatedCells} cells updated.`),this.sheet_final_complete(e)})}catch(a){this.sheet_api_error_handler(a);return}},open_sheet(e){window.open(e.spreadsheetUrl,"_blank").focus()},sheet_api_error_handler(e){Te.hide(),console.log("Error-"+e.message),J.create({color:"negative",message:"Export to google sheets failed "+e.message,timeout:2e3})},sheet_final_complete(e){this.open_sheet(e),Te.hide()}}}),hs=n("div",{class:"text-h6"},"Export to Spreadsheet",-1),ms=n("div",{class:"text-subtitle2"},"Export figures into a google docs spreadsheet.",-1),ps=n("div",{class:"textdiv"}," This feature will generate a spreadsheet containing all the current values for this project and output it to a document in your google drive. ",-1);function gs(e,r,s,t,a,c){return e.security_role_cansave?(g(),A(te,{key:0,inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:d(()=>[i(B,null,{default:d(()=>[hs,ms]),_:1}),i(B,null,{default:d(()=>[n("div",null,[i(ee,{color:"primary",icon:"save",label:"Export to google sheets",onClick:e.click_export},null,8,["onClick"])]),ps]),_:1})]),_:1})):L("",!0)}var vs=U(fs,[["render",gs]]),Ne=ve({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:r}){const s=q(()=>e.sent===!0?"sent":"received"),t=q(()=>`q-message-text-content q-message-text-content--${s.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),a=q(()=>`q-message-text q-message-text--${s.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),c=q(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),l=q(()=>e.size!==void 0?`col-${e.size}`:""),u=q(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function v(y){return r.stamp!==void 0?[y,b("div",{class:"q-message-stamp"},r.stamp())]:e.stamp?[y,b("div",{class:"q-message-stamp",[u.value.stamp]:e.stamp})]:[y]}function z(y,I){const P=I===!0?y.length>1?S=>S:S=>b("div",[S]):S=>b("div",{[u.value.msg]:S});return y.map((S,E)=>b("div",{key:E,class:a.value},[b("div",{class:t.value},v(P(S)))]))}return()=>{const y=[];r.avatar!==void 0?y.push(r.avatar()):e.avatar!==void 0&&y.push(b("img",{class:`q-message-avatar q-message-avatar--${s.value}`,src:e.avatar,"aria-hidden":"true"}));const I=[];r.name!==void 0?I.push(b("div",{class:`q-message-name q-message-name--${s.value}`},r.name())):e.name!==void 0&&I.push(b("div",{class:`q-message-name q-message-name--${s.value}`,[u.value.name]:e.name})),r.default!==void 0?I.push(z(Pt(r.default()),!0)):e.text!==void 0&&I.push(z(e.text)),y.push(b("div",{class:l.value},I));const P=[];return r.label!==void 0?P.push(b("div",{class:"q-message-label"},r.label())):e.label!==void 0&&P.push(b("div",{class:"q-message-label",[u.value.label]:e.label})),P.push(b("div",{class:c.value},y)),b("div",{class:`q-message q-message-${s.value}`},P)}}});function Qe(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+e/4).toString(16))}const bs=O({name:"BrrCalcActivityJob",emits:["projectchanged"],data(){return{activity_log:[],emit_project_change_notification:!0}},computed:{serializer_card_data(){return this.activity_log},activity_log_display(){let e=[];const r={book_viewing:{sent:!0,name:"Viewing booked"},hold_viewing:{sent:!1,name:"Viewing"},call_agent:{sent:!0,name:"Call to agent"},wf_move:{sent:!1,name:"Workflow"},offer_made:{sent:!0,name:"Offer made"},offer_rejected:{sent:!1,name:"Offer rejected"},offer_accepted:{sent:!1,name:"Offer accepted"}};let s="";return this.activity_log.forEach(function(t){const a=new Date(t.timestamp),c=a.toDateString(),l=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});s!==c&&(s=c,e=e.concat([{id:Qe(),label:s}]));let u=r[t.type].name;typeof t.head_notes!="undefined"&&(u=u+" ("+t.head_notes+")"),e=e.concat({id:t.t,label:void 0,name:u,text:t.text,sent:r[t.type].sent,stamp:l,avatar:"src/assets/activity_log_icon_"+t.type+".png"})}),e}},watch:{serializer_card_data(e){this.emit_project_change_notification&&this.$emit("projectchanged")}},methods:{log_activity(e){this.activity_log.push({id:Qe(),type:e.type,timestamp:new Date().toISOString(),text:e.text,head_notes:e.head_notes}),this.$emit("projectchanged")},serializer_load_data(e){this.emit_project_change_notification=!1,this.activity_log=e;const r=this;setTimeout(function(){r.emit_project_change_notification=!0},50)}}}),ws=n("div",{class:"text-h6"},"Activity Log",-1),ys={style:{width:"100%","max-width":"400px"}},$s={key:0},Ss={key:1};function ks(e,r,s,t,a,c){return g(),A(te,{inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:d(()=>[i(B,null,{default:d(()=>[ws,n("div",ys,[(g(!0),F(Ke,null,Je(e.activity_log_display,l=>(g(),F("div",{key:l.id},[typeof l.label=="string"?(g(),F("div",$s,[i(Ne,{label:l.label},null,8,["label"])])):L("",!0),typeof l.label=="undefined"?(g(),F("div",Ss,[i(Ne,{name:l.name,text:[l.text],sent:l.sent,stamp:l.stamp,avatar:l.avatar},null,8,["name","text","sent","stamp","avatar"])])):L("",!0)]))),128))])]),_:1})]),_:1})}var Cs=U(bs,[["render",ks]]);const Ts=O({name:"ProjectSerializer",emits:["saveprojectcomplete"],setup(){return{backend_connection_store:be()}},data(){return{loaded_project_id:void 0,proj_summary_data:{metadata:void 0,timestamp_first_entered:void 0}}},methods:{serializer_load_data(e){this.loaded_project_id=e.id,this.proj_summary_data.timestamp_first_entered=e.timestamp_first_entered,this.proj_summary_data.metadata=e.metadata},save_project({dict_of_card_info:e,activity_log:r}){const s={};for(const l in Object.keys(e)){const u=Object.keys(e)[l];s[u]=JSON.parse(JSON.stringify(e[u]))}const t={user_id:this.backend_connection_store.user_profile.id,patch_id:e.dealbasicinfo.patch_id,timestamp_first_entered:this.proj_summary_data.timestamp_first_entered,initial_phase:{total_money_in:0,start_value:0,end_value:0,flip_roi:0},reoccurring_phase:[],location:{},workflow:{},activity_log:r,sub_section_details:s,tags:[],risks:[]};typeof this.loaded_project_id!="undefined"?(t.id=this.loaded_project_id,t.metadata=this.proj_summary_data.metadata):t.timestamp_first_entered=new Date().toISOString();const a=this,c={ok:a.save_api_call_success,error:a.save_api_call_fail};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects",method:"POST",data:t,callback:c})},save_api_call_success(e){this.$emit("saveprojectcomplete",{success:!0,response:e}),this.serializer_load_data(e.data),J.create({color:"positive",message:"Project Saved",timeout:2e3})},save_api_call_fail(e){this.$emit("saveprojectcomplete",{success:!1,response:e}),J.create({color:"negative",message:"Save failed - "+e.response.data.message,timeout:2e3})}},mounted(){}});function qs(e,r,s,t,a,c){return g(),F("div")}var Ps=U(Ts,[["render",qs]]);const Rs=O({name:"CalcBrrToFlip",components:{GdvCard:Lt,PurchasePrice:Et,RefurbCost:Ft,StampDuty:Ot,OtherCosts:Ut,DealSummary:Ca,Finance:Nt,Vision:ha,DealRating:Wr,Refinance:ba,DealBasicInfo:rs,ProjectSerializer:Ps,SaveToGoogleSheet:vs,ActivityLog:Cs,BrrToolbar:ca},setup(){return{backend_connection_store:be()}},data(){return{tab:"main",isMounted:!1,purchaserange:{min:18e4,max:19e4}}},computed:{security_role_cansave(){return this.backend_connection_store.security_role_cansave},is_valid_input(){return this.isMounted?!(!this.$refs.PurchasePrice.isValid||!this.$refs.GdvCard.isValid):!0},deal_summary_final_bal(){return this.isMounted?this.$refs.DealSummary.final_bal:{best:0,worst:0}},finance_refinance(){return this.isMounted?this.$refs.Refinance.get_refinance:{userefinance:!1,ltv:{min:75,max:75}}},caculated_loan_details(){return this.isMounted?this.$refs.Finance.caculated_loan_details:[]},finance_bridgecost(){return this.isMounted?this.$refs.Finance.bridgecost:{best:0,worst:0}},finance_totalmoneyneeded(){return this.isMounted?this.$refs.Finance.totalmoneyneeded:{best:0,worst:0}},finance_in_items(){return this.isMounted?this.$refs.Finance.finance_in_items:[]},finance_during_items(){return this.isMounted?this.$refs.Finance.finance_during_items:[]},finance_out_items(){return this.isMounted?this.$refs.Finance.finance_out_items:[]},refinance_out_items(){return this.isMounted?this.$refs.Refinance.refinance_out_items:[]},purchase_items(){return this.isMounted?this.$refs.PurchasePrice.purchase_items:[]},stampduty_items(){return this.isMounted?this.$refs.StampDuty.stampduty_items:[]},othercosts_items(){return this.isMounted?this.$refs.OtherCosts.othercosts_items:[]},othercosts_items_detail(){return this.isMounted?this.$refs.OtherCosts.othercosts_items_detail:[]},refurb_cost_items(){return this.isMounted?this.$refs.RefurbCost.refurb_cost_items:[]},refurb_cost_total(){return this.isMounted?this.$refs.RefurbCost.refurb_cost_total:[]},refurbmonths(){return this.isMounted?this.$refs.RefurbCost.refurbmonths:[]},stampduty_total(){return this.isMounted?this.$refs.StampDuty.stampduty:[]},othercosts_total(){return this.isMounted?this.$refs.OtherCosts.total:[]},gdv_total(){return this.isMounted?this.$refs.GdvCard.total:[]},serialized_data(){return this.isMounted?{dealbasicinfo:this.$refs.DealBasicInfo.serializer_card_data,vision:this.$refs.Vision.serializer_card_data,gdvcard:this.$refs.GdvCard.serializer_card_data,purchaseprice:this.$refs.PurchasePrice.serializer_card_data,refurbcost:this.$refs.RefurbCost.serializer_card_data,stampduty:this.$refs.StampDuty.serializer_card_data,othercosts:this.$refs.OtherCosts.serializer_card_data,finance:this.$refs.Finance.serializer_card_data,refinance:this.$refs.Refinance.serializer_card_data}:{}},patch(){return this.isMounted?this.$refs.DealBasicInfo.patch:{id:"notset",name:"Not Set"}}},methods:{activity_log(e){this.$refs.ActivityLog.log_activity(e)},projectchanged(){this.$refs.DealBasicInfo.set_changed_true()},save_project(){this.$refs.ProjectSerializer.save_project({dict_of_card_info:this.serialized_data,activity_log:this.$refs.ActivityLog.serializer_card_data})},load_project_into_cards(e){this.$refs.ProjectSerializer.serializer_load_data(e),this.$refs.DealBasicInfo.serializer_load_data(e.sub_section_details.dealbasicinfo),typeof e.sub_section_details.vision!="undefined"&&this.$refs.Vision.serializer_load_data(e.sub_section_details.vision),typeof e.sub_section_details.gdvcard!="undefined"&&this.$refs.GdvCard.serializer_load_data(e.sub_section_details.gdvcard),typeof e.sub_section_details.purchaseprice!="undefined"&&this.$refs.PurchasePrice.serializer_load_data(e.sub_section_details.purchaseprice),typeof e.sub_section_details.refurbcost!="undefined"&&this.$refs.RefurbCost.serializer_load_data(e.sub_section_details.refurbcost),typeof e.sub_section_details.stampduty!="undefined"&&this.$refs.StampDuty.serializer_load_data(e.sub_section_details.stampduty),typeof e.sub_section_details.othercosts!="undefined"&&this.$refs.OtherCosts.serializer_load_data(e.sub_section_details.othercosts),typeof e.sub_section_details.finance!="undefined"&&this.$refs.Finance.serializer_load_data(e.sub_section_details.finance),typeof e.sub_section_details.refinance!="undefined"&&this.$refs.Refinance.serializer_load_data(e.sub_section_details.refinance),console.log("BRRCALC Load ",e.activity_log),this.$refs.ActivityLog.serializer_load_data(e.activity_log)},save_project_complete({success:e,response:r}){this.$refs.DealBasicInfo.save_project_complete_notification({success:e,response:r})},load_project_api_fail(e){J.create({color:"bg-grey-2",message:"Error loading project "+e,timeout:2e3,color:"negative"}),this.load_complete()},load_project_api_success(e){this.load_project_into_cards(e.data),J.create({color:"bg-grey-2",message:"Project Loaded",timeout:2e3,color:"positive"}),this.load_complete()},load_complete(){const e=this;setTimeout(function(){e.isMounted=!0},5)},call_load_api(){const e=this,r={ok:e.load_project_api_success,error:e.load_project_api_fail};e.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+e.$route.query.projectid,method:"GET",data:void 0,callback:r})}},mounted(){const e=this;if(typeof e.$route.query.projectid=="undefined"){if(e.load_complete(),typeof e.$route.query.patchid!="undefined"){if(!e.security_role_cansave)return;this.$refs.DealBasicInfo.select_patch_by_id(e.$route.query.patchid)}return}if(e.security_role_cansave){e.call_load_api();return}setTimeout(function(){e.call_load_api()},1e3)}}),As={class:"main-page fit col wrap justify-center items-center content-center"},Bs=n("h1",null,"Buy Refurbish Rent Refinance Calculator",-1),Is=n("div",null,"This calculator can be used for calculating deal information for a Buy, Refurbish, Rent, Refinance project (BRRR).",-1),Ms={class:"row"},zs={class:"row"};function js(e,r,s,t,a,c){const l=k("BrrToolbar"),u=k("DealBasicInfo"),v=k("Vision"),z=k("GdvCard"),y=k("PurchasePrice"),I=k("RefurbCost"),P=k("StampDuty"),S=k("OtherCosts"),E=k("Finance"),G=k("Refinance"),ae=k("DealSummary"),Y=k("DealRating"),ie=k("ProjectSerializer"),m=k("ActivityLog"),j=k("SaveToGoogleSheet");return g(),A(zt,{class:"flex"},{default:d(()=>[n("div",As,[Bs,Is,e.security_role_cansave?(g(),A(l,{key:0,onActivity_log:e.activity_log},null,8,["onActivity_log"])):L("",!0),e.security_role_cansave?(g(),A(Zt,{key:1,modelValue:e.tab,"onUpdate:modelValue":r[0]||(r[0]=M=>e.tab=M),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:d(()=>[i(Fe,{name:"main",label:"Main"}),i(Fe,{name:"project",label:"Project"})]),_:1},8,["modelValue"])):L("",!0),ge(n("div",Ms,[i(u,{ref:"DealBasicInfo",onSaveproject:e.save_project},null,8,["onSaveproject"]),i(v,{ref:"Vision",onProjectchanged:e.projectchanged},null,8,["onProjectchanged"]),i(z,{ref:"GdvCard",onProjectchanged:e.projectchanged},null,8,["onProjectchanged"]),i(y,{ref:"PurchasePrice",purchaserange:e.purchaserange,"onUpdate:purchaserange":r[1]||(r[1]=M=>e.purchaserange=M),onProjectchanged:e.projectchanged},null,8,["purchaserange","onProjectchanged"]),i(I,{ref:"RefurbCost",onProjectchanged:e.projectchanged},null,8,["onProjectchanged"]),i(P,{ref:"StampDuty",purchaserange:e.purchaserange,onProjectchanged:e.projectchanged},null,8,["purchaserange","onProjectchanged"]),i(S,{ref:"OtherCosts",purchaserange:e.purchaserange,onProjectchanged:e.projectchanged},null,8,["purchaserange","onProjectchanged"]),i(E,{ref:"Finance",purchaserange:e.purchaserange,refurb_cost_total:e.refurb_cost_total,stampduty_total:e.stampduty_total,othercosts_total:e.othercosts_total,refurbmonths:e.refurbmonths,gdv_total:e.gdv_total,onProjectchanged:e.projectchanged},null,8,["purchaserange","refurb_cost_total","stampduty_total","othercosts_total","refurbmonths","gdv_total","onProjectchanged"]),i(G,{ref:"Refinance",gdv_total:e.gdv_total,onProjectchanged:e.projectchanged},null,8,["gdv_total","onProjectchanged"]),i(ae,{ref:"DealSummary",purchaserange:e.purchaserange,finance_in_items:e.finance_in_items,finance_out_items:e.finance_out_items,finance_during_items:e.finance_during_items,refinance_out_items:e.refinance_out_items,purchase_items:e.purchase_items,stampduty_items:e.stampduty_items,othercosts_items:e.othercosts_items,refurb_cost_items:e.refurb_cost_items,gdv_total:e.gdv_total,refurbmonths:e.refurbmonths,is_valid_input:e.is_valid_input},null,8,["purchaserange","finance_in_items","finance_out_items","finance_during_items","refinance_out_items","purchase_items","stampduty_items","othercosts_items","refurb_cost_items","gdv_total","refurbmonths","is_valid_input"]),i(Y,{ref:"DealRating",purchaserange:e.purchaserange,finance_totalmoneyneeded:e.finance_totalmoneyneeded,deal_summary_final_bal:e.deal_summary_final_bal,finance_refinance:e.finance_refinance,gdv_total:e.gdv_total,refurbmonths:e.refurbmonths,stampduty_total:e.stampduty_total,othercosts_total:e.othercosts_total,refurb_cost_total:e.refurb_cost_total,is_valid_input:e.is_valid_input},null,8,["purchaserange","finance_totalmoneyneeded","deal_summary_final_bal","finance_refinance","gdv_total","refurbmonths","stampduty_total","othercosts_total","refurb_cost_total","is_valid_input"]),e.security_role_cansave?(g(),A(ie,{key:0,ref:"ProjectSerializer",onSaveprojectcomplete:e.save_project_complete},null,8,["onSaveprojectcomplete"])):L("",!0)],512),[[Ee,e.tab==="main"]]),ge(n("div",zs,[e.security_role_cansave?(g(),A(m,{key:0,ref:"ActivityLog",onProjectchanged:e.projectchanged},null,8,["onProjectchanged"])):L("",!0),i(j,{ref:"SaveToGoogleSheet",serialized_data:e.serialized_data,patch:e.patch,stampduty_total:e.stampduty_total,refurb_cost_total:e.refurb_cost_total,othercosts_items_detail:e.othercosts_items_detail,caculated_loan_details:e.caculated_loan_details,finance_bridgecost:e.finance_bridgecost},null,8,["serialized_data","patch","stampduty_total","refurb_cost_total","othercosts_items_detail","caculated_loan_details","finance_bridgecost"])],512),[[Ee,e.tab==="project"]])])]),_:1})}var Ys=U(Rs,[["render",js]]);export{Ys as default};

import{_ as L,d as P,N as v,o as c,c as g,w as A,e as r,t as _,a as l,Q as n,K as f,L as u}from"./index.4eee666e.js";import{Q as E}from"./QSelect.73b91ea0.js";import{Q as S}from"./QPage.9a7ff2ac.js";import{a as C}from"./axios.6e1fcf85.js";import"./QItemLabel.c391c9f3.js";import"./position-engine.d01cff17.js";function T({attemptsRemaining:o,bestAttemptSoFar:t,callback:e,allowLowAccuracy:a}){var i=8e3,d=!0,s=0;if(typeof a=="undefined"&&(a=!1),a&&(o=1,i=void 0,d=!1,s=void 0),t.coords.accuracy<11&&(o=0),o===0){var b={coords:{latitude:t.coords.latitude,longitude:t.coords.longitude,speed:t.coords.speed,heading:t.coords.heading,altitude:t.coords.altitude,accuracy:t.coords.accuracy,altitudeAccuracy:t.coords.altitudeAccuracy},timestamp:t.timestamp};e.ok(b);return}navigator.geolocation.getCurrentPosition(p=>{p.coords.accuracy<t.coords.accuracy&&(t=p),T({attemptsRemaining:o-1,bestAttemptSoFar:t,callback:e})},p=>{e.error(p)},{maximumAge:s,timeout:i,enableHighAccuracy:d})}function O(o,t,e){let a={method:"get",maxBodyLength:1/0,url:"https://api.postcodes.io/postcodes?longitude="+t+"&latitude="+e,headers:{Accept:"application/json"}};C.request(a).then(i=>{o.ok(i)}).catch(i=>{o.error(i)})}function N(o,t,e){let a={method:"get",maxBodyLength:1/0,url:"https://api.metcarob.com/property_backend/v0/public/api/rmproxy/typeahead?query="+t+"+"+e+"&limit=10&exclude=STREET"};C.request(a).then(i=>{o.ok(i)}).catch(i=>{o.error(i)})}var h={getLocation:T,getPostcode:O,getRightmoveLocationCode:N};const y=2,k=3,m=4,w=5,$=P({name:"ToolsLocationPage",components:{},data(){return{status:0,error_message:"",cur_location:{},postcodes:[],cur_postcode:"",rmlocationcodes:{}}},computed:{postcode_data_div(){var o="<table>";const t=this;function e(a,i){typeof t.cur_postcode_data[i]!="undefined"&&(o+='<tr><td class="postcode_data_title_field">'+a+"</td><td>"+t.cur_postcode_data[i]+"</td></tr>")}return e("Postcode","postcode"),e("nhs ha","nhs_ha"),e("European Electoral Region","european_electoral_region"),e("Primary Care Trust","primary_care_trust"),e("Region","region"),e("Parliamentary Constituency","parliamentary_constituency"),e("Parliamentary Constituency (2024)","parliamentary_constituency_2024"),e("Admin District","admin_district"),e("Parish","parish"),e("Admin Ward","admin_ward"),e("ccg","ccg"),e("nuts","nuts"),e("pfa","pfa"),o+="</table>",o},cur_postcode_data(){const o=this;return this.postcodes===null?{postcode:"AAA AAA",outcode:"AAA",incode:"AAA"}:this.postcodes.filter(function(t){return t.postcode===o.cur_postcode})[0]},button_toggle_options(){return this.postcodes===null?[]:this.postcodes.map(function(o){return{label:o.postcode,value:o.postcode}})},status_text(){return this.status===0?"Initial":this.status===1?"Finding Location...":this.status===y?"Failed to find location - "+this.error_message:this.status===k?"Location Found - finding postcode...":this.status===m?"Failed to find postcode - "+this.error_message:this.status===w?"Postcode Found":"Unknown"}},methods:{is_rightmoveid_loaded(o){return Object.prototype.hasOwnProperty.call(this.rmlocationcodes,o.postcode)},get_rightmove_url(o,t){var e="property-for-sale";return t==="RENT"&&(e="property-to-rent"),t==="STUDENTS_RENT"&&(e="student-accommodation"),"https://www.rightmove.co.uk/"+e+"/map.html?keywords=&sortType=2&viewType=MAP&channel="+t+"&index=0&radius=0.25&locationIdentifier=POSTCODE%5E"+this.rmlocationcodes[o.postcode]},get_police_postcode(o){return o.outcode.toUpperCase()+o.incode.toUpperCase()},get_census_postcode(o){return o.outcode.toLowerCase()+"%20"+o.incode.toLowerCase()},get_lharate_postcode(o){return o.outcode.toUpperCase()+"%2b"+o.incode.toUpperCase()},get_streetcheck_postcode(o){return o.outcode.toLowerCase()+o.incode.toLowerCase()},get_ukgovplanningurl(o){return"https://www.planning.data.gov.uk/map/#"+o.latitude+","+o.longitude+",14.800276418264161z"},get_rightmovesold_postcode(o){return o.outcode.toLowerCase()+"-"+o.incode.toLowerCase()},get_epc_postcode(o){return o.postcode.replace(" ","+").toLowerCase()},goto_url(o){window.location.href=o},rescan(){this.status=1,this.cur_location={},this.postcodes=[],this.cur_postcode="";var o={coords:{accuracy:99999}},t={ok:this.rescan_positive,error:this.rescan_negative};h.getLocation({attemptsRemaining:4,bestAttemptSoFar:o,callback:t,allowLowAccuracy:!1})},rescan_positive(o){this.status=k,this.cur_location=o;var t={ok:this.findpostcode_positive,error:this.findpostcode_negative};h.getPostcode(t,this.cur_location.coords.longitude,this.cur_location.coords.latitude)},rescan_negative(o){this.status=y,this.error_message=o.message,console.log("rescan_negative",o),v.create({color:"bg-grey-2",message:"Failed to access location services",timeout:2e3,color:"negative"})},findpostcode_positive(o){console.log("findpostcode_positive",o);const t=this;if(this.status=w,o.data.result===null){this.status=m,this.error_message="Failed to find postcode - No postcodes found for this location";return}this.postcodes=o.data.result,this.postcodes.length>0&&(this.cur_postcode=this.postcodes[0].postcode);var e=[];Object.keys(this.postcodes).forEach(function(i){const d=t.postcodes[i];t.rmlocationcodes.hasOwnProperty(d.postcode)||e.push(d)});function a(){if(e.length===0)return;const i=e.pop(),d={ok:function(s){t.rmlocationcodes={...t.rmlocationcodes,[i.postcode]:JSON.parse(s.data).matches[0].id},a()},error:function(s){console.log("Error looking up rightmove location code",s)}};h.getRightmoveLocationCode(d,i.outcode,i.incode)}a()},findpostcode_negative(o){this.status=m,this.error_message="Failed to find postcode - "+JSON.stringify(o),console.log("findpostcode_negative",o),v.create({color:"bg-grey-2",message:"Failed to find postcode",timeout:2e3,color:"negative"})}},mounted(){this.rescan()}}),D={class:"cols locationpage-main-div"},R=r("h1",null,"Area Research",-1),U=r("td",null,"Status:",-1),B={key:0},I=r("td",null,"Location:",-1),F=r("td",null,null,-1),H={key:0},V={class:"locationpage-postcodeselector"},q=r("div",null,"Links to external sites providing information about this area",-1),Q={class:"locationpage-extlinkbuttonlist row"},j={class:"locationpage-extlinkbuttonlist-rightmove column wrap justify-center items-center content-center"},M=r("h1",null,"Rightmove",-1),G=["innerHTML"];function J(o,t,e,a,i,d){return c(),g(S,{class:"flex flex-center locationpage-main"},{default:A(()=>[r("div",D,[R,r("table",null,[r("tr",null,[U,r("td",null,_(o.status_text),1),r("td",null,[l(n,{round:"",color:"primary",icon:"refresh",onClick:o.rescan},null,8,["onClick"])])]),o.status>2?(c(),f("tr",B,[I,r("td",null,_(o.cur_location.coords.latitude)+", "+_(o.cur_location.coords.longitude),1),F])):u("",!0)]),o.status>4?(c(),f("div",H,[r("div",V,[l(E,{modelValue:o.cur_postcode,"onUpdate:modelValue":t[0]||(t[0]=s=>o.cur_postcode=s),options:o.button_toggle_options,label:o.button_toggle_options.length.toString()+" postcodes found","emit-value":""},null,8,["modelValue","options","label"])]),q,r("div",Q,[r("div",j,[M,r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),g(n,{key:0,label:"Sale",onClick:t[1]||(t[1]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"BUY"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),g(n,{key:0,label:"Rent",onClick:t[2]||(t[2]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"RENT"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),g(n,{key:0,label:"Student Rent",onClick:t[3]||(t[3]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"STUDENTS_RENT"))),color:"primary"})):u("",!0)]),r("div",null,[l(n,{label:"Sold House Prices",onClick:t[4]||(t[4]=s=>o.goto_url("https://www.rightmove.co.uk/house-prices/"+o.get_rightmovesold_postcode(o.cur_postcode_data)+".html?radius=0.5")),color:"primary"})])]),r("div",null,[l(n,{label:"Spareroom",onClick:t[5]||(t[5]=s=>o.goto_url("https://www.spareroom.co.uk/flatshare/?search_id=&location="+o.get_police_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Openrent",onClick:t[6]||(t[6]=s=>o.goto_url("https://www.openrent.co.uk/properties-to-rent/"+o.get_rightmovesold_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"AirBnb",onClick:t[7]||(t[7]=s=>o.goto_url("https://www.airbnb.co.uk/s/"+o.get_rightmovesold_postcode(o.cur_postcode_data)+"/homes?refinement_paths%5B%5D=%2Fhomes&flexible_trip_lengths%5B%5D=one_week&price_filter_input_type=2&channel=EXPLORE&search_type=search_query")),color:"primary"})]),r("div",null,[l(n,{label:"EPCs",onClick:t[8]||(t[8]=s=>o.goto_url("https://find-energy-certificate.service.gov.uk/find-a-certificate/search-by-postcode?postcode="+o.get_epc_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"UK Gov planning data",onClick:t[9]||(t[9]=s=>o.goto_url(o.get_ukgovplanningurl(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Streetcheck",onClick:t[10]||(t[10]=s=>o.goto_url("https://www.streetcheck.co.uk/postcode/"+o.get_streetcheck_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"LHA Rates",onClick:t[11]||(t[11]=s=>o.goto_url("https://lha-direct.voa.gov.uk/SearchResults.aspx?Postcode="+o.get_lharate_postcode(o.cur_postcode_data)+"&LHACategory=999&Month=5&Year=2025&SearchPageParameters=true")),color:"primary"})]),r("div",null,[l(n,{label:"Google Search",onClick:t[12]||(t[12]=s=>o.goto_url("https://www.google.com/search?q="+o.get_epc_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Census",onClick:t[13]||(t[13]=s=>o.goto_url("https://www.nomisweb.co.uk/reports/localarea?search="+o.get_census_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Crime",onClick:t[14]||(t[14]=s=>o.goto_url("https://www.police.uk/pu/your-area/?q="+o.get_police_postcode(o.cur_postcode_data))),color:"primary"})])]),r("div",{innerHTML:o.postcode_data_div},null,8,G)])):u("",!0)])]),_:1})}var x=L($,[["render",J]]);export{x as default};

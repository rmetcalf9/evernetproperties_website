import{_ as L,d as E,N as v,o as c,c as p,w as A,e as r,t as _,a as l,Q as n,K as f,L as u}from"./index.981c98b5.js";import{Q as O}from"./QSelect.20e0f76e.js";import{Q as P}from"./QPage.9c2f0846.js";import{a as w}from"./axios.6e1fcf85.js";import"./QItemLabel.d2859ba2.js";import"./position-engine.a3140e0d.js";function T({attemptsRemaining:o,bestAttemptSoFar:e,callback:t,allowLowAccuracy:a}){var i=8e3,d=!0,s=0;if(typeof a=="undefined"&&(a=!1),a&&(o=1,i=void 0,d=!1,s=void 0),e.coords.accuracy<11&&(o=0),o===0){var b={coords:{latitude:e.coords.latitude,longitude:e.coords.longitude,speed:e.coords.speed,heading:e.coords.heading,altitude:e.coords.altitude,accuracy:e.coords.accuracy,altitudeAccuracy:e.coords.altitudeAccuracy},timestamp:e.timestamp};t.ok(b);return}navigator.geolocation.getCurrentPosition(g=>{g.coords.accuracy<e.coords.accuracy&&(e=g),T({attemptsRemaining:o-1,bestAttemptSoFar:e,callback:t})},g=>{t.error(g)},{maximumAge:s,timeout:i,enableHighAccuracy:d})}function S(o,e,t){let a={method:"get",maxBodyLength:1/0,url:"https://api.postcodes.io/postcodes?longitude="+e+"&latitude="+t,headers:{Accept:"application/json"}};w.request(a).then(i=>{o.ok(i)}).catch(i=>{o.error(i)})}function R(o,e,t){let a={method:"get",maxBodyLength:1/0,url:"https://api.metcarob.com/property_backend/v0/public/api/rmproxy/typeahead?query="+e+"+"+t+"&limit=10&exclude=STREET"};w.request(a).then(i=>{o.ok(i)}).catch(i=>{o.error(i)})}var m={getLocation:T,getPostcode:S,getRightmoveLocationCode:R};const y=2,k=3,h=4,C=5,N=E({name:"ToolsLocationPage",components:{},data(){return{status:0,error_message:"",cur_location:{},postcodes:[],cur_postcode:"",rmlocationcodes:{}}},computed:{postcode_data_div(){var o="<table>";const e=this;function t(a,i){typeof e.cur_postcode_data[i]!="undefined"&&(o+='<tr><td class="postcode_data_title_field">'+a+"</td><td>"+e.cur_postcode_data[i]+"</td></tr>")}return t("Postcode","postcode"),t("nhs ha","nhs_ha"),t("European Electoral Region","european_electoral_region"),t("Primary Care Trust","primary_care_trust"),t("Region","region"),t("Parliamentary Constituency","parliamentary_constituency"),t("Parliamentary Constituency (2024)","parliamentary_constituency_2024"),t("Admin District","admin_district"),t("Parish","parish"),t("Admin Ward","admin_ward"),t("ccg","ccg"),t("nuts","nuts"),t("pfa","pfa"),o+="</table>",o},cur_postcode_data(){const o=this;return this.postcodes===null?{postcode:"AAA AAA",outcode:"AAA",incode:"AAA"}:this.postcodes.filter(function(e){return e.postcode===o.cur_postcode})[0]},button_toggle_options(){return this.postcodes===null?[]:this.postcodes.map(function(o){return{label:o.postcode,value:o.postcode}})},status_text(){return this.status===0?"Initial":this.status===1?"Finding Location...":this.status===y?"Failed to find location - "+this.error_message:this.status===k?"Location Found - finding postcode...":this.status===h?"Failed to find postcode - "+this.error_message:this.status===C?"Postcode Found":"Unknown"}},methods:{is_rightmoveid_loaded(o){return Object.prototype.hasOwnProperty.call(this.rmlocationcodes,o.postcode)},get_rightmove_url(o,e){var t="property-for-sale",a="0.25";return e==="RENT"&&(t="property-to-rent"),e==="STUDENTS_RENT"&&(t="student-accommodation"),e==="COMMERCIAL_RENT"&&(t="commercial-property-to-let",a="0.5"),e==="COMMERCIAL_BUY"&&(t="commercial-property-for-sale",a="0.5"),"https://www.rightmove.co.uk/"+t+"/map.html?keywords=&sortType=2&viewType=MAP&channel="+e+"&index=0&radius="+a+"&locationIdentifier=POSTCODE%5E"+this.rmlocationcodes[o.postcode]},get_police_postcode(o){return o.outcode.toUpperCase()+o.incode.toUpperCase()},get_census_postcode(o){return o.outcode.toLowerCase()+"%20"+o.incode.toLowerCase()},get_lharate_postcode(o){return o.outcode.toUpperCase()+"%2b"+o.incode.toUpperCase()},get_streetcheck_postcode(o){return o.outcode.toLowerCase()+o.incode.toLowerCase()},get_ukgovplanningurl(o){return"https://www.planning.data.gov.uk/map/#"+o.latitude+","+o.longitude+",14.800276418264161z"},get_rightmovesold_postcode(o){return o.outcode.toLowerCase()+"-"+o.incode.toLowerCase()},get_epc_postcode(o){return o.postcode.replace(" ","+").toLowerCase()},goto_url(o){window.location.href=o},rescan(){this.status=1,this.cur_location={},this.postcodes=[],this.cur_postcode="";var o={coords:{accuracy:99999}},e={ok:this.rescan_positive,error:this.rescan_negative};m.getLocation({attemptsRemaining:4,bestAttemptSoFar:o,callback:e,allowLowAccuracy:!1})},rescan_positive(o){this.status=k,this.cur_location=o;var e={ok:this.findpostcode_positive,error:this.findpostcode_negative};m.getPostcode(e,this.cur_location.coords.longitude,this.cur_location.coords.latitude)},rescan_negative(o){this.status=y,this.error_message=o.message,console.log("rescan_negative",o),v.create({color:"bg-grey-2",message:"Failed to access location services",timeout:2e3,color:"negative"})},findpostcode_positive(o){console.log("findpostcode_positive",o);const e=this;if(this.status=C,o.data.result===null){this.status=h,this.error_message="Failed to find postcode - No postcodes found for this location";return}this.postcodes=o.data.result,this.postcodes.length>0&&(this.cur_postcode=this.postcodes[0].postcode);var t=[];Object.keys(this.postcodes).forEach(function(i){const d=e.postcodes[i];e.rmlocationcodes.hasOwnProperty(d.postcode)||t.push(d)});function a(){if(t.length===0)return;const i=t.pop(),d={ok:function(s){e.rmlocationcodes={...e.rmlocationcodes,[i.postcode]:JSON.parse(s.data).matches[0].id},a()},error:function(s){console.log("Error looking up rightmove location code",s)}};m.getRightmoveLocationCode(d,i.outcode,i.incode)}a()},findpostcode_negative(o){this.status=h,this.error_message="Failed to find postcode - "+JSON.stringify(o),console.log("findpostcode_negative",o),v.create({color:"bg-grey-2",message:"Failed to find postcode",timeout:2e3,color:"negative"})}},mounted(){this.rescan()}}),$={class:"cols locationpage-main-div"},U=r("h1",null,"Area Research",-1),D=r("td",null,"Status:",-1),I={key:0},B=r("td",null,"Location:",-1),M=r("td",null,null,-1),F={key:0},H={class:"locationpage-postcodeselector"},V=r("div",null,"Links to external sites providing information about this area",-1),q={class:"locationpage-extlinkbuttonlist row"},Q={class:"locationpage-extlinkbuttonlist-rightmove column wrap justify-center items-center content-center"},j=r("h1",null,"Rightmove",-1),Y=["innerHTML"];function G(o,e,t,a,i,d){return c(),p(P,{class:"flex flex-center locationpage-main"},{default:A(()=>[r("div",$,[U,r("table",null,[r("tr",null,[D,r("td",null,_(o.status_text),1),r("td",null,[l(n,{round:"",color:"primary",icon:"refresh",onClick:o.rescan},null,8,["onClick"])])]),o.status>2?(c(),f("tr",I,[B,r("td",null,_(o.cur_location.coords.latitude)+", "+_(o.cur_location.coords.longitude),1),M])):u("",!0)]),o.status>4?(c(),f("div",F,[r("div",H,[l(O,{modelValue:o.cur_postcode,"onUpdate:modelValue":e[0]||(e[0]=s=>o.cur_postcode=s),options:o.button_toggle_options,label:o.button_toggle_options.length.toString()+" postcodes found","emit-value":""},null,8,["modelValue","options","label"])]),V,r("div",q,[r("div",Q,[j,r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),p(n,{key:0,label:"Sale",onClick:e[1]||(e[1]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"BUY"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),p(n,{key:0,label:"Rent",onClick:e[2]||(e[2]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"RENT"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),p(n,{key:0,label:"Student Rent",onClick:e[3]||(e[3]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"STUDENTS_RENT"))),color:"primary"})):u("",!0)]),r("div",null,[l(n,{label:"Sold House Prices",onClick:e[4]||(e[4]=s=>o.goto_url("https://www.rightmove.co.uk/house-prices/"+o.get_rightmovesold_postcode(o.cur_postcode_data)+".html?radius=0.5")),color:"primary"})]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),p(n,{key:0,label:"Commercial Sale",onClick:e[5]||(e[5]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"COMMERCIAL_BUY"))),color:"primary"})):u("",!0)]),r("div",null,[o.is_rightmoveid_loaded(o.cur_postcode_data)?(c(),p(n,{key:0,label:"Commercial Rent",onClick:e[6]||(e[6]=s=>o.goto_url(o.get_rightmove_url(o.cur_postcode_data,"COMMERCIAL_RENT"))),color:"primary"})):u("",!0)])]),r("div",null,[l(n,{label:"Spareroom",onClick:e[7]||(e[7]=s=>o.goto_url("https://www.spareroom.co.uk/flatshare/?search_id=&location="+o.get_police_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Openrent",onClick:e[8]||(e[8]=s=>o.goto_url("https://www.openrent.co.uk/properties-to-rent/"+o.get_rightmovesold_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"AirBnb",onClick:e[9]||(e[9]=s=>o.goto_url("https://www.airbnb.co.uk/s/"+o.get_rightmovesold_postcode(o.cur_postcode_data)+"/homes?refinement_paths%5B%5D=%2Fhomes&flexible_trip_lengths%5B%5D=one_week&price_filter_input_type=2&channel=EXPLORE&search_type=search_query")),color:"primary"})]),r("div",null,[l(n,{label:"EPCs",onClick:e[10]||(e[10]=s=>o.goto_url("https://find-energy-certificate.service.gov.uk/find-a-certificate/search-by-postcode?postcode="+o.get_epc_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"UK Gov planning data",onClick:e[11]||(e[11]=s=>o.goto_url(o.get_ukgovplanningurl(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Streetcheck",onClick:e[12]||(e[12]=s=>o.goto_url("https://www.streetcheck.co.uk/postcode/"+o.get_streetcheck_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"LHA Rates",onClick:e[13]||(e[13]=s=>o.goto_url("https://lha-direct.voa.gov.uk/SearchResults.aspx?Postcode="+o.get_lharate_postcode(o.cur_postcode_data)+"&LHACategory=999&Month=5&Year=2025&SearchPageParameters=true")),color:"primary"})]),r("div",null,[l(n,{label:"Google Search",onClick:e[14]||(e[14]=s=>o.goto_url("https://www.google.com/search?q="+o.get_epc_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Census",onClick:e[15]||(e[15]=s=>o.goto_url("https://www.nomisweb.co.uk/reports/localarea?search="+o.get_census_postcode(o.cur_postcode_data))),color:"primary"})]),r("div",null,[l(n,{label:"Crime",onClick:e[16]||(e[16]=s=>o.goto_url("https://www.police.uk/pu/your-area/?q="+o.get_police_postcode(o.cur_postcode_data))),color:"primary"})])]),r("div",{innerHTML:o.postcode_data_div},null,8,Y)])):u("",!0)])]),_:1})}var x=L(N,[["render",G]]);export{x as default};

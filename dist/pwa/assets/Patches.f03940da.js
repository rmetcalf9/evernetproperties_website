import{Q as y}from"./QPage.5b728a67.js";import{u as w}from"./backend_connection.15cca581.js";import{C as $}from"./CommonBRRToolLink.4b81da5a.js";import{d as b,_ as T,o as r,c as m,w as k,ae as S,e as n,t as d,f as P,K as c,M as p,O as f,L as _,a as h,Q as B,aa as O,r as v}from"./index.ce16cc00.js";import{u as C}from"./data_caches.e9d63034.js";import{W as g}from"./Workflow_main.1e4e793e.js";import"./axios.6e1fcf85.js";var R="/assets/patch_icon.880b248a.png";const E=b({name:"PatchCard",props:["patch"],setup(){const e=w(),t=C();return{backend_connection_store:e,dataCachesStore:t}},data(){return{loaded:!1,workflows:void 0}},methods:{todo_text(e){let t=0,o=0,s=0;return Object.keys(e.detail.todogroups).forEach(function(a){t=t+e.detail.todogroups[a].due,o=o+e.detail.todogroups[a].not_due.length,s=s+e.detail.todogroups[a].done}),t.toString()+"/"+(o+t).toString()+" ("+s.toString()+")"},num_todos(e){let t=0,o=0,s=0;return Object.keys(e.detail.todogroups).forEach(function(a){t=t+e.detail.todogroups[a].due,o=o+e.detail.todogroups[a].not_due.length,s=s+e.detail.todogroups[a].done}),t+o+s},get_workflow_name(e){return this.workflows[e].name},get_workflow_stage_name(e,t){return this.workflows[e].stages[t].name},click_patch(e){this.$router.push("/tools/cansave/patches/"+e)}},mounted(){this.loaded=!1;const e=this,t={ok:function(o){e.loaded=!0,e.workflows=o},error:function(o){Notify.create({color:"bg-grey-2",message:"Unable to load workflow information",timeout:2e3,color:"negative"})}};g.workflow3(this.backend_connection_store,this.dataCachesStore,t)}}),Q={class:"text-h6"},D={class:"row"},L=n("div",null,[n("img",{alt:"Item Picture",src:R,class:"tool-picture"})],-1),N={class:"col q-ma-sm"},V={align:"right"},q={key:0},U={class:"workflow_stage_block"},W={key:0,class:"todo_stage_block"},A=n("h1",null,"Todos",-1);function F(e,t,o,s,a,j){return r(),m(O,{inline:"",class:"q-ma-sm card-style tool-card",onClick:t[0]||(t[0]=l=>e.click_patch(e.patch.from_user_profile.id))},{default:k(()=>[e.loaded?(r(),m(S,{key:0},{default:k(()=>[n("div",Q,d(e.patch.from_user_profile.name),1),n("div",D,[L,n("div",N,[n("div",V,[P(" View your projects in "+d(e.patch.from_user_profile.name)+". ",1),e.patch.loaded?(r(),c("div",q,[n("div",U,[(r(!0),c(p,null,f(Object.keys(e.patch.detail.workflow_lookup),l=>(r(),c("div",{key:l},[n("h1",null,d(e.get_workflow_name(l)),1),(r(!0),c(p,null,f(Object.keys(e.patch.detail.workflow_lookup[l]),i=>(r(),c("div",{key:i},d(e.get_workflow_stage_name(l,i))+": "+d(e.patch.detail.workflow_lookup[l][i].length),1))),128))]))),128))]),e.num_todos(e.patch)>0?(r(),c("div",W,[A,n("div",null,"Due: "+d(e.todo_text(e.patch)),1)])):_("",!0)])):_("",!0),h(B,{round:"",color:"primary",icon:"info"})])])])]),_:1})):_("",!0)]),_:1})}var I=T(E,[["render",F]]);const K=b({name:"ToolsCansavePatchesPage",components:{CommonBRRToolLink:$,PatchCard:I},setup(){const e=w(),t=C();return{backend_connection_store:e,dataCachesStore:t}},data(){return{loaded:!1,workflows:void 0,patches_data:{}}},computed:{active_patches(){const e=this;return Object.keys(this.patches_data).filter(function(t){return e.patches_data[t].loaded?e.patch_has_active_projects(e.patches_data[t]):!1}).reduce((t,o)=>(t[o]=e.patches_data[o],t),{})},dormant_patches(){const e=this;return Object.keys(this.patches_data).filter(function(t){return e.patches_data[t].loaded?!e.patch_has_active_projects(e.patches_data[t]):!1}).reduce((t,o)=>(t[o]=e.patches_data[o],t),{})},user_profile(){return this.backend_connection_store.user_profile}},methods:{patch_has_active_projects(e){const t=this;let o=!1;return Object.keys(e.detail.workflow_lookup).forEach(function(s){Object.keys(e.detail.workflow_lookup[s]).forEach(function(a){e.detail.workflow_lookup[s][a].length>0&&g.isActiveStage(t.workflows,s,a)&&(o=!0)})}),o},click_brrr_card(){this.$router.push("/tools/brrcalc")},recursive_load_project_details(){const e=this.patches_data.filter(function(a){return a.loaded===!1});if(e.length===0)return;const t=e[0],o=this,s={ok:function(a){t.loaded=!0,t.loadsuccess=!0,t.detail=a.data,o.recursive_load_project_details()},error:function(a){t.loaded=!0,t.loadsuccess=!1,o.recursive_load_project_details()}};this.dataCachesStore.get({backend_connection_store:this.backend_connection_store,object_type:"patches",object_id:t.from_user_profile.id,skip_cache:!1,callback:s})}},mounted(){this.loaded=!1;const e=this;this.patches_data=this.user_profile.patches.map(function(o){return{from_user_profile:o,loaded:!1,loadsuccess:!0,detail:{}}});const t={ok:function(o){e.workflows=o,e.loaded=!0,e.recursive_load_project_details()},error:function(o){console.log("Error loading workflows",o)}};g.workflow3(this.backend_connection_store,this.dataCachesStore,t)}}),M={key:0},Y=n("h1",null,"Select Patch",-1),z=n("h2",null,"Dormant",-1),G=n("p",null,"Dormant patches are patches with no projects in an active stage.",-1),H={key:0},J=n("div",null,"You have not saved any projects. Use the BRR tool to create your first project:",-1);function X(e,t,o,s,a,j){const l=v("PatchCard"),i=v("CommonBRRToolLink");return r(),m(y,{class:"flex flex-center"},{default:k(()=>[e.loaded?(r(),c("div",M,[Y,(r(!0),c(p,null,f(e.active_patches,u=>(r(),c("div",{key:u},[h(l,{patch:u},null,8,["patch"])]))),128)),z,G,(r(!0),c(p,null,f(e.dormant_patches,u=>(r(),c("div",{key:u},[h(l,{patch:u},null,8,["patch"])]))),128)),e.user_profile.patches.length===0?(r(),c("div",H,[J,h(i)])):_("",!0)])):_("",!0)]),_:1})}var re=T(K,[["render",X]]);export{re as default};

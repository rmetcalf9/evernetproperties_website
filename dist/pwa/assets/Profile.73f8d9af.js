import{d as y,_ as b,r as k,o as l,K as n,a as t,w as I,aj as S,N as c,e as i,f as r,Q as p,M as C,O as T,t as d,c as P,a9 as m,L as f}from"./index.ce16cc00.js";import{Q as M}from"./QPage.5b728a67.js";import{u as D,a as E}from"./backend_connection.15cca581.js";import{u as A}from"./data_caches.e9d63034.js";import{P as $}from"./ProfilePimsDetailForm.351a03fe.js";import"./axios.6e1fcf85.js";const w=y({name:"ProfilePimsDetailDialogComponent",components:{ProfilePimsDetailForm:$},setup(){},data(){return{enterpimsdialog:{visible:!1}}},methods:{launch_dialog(){this.enterpimsdialog.visible=!0;const e=this;setTimeout(function(){e.$refs.ProfilePimsDetailForm.blank_data()},10)},enterpimsdialogclick(){this.enterpimsdialog.visible=!1}}});function N(e,o,s,u,g,v){const a=k("ProfilePimsDetailForm");return l(),n("div",null,[t(S,{modelValue:e.enterpimsdialog.visible,"onUpdate:modelValue":o[0]||(o[0]=_=>e.enterpimsdialog.visible=_),persistent:""},{default:I(()=>[t(a,{ref:"ProfilePimsDetailForm",onProcess_done:e.enterpimsdialogclick,onClick_cancel:e.enterpimsdialogclick},null,8,["onProcess_done","onClick_cancel"])]),_:1},8,["modelValue"])])}var F=b(w,[["render",N]]);const L=y({name:"ProfilePageApiKeys",setup(){return{backend_connection_store:D()}},components:{},data(){return{}},computed:{user_profile(){return this.backend_connection_store.user_profile}},methods:{delete_apikey(e){const o=this,s={ok:o.delapikey_successcallback,error:o.delapikey_failcallback},u={name:e.name};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/apikey",method:"DELETE",data:u,callback:s})},copy_apikey(e){const o={ok:function(s){c.create({color:"bg-grey-2",message:"API key copied to clipboard",timeout:2e3})},error:function(s){c.create({color:"negative",message:"Copy failed",timeout:2e3})}};E.copyTextToClipboard2(e.apikey,o)},expires_string(e){return new Date(e).toDateString()},get_last_used_string(e){return e===""?"Never":"SS"+e},clickhelp(){this.$q.dialog({title:"API Keys",message:"API Keys allow for integrations with other systems.",html:!0}).onOk(()=>{})},addapikey(){const e=this;this.$q.dialog({title:"Create API Key",message:"Enter the name for this API key",html:!1,ok:{push:!0,label:"Ok",color:"primary"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(o=>{if(o.length<1){c.create({color:"negative",message:"You must specify a name for the apikey",timeout:2e3});return}const s={ok:e.addapikey_successcallback,error:e.addapikey_failcallback},u={name:o};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/apikey",method:"POST",data:u,callback:s})})},addapikey_successcallback(e){this.backend_connection_store.update_user_profile({user_profile:e.data.user_profile,then:void 0})},addapikey_failcallback(e){c.create({color:"negative",message:"Api key creation failed - "+e,timeout:2e3})},delapikey_successcallback(e){this.backend_connection_store.update_user_profile({user_profile:e.data.user_profile,then:void 0})},delapikey_failcallback(e){c.create({color:"negative",message:"Api key deletion failed - "+e,timeout:2e3})}}}),V={class:"profileapikeys-main"},O=i("thead",null,[i("tr",null,[i("th",null,"Name"),i("th",null,"Last Used"),i("th",null,"Expires"),i("th")])],-1);function R(e,o,s,u,g,v){return l(),n("div",V,[i("h4",null,[r("API Keys"),t(p,{round:"",dense:"",flat:"",icon:"info",onClick:e.clickhelp},null,8,["onClick"])]),i("table",null,[O,i("tbody",null,[(l(!0),n(C,null,T(e.user_profile.apikeys,a=>(l(),n("tr",{key:a.id},[i("td",null,d(a.name),1),i("td",null,d(e.get_last_used_string(a.last_used)),1),i("td",null,d(e.expires_string(a.expires)),1),i("td",null,[t(p,{round:"",dense:"",flat:"",icon:"content_copy",onClick:_=>e.copy_apikey(a)},null,8,["onClick"]),t(p,{round:"",dense:"",flat:"",icon:"delete",onClick:_=>e.delete_apikey(a)},null,8,["onClick"])])]))),128))])]),t(p,{class:"profileapikeys-bottom-button",onClick:e.addapikey,color:"secondary",label:"Add API Key"},null,8,["onClick"])])}var K=b(L,[["render",R]]);const x=y({name:"ProfilePage",setup(){const e=D(),o=A();return{backend_connection_store:e,dataCachesStore:o}},components:{ProfilePimsDetailDialog:F,ProfileApiKeys:K},data(){return{}},computed:{isLoggedin(){return this.backend_connection_store.isLoggedin},user_profile(){return this.backend_connection_store.user_profile},pimsverfiylink(){const e=window.location.origin+"/#/v/"+this.user_profile.pims.verify_code+"/"+this.user_profile.pims.number;return"Robert - Please verify my PIMS "+this.user_profile.pims.first_name+"/"+this.user_profile.pims.last_name+" ("+this.user_profile.pims.number+') <a href="'+e+'" target="_new">'+e+"</a>"},security_role_cansave(){return this.backend_connection_store.security_role_cansave}},methods:{clickcopypimsverfiylink(){const e=this,o={ok:function(s){c.create({color:"bg-grey-2",message:"Copied text to clipboard "+e.pimsverfiylink,timeout:2e3})},error:function(s){c.create({color:"negative",message:"Copy to clipboard failed",timeout:2e3})}};E.copyTextToClipboard2(this.pimsverfiylink,o)},logout(){this.dataCachesStore.reset(),this.backend_connection_store.logout(),this.$router.push("/tools")},clickenterpimsinformation(){this.$refs.ProfilePimsDetailDialog.launch_dialog()},pimsinfo(){const e=this;let o="Enter PIMS details",s="Extra site features are available to users who have a verified PIMS membership.";this.user_profile.pims.state==="WAITINGVERIFICATION"&&(o="Change PIMS details"),this.user_profile.pims.state==="VERIFIED"&&(o="Change PIMS details",s="WARNING - you are already a verified PIMS member. Changing the details will result in resetting the verification process. You will <b>temporarily lose access</b> to your projects until you are successfully reverified."),this.$q.dialog({title:"PIMS Membership Details",message:s,html:!0,ok:{push:!0,label:o,color:"secondary"},cancel:{push:!0,label:"Close",color:"primary"}}).onOk(()=>{e.clickenterpimsinformation()})},deleteaccount(){const e=this;this.$q.dialog({title:"Delete Account",message:"Deleting your account will wipe all your user data from our system. This inclues all saved projects. Are you sure? (Type DELETE below to confirm)<br>Account Username: "+this.user_profile.name+"<br>Account Email: "+this.user_profile.email,html:!0,ok:{push:!0,label:"Delete",color:"red"},cancel:{push:!0,label:"Cancel",color:"primary"},prompt:{model:"",type:"text"}}).onOk(o=>{if(o.trim()!=="DELETE"){c.create({color:"red",message:"Failed - You must type DELETE in the text box",timeout:2e3});return}const s={ok:function(u){e.logout(),c.create({color:"bg-grey-2",message:"User account deleted",timeout:2e3})},error:function(u){c.create({color:"bg-grey-2",message:"Account deletion failed "+u,timeout:2e3})}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/me/delete",method:"GET",data:o,callback:s})})}},mounted(){this.isLoggedin||this.$router.push("/tools")}}),U={rows:""},B=i("h3",{style:{margin:"0px"}},"User Profile",-1),z={key:0,class:"notice"},Q=i("h4",null,"Details",-1),j={class:"section"},q={class:"section"},G={key:0},W=i("div",null,"PIMS Membership details not entered - Extra site features are available to Academy/PIMS members.",-1),Y={align:"center"},H={key:1},J=i("div",null,[r("PIMS details entered but not verified. To verify please send a message in the Samuel Social. Search for me (Robert Metcalf) or click "),i("a",{href:"https://groupchat.samuelleeds.com/members/d185549c/",target:"_new"},"here to open my profile"),r(". "),i("br"),r("Send me a message with the following text:")],-1),X=["innerHTML"],Z=i("p",null,"While you are there feel free to say hi!",-1),ee={key:2},ie=i("div",null,[i("h5",null,"PIMS member")],-1),oe={key:3},te=i("div",null,"Extra site features are available to Academy/PIMS members. PIMS Membership details verification failed",-1),se={align:"center"},le={class:"bottom-buttons"},re={class:"profile-delete-account-button-section"},ne=i("div",null,"This option will wipe all your data from our servers. This includes personal data and all the patches, projects, etc. you have stored. Once completed it is not recoverable and if you want to use the system again you need to sign up again.",-1);function ae(e,o,s,u,g,v){const a=k("ProfileApiKeys"),_=k("ProfilePimsDetailDialog");return l(),P(M,{class:"flex flex-center"},{default:I(()=>[i("div",U,[B,e.user_profile.pims.state!=="VERIFIED"?(l(),n("div",z,[t(m,{name:"info",size:"md",color:"green"}),r(" Enter and verify your PIMS membership details to activate Property Pipeline Builder early access.")])):f("",!0),Q,i("div",j,[i("div",null,"User: "+d(e.user_profile.name),1),i("div",null,"Email: "+d(e.user_profile.email),1),i("div",null,[r("Roles: "),i("ul",null,[(l(!0),n(C,null,T(e.user_profile.roles,h=>(l(),n("div",{key:h},[i("li",null,d(h),1)]))),128))])])]),i("div",q,[i("h4",null,[r("PIMS Membership "),t(p,{round:"",dense:"",flat:"",icon:"info",onClick:e.pimsinfo},null,8,["onClick"])]),e.user_profile.pims.state==="NOTENTERED"?(l(),n("div",G,[W,i("div",Y,[t(p,{label:"Enter PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[r("PIMS Membership verified: "),t(m,{name:"cancel",color:"red",size:"32px"})])])):f("",!0),e.user_profile.pims.state==="WAITINGVERIFICATION"?(l(),n("div",H,[J,i("div",{class:"pimstext",onClick:o[0]||(o[0]=(...h)=>e.clickcopypimsverfiylink&&e.clickcopypimsverfiylink(...h))},[i("div",{innerHTML:e.pimsverfiylink},null,8,X),r("\xA0 "),t(m,{class:"float-right",name:"content_copy",size:"16px"})]),Z,i("div",null,[r("PIMS Membership verified: "),t(m,{name:"cancel",color:"red",size:"32px"})])])):f("",!0),e.user_profile.pims.state==="VERIFIED"?(l(),n("div",ee,[ie,i("div",null,d(e.user_profile.pims.first_name)+" "+d(e.user_profile.pims.last_name)+" - PIMS number "+d(e.user_profile.pims.number),1),i("div",null,[r("PIMS Membership verified: "),t(m,{name:"check_box",color:"green",size:"32px"})])])):f("",!0),e.user_profile.pims.state==="VERIFICATIONFAILED"?(l(),n("div",oe,[te,i("div",se,[t(p,{label:"Retry entering PIMS information",color:"primary",onClick:e.clickenterpimsinformation},null,8,["onClick"])]),i("div",null,[r("PIMS Membership verified: "),t(m,{name:"cancel",color:"red",size:"32px"})])])):f("",!0),e.security_role_cansave?(l(),P(a,{key:4})):f("",!0)]),i("div",le,[t(p,{class:"bottom-button",onClick:e.logout,color:"secondary",label:"Logout"},null,8,["onClick"])]),i("div",re,[ne,t(p,{class:"bottom-button",onClick:e.deleteaccount,color:"red",label:"Delete my account"},null,8,["onClick"])])]),t(_,{ref:"ProfilePimsDetailDialog"},null,512)]),_:1})}var _e=b(x,[["render",ae]]);export{_e as default};

import{d as b,_ as v,r as y,o as c,g as p,e as h,a as d,w as f,f as x,t as $,ad as T,a7 as P,aq as m,N as z,c as I,ae as C}from"./index.1e9114d3.js";import{Q as V}from"./QPage.4e0dd9b8.js";import{u as B}from"./backend_connection.7f1d2b37.js";import{b as L,Q as N}from"./QTable.5c1a34cc.js";import{Q}from"./QTr.68c91536.js";import{C as W}from"./CommonBRRToolLink.75674807.js";import{c as E,z as A}from"./zoom.2619b28f.js";import"./axios.6e1fcf85.js";import"./QItemLabel.b0774ebf.js";import"./position-engine.712071f4.js";const D=b({name:"ToolsCansavePatchePage",props:["patch_data_projects"],components:{CommonBRRToolLink:W},setup(){return{backend_connection_store:B()}},data(){return{rows:[],filter:"",columns:[{name:"address",required:!0,label:"Address",align:"left",field:"address",sortable:!0}]}},computed:{user_profile(){return this.backend_connection_store.user_profile}},methods:{onRowClick(e){this.$router.push("/tools/brrcalc?projectid="+e.id)},recursive_load_project_details(){const e=this.rows.filter(function(r){return r.loaded===!1});if(e.length===0)return;const a=e[0],o=this,t={ok:function(r){a.loaded=!0,a.address=r.data.sub_section_details.dealbasicinfo.address,o.recursive_load_project_details()},error:function(r){a.loaded=!0,a.address="TODO LOAD FAIL",o.recursive_load_project_details()}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/projects/"+a.id,method:"GET",data:void 0,callback:t})}},mounted(){this.rows=this.patch_data_projects.map(function(e){return{id:e,loaded:!1,address:"loading..."}}),this.recursive_load_project_details()}}),S={class:"q-pa-md"},j={key:0},U={key:1};function q(e,a,o,t,r,n){const i=y("CommonBRRToolLink");return c(),p("div",null,[h("div",S,[d(N,{flat:"",bordered:"",title:"Projects",rows:e.rows,columns:e.columns,filter:e.filter,"no-data-label":"I didn't find anything for you","no-results-label":"The filter didn't uncover any results","row-key":"name"},{body:f(s=>[d(Q,{props:s,onClick:l=>e.onRowClick(s.row)},{default:f(()=>[d(L,{key:"address",props:s},{default:f(()=>[x($(s.row.address),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),"top-right":f(()=>[d(T,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":a[0]||(a[0]=s=>e.filter=s),clearable:"",placeholder:"Search"},{append:f(()=>[d(P,{name:"search"})]),_:1},8,["modelValue"])]),"no-data":f(({})=>[h("div",null,[e.rows.length===0?(c(),p("div",j,[x(" No projects in this patch - use the BRR calculator to create one "),d(i)])):m("",!0),e.rows.length!==0?(c(),p("div",U," No projects match the filter ")):m("",!0)])]),_:1},8,["rows","columns","filter"])])])}var F=v(D,[["render",q]]),G={id:1,name:"BRR Project Workflow",initial_stage:"1",stages:{1:{name:"Lead",progression:{failed:"1.1",success:[{next_stage:"2"}]},diagram_notes:"Identify profitable strategy<BR>Find on Streetview<BR>Identify full address"},"1.1":{name:"Rejected Lead"},2:{name:"Potential",progression:{failed:"2.1",success:[{next_stage:"3"}]},diagram_notes:"Phone Agent<BR>Is peoperty still available<BR>What is sellers situation"},"2.1":{name:"Rejected Lead"},3:{name:"Viewing Booked",progression:{success:[{next_stage:"4"}]},diagram_notes:"Property Condition<BR>Identify Show stoppers<BR>Estimate Refurb cost<BR>Evaluate potential"},4:{name:"Viewed",progression:{failed:"4.1",success:[{next_stage:"5"}]},diagram_notes:"Market Comparable<BR>Refurb cost<BR>Identify offer price<BR>Make offer"},"4.1":{name:"Unviable"},5:{name:"Offer made",progression:{success:[{next_stage:"6"},{next_stage:"7"}]},diagram_notes:"Negotiation"},6:{name:"Rejected offer",draw_col:1,progression:{success:[{next_stage:"7"}]}},7:{name:"Accepted offer"}}};function M(e,a,o){const t={items_drawn:{},cols:[-300,200,500]};w(e,a.initial_stage,a.stages[a.initial_stage],t,a,200,!1,o)}const _=130,g=400;function H(e,a,o){let t=0;return o?t=2:typeof e.draw_col!="undefined"&&(t=e.draw_col),a.cols[t]}function w(e,a,o,t,r,n,i,s){if(Object.keys(t.items_drawn).includes(a))return;const l=H(o,t,i),k=e.append("g").attr("transform","translate( "+l+" "+n+")");t.items_drawn[a]={pos_x:l,pos_y:n},X(k,a,o,i,s),typeof o.progression!="undefined"&&(typeof o.progression.failed!="undefined"&&(w(e,o.progression.failed,r.stages[o.progression.failed],t,r,n+150,!0,s),R(e,l,n+_,t.cols[2]-g/2,n+150+_/2)),typeof o.progression.success!="undefined"&&o.progression.success.forEach(function(u){w(e,u.next_stage,r.stages[u.next_stage],t,r,n+300,!1,s),R(e,l,n+_,t.items_drawn[u.next_stage].pos_x,t.items_drawn[u.next_stage].pos_y)}))}function R(e,a,o,t,r){e.append("line").attr("x1",a).attr("y1",o).attr("x2",t).attr("y2",r).attr("stroke","black").attr("style","stroke-width:10;").attr("marker-end","url(#triangle)")}function X(e,a,o,t,r){const n=e.append("g");let i="lightgreen";t&&(i="pink");function s(){r(a,o)}if(n.append("rect").attr("width",g).attr("height",_).attr("x",-(g/2)).attr("y",0).attr("style","fill: "+i+";stroke-width:3;stroke:rgb(0,0,0)").on("click",s),n.append("text").attr("x",0).attr("y",50).attr("text-anchor","middle").style("font-size","28px").style("font-weight","500").text(o.name),n.append("text").attr("x",0).attr("y",110).attr("text-anchor","middle").style("font-size","56px").style("font-weight","500").text("0"),typeof o.diagram_notes!="undefined"){let l=0;o.diagram_notes.split("<BR>").forEach(function(k){n.append("text").attr("x",-(g/2+20)).attr("y",l).attr("text-anchor","end").attr("alignment-baseline","text-before-edge").style("font-size","24px").style("font-weight","500").text(k),l=l+30})}}const Y=b({name:"WorkflowChart",props:["patch_data"],emits:["onclickstage"],data(){return{allzoomedelements:void 0,boudaryRect:void 0,svg:void 0,background_item_group:void 0,chartarea:{xmin:-950,xmax:950,ymin:-150,ymax:2300}}},computed:{workflow(){return G}},methods:{initChart(){for(var e=this,a=function(t){var r=800,n=800;t.svg=E("svg").attr("style","border: 1px solid black;position:fixed; top:0; left:0; height:100%; width:100%").attr("viewBox",[-r/2,-n/2,r,n]).attr("oncontextmenu","return false;"),t.allzoomedelements=t.svg.append("g"),e.boudaryRect=t.allzoomedelements.append("rect").attr("width",t.chartarea.xmax-t.chartarea.xmin).attr("height",t.chartarea.ymax-t.chartarea.ymin).attr("x",t.chartarea.xmin).attr("y",t.chartarea.ymin).attr("style","fill: white;stroke-width:3;stroke:rgb(0,0,0)"),t.svg.call(A().extent([[0,0],[r,n]]).scaleExtent([-5,10]).on("zoom",i)),t.svg.on("dblclick.zoom",null);function i(s,l){t.allzoomedelements.attr("transform",s.transform)}return t.allzoomedelements.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("x",0).attr("y",-70).attr("style","font-size: 60px; font-weight: 800;").text(s=>e.workflow.name),t.allzoomedelements.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("x",0).attr("y",-0).attr("style","font-size: 50px; font-weight: 300;").text(s=>"Projects for patch "+e.patch_data.name),t.allzoomedelements.append("text").attr("text-anchor","middle").attr("alignment-baseline","central").attr("x",0).attr("y",60).attr("style","font-size: 40px; font-weight: 300;").text(s=>"(Note: Diagram only - workflows not yet implemented)"),t.svg.node()},o=document.getElementById("chartInsetionPoint_workflowchart");o.firstChild;)console.log("Removing old SVG"),o.removeChild(o.firstChild);o.appendChild(a(this)),this.svg.append("marker").attr("id","triangle").attr("viewBox","0 0 10 10").attr("refX","8").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","4").attr("orient","auto").attr("fill","black").append("path").attr("d","M 0 0 L 10 5 L 0 10 z"),M(this.allzoomedelements,this.workflow,this.click_stage_callback)},click_stage_callback(e,a){this.$emit("onclickstage",e,a),console.log("clicked on stage",e,a)},clickDIV(){}},mounted(){this.initChart()}});function J(e,a,o,t,r,n){return c(),p("div",{id:"chartInsetionPoint_workflowchart",onClick:a[0]||(a[0]=i=>e.clickDIV(i))})}var K=v(Y,[["render",J]]);const Z=b({name:"ToolsCansavePatchePage",components:{ProjectTable:F,WrokflowChart:K},setup(){return{backend_connection_store:B()}},data(){return{loaded:!1,patch_data:{},table_view:!0}},computed:{user_profile(){return this.backend_connection_store.user_profile}},methods:{onchartclickstage(e,a){console.log("clicked onchartclickstage",e,a),this.table_view=!0},clicknewproject(){this.$router.push("/tools/brrcalc?patchid="+this.$route.params.patchid)},click_brrr_card(){this.$router.push("/tools/brrcalc")},refresh(){const e=this,a={ok:e.refresh_success,error:function(o){z.create({color:"negative",message:"Failed to find patch information",timeout:2e3}),e.$router.push("/tools/cansave/patches")}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:"/patches/"+e.$route.params.patchid,method:"GET",data:void 0,callback:a})},refresh_success(e){this.patch_data=e.data,this.loaded=!0}},mounted(){this.loaded=!1,this.refresh()}}),O={key:0},ee=h("h1",null,"Loading...",-1),te=[ee],ae={key:1},oe={key:0},re={key:1};function ne(e,a,o,t,r,n){const i=y("ProjectTable"),s=y("WrokflowChart");return c(),I(V,{class:"flex flex-center"},{default:f(()=>[e.loaded?m("",!0):(c(),p("div",O,te)),e.loaded?(c(),p("div",ae,[e.table_view?(c(),p("div",oe,[h("h1",null,$(e.patch_data.name),1),h("h2",null,[x("Projects "),d(C,{color:"primary",icon:"account_tree",label:"Worlflow",onClick:a[0]||(a[0]=l=>e.table_view=!1)})]),h("div",null,[d(i,{patch_data_projects:e.patch_data.projects},null,8,["patch_data_projects"])]),d(C,{color:"primary",label:"Add Project",onClick:e.clicknewproject},null,8,["onClick"])])):m("",!0),e.table_view?m("",!0):(c(),p("div",re,[d(s,{patch_data:e.patch_data,onOnclickstage:e.onchartclickstage},null,8,["patch_data","onOnclickstage"])]))])):m("",!0)]),_:1})}var _e=v(Z,[["render",ne]]);export{_e as default};

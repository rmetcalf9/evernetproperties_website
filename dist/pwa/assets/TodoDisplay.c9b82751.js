import{d as k,N as v,_ as g,r as b,o as n,K as r,L as _,e as l,f as h,a as p,au as T,M as c,O as f,t as y,Q as j}from"./index.de212354.js";import{u as w}from"./backend_connection.43b04ba5.js";import{T as D}from"./TodoItem.abcb3a90.js";import{W as C}from"./Workflow_main.512fc34f.js";import{u as N}from"./utils.99aafcb0.js";const U=k({name:"TodoDisplayComponent",props:{patch_id:{type:String,default:void 0}},components:{TodoItem:D},setup(){return{backend_connection_store:w()}},data(){return{show_only_active:!0,loaded:!1,loaded_todo_data:void 0,group_by:"group",group_by_options:[{label:"None",value:"none"},{label:"Group",value:"group"},{label:"Project",value:"project"}]}},computed:{display_groups(){const e=this;let d=[],t={"":{name:"",link_url:void 0,filter:void 0}};return this.group_by==="none"?t[""]={name:"",filter:function(o){return!0}}:this.loaded_todo_data.forEach(function(o){e.group_by==="group"&&(t[o.group]={name:o.group,link_url:void 0,filter:function(s){return s.group===o.group}}),e.group_by==="project"&&(t[o.project_name]={name:o.project_name,link_url:"/tools/brrcalc?projectid="+o.project_id,filter:function(s){return s.project_id===o.project_id}})}),Object.keys(t).map(function(o){if(typeof t[o].filter!="undefined"){let s=t[o].name;s===""&&(s="Ungrouped"),d.push({name:s,link_url:t[o].link_url,due_items:e.loaded_todo_data.filter(t[o].filter).filter(function(u){return u.due}),nondue_items:e.loaded_todo_data.filter(t[o].filter).filter(function(u){return!u.due})})}}),d}},methods:{refresh(){const e=this;let d="/me/todos?done=false";typeof this.patch_id!="undefined"&&(d="/me/todos?done=false&patch_id="+this.patch_id);const t={ok:e.refresh_success,error:function(o){v.create({color:"negative",message:"Failed to load todos",timeout:2e3}),e.$router.push("/tools")}};this.backend_connection_store.call_api({apiprefix:"privateUserAPIPrefix",url:d,method:"GET",data:void 0,callback:t})},refresh_success(e){const d=this;this.loaded_todo_data=e.data.todos.filter(function(t){return d.show_only_active?N.boolean_undefined_to_false(C.workflows[t.project_workflow.workflow_used_id].stages[t.project_workflow.current_stage].active):!0}),this.loaded=!0}},mounted(){this.loaded=!1,this.refresh()}}),V={class:"tododisplayclass"},$={key:0},B=l("h1",null,"Loading...",-1),G=[B],I={key:1},E={class:"flex"},L={key:0},O={key:1},P={class:"row"};function Q(e,d,t,o,s,u){const m=b("TodoItem");return n(),r("div",V,[e.loaded?_("",!0):(n(),r("div",$,G)),e.loaded?(n(),r("div",I,[l("div",null,[l("div",null,[l("div",E,[h("Group: "),p(T,{modelValue:e.group_by,"onUpdate:modelValue":d[0]||(d[0]=i=>e.group_by=i),options:e.group_by_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),(n(!0),r(c,null,f(e.display_groups,i=>(n(),r("div",{key:i.name},[typeof i.link_url=="undefined"?(n(),r("div",L,[l("h2",null,y(i.name),1)])):_("",!0),typeof i.link_url!="undefined"?(n(),r("div",O,[l("h2",null,[h(y(i.name)+" ",1),p(j,{color:"primary",icon:"arrow_forward",onClick:a=>e.$router.push(i.link_url)},null,8,["onClick"])])])):_("",!0),l("div",P,[(n(!0),r(c,null,f(i.due_items,a=>(n(),r("div",{key:a.id},[p(m,{todo:a,include_project:e.group_by!="project",onUpdate_todo_item:e.refresh,onDelete_todo_item:e.refresh},null,8,["todo","include_project","onUpdate_todo_item","onDelete_todo_item"])]))),128)),(n(!0),r(c,null,f(i.nondue_items,a=>(n(),r("div",{key:a.id},[p(m,{todo:a,include_project:e.group_by!="project",onUpdate_todo_item:e.refresh,onDelete_todo_item:e.refresh},null,8,["todo","include_project","onUpdate_todo_item","onDelete_todo_item"])]))),128))])]))),128))])])):_("",!0)])}var M=g(U,[["render",Q]]);export{M as T};

import{d as m,j as Q,_ as f,o as s,K as l,a as o,Q as r,w as n,aa as C,ae as p,ak as S,e as i,af as g,ah as V,at as B,L as k,f as I,au as A,r as y,c as D,a9 as O,M as $,O as T,t as R}from"./index.461ae6f5.js";import{Q as j}from"./QSpace.2c7e751e.js";import{C as w}from"./ClosePopup.4beb1391.js";import{Q as q}from"./QSelect.547cddef.js";import{c as z}from"./common_constants.94b43302.js";import{u as L}from"./uuid.6153c38a.js";import{u as E}from"./backend_connection.493146bc.js";import{T as G}from"./TodoItem.fdb66716.js";const M=m({name:"BrrCalcToolbarCallSellingAgent",emits:["activity_log"],data(){return{dialog_visible:Q(!1),spoke_to:"",notes:""}},computed:{isDisabled(){return this.spoke_to.length<1||this.notes<3}},methods:{open_dialog(){this.dialog_visible=!0,this.spoke_to="",this.notes=""},click_selling_agent_btn(){const e={type:"call_agent",text:"Called selling agent spoke to ("+this.spoke_to+") - "+this.notes,head_notes:void 0};this.$emit("activity_log",e),this.dialog_visible=!1}}}),F={class:"brrcalctoolbar"},H=i("div",{class:"text-h6"},"Log call with selling agent",-1);function K(e,t,d,u,h,b){return s(),l("div",F,[o(r,{color:"primary",icon:"call",label:"Selling agent",onClick:e.open_dialog},null,8,["onClick"]),o(B,{modelValue:e.dialog_visible,"onUpdate:modelValue":t[3]||(t[3]=a=>e.dialog_visible=a)},{default:n(()=>[o(C,null,{default:n(()=>[o(p,{class:"row items-center q-pb-none"},{default:n(()=>[H,o(j),S(o(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[w]])]),_:1}),o(p,null,{default:n(()=>[i("div",null,[o(g,{filled:"",clearable:"",modelValue:e.spoke_to,"onUpdate:modelValue":t[0]||(t[0]=a=>e.spoke_to=a),label:"Spoke to",rules:[a=>a.length>2||"Too short"]},null,8,["modelValue","rules"])]),i("div",null,[o(g,{filled:"",autogrow:"",modelValue:e.notes,"onUpdate:modelValue":t[1]||(t[1]=a=>e.notes=a),label:"Notes",rules:[a=>a.length>2||"Too short"]},null,8,["modelValue","rules"])]),o(V,{align:"right",class:"text-primary"},{default:n(()=>[o(r,{label:"Cancel",onClick:t[2]||(t[2]=a=>this.dialog_visible=!1)}),o(r,{color:"primary",icon:"call",label:"Save",onClick:e.click_selling_agent_btn,disable:e.isDisabled},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var P=f(M,[["render",K]]);const J=m({name:"BrrCalcToolbarResearchCall",emits:["activity_log"],data(){return{dialog_visible:Q(!1),spoke_to:"",notes:""}},computed:{isDisabled(){return this.spoke_to.length<1||this.notes<3}},methods:{open_dialog(){this.dialog_visible=!0,this.spoke_to="",this.notes=""},click_selling_agent_btn(){const e={type:"research_call",text:"Research call with ("+this.spoke_to+") - "+this.notes,head_notes:void 0};this.$emit("activity_log",e),this.dialog_visible=!1}}}),W={class:"brrcalctoolbar"},X=i("div",{class:"text-h6"},"Log research call",-1);function Y(e,t,d,u,h,b){return s(),l("div",W,[o(r,{color:"primary",icon:"call",label:"Research",onClick:e.open_dialog},null,8,["onClick"]),o(B,{modelValue:e.dialog_visible,"onUpdate:modelValue":t[3]||(t[3]=a=>e.dialog_visible=a)},{default:n(()=>[o(C,null,{default:n(()=>[o(p,{class:"row items-center q-pb-none"},{default:n(()=>[X,o(j),S(o(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[w]])]),_:1}),o(p,null,{default:n(()=>[i("div",null,[o(g,{filled:"",clearable:"",modelValue:e.spoke_to,"onUpdate:modelValue":t[0]||(t[0]=a=>e.spoke_to=a),label:"Spoke to",rules:[a=>a.length>2||"Too short"]},null,8,["modelValue","rules"])]),i("div",null,[o(g,{filled:"",autogrow:"",modelValue:e.notes,"onUpdate:modelValue":t[1]||(t[1]=a=>e.notes=a),label:"Notes",rules:[a=>a.length>2||"Too short"]},null,8,["modelValue","rules"])]),o(V,{align:"right",class:"text-primary"},{default:n(()=>[o(r,{label:"Cancel",onClick:t[2]||(t[2]=a=>this.dialog_visible=!1)}),o(r,{color:"primary",icon:"call",label:"Save",onClick:e.click_selling_agent_btn,disable:e.isDisabled},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Z=f(J,[["render",Y]]);const x=2,ee=m({name:"BrrCalcToolbarSaveButton",props:["reason_project_not_savable"],emits:["saveproject"],data(){return{changed:!1,autosave_seconds_left:60,ever_saved:!1,save_in_progress:!1,save_monitor_function_running:!1,pending_set_changed:!1}},computed:{no_save_message(){return this.reason_project_not_savable!==""?this.reason_project_not_savable:this.save_in_progress?"Saving...":""},can_save(){return this.save_in_progress?!1:!!this.changed},save_btn_text(){return this.save_in_progress?"Saving...":this.no_save_message!==""?"Not able to save ("+this.no_save_message+")":this.changed?this.autosave_seconds_left===-1?"Save Now":"Save now (auto save in "+this.autosave_seconds_left+")":this.ever_saved?"Saved":"Not able to save (No changes)"},is_project_changed(){return this.changed}},methods:{serializer_load_data(e){this.ever_saved=!0},click_btn(){if(!!this.changed){if(this.no_save_message!==""){this.$q.dialog({title:"Not currently able to save",message:this.no_save_message,html:!0});return}this.autosave_seconds_left=-1,this.save_now()}},set_changed_true(){if(this.pending_set_changed){console.log("SaveButton.vue:set_changed_true - set changed called but there is already one pending");return}if(this.save_in_progress){console.log("SaveButton.vue:set_changed_true - Delay set changed due to save in progress");const e=this;setTimeout(function(){e.pending_set_changed=!1,e.set_changed_true()},1e3);return}this.changed=!0,this.no_save_message===""&&(this.autosave_seconds_left=x,this.start_save_monitor_function())},start_save_monitor_function(){this.save_monitor_function_running||this.save_monitor_function()},save_monitor_function(){if(this.save_monitor_function_running=!0,this.save_in_progress)return;if(this.autosave_seconds_left===-1){this.save_monitor_function_running=!1;return}const e=this;if(e.autosave_seconds_left=e.autosave_seconds_left-1,e.autosave_seconds_left<1){this.save_monitor_function_running=!1,this.save_now();return}setTimeout(e.save_monitor_function,1e3)},save_now(){!this.can_save||(this.save_in_progress=!0,this.$emit("saveproject"))},save_project_complete_notification({success:e,response:t}){console.log("SaveButton - Save completed notification recieved"),this.save_in_progress=!1,e?(this.changed=!1,this.ever_saved=!0):this.autosave_seconds_left=-1}}}),te={class:"brrcalctoolbar"};function oe(e,t,d,u,h,b){return s(),l("div",te,[o(r,{color:"primary",icon:"save",label:e.save_btn_text,onClick:e.click_btn},null,8,["label","onClick"])])}var ae=f(ee,[["render",oe]]);function U(){return{due:"1",description:"",type:"other",group:""}}const se=m({name:"BrrCalcToolbarTodoButton",emits:["createtodo"],data(){return{dialog_visible:!1,dialog_data:U(),type_options:z.todo_item_types,due_options:[{label:"1 Day",value:"1"},{label:"3 Days",value:"3"},{label:"5 Days",value:"5"}]}},computed:{isDisabled(){return!1}},methods:{open_dialog(){this.dialog_data=U(),this.dialog_visible=!0},click_ok(){if(this.$refs.field_description.validate(),this.$refs.field_description.hasError)return;let e=this.dialog_data.group;this.dialog_data.type==="agent"&&(e=""),this.dialog_data.type==="sourcer"&&(e="");const t=parseInt(this.dialog_data.due),d=new Date(new Date().getTime()+t*24*60*60*1e3),u={id:L(),weight:"100",due_date:d.toISOString(),description:this.dialog_data.description,done:!1,done_date:"",group:e,type:this.dialog_data.type,done_text:""};this.$emit("createtodo",u),this.dialog_visible=!1},helpgrouping(){this.$q.dialog({title:"Todo Item Grouping",message:"The grouping field can be left blank. It can be used to group todo items together in displays.",html:!1}).onOk(()=>{})}}}),le={class:"brrcalctoolbar-todobutton"},ne=i("div",{class:"text-h6"},"Log todo task for this project",-1),ie={class:"brrcalctoolbar-field"},re={key:0,class:"brrcalctoolbar-field col flex"},de={class:"brrcalctoolbar-field"},_e={class:"brrcalctoolbar-field"};function ue(e,t,d,u,h,b){return s(),l("div",le,[o(r,{color:"primary",icon:"rule",label:"Add TODO",onClick:e.open_dialog},null,8,["onClick"]),o(B,{modelValue:e.dialog_visible,"onUpdate:modelValue":t[5]||(t[5]=a=>e.dialog_visible=a)},{default:n(()=>[o(C,{class:"brrcalctoolbar-card"},{default:n(()=>[o(p,{class:"row items-center q-pb-none"},{default:n(()=>[ne,o(j),S(o(r,{icon:"close",flat:"",round:"",dense:""},null,512),[[w]])]),_:1}),o(p,null,{default:n(()=>[i("div",null,[i("div",ie,[o(q,{modelValue:e.dialog_data.type,"onUpdate:modelValue":t[0]||(t[0]=a=>e.dialog_data.type=a),options:e.type_options,label:"Type of Task","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e.dialog_data.type==="other"?(s(),l("div",re,[o(g,{modelValue:e.dialog_data.group,"onUpdate:modelValue":t[1]||(t[1]=a=>e.dialog_data.group=a),label:"Grouping",class:"col-grow"},null,8,["modelValue"]),o(r,{round:"",dense:"",flat:"",icon:"info",onClick:e.helpgrouping},null,8,["onClick"])])):k("",!0),i("div",de,[o(g,{modelValue:e.dialog_data.description,"onUpdate:modelValue":t[2]||(t[2]=a=>e.dialog_data.description=a),label:"Description",autogrow:"",rules:[a=>a.trim().length>3||"Minimum 4 characters"],ref:"field_description"},null,8,["modelValue","rules"])]),i("div",_e,[I("How long until it's due: "),o(A,{modelValue:e.dialog_data.due,"onUpdate:modelValue":t[3]||(t[3]=a=>e.dialog_data.due=a),options:e.due_options,color:"primary",inline:""},null,8,["modelValue","options"])])]),o(V,{align:"right",class:"text-primary"},{default:n(()=>[o(r,{label:"Cancel",onClick:t[4]||(t[4]=a=>this.dialog_visible=!1)}),o(r,{color:"primary",icon:"rule",label:"Ok",onClick:e.click_ok,disable:e.isDisabled},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var ce=f(se,[["render",ue]]);const pe=m({name:"BrrCalcToolbar",props:{reason_project_not_savable:{type:String},is_saved_project_with_id:{type:Boolean},is_rent_project:{type:Boolean,default:!1}},emits:["activity_log","saveproject","createtodo"],components:{CallSellingAgent:P,ResearchCall:Z,SaveButton:ae,TodoButton:ce},data(){return{}},computed:{ever_saved(){return this.$refs.SaveToolbar.ever_saved},is_project_changed(){return this.$refs.SaveToolbar.is_project_changed}},methods:{click_save_btn(){this.$refs.SaveToolbar.click_btn()},set_changed_true(){this.$refs.SaveToolbar.set_changed_true()},save_project_complete_notification(e){this.$refs.SaveToolbar.save_project_complete_notification(e)},serializer_load_data(e){this.$refs.SaveToolbar.serializer_load_data(e)}}}),ve={class:"row brrcalctoolbar"};function ge(e,t,d,u,h,b){const a=y("SaveButton"),_=y("CallSellingAgent"),c=y("ResearchCall"),N=y("TodoButton");return s(),l("div",ve,[o(a,{ref:"SaveToolbar",onSaveproject:t[0]||(t[0]=v=>e.$emit("saveproject")),reason_project_not_savable:e.reason_project_not_savable},null,8,["reason_project_not_savable"]),e.is_rent_project?k("",!0):(s(),D(_,{key:0,onActivity_log:t[1]||(t[1]=v=>e.$emit("activity_log",v))})),o(c,{onActivity_log:t[2]||(t[2]=v=>e.$emit("activity_log",v))}),e.is_saved_project_with_id?(s(),D(N,{key:1,onCreatetodo:t[3]||(t[3]=v=>e.$emit("createtodo",v))})):k("",!0)])}var Ue=f(pe,[["render",ge]]);const me=m({name:"BrrCalcTodos",components:{TodoItem:G},setup(){return{backend_connection_store:E()}},data(){return{todos:[]}},computed:{todo_groups(){let e={"":!0};return this.todos.forEach(function(t){e[t.group]=!0}),e},done_todos(){return this.todos.filter(function(e){return e.done===!0})}},methods:{due_todos(e){return this.todos.filter(function(t){return t.group===e&&t.done===!1&&t.due===!0})},notdone_todos(e){return this.todos.filter(function(t){return t.group===e&&t.done===!1&&t.due===!1})},serializer_load_data(e){this.todos=e},add_single_todo(e){this.todos.push(e)},update_todo_item(e){const t=this;t.todos=t.todos.map(function(d){return d.id==e.id&&(d=e),d})},delete_todo_item(e){const t=this;t.todos=t.todos.filter(function(d){return d.id!==e})}}}),fe={class:"text-h6 todos-card-head"},he={style:{width:"100%","max-width":"400px"}},be={key:0},ye={key:0,class:"todos-grouptitle"},ke=i("div",null,"Completed Items",-1);function $e(e,t,d,u,h,b){const a=y("TodoItem");return s(),l("div",null,[o(C,{inline:"",class:"q-ma-sm card-style featurecard col-grow"},{default:n(()=>[o(p,null,{default:n(()=>[i("div",fe,[o(O,{name:"rule",size:"30px"}),I(" Todo Items")]),i("div",he,[(s(!0),l($,null,T(Object.keys(e.todo_groups),_=>(s(),l("div",{key:_},[e.due_todos(_).length+e.notdone_todos(_).length>0?(s(),l("div",be,[_!==""?(s(),l("div",ye,R(_),1)):k("",!0),i("div",null,[(s(!0),l($,null,T(e.due_todos(_),c=>(s(),l("div",{key:c.id},[o(a,{todo:c,onUpdate_todo_item:e.update_todo_item,onDelete_todo_item:e.delete_todo_item},null,8,["todo","onUpdate_todo_item","onDelete_todo_item"])]))),128)),(s(!0),l($,null,T(e.notdone_todos(_),c=>(s(),l("div",{key:c.id},[o(a,{todo:c,onUpdate_todo_item:e.update_todo_item,onDelete_todo_item:e.delete_todo_item},null,8,["todo","onUpdate_todo_item","onDelete_todo_item"])]))),128))])])):k("",!0)]))),128)),i("div",null,[ke,(s(!0),l($,null,T(e.done_todos,_=>(s(),l("div",{key:_.id},[o(a,{todo:_,onUpdate_todo_item:e.update_todo_item,onDelete_todo_item:e.delete_todo_item},null,8,["todo","onUpdate_todo_item","onDelete_todo_item"])]))),128))])])]),_:1})]),_:1})])}var Qe=f(me,[["render",$e]]);export{Ue as B,Qe as T};
